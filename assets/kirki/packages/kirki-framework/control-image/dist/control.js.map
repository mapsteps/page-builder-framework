{"mappings":"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","sources":["src/control.js"],"sourcesContent":["wp.customize.controlConstructor['kirki-image'] = wp.customize.kirkiDynamicControl.extend( {\r\n\r\n\tinitKirkiControl: function( control ) {\r\n\t\tvar value, saveAs, preview, previewImage, removeButton, defaultButton;\r\n\t\tcontrol       = control || this;\r\n\t\tvalue         = control.setting._value;\r\n\t\tsaveAs        = ( ! _.isUndefined( control.params.choices ) && ! _.isUndefined( control.params.choices.save_as ) ) ? control.params.choices.save_as : 'url';\r\n\t\tpreview       = control.container.find( '.placeholder, .thumbnail' );\r\n\t\tpreviewImage  = ( 'array' === saveAs ) ? value.url : value;\r\n\t\tremoveButton  = control.container.find( '.image-upload-remove-button' );\r\n\t\tdefaultButton = control.container.find( '.image-default-button' );\r\n\r\n\t\t// Make sure value is properly formatted.\r\n\t\tvalue = ( 'array' === saveAs && _.isString( value ) ) ? { url: value } : value;\r\n\r\n\t\t// Tweaks for save_as = id.\r\n\t\tif ( ( 'id' === saveAs || 'ID' === saveAs ) && '' !== value ) {\r\n\t\t\twp.media.attachment( value ).fetch().then( function() {\r\n\t\t\t\tsetTimeout( function() {\r\n\t\t\t\t\tvar url = wp.media.attachment( value ).get( 'url' );\r\n\t\t\t\t\tpreview.removeClass().addClass( 'thumbnail thumbnail-image' ).html( '<img src=\"' + url + '\" alt=\"\" />' );\r\n\t\t\t\t}, 700 );\r\n\t\t\t} );\r\n\t\t}\r\n\r\n\t\t// If value is not empty, hide the \"default\" button.\r\n\t\tif ( ( 'url' === saveAs && '' !== value ) || ( 'array' === saveAs && ! _.isUndefined( value.url ) && '' !== value.url ) ) {\r\n\t\t\tcontrol.container.find( 'image-default-button' ).hide();\r\n\t\t}\r\n\r\n\t\t// If value is empty, hide the \"remove\" button.\r\n\t\tif ( ( 'url' === saveAs && '' === value ) || ( 'array' === saveAs && ( _.isUndefined( value.url ) || '' === value.url ) ) ) {\r\n\t\t\tremoveButton.hide();\r\n\t\t}\r\n\r\n\t\t// If value is default, hide the default button.\r\n\t\tif ( value === control.params.default ) {\r\n\t\t\tcontrol.container.find( 'image-default-button' ).hide();\r\n\t\t}\r\n\r\n\t\tif ( '' !== previewImage ) {\r\n\t\t\tpreview.removeClass().addClass( 'thumbnail thumbnail-image' ).html( '<img src=\"' + previewImage + '\" alt=\"\" />' );\r\n\t\t}\r\n\r\n\t\tcontrol.container.on( 'click', '.image-upload-button', function( e ) {\r\n\t\t\tvar image = wp.media( { multiple: false } ).open().on( 'select', function() {\r\n\r\n\t\t\t\t// This will return the selected image from the Media Uploader, the result is an object.\r\n\t\t\t\tvar uploadedImage = image.state().get( 'selection' ).first(),\r\n\t\t\t\t\tjsonImg       = uploadedImage.toJSON();\r\n\r\n\t\t\t\tpreviewImage  = jsonImg.url;\r\n\r\n\t\t\t\tif ( ! _.isUndefined( jsonImg.sizes ) ) {\r\n\t\t\t\t\tpreviewImage = jsonImg.sizes.full.url;\r\n\t\t\t\t\tif ( ! _.isUndefined( jsonImg.sizes.medium ) ) {\r\n\t\t\t\t\t\tpreviewImage = jsonImg.sizes.medium.url;\r\n\t\t\t\t\t} else if ( ! _.isUndefined( jsonImg.sizes.thumbnail ) ) {\r\n\t\t\t\t\t\tpreviewImage = jsonImg.sizes.thumbnail.url;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( 'array' === saveAs ) {\r\n\t\t\t\t\tcontrol.setting.set( {\r\n\t\t\t\t\t\tid: jsonImg.id,\r\n\t\t\t\t\t\turl: jsonImg.sizes.full.url,\r\n\t\t\t\t\t\twidth: jsonImg.width,\r\n\t\t\t\t\t\theight: jsonImg.height\r\n\t\t\t\t\t} );\r\n\t\t\t\t} else if ( 'id' === saveAs ) {\r\n\t\t\t\t\tcontrol.setting.set( jsonImg.id );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontrol.setting.set( ( ! _.isUndefined( jsonImg.sizes ) ) ? jsonImg.sizes.full.url : jsonImg.url );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( preview.length ) {\r\n\t\t\t\t\tpreview.removeClass().addClass( 'thumbnail thumbnail-image' ).html( '<img src=\"' + previewImage + '\" alt=\"\" />' );\r\n\t\t\t\t}\r\n\t\t\t\tif ( removeButton.length ) {\r\n\t\t\t\t\tremoveButton.show();\r\n\t\t\t\t\tdefaultButton.hide();\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\r\n\t\t\te.preventDefault();\r\n\t\t} );\r\n\r\n\t\tcontrol.container.on( 'click', '.image-upload-remove-button', function( e ) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tcontrol.setting.set( '' );\r\n\r\n\t\t\tpreview       = control.container.find( '.placeholder, .thumbnail' );\r\n\t\t\tremoveButton  = control.container.find( '.image-upload-remove-button' );\r\n\t\t\tdefaultButton = control.container.find( '.image-default-button' );\r\n\r\n\t\t\tif ( preview.length ) {\r\n\t\t\t\tpreview.removeClass().addClass( 'placeholder' ).html( wp.i18n.__( 'No image selected', 'kirki' ) );\r\n\t\t\t}\r\n\t\t\tif ( removeButton.length ) {\r\n\t\t\t\tremoveButton.hide();\r\n\t\t\t\tif ( jQuery( defaultButton ).hasClass( 'button' ) ) {\r\n\t\t\t\t\tdefaultButton.show();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\tcontrol.container.on( 'click', '.image-default-button', function( e ) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tcontrol.setting.set( control.params.default );\r\n\r\n\t\t\tpreview       = control.container.find( '.placeholder, .thumbnail' );\r\n\t\t\tremoveButton  = control.container.find( '.image-upload-remove-button' );\r\n\t\t\tdefaultButton = control.container.find( '.image-default-button' );\r\n\r\n\t\t\tif ( preview.length ) {\r\n\t\t\t\tpreview.removeClass().addClass( 'thumbnail thumbnail-image' ).html( '<img src=\"' + control.params.default + '\" alt=\"\" />' );\r\n\t\t\t}\r\n\t\t\tif ( removeButton.length ) {\r\n\t\t\t\tremoveButton.show();\r\n\t\t\t\tdefaultButton.hide();\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n} );\r\n"],"names":["wp","customize","controlConstructor","kirkiDynamicControl","extend","initKirkiControl","control","value","saveAs","preview","previewImage","removeButton","defaultButton","this","setting","_value","_","isUndefined","params","choices","save_as","container","find","url","isString","media","attachment","fetch","then","setTimeout","get","removeClass","addClass","html","hide","default","on","e","image","multiple","open","jsonImg","state","first","toJSON","sizes","full","medium","thumbnail","set","id","width","height","length","show","preventDefault","i18n","__","jQuery","hasClass"],"version":3,"file":"control.js.map"}