{"version":3,"file":"controls-bundle-min.js","sources":["../../Base/src/control-dependencies.ts","../../Base/src/tooltips.ts","../../Base/src/base-control.ts","../../../../assets/js/utils/dom-util.js","../../Responsive/src/responsive-control.ts","../../Checkbox/src/checkbox-control.ts","../../../../node_modules/.pnpm/colord@2.9.3/node_modules/colord/index.mjs","../../Color/src/components/ColorPickerSwatches.tsx","../../Generic/src/number-util.ts","../../Color/src/utils/misc.ts","../../Color/src/components/ColorPickerInput.tsx","../../Color/src/hooks/useFocusOutside.ts","../../Color/src/hooks/useClickOutside.ts","../../../../node_modules/.pnpm/react-colorful@5.6.1_react-_49b246a3ee1fb7a92c96bf645deb1c98/node_modules/react-colorful/dist/index.mjs","../../Color/src/components/ColorPickerComponent.tsx","../../Color/src/components/ColorPickerCircleTrigger.tsx","../../Color/src/components/ControlLabel.tsx","../../Color/src/components/ControlHeader.tsx","../../Color/src/utils/convert-color-for-input.ts","../../Color/src/utils/convert-color-for-picker.ts","../../Color/src/ColorForm.tsx","../../Color/src/hooks/useWindowResize.ts","../../../../node_modules/.pnpm/react-dom@18.3.1_react@18.3.1/node_modules/react-dom/client.js","../../Color/src/utils/convert-color-for-customizer.ts","../../Color/src/ColorControl.tsx","../../Color/src/MulticolorForm.tsx","../../Color/src/MulticolorControl.tsx","../../Generic/src/string-util.ts","../../Responsive/src/responsive-util.ts","../../MarginPadding/src/margin-padding-util.ts","../../Responsive/src/DeviceButtons.tsx","../../MarginPadding/src/MarginPaddingForm.tsx","../../MarginPadding/src/MarginPaddingControl.tsx","../../Color/src/color-control.ts","../../Dimension/src/dimension-control.ts","../../Editor/src/editor-control.ts","../../Generic/src/generic-control.ts","../../Generic/src/assoc-array-control.ts","../../Generic/src/responsive-generic-control.ts","../../MarginPadding/src/margin-padding-control.ts","../../Media/src/image-control.ts","../../Radio/src/radio-control.ts","../../Repeater/src/repeater-row.tsx","../../Select/src/shared-font-data-adapter.ts","../../Slider/src/SliderForm.tsx","../../Slider/src/slider-util.ts","../../Slider/src/InputSliderForm.tsx","../../Slider/src/ResponsiveInputSliderForm.tsx","../../Typography/src/typography-control.ts","../../Repeater/src/repeater-control.ts","../../Select/src/select-control.ts","../../Slider/src/slider-control.ts","../../Slider/src/SliderControl.tsx","../../Slider/src/input-slider-control.ts","../../Slider/src/InputSliderControl.tsx","../../Slider/src/responsive-input-slider-control.ts","../../Slider/src/ResponsiveInputSliderControl.tsx","../../Sortable/src/sortable-control.ts","../../Builder/src/builder-control.ts","../../Builder/src/responsive-builder-control.ts"],"sourcesContent":["import _ from \"lodash\";\r\nimport {\r\n\tWpbfControlDependencies,\r\n\tWpbfReversedControlDependencies,\r\n\tWpbfReversedControlDependency,\r\n} from \"./base-interface\";\r\n\r\nexport default function setupControlDependencies(\r\n\tglobalControlDependencies: WpbfControlDependencies,\r\n) {\r\n\tif (!window.wp.customize) return;\r\n\tconst reversedControlDependencies: WpbfReversedControlDependencies = {};\r\n\r\n\tfor (const dependantControlId in globalControlDependencies) {\r\n\t\tif (!globalControlDependencies.hasOwnProperty(dependantControlId)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst controlDependencies = globalControlDependencies[dependantControlId];\r\n\r\n\t\tfor (const dependency of controlDependencies) {\r\n\t\t\tlet dependencySettingId = dependency.setting;\r\n\r\n\t\t\t// Backwards compatibility.\r\n\t\t\tif (!dependencySettingId && dependency.id) {\r\n\t\t\t\tdependencySettingId = dependency.id;\r\n\t\t\t}\r\n\r\n\t\t\tif (!dependencySettingId) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!reversedControlDependencies[dependencySettingId]) {\r\n\t\t\t\treversedControlDependencies[dependencySettingId] = [];\r\n\t\t\t}\r\n\r\n\t\t\treversedControlDependencies[dependencySettingId].push({\r\n\t\t\t\tdependantControlId: dependantControlId,\r\n\t\t\t\toperator: dependency.operator,\r\n\t\t\t\tvalue: dependency.value,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tconst customizer = window.wp.customize;\r\n\r\n\tcustomizer.bind(\"ready\", function () {\r\n\t\tfor (const dependencySettingId in reversedControlDependencies) {\r\n\t\t\tif (!reversedControlDependencies.hasOwnProperty(dependencySettingId)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlistenDependencyControl(dependencySettingId);\r\n\t\t}\r\n\t});\r\n\r\n\tfunction listenDependencyControl(dependencySettingId: string) {\r\n\t\tcustomizer(dependencySettingId, function (setting) {\r\n\t\t\tconst rules = reversedControlDependencies[dependencySettingId];\r\n\r\n\t\t\thandleRulesCondition(dependencySettingId, setting.get(), rules);\r\n\r\n\t\t\tsetting.bind(function (newValue: string) {\r\n\t\t\t\thandleRulesCondition(dependencySettingId, newValue, rules);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleRulesCondition(\r\n\t\tdependencySettingId: string,\r\n\t\tnewValue: string,\r\n\t\trules: WpbfReversedControlDependency[],\r\n\t) {\r\n\t\tfor (const ruleSet of rules) {\r\n\t\t\tlet isDependencySatisfied = isRuleSatisfied(\r\n\t\t\t\tnewValue,\r\n\t\t\t\truleSet.operator,\r\n\t\t\t\truleSet.value,\r\n\t\t\t);\r\n\r\n\t\t\tif (!isDependencySatisfied) {\r\n\t\t\t\thideControl(ruleSet.dependantControlId);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst dependantDependencies =\r\n\t\t\t\tglobalControlDependencies[ruleSet.dependantControlId];\r\n\r\n\t\t\tif (dependantDependencies.length < 2) {\r\n\t\t\t\tshowControl(ruleSet.dependantControlId);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet otherRulesSatisfied = true;\r\n\r\n\t\t\tfor (const dependantDependency of dependantDependencies) {\r\n\t\t\t\tlet dependantDependencySettingId = dependantDependency.setting;\r\n\r\n\t\t\t\t// Backwards compatibility.\r\n\t\t\t\tif (!dependantDependencySettingId && dependantDependency.id) {\r\n\t\t\t\t\tdependantDependencySettingId = dependantDependency.id;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!dependantDependencySettingId) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (dependantDependencySettingId === dependencySettingId) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst dependantDependencyValue = customizer(\r\n\t\t\t\t\tdependantDependencySettingId,\r\n\t\t\t\t).get();\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t!isRuleSatisfied(\r\n\t\t\t\t\t\tdependantDependencyValue,\r\n\t\t\t\t\t\tdependantDependency.operator,\r\n\t\t\t\t\t\tdependantDependency.value,\r\n\t\t\t\t\t)\r\n\t\t\t\t) {\r\n\t\t\t\t\totherRulesSatisfied = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!otherRulesSatisfied) {\r\n\t\t\t\thideControl(ruleSet.dependantControlId);\r\n\t\t\t} else {\r\n\t\t\t\tshowControl(ruleSet.dependantControlId);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction hideControl(controlId: string) {\r\n\t\tif (insideInactiveTab(customizer.control(controlId)?.container[0])) {\r\n\t\t\tcustomizer\r\n\t\t\t\t.control(controlId)\r\n\t\t\t\t?.container.removeClass(\"wpbf-tab-item-hidden\");\r\n\r\n\t\t\tcustomizer\r\n\t\t\t\t.control(controlId)\r\n\t\t\t\t?.container.addClass(\"wpbf-tab-item-invisible\");\r\n\t\t}\r\n\r\n\t\tcustomizer.control(controlId)?.onChangeActive(false, {\r\n\t\t\tcompleteCallback: () => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tcustomizer\r\n\t\t\t\t\t\t.control(controlId)\r\n\t\t\t\t\t\t?.container.hasClass(\"wpbf-tab-item-invisible\")\r\n\t\t\t\t) {\r\n\t\t\t\t\tcustomizer\r\n\t\t\t\t\t\t.control(controlId)\r\n\t\t\t\t\t\t?.container.removeClass(\"wpbf-tab-item-invisible\");\r\n\r\n\t\t\t\t\tcustomizer\r\n\t\t\t\t\t\t.control(controlId)\r\n\t\t\t\t\t\t?.container.addClass(\"wpbf-tab-item-hidden\");\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showControl(controlId: string) {\r\n\t\tcustomizer.control(controlId)?.onChangeActive(true, {});\r\n\t}\r\n}\r\n\r\nfunction insideInactiveTab(el: HTMLElement | undefined | null) {\r\n\tif (!el) return false;\r\n\tif (!el.dataset.wpbfParentTabId) return false;\r\n\tif (!el.classList.contains(\"wpbf-tab-item-hidden\")) return false;\r\n\treturn true;\r\n}\r\n\r\nexport function isRuleSatisfied(\r\n\tactualValue: any,\r\n\toperator: string,\r\n\texpectedValue: any,\r\n): boolean {\r\n\toperator = operator.trim().toLowerCase();\r\n\r\n\tswitch (operator) {\r\n\t\tcase \"==\":\r\n\t\t\treturn actualValue == expectedValue;\r\n\t\tcase \"===\":\r\n\t\t\treturn actualValue === expectedValue;\r\n\t\tcase \"!=\":\r\n\t\t\treturn actualValue != expectedValue;\r\n\t\tcase \"!==\":\r\n\t\t\treturn actualValue !== expectedValue;\r\n\t\tcase \">\":\r\n\t\t\treturn actualValue > expectedValue;\r\n\t\tcase \">=\":\r\n\t\t\treturn actualValue >= expectedValue;\r\n\t\tcase \"<\":\r\n\t\t\treturn actualValue < expectedValue;\r\n\t\tcase \"<=\":\r\n\t\t\treturn actualValue <= expectedValue;\r\n\t\tcase \"in\":\r\n\t\t\treturn compareInOperator(actualValue, expectedValue);\r\n\t\tcase \"not in\":\r\n\t\t\treturn !compareInOperator(actualValue, expectedValue);\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nfunction compareInOperator(actualValue: any, expectedValue: any): boolean {\r\n\tif (Array.isArray(expectedValue)) {\r\n\t\tconst expectedValueArray: any[] = expectedValue;\r\n\t\tlet found = false;\r\n\r\n\t\tif (Array.isArray(actualValue)) {\r\n\t\t\tconst actualValueArray: any[] = actualValue;\r\n\r\n\t\t\tfor (let i = 0; i < actualValueArray.length; ++i) {\r\n\t\t\t\tif (expectedValueArray.includes(actualValueArray[i])) {\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (expectedValueArray.includes(actualValue)) {\r\n\t\t\t\tfound = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n\r\n\tif (Array.isArray(actualValue)) {\r\n\t\tconst actualValueArray: any[] = actualValue;\r\n\t\treturn actualValueArray.includes(expectedValue);\r\n\t}\r\n\r\n\tif (_.isObject(actualValue)) {\r\n\t\tconst actualValueObj: Record<string, any> = actualValue;\r\n\r\n\t\tif (!_.isUndefined(actualValueObj[expectedValue])) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfor (const prop in actualValueObj) {\r\n\t\t\tif (!actualValueObj.hasOwnProperty(prop)) continue;\r\n\r\n\t\t\tif (actualValueObj[prop] === expectedValue) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (\"string\" === typeof actualValue) {\r\n\t\tif (\"string\" === typeof expectedValue) {\r\n\t\t\treturn (\r\n\t\t\t\t-1 < expectedValue.indexOf(actualValue) &&\r\n\t\t\t\t-1 < actualValue.indexOf(expectedValue)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn -1 < expectedValue.indexOf(actualValue);\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n","import { WpbfCustomizeControl, WpbfCustomizeControlParams } from \"./base-interface\";\r\nimport _ from \"lodash\";\r\n\r\ndeclare var wpbfCustomizerTooltips: {\r\n\tid: string;\r\n\tcontent: string;\r\n}[];\r\n\r\nexport function wpbfSetupTooltips(customizer: WpbfCustomize) {\r\n\tlet sectionNames: string[] = [];\r\n\r\n\tcustomizer.control.each(function (\r\n\t\tcontrol: WpbfCustomizeControl<any, WpbfCustomizeControlParams<any>>,\r\n\t) {\r\n\t\tif (!sectionNames.includes(control.section())) {\r\n\t\t\tsectionNames.push(control.section());\r\n\t\t}\r\n\r\n\t\tcustomizer.section(control.section(), function (section) {\r\n\t\t\tif (\r\n\t\t\t\tsection.expanded() ||\r\n\t\t\t\tcustomizer.settings.autofocus.control === control.id\r\n\t\t\t) {\r\n\t\t\t\twpbfInjectTooltip(control);\r\n\t\t\t} else {\r\n\t\t\t\tsection.expanded.bind(function (expanded) {\r\n\t\t\t\t\tif (expanded) {\r\n\t\t\t\t\t\twpbfInjectTooltip(control);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\tconst tooltipStyleTag = document.createElement(\"style\");\r\n\tconst sidebarOverlay = document.querySelector(\r\n\t\t\".wp-full-overlay-sidebar-content\",\r\n\t);\r\n\r\n\ttooltipStyleTag.classList.add(\"wpbf-tooltip-inline-styles\");\r\n\tdocument.head.appendChild(tooltipStyleTag);\r\n\r\n\tsectionNames.forEach(function (sectionName) {\r\n\t\tif (!sidebarOverlay) return;\r\n\r\n\t\tcustomizer.section(sectionName, function (section) {\r\n\t\t\tsection.expanded.bind(function (expanded) {\r\n\t\t\t\tif (expanded) {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tsection.contentContainer &&\r\n\t\t\t\t\t\tsection.contentContainer[0].scrollHeight >\r\n\t\t\t\t\t\t\tsidebarOverlay.clientHeight\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\ttooltipStyleTag.innerHTML =\r\n\t\t\t\t\t\t\t\".wpbf-tooltip-wrapper span.tooltip-content {min-width: 258px;}\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttooltipStyleTag.innerHTML = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction wpbfInjectTooltip(\r\n\tcontrol: WpbfCustomizeControl<any, WpbfCustomizeControlParams<any>>,\r\n) {\r\n\t_.each(wpbfCustomizerTooltips, function (tooltip) {\r\n\t\tif (tooltip.id !== control.id) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (control.container.find(\".tooltip-content\").length) return;\r\n\r\n\t\tconst target = document.querySelector(\r\n\t\t\t\"#customize-control-\" + tooltip.id + \" .customize-control-title\",\r\n\t\t);\r\n\r\n\t\tif (!target) return;\r\n\t\ttarget.classList.add(\"wpbf-tooltip-wrapper\");\r\n\r\n\t\t// Build the tooltip trigger.\r\n\t\tconst trigger = document.createElement(\"span\");\r\n\t\ttrigger.classList.add(\"tooltip-trigger\");\r\n\t\ttrigger.innerHTML = '<span class=\"dashicons dashicons-editor-help\"></span>';\r\n\r\n\t\t// Build the tooltip content.\r\n\t\tconst content = document.createElement(\"span\");\r\n\t\tcontent.classList.add(\"tooltip-content\");\r\n\t\tcontent.innerHTML = tooltip.content;\r\n\r\n\t\t// Append the trigger & content next to the control's title.\r\n\t\ttarget.appendChild(trigger);\r\n\t\ttarget.appendChild(content);\r\n\t});\r\n}\r\n","import _ from \"lodash\";\n\nimport setupControlDependencies from \"./control-dependencies\";\nimport { wpbfSetupTooltips } from \"./tooltips\";\nimport {\n\tWpbfCustomizeControl,\n\tWpbfCustomizeControlParams,\n\tWpbfCustomizeElement,\n} from \"./base-interface\";\n\n/**\n * This file was taken from Kirki.\n *\n * The majority of the code in this file\n * is derived from the wp-customize-posts plugin\n * and the work of @westonruter to whom I am very grateful.\n *\n * @see https://github.com/xwp/wp-customize-posts\n */\n\n(function (customizer) {\n\tif (!customizer) return;\n\n\tcustomizer.wpbfDynamicControl = customizer.Control.extend<\n\t\tWpbfCustomizeControl<any, WpbfCustomizeControlParams<any>>\n\t>({\n\t\tinitialize: function initialize(\n\t\t\tthis: WpbfCustomizeControl<any, WpbfCustomizeControlParams<any>>,\n\t\t\tid: string,\n\t\t\tparams: WpbfCustomizeControlParams<any>,\n\t\t) {\n\t\t\tconst control = this;\n\n\t\t\tif (!params.type) {\n\t\t\t\tparams.type = \"wpbf-generic\";\n\t\t\t}\n\n\t\t\tlet className = \"\";\n\n\t\t\tif (params.content) {\n\t\t\t\tlet splits = params.content.split('class=\"');\n\t\t\t\tsplits = splits[1].split('\"');\n\t\t\t\tclassName = splits[0];\n\t\t\t} else {\n\t\t\t\tclassName = \"customize-control customize-control-\" + params.type;\n\t\t\t}\n\n\t\t\tif (params.content) {\n\t\t\t\tconst $content = jQuery(params.content);\n\t\t\t\t$content.attr(\n\t\t\t\t\t\"id\",\n\t\t\t\t\t\"customize-control-\" + id.replace(/]/g, \"\").replace(/\\[/g, \"-\"),\n\t\t\t\t);\n\t\t\t\t$content.attr(\"class\", className);\n\n\t\t\t\tconst wrapperAttrs = params[\"wrapperAttrs\"] ?? {};\n\n\t\t\t\t_.each(wrapperAttrs, function (val: any, key: string) {\n\t\t\t\t\tif (\"class\" === key) {\n\t\t\t\t\t\tval = val.replace(\"{default_class}\", className);\n\t\t\t\t\t}\n\n\t\t\t\t\t$content.attr(key, val);\n\t\t\t\t});\n\n\t\t\t\t// Hijack the container to add wrapperAttrs.\n\t\t\t\tparams.content = $content.prop(\"outerHTML\");\n\t\t\t}\n\n\t\t\tcontrol.propertyElements = [];\n\t\t\tcustomizer.Control.prototype.initialize.call(control, id, params);\n\t\t\twindow.wp.hooks.doAction(\n\t\t\t\t\"wpbf.dynamicControl.init.after\",\n\t\t\t\tid,\n\t\t\t\tcontrol,\n\t\t\t\tparams,\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Add bidirectional data binding links between inputs and the setting(s).\n\t\t *\n\t\t * This is copied from api.Control.prototype.initialize(). It\n\t\t * should be changed in Core to be applied once the control is embedded.\n\t\t */\n\t\t_setUpSettingRootLinks: function _setUpSettingRootLinks(\n\t\t\tthis: WpbfCustomizeControl<any, WpbfCustomizeControlParams<any>>,\n\t\t) {\n\t\t\tconst control = this;\n\t\t\tconst nodes = control.container.find(\"[data-customize-setting-link]\");\n\n\t\t\tnodes.each(function (i, el) {\n\t\t\t\tconst node = jQuery(this);\n\t\t\t\tconst settingKey = this.dataset.customizeSettingLink;\n\t\t\t\tif (!settingKey) return;\n\n\t\t\t\tcustomizer(settingKey, function (setting) {\n\t\t\t\t\t// @ts-ignore The `new` operator has TS error (not runtime error).\n\t\t\t\t\tconst element = new customizer.Element(node);\n\t\t\t\t\tcontrol.elements.push(element);\n\t\t\t\t\telement.sync(setting);\n\t\t\t\t\telement.set(setting());\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * Add bidirectional data binding links between inputs and the setting properties.\n\t\t */\n\t\t_setUpSettingPropertyLinks: function _setUpSettingPropertyLinks(\n\t\t\tthis: WpbfCustomizeControl<any, WpbfCustomizeControlParams<any>>,\n\t\t) {\n\t\t\tconst control = this;\n\t\t\tlet nodes;\n\n\t\t\tif (!control.setting) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnodes = control.container.find(\"[data-customize-setting-property-link]\");\n\n\t\t\tnodes.each(function () {\n\t\t\t\tconst node = jQuery(this);\n\t\t\t\tlet element: WpbfCustomizeElement;\n\t\t\t\tlet propertyName = node.data(\"customizeSettingPropertyLink\");\n\n\t\t\t\t// @ts-ignore The `new` operator has TS error (not runtime error).\n\t\t\t\telement = new customizer.Element(node);\n\t\t\t\tcontrol.propertyElements.push(element);\n\n\t\t\t\tif (!control.setting || typeof control.setting !== \"function\") {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\telement.set(control.setting()[propertyName]);\n\n\t\t\t\telement.bind(function (newPropertyValue) {\n\t\t\t\t\tif (!control.setting || typeof control.setting !== \"function\") {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet newSetting = control.setting();\n\n\t\t\t\t\tif (newPropertyValue === newSetting[propertyName]) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tnewSetting = _.clone(newSetting);\n\t\t\t\t\tnewSetting[propertyName] = newPropertyValue;\n\t\t\t\t\tcontrol.setting.set(newSetting);\n\t\t\t\t});\n\n\t\t\t\tcontrol.setting.bind(function (newValue) {\n\t\t\t\t\tif (newValue[propertyName] !== element.get()) {\n\t\t\t\t\t\telement.set(newValue[propertyName]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * @inheritdoc\n\t\t */\n\t\tready: function ready() {\n\t\t\tthis._setUpSettingRootLinks?.();\n\t\t\tthis._setUpSettingPropertyLinks?.();\n\n\t\t\tcustomizer.Control.prototype.ready.call(this);\n\n\t\t\tthis.deferred?.embedded.done(() => {\n\t\t\t\tthis.initWpbfControl?.();\n\n\t\t\t\twindow.wp.hooks.doAction(\n\t\t\t\t\t\"wpbf.dynamicControl.ready.deferred.embedded.done\",\n\t\t\t\t\tthis,\n\t\t\t\t);\n\t\t\t});\n\n\t\t\twindow.wp.hooks.doAction(\"wpbf.dynamicControl.ready.after\", this);\n\t\t},\n\n\t\t/**\n\t\t * Embed the control in the document.\n\t\t *\n\t\t * Override the embed() method to do nothing,\n\t\t * so that the control isn't embedded on load,\n\t\t * unless the containing section is already expanded.\n\t\t */\n\t\tembed: function embed() {\n\t\t\tlet sectionId = this.section?.();\n\t\t\tif (!sectionId) return;\n\n\t\t\tcustomizer.section(sectionId, (section) => {\n\t\t\t\tif (\n\t\t\t\t\t\"wpbf-expanded\" === section.params.type ||\n\t\t\t\t\tsection.expanded() ||\n\t\t\t\t\tcustomizer.settings.autofocus.control === this.id\n\t\t\t\t) {\n\t\t\t\t\tthis.actuallyEmbed?.();\n\t\t\t\t} else {\n\t\t\t\t\tsection.expanded.bind((expanded) => {\n\t\t\t\t\t\tif (expanded) this.actuallyEmbed?.();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\twindow.wp.hooks.doAction(\"wpbf.dynamicControl.embed.after\", this);\n\t\t},\n\n\t\t/**\n\t\t * Deferred embedding of control when actually\n\t\t *\n\t\t * This function is called in Section.onChangeExpanded() so the control\n\t\t * will only get embedded when the Section is first expanded.\n\t\t */\n\t\tactuallyEmbed: function actuallyEmbed() {\n\t\t\tif (\"resolved\" === this.deferred?.embedded?.state()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.renderContent?.();\n\n\t\t\t// This triggers control.ready().\n\t\t\tthis.deferred?.embedded.resolve();\n\n\t\t\twindow.wp.hooks.doAction(\"wpbf.dynamicControl.actuallyEmbed.after\", this);\n\t\t},\n\n\t\t/**\n\t\t * This is not working with autofocus.\n\t\t */\n\t\tfocus: function focus(args: Record<string, any>) {\n\t\t\tthis.actuallyEmbed?.();\n\t\t\tcustomizer.Control.prototype.focus.call(this, args);\n\t\t\twindow.wp.hooks.doAction(\"wpbf.dynamicControl.focus.after\", this);\n\t\t},\n\n\t\t/**\n\t\t * Additional actions that run on ready.\n\t\t */\n\t\tinitWpbfControl: function initWpbfControl(ctrl) {\n\t\t\twindow.wp.hooks.doAction(\"wpbf.dynamicControl.initWpbfControl\", this);\n\n\t\t\tconst control = this;\n\n\t\t\t// Save the value\n\t\t\tthis.container?.on(\"change input paste click\", \"input\", function () {\n\t\t\t\tcontrol.setting?.set(this.value);\n\t\t\t});\n\t\t},\n\n\t\tdestroy: function () {\n\t\t\tthis.container?.off(\"change input paste click\", \"input\");\n\t\t},\n\n\t\tupdateCustomizerSetting: function updateCustomizerSetting(val) {\n\t\t\tthis.setting?.set(val);\n\t\t},\n\n\t\tfindHtmlEl: function findHtmlEl(elOrSelector, selector) {\n\t\t\tif (!elOrSelector) return undefined;\n\n\t\t\tif (typeof elOrSelector === \"string\") {\n\t\t\t\tconst result = document.querySelector(elOrSelector);\n\n\t\t\t\treturn result instanceof HTMLElement ? result : undefined;\n\t\t\t}\n\n\t\t\tif (!selector) return undefined;\n\n\t\t\tconst result = elOrSelector.querySelector(selector);\n\n\t\t\treturn result instanceof HTMLElement ? result : undefined;\n\t\t},\n\n\t\tfindHtmlEls: function findHtmlEls(elOrSelector, selector) {\n\t\t\tif (!elOrSelector) return [];\n\n\t\t\tif (typeof elOrSelector === \"string\") {\n\t\t\t\tconst result = document.querySelectorAll(elOrSelector);\n\n\t\t\t\treturn Array.from(result).filter((el) => el instanceof HTMLElement);\n\t\t\t}\n\n\t\t\tif (!selector) return [];\n\n\t\t\tconst result = elOrSelector.querySelectorAll(selector);\n\n\t\t\treturn Array.from(result).filter((el) => el instanceof HTMLElement);\n\t\t},\n\t});\n\n\tcustomizer.bind(\"ready\", () => {\n\t\twpbfSetupTooltips(customizer);\n\t});\n\n\tif (window.wpbfCustomizerControlDependencies) {\n\t\tsetupControlDependencies(window.wpbfCustomizerControlDependencies);\n\t}\n\n\t/**\n\t * Set the value and trigger all bound callbacks.\n\t */\n\tcustomizer.Value.prototype.set = function (to: any) {\n\t\tconst from = this._value;\n\n\t\tto = this._setter.apply(this, arguments);\n\t\tto = this.validate(to);\n\n\t\t// Bail if the sanitized value is null or unchanged.\n\t\tif (null === to || _.isEqual(from, to)) {\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * This was brought from Kirki.\n\t\t * But this is too much for now.\n\t\t *\n\t\t * Start Kirki mod.\n\t\t */\n\t\t/*\n\t\tlet parentSetting;\n\t\tlet newVal;\n\t\tif (this.id && api.control(this.id) && api.control(this.id).params && api.control(this.id).params.parent_setting) {\n\t\t\tparentSetting = api.control(this.id).params.parent_setting;\n\t\t\tnewVal = {};\n\t\t\tnewVal[this.id.replace(parentSetting + '[', '').replace(']', '')] = to;\n\t\t\tapi.control(parentSetting).setting.set(jQuery.extend({}, api.control(parentSetting).setting._value, newVal));\n\t\t}\n\t\t*/\n\n\t\t// End Kirki mod.\n\n\t\tthis._value = to;\n\t\tthis._dirty = true;\n\n\t\tthis.callbacks.fireWith(this, [to, from]);\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Get the value.\n\t */\n\tcustomizer.Value.prototype.get = function () {\n\t\t/**\n\t\t * This was brought from Kirki.\n\t\t * But this is too much for now.\n\t\t *\n\t\t * Start Kirki mod.\n\t\t */\n\t\t/*\n\t\tlet parentSetting;\n\n\t\tif (this.id && api.control(this.id) && api.control(this.id).params && api.control(this.id).params.parent_setting) {\n\t\t\tparentSetting = api.control(this.id).params.parent_setting;\n\t\t\treturn api.control(parentSetting).setting.get()[this.id.replace(parentSetting + '[', '').replace(']', '')];\n\t\t}\n\t\t*/\n\t\t// End Kirki mod.\n\n\t\treturn this._value;\n\t};\n})(window.wp.customize);\n","/**\r\n * Iterates over a collection of elements and applies a function to each.\r\n *\r\n * @param {string|NodeListOf<Element>|HTMLElement[]} selector - Either a NodeList obtained from document.querySelectorAll() or a CSS selector string.\r\n * @param {function(Element): void} handler - The function to be applied to each element. Accepts one parameter, which is the element.\r\n *\r\n * @returns {void}\r\n */\r\nexport function forEachEl(selector, handler) {\r\n\tif (\r\n\t\t!(selector instanceof NodeList) &&\r\n\t\t!Array.isArray(selector) &&\r\n\t\ttypeof selector !== \"string\"\r\n\t) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (typeof handler !== \"function\") return;\r\n\r\n\tconst elms =\r\n\t\tselector instanceof NodeList || Array.isArray(selector)\r\n\t\t\t? selector\r\n\t\t\t: document.querySelectorAll(selector);\r\n\r\n\tif (!elms.length) return;\r\n\r\n\tfor (let i = 0; i < elms.length; i++) {\r\n\t\tconst elm = elms[i];\r\n\r\n\t\tif (elm instanceof HTMLElement) {\r\n\t\t\thandler(elm);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Check whether we're inside customizer or not.\r\n *\r\n * @returns {boolean} Whether we're inside customizer or not.\r\n */\r\nexport function isInsideCustomizer() {\r\n\treturn window.wp && window.wp.customize ? true : false;\r\n}\r\n\r\n/**\r\n * @type {WpbfBreakpoints}\r\n */\r\nconst defaultBreakpoints = {\r\n\tdesktop: 1024,\r\n\ttablet: 768,\r\n\tmobile: 480,\r\n};\r\n\r\n/**\r\n * Get breakpoint by device type.\r\n *\r\n * Retrieve breakpoint based on body class,\r\n * then set it as the value of top level `breakpoints` variable.\r\n *\r\n * @param {\"desktop\"|\"tablet\"|\"mobile\"} device - The device type. Accepts 'desktop', 'tablet', or 'mobile'.\r\n * @returns {number} The breakpoint value.\r\n */\r\nfunction getBreakpointValue(device) {\r\n\tlet breakpoint = defaultBreakpoints[device] || 0;\r\n\r\n\tconst matchRule = \"wpbf-\" + device + \"-breakpoint-[\\\\w-]*\\\\b\";\r\n\tconst breakpointClassMatch = document.body.className.match(matchRule);\r\n\r\n\tif (!breakpointClassMatch) {\r\n\t\treturn breakpoint;\r\n\t}\r\n\r\n\tconst breakpointMatch = breakpointClassMatch.toString().match(/\\d+/);\r\n\r\n\tconst breakpointValue = Array.isArray(breakpointMatch)\r\n\t\t? parseInt(breakpointMatch[0], 10)\r\n\t\t: 0;\r\n\r\n\treturn breakpointValue;\r\n}\r\n\r\n/**\r\n * Get breakpoint values for desktop, tablet, and mobile.\r\n *\r\n * @returns {WpbfBreakpoints} breakpoints The breakpoints object.\r\n */\r\nexport function getBreakpoints() {\r\n\tlet breakpoints = defaultBreakpoints;\r\n\r\n\tbreakpoints.desktop = getBreakpointValue(\"desktop\");\r\n\tbreakpoints.tablet = getBreakpointValue(\"tablet\");\r\n\tbreakpoints.mobile = getBreakpointValue(\"mobile\");\r\n\r\n\treturn breakpoints;\r\n}\r\n\r\n/**\r\n * Get the current active breakpoint.\r\n *\r\n * @returns {string} - The active breakpoint. Accepts 'desktop', 'tablet', or 'mobile'.\r\n */\r\nexport function getActiveBreakpoint() {\r\n\tconst breakpoints = getBreakpoints();\r\n\tconst windowWidth = document.documentElement.clientWidth;\r\n\r\n\tlet activeBreakpoint = \"desktop\";\r\n\r\n\tif (windowWidth > breakpoints.desktop) {\r\n\t\treturn activeBreakpoint;\r\n\t}\r\n\r\n\tif (windowWidth > breakpoints.tablet) {\r\n\t\tactiveBreakpoint = \"tablet\";\r\n\t} else {\r\n\t\tactiveBreakpoint = \"mobile\";\r\n\t}\r\n\r\n\treturn activeBreakpoint;\r\n}\r\n","import { forEachEl } from \"../../../../assets/js/utils/dom-util\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\nwp.customize.bind(\"ready\", function () {\r\n\tinit();\r\n});\r\n\r\nfunction init() {\r\n\tlistenDevicePreviewSwitch();\r\n\r\n\t// Loop through wpbf device buttons and assign the event.\r\n\tjQuery(document).on(\r\n\t\t\"click\",\r\n\t\t\".wpbf-device-buttons .wpbf-device-button\",\r\n\t\tfunction (e) {\r\n\t\t\tconst device = (this as HTMLButtonElement).dataset.wpbfDevice;\r\n\t\t\tif (!device) return;\r\n\r\n\t\t\tswitchPreviewButtons(device);\r\n\r\n\t\t\t// Trigger WordPress device event.\r\n\t\t\twp.customize.previewedDevice.set(device);\r\n\t\t},\r\n\t);\r\n}\r\n\r\n/**\r\n * Listen device switch event and switch our device buttons accordingly.\r\n */\r\nfunction listenDevicePreviewSwitch() {\r\n\t// Bind device changes from WordPress default.\r\n\twp.customize.previewedDevice.bind(function (device: string) {\r\n\t\tswitchPreviewButtons(device);\r\n\t});\r\n}\r\n\r\n/**\r\n * Setup WPBF device preview.\r\n *\r\n * @param string device The device (mobile, tablet, or desktop).\r\n */\r\nfunction switchPreviewButtons(device: string) {\r\n\tforEachEl(\".wpbf-device-buttons .wpbf-device-button\", function (el) {\r\n\t\tif (!(el instanceof HTMLButtonElement)) return;\r\n\r\n\t\tif (device === el.dataset.wpbfDevice) {\r\n\t\t\tel.classList.add(\"is-active\");\r\n\t\t} else {\r\n\t\t\tel.classList.remove(\"is-active\");\r\n\t\t}\r\n\t});\r\n\r\n\tforEachEl(\".wpbf-control-device\", function (el) {\r\n\t\tif (!(el instanceof HTMLButtonElement)) return;\r\n\r\n\t\tif (device === el.dataset.wpbfDevice) {\r\n\t\t\tel.classList.add(\"is-active\");\r\n\t\t} else {\r\n\t\t\tel.classList.remove(\"is-active\");\r\n\t\t}\r\n\t});\r\n\r\n\t// Switch the label to target first input field in current device mode.\r\n\tforEachEl(\".responsive-control\", function (el) {\r\n\t\tif (!(el instanceof HTMLButtonElement)) return;\r\n\r\n\t\tconst setting = el.dataset.wpbfSetting;\r\n\t\tconst id = `${setting ?? \"\"}-${device}`;\r\n\t\tconst label = el.querySelector(\"label.customize-control-label\");\r\n\r\n\t\tif (label && label instanceof HTMLLabelElement) {\r\n\t\t\tlabel.htmlFor = id;\r\n\t\t}\r\n\t});\r\n}\r\n","import {\r\n\tWpbfCheckboxButtonsetControl,\r\n\tWpbfCheckboxControl,\r\n} from \"./checkbox-interface\";\r\n\r\n((customizer: WpbfCustomize | undefined) => {\r\n\tif (!customizer) return;\r\n\r\n\tcustomizer.controlConstructor[\"wpbf-checkbox\"] =\r\n\t\tcustomizer.wpbfDynamicControl.extend<WpbfCheckboxControl>({\r\n\t\t\tinitWpbfControl: function (ctrl) {\r\n\t\t\t\tconst control = ctrl || this;\r\n\r\n\t\t\t\tcontrol.container?.on(\"change\", \"input\", function () {\r\n\t\t\t\t\tcontrol.setting?.set(jQuery(this).is(\":checked\"));\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t});\r\n\r\n\tcustomizer.controlConstructor[\"wpbf-toggle\"] =\r\n\t\tcustomizer.wpbfDynamicControl.extend<WpbfCheckboxControl>({\r\n\t\t\tinitWpbfControl: function (ctrl) {\r\n\t\t\t\tconst control = ctrl || this;\r\n\r\n\t\t\t\tcontrol.container?.on(\"change\", \"input\", function () {\r\n\t\t\t\t\tcontrol.setting?.set(jQuery(this).is(\":checked\"));\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t});\r\n\r\n\tcustomizer.controlConstructor[\"wpbf-checkbox-buttonset\"] =\r\n\t\tcustomizer.wpbfDynamicControl.extend<WpbfCheckboxButtonsetControl>({\r\n\t\t\tcurrentValue: undefined,\r\n\r\n\t\t\tinitWpbfControl: function (ctrl) {},\r\n\r\n\t\t\tready: function () {\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tthis.currentValue = this.setting?.get();\r\n\r\n\t\t\t\tthis.container?.on(\"change\", \".switch-input\", (e) => {\r\n\t\t\t\t\tconst values: string[] = [];\r\n\r\n\t\t\t\t\tif (!control.container) return values;\r\n\r\n\t\t\t\t\tconst fields = control.container[0].querySelectorAll(\r\n\t\t\t\t\t\t\".switch-input:checked\",\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tfields.forEach((field) => {\r\n\t\t\t\t\t\tif (!(field instanceof HTMLInputElement)) return;\r\n\t\t\t\t\t\tvalues.push(field.value);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcontrol.setting?.set(values);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.setting?.bind((val) => {\r\n\t\t\t\t\tcontrol.updateComponentState?.(val);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tupdateComponentState: function (val) {\r\n\t\t\t\tif (this.currentValue === val) return;\r\n\t\t\t\tif (!this.container) return;\r\n\r\n\t\t\t\tconst fields = this.container[0].querySelectorAll(\".switch-input\");\r\n\r\n\t\t\t\tfields.forEach((field) => {\r\n\t\t\t\t\tif (!(field instanceof HTMLInputElement)) return;\r\n\t\t\t\t\tfield.checked = val.includes(field.value);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t});\r\n})(window.wp.customize);\r\n","var r={grad:.9,turn:360,rad:360/(2*Math.PI)},t=function(r){return\"string\"==typeof r?r.length>0:\"number\"==typeof r},n=function(r,t,n){return void 0===t&&(t=0),void 0===n&&(n=Math.pow(10,t)),Math.round(n*r)/n+0},e=function(r,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),r>n?n:r>t?r:t},u=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},a=function(r){return{r:e(r.r,0,255),g:e(r.g,0,255),b:e(r.b,0,255),a:e(r.a)}},o=function(r){return{r:n(r.r),g:n(r.g),b:n(r.b),a:n(r.a,3)}},i=/^#([0-9a-f]{3,8})$/i,s=function(r){var t=r.toString(16);return t.length<2?\"0\"+t:t},h=function(r){var t=r.r,n=r.g,e=r.b,u=r.a,a=Math.max(t,n,e),o=a-Math.min(t,n,e),i=o?a===t?(n-e)/o:a===n?2+(e-t)/o:4+(t-n)/o:0;return{h:60*(i<0?i+6:i),s:a?o/a*100:0,v:a/255*100,a:u}},b=function(r){var t=r.h,n=r.s,e=r.v,u=r.a;t=t/360*6,n/=100,e/=100;var a=Math.floor(t),o=e*(1-n),i=e*(1-(t-a)*n),s=e*(1-(1-t+a)*n),h=a%6;return{r:255*[e,i,o,o,s,e][h],g:255*[s,e,e,i,o,o][h],b:255*[o,o,s,e,e,i][h],a:u}},g=function(r){return{h:u(r.h),s:e(r.s,0,100),l:e(r.l,0,100),a:e(r.a)}},d=function(r){return{h:n(r.h),s:n(r.s),l:n(r.l),a:n(r.a,3)}},f=function(r){return b((n=(t=r).s,{h:t.h,s:(n*=((e=t.l)<50?e:100-e)/100)>0?2*n/(e+n)*100:0,v:e+n,a:t.a}));var t,n,e},c=function(r){return{h:(t=h(r)).h,s:(u=(200-(n=t.s))*(e=t.v)/100)>0&&u<200?n*e/100/(u<=100?u:200-u)*100:0,l:u/2,a:t.a};var t,n,e,u},l=/^hsla?\\(\\s*([+-]?\\d*\\.?\\d+)(deg|rad|grad|turn)?\\s*,\\s*([+-]?\\d*\\.?\\d+)%\\s*,\\s*([+-]?\\d*\\.?\\d+)%\\s*(?:,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,p=/^hsla?\\(\\s*([+-]?\\d*\\.?\\d+)(deg|rad|grad|turn)?\\s+([+-]?\\d*\\.?\\d+)%\\s+([+-]?\\d*\\.?\\d+)%\\s*(?:\\/\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,v=/^rgba?\\(\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*(?:,\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,m=/^rgba?\\(\\s*([+-]?\\d*\\.?\\d+)(%)?\\s+([+-]?\\d*\\.?\\d+)(%)?\\s+([+-]?\\d*\\.?\\d+)(%)?\\s*(?:\\/\\s*([+-]?\\d*\\.?\\d+)(%)?\\s*)?\\)$/i,y={string:[[function(r){var t=i.exec(r);return t?(r=t[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:4===r.length?n(parseInt(r[3]+r[3],16)/255,2):1}:6===r.length||8===r.length?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:8===r.length?n(parseInt(r.substr(6,2),16)/255,2):1}:null:null},\"hex\"],[function(r){var t=v.exec(r)||m.exec(r);return t?t[2]!==t[4]||t[4]!==t[6]?null:a({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},\"rgb\"],[function(t){var n=l.exec(t)||p.exec(t);if(!n)return null;var e,u,a=g({h:(e=n[1],u=n[2],void 0===u&&(u=\"deg\"),Number(e)*(r[u]||1)),s:Number(n[3]),l:Number(n[4]),a:void 0===n[5]?1:Number(n[5])/(n[6]?100:1)});return f(a)},\"hsl\"]],object:[[function(r){var n=r.r,e=r.g,u=r.b,o=r.a,i=void 0===o?1:o;return t(n)&&t(e)&&t(u)?a({r:Number(n),g:Number(e),b:Number(u),a:Number(i)}):null},\"rgb\"],[function(r){var n=r.h,e=r.s,u=r.l,a=r.a,o=void 0===a?1:a;if(!t(n)||!t(e)||!t(u))return null;var i=g({h:Number(n),s:Number(e),l:Number(u),a:Number(o)});return f(i)},\"hsl\"],[function(r){var n=r.h,a=r.s,o=r.v,i=r.a,s=void 0===i?1:i;if(!t(n)||!t(a)||!t(o))return null;var h=function(r){return{h:u(r.h),s:e(r.s,0,100),v:e(r.v,0,100),a:e(r.a)}}({h:Number(n),s:Number(a),v:Number(o),a:Number(s)});return b(h)},\"hsv\"]]},N=function(r,t){for(var n=0;n<t.length;n++){var e=t[n][0](r);if(e)return[e,t[n][1]]}return[null,void 0]},x=function(r){return\"string\"==typeof r?N(r.trim(),y.string):\"object\"==typeof r&&null!==r?N(r,y.object):[null,void 0]},I=function(r){return x(r)[1]},M=function(r,t){var n=c(r);return{h:n.h,s:e(n.s+100*t,0,100),l:n.l,a:n.a}},H=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},$=function(r,t){var n=c(r);return{h:n.h,s:n.s,l:e(n.l+100*t,0,100),a:n.a}},j=function(){function r(r){this.parsed=x(r)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return null!==this.parsed},r.prototype.brightness=function(){return n(H(this.rgba),2)},r.prototype.isDark=function(){return H(this.rgba)<.5},r.prototype.isLight=function(){return H(this.rgba)>=.5},r.prototype.toHex=function(){return r=o(this.rgba),t=r.r,e=r.g,u=r.b,i=(a=r.a)<1?s(n(255*a)):\"\",\"#\"+s(t)+s(e)+s(u)+i;var r,t,e,u,a,i},r.prototype.toRgb=function(){return o(this.rgba)},r.prototype.toRgbString=function(){return r=o(this.rgba),t=r.r,n=r.g,e=r.b,(u=r.a)<1?\"rgba(\"+t+\", \"+n+\", \"+e+\", \"+u+\")\":\"rgb(\"+t+\", \"+n+\", \"+e+\")\";var r,t,n,e,u},r.prototype.toHsl=function(){return d(c(this.rgba))},r.prototype.toHslString=function(){return r=d(c(this.rgba)),t=r.h,n=r.s,e=r.l,(u=r.a)<1?\"hsla(\"+t+\", \"+n+\"%, \"+e+\"%, \"+u+\")\":\"hsl(\"+t+\", \"+n+\"%, \"+e+\"%)\";var r,t,n,e,u},r.prototype.toHsv=function(){return r=h(this.rgba),{h:n(r.h),s:n(r.s),v:n(r.v),a:n(r.a,3)};var r},r.prototype.invert=function(){return w({r:255-(r=this.rgba).r,g:255-r.g,b:255-r.b,a:r.a});var r},r.prototype.saturate=function(r){return void 0===r&&(r=.1),w(M(this.rgba,r))},r.prototype.desaturate=function(r){return void 0===r&&(r=.1),w(M(this.rgba,-r))},r.prototype.grayscale=function(){return w(M(this.rgba,-1))},r.prototype.lighten=function(r){return void 0===r&&(r=.1),w($(this.rgba,r))},r.prototype.darken=function(r){return void 0===r&&(r=.1),w($(this.rgba,-r))},r.prototype.rotate=function(r){return void 0===r&&(r=15),this.hue(this.hue()+r)},r.prototype.alpha=function(r){return\"number\"==typeof r?w({r:(t=this.rgba).r,g:t.g,b:t.b,a:r}):n(this.rgba.a,3);var t},r.prototype.hue=function(r){var t=c(this.rgba);return\"number\"==typeof r?w({h:r,s:t.s,l:t.l,a:t.a}):n(t.h)},r.prototype.isEqual=function(r){return this.toHex()===w(r).toHex()},r}(),w=function(r){return r instanceof j?r:new j(r)},S=[],k=function(r){r.forEach(function(r){S.indexOf(r)<0&&(r(j,y),S.push(r))})},E=function(){return new j({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};export{j as Colord,w as colord,k as extend,I as getFormat,E as random};\n","export default function ColorPickerSwatches(props: {\r\n\tcolors: Array<string | { color: string } | undefined>;\r\n\tonClick: (color: string) => void;\r\n}) {\r\n\tconst { colors, onClick } = props;\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName={`wpbf-color-swatches${colors && colors.length < 7 ? \" no-stretch\" : \"\"}`}\r\n\t\t>\r\n\t\t\t{colors.map((clr, index) => {\r\n\t\t\t\tconst color =\r\n\t\t\t\t\ttypeof clr === \"string\" ? clr : clr && clr.color ? clr.color : \"\";\r\n\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tkey={index.toString()}\r\n\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\tclassName=\"wpbf-color-swatch\"\r\n\t\t\t\t\t\tdata-wpbf-color={color}\r\n\t\t\t\t\t\tstyle={{ backgroundColor: color }}\r\n\t\t\t\t\t\tonClick={() => onClick(color)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t})}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import { NumberUnitPair } from \"../../Responsive/src/responsive-interface\";\r\n\r\nexport function normalizeMaxValue(\r\n\tmin: number | null | undefined,\r\n\tmax: number | null | undefined,\r\n): number | null | undefined {\r\n\tif (\"undefined\" === typeof min || \"undefined\" === typeof max) {\r\n\t\treturn max;\r\n\t}\r\n\r\n\tif (null === min || null === max) {\r\n\t\treturn max;\r\n\t}\r\n\r\n\treturn Math.max(min, max);\r\n}\r\n\r\n/**\r\n * Check if the provided value is a numeric.\r\n *\r\n * Thanks to Dan (https://stackoverflow.com/users/17121/dan) for his answer on StackOverflow:\r\n * @see https://stackoverflow.com/questions/175739/built-in-way-in-javascript-to-check-if-a-string-is-a-valid-number#answer-175787\r\n */\r\nexport function isNumeric(char: unknown): boolean {\r\n\t// Number is a numeric.\r\n\tif (\"number\" === typeof char) return true;\r\n\r\n\t// We only process strings.\r\n\tif (\"string\" !== typeof char) return false;\r\n\r\n\treturn !isNaN(parseFloat(char));\r\n}\r\n\r\nexport function improperNumeric(value: any): boolean {\r\n\tif (\r\n\t\t(typeof value !== \"string\" && typeof value !== \"number\") ||\r\n\t\t(typeof value === \"string\" && isNaN(parseFloat(value)))\r\n\t) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Limit number based on the min and max values.\r\n *\r\n * @param {string | number} value - The value to parse.\r\n * @param {number | null | undefined} min - The minimum value. Null or undefined if not set.\r\n * @param {number | null | undefined} max - The maximum value. Null or undefined if not set.\r\n *\r\n * @return {number | \"\"} The returned value can be either `number` or empty string.\r\n */\r\nexport function limitNumber(\r\n\tvalue: string | number,\r\n\tmin?: number | null,\r\n\tmax?: number | null,\r\n): number | \"\" {\r\n\tif (value === \"\") {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tif (improperNumeric(value)) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tlet parsedValue = typeof value === \"string\" ? parseFloat(value) : value;\r\n\r\n\tif (\"number\" === typeof min) {\r\n\t\tif (parsedValue < min) {\r\n\t\t\tparsedValue = min;\r\n\t\t}\r\n\t}\r\n\r\n\tif (\"number\" === typeof max) {\r\n\t\tif (parsedValue > max) {\r\n\t\t\tparsedValue = max;\r\n\t\t}\r\n\t}\r\n\r\n\treturn parsedValue;\r\n}\r\n\r\n/**\r\n * Get unit from a value.\r\n *\r\n * @param {any} value The value to get unit from.\r\n *\r\n * @return {string} The unit or empty string if there's no unit.\r\n */\r\nexport function getUnit(value: any): string {\r\n\tif (!value) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tconst strValue = String(value);\r\n\tconst unitPattern = /[a-z%]+$/i;\r\n\tconst unitMatch = strValue.match(unitPattern);\r\n\r\n\treturn unitMatch ? unitMatch[0] : \"\";\r\n}\r\n\r\n/**\r\n * Separate number and unit.\r\n *\r\n * @param {string | number | null} value The value to separate.\r\n *\r\n * @return {NumberUnitPair} The returned value will be a pair of `unit` and `number`.\r\n */\r\nexport function makeNumberUnitPair(\r\n\tvalue: string | number | null,\r\n): NumberUnitPair {\r\n\t// We support empty string.\r\n\tif (value === \"\" || value === null) {\r\n\t\treturn {\r\n\t\t\tnumber: \"\",\r\n\t\t\tunit: \"\",\r\n\t\t};\r\n\t}\r\n\r\n\tif (improperNumeric(value)) {\r\n\t\treturn {\r\n\t\t\tnumber: \"\",\r\n\t\t\tunit: \"\",\r\n\t\t};\r\n\t}\r\n\r\n\tlet strValue = String(value).trim();\r\n\tconst negativeSign = -1 < strValue.indexOf(\"-\") ? \"-\" : \"\";\r\n\tstrValue = strValue.replace(negativeSign, \"\");\r\n\r\n\tconst unit = getUnit(strValue);\r\n\tlet numeric = unit ? strValue.replace(unit, \"\") : strValue;\r\n\tnumeric = numeric.trim();\r\n\r\n\tif (\"\" === numeric) {\r\n\t\treturn {\r\n\t\t\tnumber: \"\",\r\n\t\t\tunit: unit,\r\n\t\t};\r\n\t}\r\n\r\n\tconst hasTrailingDot = numeric.endsWith(\".\");\r\n\tnumeric = negativeSign + numeric;\r\n\tconst number = parseFloat(numeric);\r\n\r\n\tif (isNaN(number)) {\r\n\t\treturn {\r\n\t\t\tnumber: \"\",\r\n\t\t\tunit: unit,\r\n\t\t};\r\n\t}\r\n\r\n\treturn {\r\n\t\tnumber: number,\r\n\t\tunit: unit,\r\n\t\thasTrailingDotBeforeUnit: unit && hasTrailingDot ? true : false,\r\n\t};\r\n}\r\n\r\n/**\r\n * Make a `NumberUnitPair` object from a string or number.\r\n *\r\n * @export\r\n *\r\n * @param {(string | number)} val - The value to convert.\r\n * @param {number} min - The minimum value.\r\n * @param {number} max - The maximum value.\r\n *\r\n * @return {NumberUnitPair} The `NumberUnitPair` object.\r\n */\r\nexport function makeLimitedNumberUnitPair(\r\n\tval: string | number,\r\n\tmin: number,\r\n\tmax: number,\r\n): NumberUnitPair {\r\n\tconst valueObject = makeNumberUnitPair(val);\r\n\r\n\tif (\"\" === valueObject.number) {\r\n\t\treturn valueObject;\r\n\t}\r\n\r\n\tconst number = limitNumber(valueObject.number, min, max);\r\n\r\n\treturn {\r\n\t\tnumber: number,\r\n\t\tunit: valueObject.unit,\r\n\t\thasTrailingDotBeforeUnit: valueObject.hasTrailingDotBeforeUnit,\r\n\t};\r\n}\r\n\r\n/**\r\n * Limit number with unit based on the min and max values.\r\n *\r\n * Currently only used in `initWpbfControl` in generic-control.ts and responsive-generic-control.ts files.\r\n * Meaning, this function doesn't need to take account of the `hasTrailingDotBeforeUnit` property.\r\n *\r\n * @param {string | number} value The value to parse.\r\n * @param {number | null | undefined} min The minimum value. Null or undefined if not set.\r\n * @param {number | null | undefined} max The maximum value. Null or undefined if not set.\r\n *\r\n * @return {string | number} The returned value can be either `number`, `string`, or concatenation between value and unit.\r\n */\r\nexport function limitNumberWithUnit(\r\n\tvalue: string | number,\r\n\tmin?: number | null,\r\n\tmax?: number | null,\r\n): string | number {\r\n\tif (value === \"\") {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tif (improperNumeric(value)) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tconst numberAndUnit = makeNumberUnitPair(value);\r\n\r\n\tconst number = numberAndUnit.number;\r\n\tconst unit = numberAndUnit.unit;\r\n\r\n\tif (number === \"\") {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tconst limitedNumber = limitNumber(number, min, max);\r\n\r\n\tif (!unit) {\r\n\t\treturn limitedNumber;\r\n\t}\r\n\r\n\treturn `${limitedNumber}${unit}`;\r\n}\r\n","import { colord } from \"colord\";\r\nimport { WpbfColorControlValue } from \"../color-interface\";\r\nimport { isNumeric } from \"../../../Generic/src/number-util\";\r\n\r\n// Thanks to Blocksy for their base64 image data in their color picker control.\r\nexport const colorBgImgData =\r\n\t\"data:image/webp;base64,UklGRjIAAABXRUJQVlA4TCUAAAAvE8AEAA9w7/97/9/7f/7jAYraNmI6AJQ/1xvvMojof2BSvVEBAA==\";\r\n\r\nexport function parseHueModeValue(value: WpbfColorControlValue) {\r\n\tlet hueValue = 0;\r\n\r\n\tif (isNumeric(value)) {\r\n\t\thueValue = Number(value);\r\n\t} else if (typeof value === \"object\" && \"h\" in value) {\r\n\t\thueValue = value.h;\r\n\t} else {\r\n\t\thueValue = typeof value !== \"number\" ? colord(value).toHsl().h : 0;\r\n\t}\r\n\r\n\thueValue = hueValue < 0 ? 0 : hueValue;\r\n\r\n\treturn hueValue > 360 ? 360 : hueValue;\r\n}\r\n\r\nexport function hexColorFromHueModeValue(value: WpbfColorControlValue) {\r\n\tconst hue = parseHueModeValue(value);\r\n\treturn colord({ h: hue, s: 100, l: 50 }).toHex();\r\n}\r\n","import { ChangeEvent, useCallback, useEffect, useState } from \"react\";\r\nimport { colorBgImgData } from \"../utils/misc\";\r\n\r\nexport default function ColorPickerInput(props: {\r\n\tonChange: (color: string) => void;\r\n\tpickerComponent: string;\r\n\tuseHueMode: boolean;\r\n\tcolor?: string | number;\r\n}) {\r\n\tconst { onChange, pickerComponent, useHueMode } = props;\r\n\tconst [value, setValue] = useState(() => props.color);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetValue(props.color);\r\n\t}, [props.color]);\r\n\r\n\tconst handleInputChange = useCallback(\r\n\t\t(e: ChangeEvent) => {\r\n\t\t\tconst target = e.target as HTMLInputElement | undefined;\r\n\t\t\tlet val = target?.value ?? \"\";\r\n\r\n\t\t\tif (2 === val.length) {\r\n\t\t\t\tif (!val.includes(\"#\") && !val.includes(\"rg\") && !val.includes(\"hs\")) {\r\n\t\t\t\t\tval = \"#\" + val;\r\n\t\t\t\t}\r\n\t\t\t} else if (3 === val.length || 6 === val.length) {\r\n\t\t\t\tif (!val.includes(\"#\") && !val.includes(\"rg\") && !val.includes(\"hs\")) {\r\n\t\t\t\t\tval = \"#\" + val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tval = val.toLowerCase();\r\n\r\n\t\t\t// Thank you: https://regexr.com/39cgj\r\n\t\t\tconst pattern = new RegExp(\r\n\t\t\t\t/(?:#|0x)(?:[a-f0-9]{3}|[a-f0-9]{6}|[a-f0-9]{8})\\b|(?:rgb|hsl)a?\\([^)]*\\)/,\r\n\t\t\t);\r\n\r\n\t\t\tif (\"\" === val || pattern.test(val)) {\r\n\t\t\t\t// Run onChange handler passed by `ColorForm` component.\r\n\t\t\t\tonChange(val);\r\n\t\t\t}\r\n\r\n\t\t\tsetValue(val);\r\n\t\t},\r\n\t\t[onChange],\r\n\t);\r\n\r\n\tconst pickersWithAlpha = [\r\n\t\t\"RgbaColorPicker\",\r\n\t\t\"RgbaStringColorPicker\",\r\n\t\t\"HslaColorPicker\",\r\n\t\t\"HslaStringColorPicker\",\r\n\t\t\"HsvaColorPicker\",\r\n\t\t\"HsvaStringColorPicker\",\r\n\t];\r\n\r\n\tconst previewWrapperBgImg = pickersWithAlpha.includes(pickerComponent)\r\n\t\t? `url(\"${colorBgImgData}\")`\r\n\t\t: \"none\";\r\n\r\n\t/**\r\n\t * Parse value to be used as background color.\r\n\t *\r\n\t * This is only used for non-hue mode.\r\n\t */\r\n\tfunction parseBgColorValue() {\r\n\t\tif (useHueMode || typeof value === \"number\") {\r\n\t\t\treturn \"transparent\";\r\n\t\t}\r\n\r\n\t\treturn value ?? \"transparent\";\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"wpbf-color-input-wrapper\">\r\n\t\t\t<div className=\"wpbf-color-input-control\">\r\n\t\t\t\t{!useHueMode && (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"wpbf-color-preview-wrapper\"\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tbackgroundImage: previewWrapperBgImg,\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\tclassName=\"wpbf-color-preview\"\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tbackgroundColor: parseBgColorValue(),\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tvalue={value ?? \"\"}\r\n\t\t\t\t\tclassName=\"wpbf-color-input\"\r\n\t\t\t\t\tspellCheck=\"false\"\r\n\t\t\t\t\tonChange={handleInputChange}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import { useEffect } from \"react\";\r\n\r\nexport default function useFocusOutside(ref: any, handler: any) {\r\n\tuseEffect(() => {\r\n\t\tconst listener = (e: any) => {\r\n\t\t\t// Do nothing if the component hasn't been mounted.\r\n\t\t\tif (!ref.current) return;\r\n\r\n\t\t\t// Do nothing if the focused element is inside the ref or the ref itself.\r\n\t\t\tif (ref.current.contains(e.target)) return;\r\n\r\n\t\t\thandler();\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener(\"focus\", listener, true);\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener(\"focus\", listener, true);\r\n\t\t};\r\n\t}, [ref, handler]);\r\n}\r\n","import { useEffect } from \"react\";\r\n\r\n/**\r\n * Code was taken and then modified from https://codesandbox.io/s/opmco?file=/src/useClickOutside.js:0-1192\r\n * It was improved version of https://usehooks.com/useOnClickOutside/\r\n */\r\nexport default function useClickOutside(\r\n\tpickerRef: any,\r\n\tresetRef: any,\r\n\thandler: any,\r\n) {\r\n\tuseEffect(() => {\r\n\t\tlet startedWhenMounted = false;\r\n\t\tlet startedInside = false;\r\n\r\n\t\tconst listener = (event: any) => {\r\n\t\t\t// Do nothing if `mousedown` or `touchstart` started either inside resetRef or pickerRef element\r\n\t\t\tif (!startedWhenMounted || startedInside) return;\r\n\r\n\t\t\t// Do nothing if clicking resetRef's element or descendent elements\r\n\t\t\tif (!resetRef.current || resetRef.current.contains(event.target)) return;\r\n\r\n\t\t\t// Do nothing if clicking pickerRef's element or descendent elements\r\n\t\t\tif (!pickerRef.current || pickerRef.current.contains(event.target))\r\n\t\t\t\treturn;\r\n\r\n\t\t\thandler();\r\n\t\t};\r\n\r\n\t\tconst validateEventStart = (event: any) => {\r\n\t\t\tstartedWhenMounted = resetRef.current && pickerRef.current;\r\n\t\t\tstartedInside =\r\n\t\t\t\t(resetRef.current && resetRef.current.contains(event.target)) ||\r\n\t\t\t\t(pickerRef.current && pickerRef.current.contains(event.target));\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener(\"mousedown\", validateEventStart);\r\n\t\tdocument.addEventListener(\"touchstart\", validateEventStart);\r\n\t\tdocument.addEventListener(\"click\", listener);\r\n\r\n\t\treturn () => {\r\n\t\t\tdocument.removeEventListener(\"mousedown\", validateEventStart);\r\n\t\t\tdocument.removeEventListener(\"touchstart\", validateEventStart);\r\n\t\t\tdocument.removeEventListener(\"click\", listener);\r\n\t\t};\r\n\t}, [resetRef, pickerRef, handler]);\r\n}\r\n","import e,{useRef as r,useMemo as t,useEffect as n,useState as o,useCallback as a,useLayoutEffect as l}from\"react\";function u(){return(u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function c(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r.indexOf(t=a[n])>=0||(o[t]=e[t]);return o}function i(e){var t=r(e),n=r(function(e){t.current&&t.current(e)});return t.current=e,n.current}var s=function(e,r,t){return void 0===r&&(r=0),void 0===t&&(t=1),e>t?t:e<r?r:e},f=function(e){return\"touches\"in e},v=function(e){return e&&e.ownerDocument.defaultView||self},d=function(e,r,t){var n=e.getBoundingClientRect(),o=f(r)?function(e,r){for(var t=0;t<e.length;t++)if(e[t].identifier===r)return e[t];return e[0]}(r.touches,t):r;return{left:s((o.pageX-(n.left+v(e).pageXOffset))/n.width),top:s((o.pageY-(n.top+v(e).pageYOffset))/n.height)}},h=function(e){!f(e)&&e.preventDefault()},m=e.memo(function(o){var a=o.onMove,l=o.onKey,s=c(o,[\"onMove\",\"onKey\"]),m=r(null),g=i(a),p=i(l),b=r(null),_=r(!1),x=t(function(){var e=function(e){h(e),(f(e)?e.touches.length>0:e.buttons>0)&&m.current?g(d(m.current,e,b.current)):t(!1)},r=function(){return t(!1)};function t(t){var n=_.current,o=v(m.current),a=t?o.addEventListener:o.removeEventListener;a(n?\"touchmove\":\"mousemove\",e),a(n?\"touchend\":\"mouseup\",r)}return[function(e){var r=e.nativeEvent,n=m.current;if(n&&(h(r),!function(e,r){return r&&!f(e)}(r,_.current)&&n)){if(f(r)){_.current=!0;var o=r.changedTouches||[];o.length&&(b.current=o[0].identifier)}n.focus(),g(d(n,r,b.current)),t(!0)}},function(e){var r=e.which||e.keyCode;r<37||r>40||(e.preventDefault(),p({left:39===r?.05:37===r?-.05:0,top:40===r?.05:38===r?-.05:0}))},t]},[p,g]),C=x[0],E=x[1],H=x[2];return n(function(){return H},[H]),e.createElement(\"div\",u({},s,{onTouchStart:C,onMouseDown:C,className:\"react-colorful__interactive\",ref:m,onKeyDown:E,tabIndex:0,role:\"slider\"}))}),g=function(e){return e.filter(Boolean).join(\" \")},p=function(r){var t=r.color,n=r.left,o=r.top,a=void 0===o?.5:o,l=g([\"react-colorful__pointer\",r.className]);return e.createElement(\"div\",{className:l,style:{top:100*a+\"%\",left:100*n+\"%\"}},e.createElement(\"div\",{className:\"react-colorful__pointer-fill\",style:{backgroundColor:t}}))},b=function(e,r,t){return void 0===r&&(r=0),void 0===t&&(t=Math.pow(10,r)),Math.round(t*e)/t},_={grad:.9,turn:360,rad:360/(2*Math.PI)},x=function(e){return L(C(e))},C=function(e){return\"#\"===e[0]&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?b(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:8===e.length?b(parseInt(e.substring(6,8),16)/255,2):1}},E=function(e,r){return void 0===r&&(r=\"deg\"),Number(e)*(_[r]||1)},H=function(e){var r=/hsla?\\(?\\s*(-?\\d*\\.?\\d+)(deg|rad|grad|turn)?[,\\s]+(-?\\d*\\.?\\d+)%?[,\\s]+(-?\\d*\\.?\\d+)%?,?\\s*[/\\s]*(-?\\d*\\.?\\d+)?(%)?\\s*\\)?/i.exec(e);return r?N({h:E(r[1],r[2]),s:Number(r[3]),l:Number(r[4]),a:void 0===r[5]?1:Number(r[5])/(r[6]?100:1)}):{h:0,s:0,v:0,a:1}},M=H,N=function(e){var r=e.s,t=e.l;return{h:e.h,s:(r*=(t<50?t:100-t)/100)>0?2*r/(t+r)*100:0,v:t+r,a:e.a}},w=function(e){return K(I(e))},y=function(e){var r=e.s,t=e.v,n=e.a,o=(200-r)*t/100;return{h:b(e.h),s:b(o>0&&o<200?r*t/100/(o<=100?o:200-o)*100:0),l:b(o/2),a:b(n,2)}},q=function(e){var r=y(e);return\"hsl(\"+r.h+\", \"+r.s+\"%, \"+r.l+\"%)\"},k=function(e){var r=y(e);return\"hsla(\"+r.h+\", \"+r.s+\"%, \"+r.l+\"%, \"+r.a+\")\"},I=function(e){var r=e.h,t=e.s,n=e.v,o=e.a;r=r/360*6,t/=100,n/=100;var a=Math.floor(r),l=n*(1-t),u=n*(1-(r-a)*t),c=n*(1-(1-r+a)*t),i=a%6;return{r:b(255*[n,u,l,l,c,n][i]),g:b(255*[c,n,n,u,l,l][i]),b:b(255*[l,l,c,n,n,u][i]),a:b(o,2)}},O=function(e){var r=/hsva?\\(?\\s*(-?\\d*\\.?\\d+)(deg|rad|grad|turn)?[,\\s]+(-?\\d*\\.?\\d+)%?[,\\s]+(-?\\d*\\.?\\d+)%?,?\\s*[/\\s]*(-?\\d*\\.?\\d+)?(%)?\\s*\\)?/i.exec(e);return r?A({h:E(r[1],r[2]),s:Number(r[3]),v:Number(r[4]),a:void 0===r[5]?1:Number(r[5])/(r[6]?100:1)}):{h:0,s:0,v:0,a:1}},j=O,z=function(e){var r=/rgba?\\(?\\s*(-?\\d*\\.?\\d+)(%)?[,\\s]+(-?\\d*\\.?\\d+)(%)?[,\\s]+(-?\\d*\\.?\\d+)(%)?,?\\s*[/\\s]*(-?\\d*\\.?\\d+)?(%)?\\s*\\)?/i.exec(e);return r?L({r:Number(r[1])/(r[2]?100/255:1),g:Number(r[3])/(r[4]?100/255:1),b:Number(r[5])/(r[6]?100/255:1),a:void 0===r[7]?1:Number(r[7])/(r[8]?100:1)}):{h:0,s:0,v:0,a:1}},B=z,D=function(e){var r=e.toString(16);return r.length<2?\"0\"+r:r},K=function(e){var r=e.r,t=e.g,n=e.b,o=e.a,a=o<1?D(b(255*o)):\"\";return\"#\"+D(r)+D(t)+D(n)+a},L=function(e){var r=e.r,t=e.g,n=e.b,o=e.a,a=Math.max(r,t,n),l=a-Math.min(r,t,n),u=l?a===r?(t-n)/l:a===t?2+(n-r)/l:4+(r-t)/l:0;return{h:b(60*(u<0?u+6:u)),s:b(a?l/a*100:0),v:b(a/255*100),a:o}},A=function(e){return{h:b(e.h),s:b(e.s),v:b(e.v),a:b(e.a,2)}},S=e.memo(function(r){var t=r.hue,n=r.onChange,o=g([\"react-colorful__hue\",r.className]);return e.createElement(\"div\",{className:o},e.createElement(m,{onMove:function(e){n({h:360*e.left})},onKey:function(e){n({h:s(t+360*e.left,0,360)})},\"aria-label\":\"Hue\",\"aria-valuenow\":b(t),\"aria-valuemax\":\"360\",\"aria-valuemin\":\"0\"},e.createElement(p,{className:\"react-colorful__hue-pointer\",left:t/360,color:q({h:t,s:100,v:100,a:1})})))}),T=e.memo(function(r){var t=r.hsva,n=r.onChange,o={backgroundColor:q({h:t.h,s:100,v:100,a:1})};return e.createElement(\"div\",{className:\"react-colorful__saturation\",style:o},e.createElement(m,{onMove:function(e){n({s:100*e.left,v:100-100*e.top})},onKey:function(e){n({s:s(t.s+100*e.left,0,100),v:s(t.v-100*e.top,0,100)})},\"aria-label\":\"Color\",\"aria-valuetext\":\"Saturation \"+b(t.s)+\"%, Brightness \"+b(t.v)+\"%\"},e.createElement(p,{className:\"react-colorful__saturation-pointer\",top:1-t.v/100,left:t.s/100,color:q(t)})))}),F=function(e,r){if(e===r)return!0;for(var t in e)if(e[t]!==r[t])return!1;return!0},P=function(e,r){return e.replace(/\\s/g,\"\")===r.replace(/\\s/g,\"\")},X=function(e,r){return e.toLowerCase()===r.toLowerCase()||F(C(e),C(r))};function Y(e,t,l){var u=i(l),c=o(function(){return e.toHsva(t)}),s=c[0],f=c[1],v=r({color:t,hsva:s});n(function(){if(!e.equal(t,v.current.color)){var r=e.toHsva(t);v.current={hsva:r,color:t},f(r)}},[t,e]),n(function(){var r;F(s,v.current.hsva)||e.equal(r=e.fromHsva(s),v.current.color)||(v.current={hsva:s,color:r},u(r))},[s,e,u]);var d=a(function(e){f(function(r){return Object.assign({},r,e)})},[]);return[s,d]}var R,V=\"undefined\"!=typeof window?l:n,$=function(){return R||(\"undefined\"!=typeof __webpack_nonce__?__webpack_nonce__:void 0)},G=function(e){R=e},J=new Map,Q=function(e){V(function(){var r=e.current?e.current.ownerDocument:document;if(void 0!==r&&!J.has(r)){var t=r.createElement(\"style\");t.innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:\"\";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\\'data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill-opacity=\".05\"><path d=\"M8 0h8v8H8zM0 8h8v8H0z\"/></svg>\\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}',J.set(r,t);var n=$();n&&t.setAttribute(\"nonce\",n),r.head.appendChild(t)}},[])},U=function(t){var n=t.className,o=t.colorModel,a=t.color,l=void 0===a?o.defaultColor:a,i=t.onChange,s=c(t,[\"className\",\"colorModel\",\"color\",\"onChange\"]),f=r(null);Q(f);var v=Y(o,l,i),d=v[0],h=v[1],m=g([\"react-colorful\",n]);return e.createElement(\"div\",u({},s,{ref:f,className:m}),e.createElement(T,{hsva:d,onChange:h}),e.createElement(S,{hue:d.h,onChange:h,className:\"react-colorful__last-control\"}))},W={defaultColor:\"000\",toHsva:x,fromHsva:function(e){return w({h:e.h,s:e.s,v:e.v,a:1})},equal:X},Z=function(r){return e.createElement(U,u({},r,{colorModel:W}))},ee=function(r){var t=r.className,n=r.hsva,o=r.onChange,a={backgroundImage:\"linear-gradient(90deg, \"+k(Object.assign({},n,{a:0}))+\", \"+k(Object.assign({},n,{a:1}))+\")\"},l=g([\"react-colorful__alpha\",t]),u=b(100*n.a);return e.createElement(\"div\",{className:l},e.createElement(\"div\",{className:\"react-colorful__alpha-gradient\",style:a}),e.createElement(m,{onMove:function(e){o({a:e.left})},onKey:function(e){o({a:s(n.a+e.left)})},\"aria-label\":\"Alpha\",\"aria-valuetext\":u+\"%\",\"aria-valuenow\":u,\"aria-valuemin\":\"0\",\"aria-valuemax\":\"100\"},e.createElement(p,{className:\"react-colorful__alpha-pointer\",left:n.a,color:k(n)})))},re=function(t){var n=t.className,o=t.colorModel,a=t.color,l=void 0===a?o.defaultColor:a,i=t.onChange,s=c(t,[\"className\",\"colorModel\",\"color\",\"onChange\"]),f=r(null);Q(f);var v=Y(o,l,i),d=v[0],h=v[1],m=g([\"react-colorful\",n]);return e.createElement(\"div\",u({},s,{ref:f,className:m}),e.createElement(T,{hsva:d,onChange:h}),e.createElement(S,{hue:d.h,onChange:h}),e.createElement(ee,{hsva:d,onChange:h,className:\"react-colorful__last-control\"}))},te={defaultColor:\"0001\",toHsva:x,fromHsva:w,equal:X},ne=function(r){return e.createElement(re,u({},r,{colorModel:te}))},oe={defaultColor:{h:0,s:0,l:0,a:1},toHsva:N,fromHsva:y,equal:F},ae=function(r){return e.createElement(re,u({},r,{colorModel:oe}))},le={defaultColor:\"hsla(0, 0%, 0%, 1)\",toHsva:H,fromHsva:k,equal:P},ue=function(r){return e.createElement(re,u({},r,{colorModel:le}))},ce={defaultColor:{h:0,s:0,l:0},toHsva:function(e){return N({h:e.h,s:e.s,l:e.l,a:1})},fromHsva:function(e){return{h:(r=y(e)).h,s:r.s,l:r.l};var r},equal:F},ie=function(r){return e.createElement(U,u({},r,{colorModel:ce}))},se={defaultColor:\"hsl(0, 0%, 0%)\",toHsva:M,fromHsva:q,equal:P},fe=function(r){return e.createElement(U,u({},r,{colorModel:se}))},ve={defaultColor:{h:0,s:0,v:0,a:1},toHsva:function(e){return e},fromHsva:A,equal:F},de=function(r){return e.createElement(re,u({},r,{colorModel:ve}))},he={defaultColor:\"hsva(0, 0%, 0%, 1)\",toHsva:O,fromHsva:function(e){var r=A(e);return\"hsva(\"+r.h+\", \"+r.s+\"%, \"+r.v+\"%, \"+r.a+\")\"},equal:P},me=function(r){return e.createElement(re,u({},r,{colorModel:he}))},ge={defaultColor:{h:0,s:0,v:0},toHsva:function(e){return{h:e.h,s:e.s,v:e.v,a:1}},fromHsva:function(e){var r=A(e);return{h:r.h,s:r.s,v:r.v}},equal:F},pe=function(r){return e.createElement(U,u({},r,{colorModel:ge}))},be={defaultColor:\"hsv(0, 0%, 0%)\",toHsva:j,fromHsva:function(e){var r=A(e);return\"hsv(\"+r.h+\", \"+r.s+\"%, \"+r.v+\"%)\"},equal:P},_e=function(r){return e.createElement(U,u({},r,{colorModel:be}))},xe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:L,fromHsva:I,equal:F},Ce=function(r){return e.createElement(re,u({},r,{colorModel:xe}))},Ee={defaultColor:\"rgba(0, 0, 0, 1)\",toHsva:z,fromHsva:function(e){var r=I(e);return\"rgba(\"+r.r+\", \"+r.g+\", \"+r.b+\", \"+r.a+\")\"},equal:P},He=function(r){return e.createElement(re,u({},r,{colorModel:Ee}))},Me={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return L({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(r=I(e)).r,g:r.g,b:r.b};var r},equal:F},Ne=function(r){return e.createElement(U,u({},r,{colorModel:Me}))},we={defaultColor:\"rgb(0, 0, 0)\",toHsva:B,fromHsva:function(e){var r=I(e);return\"rgb(\"+r.r+\", \"+r.g+\", \"+r.b+\")\"},equal:P},ye=function(r){return e.createElement(U,u({},r,{colorModel:we}))},qe=/^#?([0-9A-F]{3,8})$/i,ke=function(r){var t=r.color,l=void 0===t?\"\":t,s=r.onChange,f=r.onBlur,v=r.escape,d=r.validate,h=r.format,m=r.process,g=c(r,[\"color\",\"onChange\",\"onBlur\",\"escape\",\"validate\",\"format\",\"process\"]),p=o(function(){return v(l)}),b=p[0],_=p[1],x=i(s),C=i(f),E=a(function(e){var r=v(e.target.value);_(r),d(r)&&x(m?m(r):r)},[v,m,d,x]),H=a(function(e){d(e.target.value)||_(v(l)),C(e)},[l,v,d,C]);return n(function(){_(v(l))},[l,v]),e.createElement(\"input\",u({},g,{value:h?h(b):b,spellCheck:\"false\",onChange:E,onBlur:H}))},Ie=function(e){return\"#\"+e},Oe=function(r){var t=r.prefixed,n=r.alpha,o=c(r,[\"prefixed\",\"alpha\"]),l=a(function(e){return e.replace(/([^0-9A-F]+)/gi,\"\").substring(0,n?8:6)},[n]),i=a(function(e){return function(e,r){var t=qe.exec(e),n=t?t[1].length:0;return 3===n||6===n||!!r&&4===n||!!r&&8===n}(e,n)},[n]);return e.createElement(ke,u({},o,{escape:l,format:t?Ie:void 0,process:Ie,validate:i}))};export{ne as HexAlphaColorPicker,Oe as HexColorInput,Z as HexColorPicker,ie as HslColorPicker,fe as HslStringColorPicker,ae as HslaColorPicker,ue as HslaStringColorPicker,pe as HsvColorPicker,_e as HsvStringColorPicker,de as HsvaColorPicker,me as HsvaStringColorPicker,Ne as RgbColorPicker,ye as RgbStringColorPicker,Ce as RgbaColorPicker,He as RgbaStringColorPicker,G as setNonce};\n//# sourceMappingURL=index.module.js.map\n","import {\r\n\tHexColorPicker,\r\n\tHslaColorPicker,\r\n\tHslaStringColorPicker,\r\n\tHslColorPicker,\r\n\tHslStringColorPicker,\r\n\tHsvaColorPicker,\r\n\tHsvaStringColorPicker,\r\n\tHsvColorPicker,\r\n\tHsvStringColorPicker,\r\n\tRgbaColorPicker,\r\n\tRgbaStringColorPicker,\r\n\tRgbColorPicker,\r\n\tRgbStringColorPicker,\r\n} from \"react-colorful\";\r\nimport {\r\n\tHslaColor,\r\n\tHslColor,\r\n\tHsvaColor,\r\n\tHsvColor,\r\n\tRgbaColor,\r\n\tRgbColor,\r\n} from \"colord\";\r\nimport { WpbfColorPickerValue } from \"../color-interface\";\r\n\r\nexport default function ColorPickerComponent(props: {\r\n\tpickerComponent: string;\r\n\tvalue: WpbfColorPickerValue;\r\n\tonChange: (e: WpbfColorPickerValue) => void;\r\n}) {\r\n\tconst { pickerComponent, value, onChange } = props;\r\n\r\n\tswitch (pickerComponent) {\r\n\t\tcase \"HexColorPicker\":\r\n\t\t\treturn <HexColorPicker color={value as string} onChange={onChange} />;\r\n\t\tcase \"RgbColorPicker\":\r\n\t\t\treturn <RgbColorPicker color={value as RgbColor} onChange={onChange} />;\r\n\t\tcase \"RgbStringColorPicker\":\r\n\t\t\treturn (\r\n\t\t\t\t<RgbStringColorPicker color={value as string} onChange={onChange} />\r\n\t\t\t);\r\n\t\tcase \"RgbaColorPicker\":\r\n\t\t\treturn <RgbaColorPicker color={value as RgbaColor} onChange={onChange} />;\r\n\t\tcase \"RgbaStringColorPicker\":\r\n\t\t\treturn (\r\n\t\t\t\t<RgbaStringColorPicker color={value as string} onChange={onChange} />\r\n\t\t\t);\r\n\t\t// We treat HueColorPicker (hue mode) as HslColorPicker.\r\n\t\tcase \"HueColorPicker\":\r\n\t\t\treturn <HslColorPicker color={value as HslColor} onChange={onChange} />;\r\n\t\tcase \"HslColorPicker\":\r\n\t\t\treturn <HslColorPicker color={value as HslColor} onChange={onChange} />;\r\n\t\tcase \"HslStringColorPicker\":\r\n\t\t\treturn (\r\n\t\t\t\t<HslStringColorPicker color={value as string} onChange={onChange} />\r\n\t\t\t);\r\n\t\tcase \"HslaColorPicker\":\r\n\t\t\treturn <HslaColorPicker color={value as HslaColor} onChange={onChange} />;\r\n\t\tcase \"HslaStringColorPicker\":\r\n\t\t\treturn (\r\n\t\t\t\t<HslaStringColorPicker color={value as string} onChange={onChange} />\r\n\t\t\t);\r\n\t\tcase \"HsvColorPicker\":\r\n\t\t\treturn <HsvColorPicker color={value as HsvColor} onChange={onChange} />;\r\n\t\tcase \"HsvStringColorPicker\":\r\n\t\t\treturn (\r\n\t\t\t\t<HsvStringColorPicker color={value as string} onChange={onChange} />\r\n\t\t\t);\r\n\t\tcase \"HsvaColorPicker\":\r\n\t\t\treturn <HsvaColorPicker color={value as HsvaColor} onChange={onChange} />;\r\n\t\tcase \"HsvaStringColorPicker\":\r\n\t\t\treturn (\r\n\t\t\t\t<HsvaStringColorPicker color={value as string} onChange={onChange} />\r\n\t\t\t);\r\n\t\tdefault:\r\n\t\t\treturn <HexColorPicker color={value as string} onChange={onChange} />;\r\n\t}\r\n}\r\n","import { colorBgImgData } from \"../utils/misc\";\r\n\r\nexport default function ColorPickerCirleTrigger(props: {\r\n\tcolor: string;\r\n\tisPopupOpen: boolean;\r\n\ttooltip?: JSX.Element | string;\r\n\tresetRef?: React.MutableRefObject<HTMLButtonElement | null>;\r\n\tonResetButtonClick?: () => void;\r\n\tonToggleButtonClick?: () => void;\r\n}) {\r\n\tconst {\r\n\t\tisPopupOpen,\r\n\t\ttooltip,\r\n\t\tresetRef,\r\n\t\tonResetButtonClick,\r\n\t\tonToggleButtonClick,\r\n\t} = props;\r\n\r\n\tconst triggerButtonBgImage = `url(\"${colorBgImgData}\")`;\r\n\r\n\tfunction hasResetButton() {\r\n\t\treturn resetRef && onResetButtonClick;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{hasResetButton() && (\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tref={resetRef}\r\n\t\t\t\t\tclassName={`wpbf-control-reset${isPopupOpen ? \" is-shown\" : \"\"}`}\r\n\t\t\t\t\tonClick={onResetButtonClick}\r\n\t\t\t\t>\r\n\t\t\t\t\t<i className=\"dashicons dashicons-image-rotate\"></i>\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\r\n\t\t\t<div className=\"wpbf-trigger-circle-wrapper\">\r\n\t\t\t\t{tooltip && <div className=\"wpbf-label-tooltip\">{tooltip}</div>}\r\n\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tclassName=\"wpbf-trigger-circle\"\r\n\t\t\t\t\tonClick={onToggleButtonClick}\r\n\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\tbackgroundImage: triggerButtonBgImage,\r\n\t\t\t\t\t}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"wpbf-color-preview\"\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tbackgroundColor: props.color ? props.color : \"transparent\",\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t></div>\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","export default function ControlLabel(props: {\r\n\tlabel: string;\r\n\tdescription: string;\r\n\tsetNotificationContainer?: any;\r\n}) {\r\n\tconst { label, description, setNotificationContainer } = props;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t{label || description ? (\r\n\t\t\t\t<label className=\"wpbf-control-label\">\r\n\t\t\t\t\t{label && (\r\n\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\tclassName=\"customize-control-title\"\r\n\t\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: label }}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{description && (\r\n\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\tclassName=\"description customize-control-description\"\r\n\t\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: description }}\r\n\t\t\t\t\t\t></span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</label>\r\n\t\t\t) : (\r\n\t\t\t\t\"\"\r\n\t\t\t)}\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"customize-control-notifications-container\"\r\n\t\t\t\tref={setNotificationContainer}\r\n\t\t\t/>\r\n\t\t</>\r\n\t);\r\n}\r\n","import ColorPickerCirleTrigger from \"./ColorPickerCircleTrigger\";\r\nimport ControlLabel from \"./ControlLabel\";\r\nimport { hexColorFromHueModeValue } from \"../utils/misc\";\r\nimport { ColorControlLabelStyle } from \"../color-interface\";\r\n\r\nexport default function ControlHeader(props: {\r\n\tlabel: string;\r\n\tdescription: string;\r\n\tlabelStyle: ColorControlLabelStyle;\r\n\tpickerComponent: string;\r\n\tuseHueMode: boolean;\r\n\tinputValue?: string | number;\r\n\tisPopupOpen?: boolean;\r\n\ttogglePicker?: () => void;\r\n\tresetRef?: React.MutableRefObject<HTMLButtonElement | null>;\r\n\tonResetButtonClick: () => void;\r\n\tsetNotificationContainer?: any;\r\n}) {\r\n\tconst { label, description, labelStyle, setNotificationContainer } = props;\r\n\r\n\tfunction renderLabel() {\r\n\t\treturn (\r\n\t\t\t<ControlLabel\r\n\t\t\t\tlabel={label}\r\n\t\t\t\tdescription={description}\r\n\t\t\t\tsetNotificationContainer={setNotificationContainer}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\tfunction renderTrigger(useTooltip?: boolean) {\r\n\t\tif (\r\n\t\t\ttypeof props.inputValue === \"undefined\" ||\r\n\t\t\ttypeof props.isPopupOpen === \"undefined\"\r\n\t\t) {\r\n\t\t\treturn <></>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"wpbf-buttons\">\r\n\t\t\t\t<ColorPickerCirleTrigger\r\n\t\t\t\t\tcolor={String(\r\n\t\t\t\t\t\tprops.useHueMode\r\n\t\t\t\t\t\t\t? hexColorFromHueModeValue(props.inputValue)\r\n\t\t\t\t\t\t\t: props.inputValue,\r\n\t\t\t\t\t)}\r\n\t\t\t\t\tisPopupOpen={props.isPopupOpen}\r\n\t\t\t\t\tresetRef={props.resetRef}\r\n\t\t\t\t\tonToggleButtonClick={props.togglePicker}\r\n\t\t\t\t\tonResetButtonClick={props.onResetButtonClick}\r\n\t\t\t\t\ttooltip={useTooltip && !props.isPopupOpen ? label : undefined}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tswitch (labelStyle) {\r\n\t\tcase \"tooltip\":\r\n\t\t\treturn <>{renderTrigger(true)}</>;\r\n\r\n\t\tcase \"top\":\r\n\t\t\treturn (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{renderLabel()}\r\n\t\t\t\t\t{renderTrigger()}\r\n\t\t\t\t</>\r\n\t\t\t);\r\n\r\n\t\tcase \"label_only\":\r\n\t\t\treturn renderLabel();\r\n\r\n\t\tcase \"none\":\r\n\t\t\treturn renderTrigger();\r\n\r\n\t\tdefault:\r\n\t\t\treturn (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<div className=\"wpbf-control-cols\">\r\n\t\t\t\t\t\t<div className=\"wpbf-control-left-col\">{renderLabel()}</div>\r\n\t\t\t\t\t\t<div className=\"wpbf-control-right-col\">{renderTrigger()}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t);\r\n\t}\r\n}\r\n","import { colord } from \"colord\";\r\nimport { WpbfColorControlValue } from \"../color-interface\";\r\nimport { parseHueModeValue } from \"./misc\";\r\n\r\n/**\r\n * Convert the value for the color input.\r\n *\r\n * @param {WpbfColorControlValue} value - The value to be converted.\r\n * @param {string} pickerComponent - The picker component name.\r\n * @param {string|undefined} formComponent - The form component name.\r\n *\r\n * @returns {string} The converted value.\r\n */\r\nexport default function convertColorForInput(\r\n\tvalue: WpbfColorControlValue,\r\n\tuseHueMode: boolean,\r\n\tpickerComponent: string,\r\n\tformComponent?: string,\r\n): string {\r\n\tif (\"\" === value) return \"\";\r\n\r\n\tif (useHueMode) {\r\n\t\treturn String(parseHueModeValue(value));\r\n\t}\r\n\r\n\t// If hudeMode is false, but value is a number, then return empty string.\r\n\tif (typeof value === \"number\") return \"\";\r\n\r\n\tlet rgba;\r\n\tlet hsv;\r\n\tlet hsva;\r\n\tlet convertedValue;\r\n\r\n\tswitch (pickerComponent) {\r\n\t\t/**\r\n\t\t * The HexColorPicker is used by these condition:\r\n\t\t * 1. When formComponent is defined with HexColorPicker as the value.\r\n\t\t * 2. When formComponent is not defined but the \"alpha\" choice is not set or set to false (the old way).\r\n\t\t */\r\n\t\tcase \"HexColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"#\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toHex();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"rgb(\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toRgbString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbStringColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"rgba\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toRgbString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbaColorPicker\":\r\n\t\t\trgba = colord(value).toRgb();\r\n\r\n\t\t\tif (rgba.a < 1) {\r\n\t\t\t\tconvertedValue =\r\n\t\t\t\t\t\"string\" === typeof value && value.includes(\"rgba\")\r\n\t\t\t\t\t\t? value\r\n\t\t\t\t\t\t: colord(value).toRgbString();\r\n\t\t\t} else {\r\n\t\t\t\tconvertedValue = colord(value).toRgbString();\r\n\r\n\t\t\t\t// Force to set the alpha value.\r\n\t\t\t\tif (\r\n\t\t\t\t\tconvertedValue.includes(\"rgb\") &&\r\n\t\t\t\t\t!convertedValue.includes(\"rgba\")\r\n\t\t\t\t) {\r\n\t\t\t\t\tconvertedValue = convertedValue.replace(\"rgb\", \"rgba\");\r\n\t\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t/**\r\n\t\t * The RgbaStringColorPicker is used by these condition:\r\n\t\t * 1. When formComponent is defined with RgbaColorPicker as the value.\r\n\t\t * 2. When formComponent is not defined but the \"alpha\" choice is set to true.\r\n\t\t */\r\n\t\tcase \"RgbaStringColorPicker\":\r\n\t\t\trgba = colord(value).toRgb();\r\n\r\n\t\t\t// When it uses the 2nd condition above, then the expected value is \"hex\".\r\n\t\t\tif (rgba.a == 1 && !formComponent) {\r\n\t\t\t\tconvertedValue =\r\n\t\t\t\t\t\"string\" === typeof value && value.includes(\"#\")\r\n\t\t\t\t\t\t? value\r\n\t\t\t\t\t\t: colord(value).toHex();\r\n\t\t\t} else {\r\n\t\t\t\tconvertedValue = colord(value).toRgbString();\r\n\r\n\t\t\t\t// Force to set the alpha value.\r\n\t\t\t\tif (\r\n\t\t\t\t\tconvertedValue.includes(\"rgb\") &&\r\n\t\t\t\t\t!convertedValue.includes(\"rgba\")\r\n\t\t\t\t) {\r\n\t\t\t\t\tconvertedValue = convertedValue.replace(\"rgb\", \"rgba\");\r\n\t\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"hsl(\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toHslString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslStringColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"hsl(\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toHslString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslaColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHslString();\r\n\r\n\t\t\t// Force to set the alpha value.\r\n\t\t\tif (convertedValue.includes(\"hsl\") && !convertedValue.includes(\"hsla\")) {\r\n\t\t\t\tconvertedValue = convertedValue.replace(\"hsl\", \"hsla\");\r\n\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslaStringColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHslString();\r\n\r\n\t\t\t// Force to set the alpha value.\r\n\t\t\tif (convertedValue.includes(\"hsl\") && !convertedValue.includes(\"hsla\")) {\r\n\t\t\t\tconvertedValue = convertedValue.replace(\"hsl\", \"hsla\");\r\n\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\t/**\r\n\t\t * The colord library doesn't provide .toHsvString() method yet.\r\n\t\t * This manual value-building will apply to \"hsv\" and \"hsva\" stuff below.\r\n\t\t */\r\n\t\tcase \"HsvColorPicker\":\r\n\t\t\thsv = colord(value).toHsv();\r\n\t\t\tconvertedValue = \"hsv(\" + hsv.h + \", \" + hsv.s + \"%, \" + hsv.v + \"%)\";\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvStringColorPicker\":\r\n\t\t\thsv = colord(value).toHsv();\r\n\t\t\tconvertedValue = \"hsv(\" + hsv.h + \", \" + hsv.s + \"%, \" + hsv.v + \"%)\";\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvaColorPicker\":\r\n\t\t\thsva = colord(value).toHsv();\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"hsva(\" +\r\n\t\t\t\thsva.h +\r\n\t\t\t\t\", \" +\r\n\t\t\t\thsva.s +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.v +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.a +\r\n\t\t\t\t\")\";\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvaStringColorPicker\":\r\n\t\t\thsva = colord(value).toHsv();\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"hsva(\" +\r\n\t\t\t\thsva.h +\r\n\t\t\t\t\", \" +\r\n\t\t\t\thsva.s +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.v +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.a +\r\n\t\t\t\t\")\";\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tconvertedValue = colord(value).toHex();\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn convertedValue.replace(\";\", \"\");\r\n}\r\n","import { colord } from \"colord\";\r\nimport {\r\n\tWpbfColorPickerValue,\r\n\tWpbfColorControlValue,\r\n} from \"../color-interface\";\r\nimport { parseHueModeValue } from \"./misc\";\r\n\r\n/**\r\n * Convert the value for the color picker.\r\n *\r\n * @param {WpbfColorControlValue} value - The value to be converted.\r\n * @param {string} pickerComponent - The picker component name.\r\n *\r\n * @returns {WpbfColorPickerValue} The converted value.\r\n */\r\nexport default function convertColorForPicker(\r\n\tvalue: WpbfColorControlValue,\r\n\tuseHueMode: boolean,\r\n\tpickerComponent: string,\r\n): WpbfColorPickerValue {\r\n\tlet convertedValue;\r\n\r\n\tif (useHueMode) {\r\n\t\tconst hueValue = parseHueModeValue(value);\r\n\r\n\t\t// Hard coded saturation and lightness when using hue mode.\r\n\t\treturn { h: hueValue, s: 100, l: 50 };\r\n\t}\r\n\r\n\t// If hudeMode is false, but value is a number, then hardcode the value to #000000.\r\n\tif (typeof value === \"number\") {\r\n\t\tvalue = \"#000000\";\r\n\t}\r\n\r\n\tswitch (pickerComponent) {\r\n\t\tcase \"HexColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHex();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toRgb();\r\n\t\t\tconvertedValue = {\r\n\t\t\t\tr: convertedValue.r,\r\n\t\t\t\tg: convertedValue.g,\r\n\t\t\t\tb: convertedValue.b,\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbStringColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toRgbString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbaColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toRgb();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbaStringColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toRgbString();\r\n\r\n\t\t\t// Force to set the alpha channel value.\r\n\t\t\tif (convertedValue.includes(\"rgb\") && !convertedValue.includes(\"rgba\")) {\r\n\t\t\t\tconvertedValue = convertedValue.replace(\"rgb\", \"rgba\");\r\n\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsl();\r\n\t\t\tconvertedValue = {\r\n\t\t\t\th: convertedValue.h,\r\n\t\t\t\ts: convertedValue.s,\r\n\t\t\t\tl: convertedValue.l,\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslStringColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHslString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslaColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsl();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslaStringColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHslString();\r\n\r\n\t\t\t// Force to set the alpha channel value.\r\n\t\t\tif (convertedValue.includes(\"hsl\") && !convertedValue.includes(\"hsla\")) {\r\n\t\t\t\tconvertedValue = convertedValue.replace(\"hsl\", \"hsla\");\r\n\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsv();\r\n\t\t\tconvertedValue = {\r\n\t\t\t\th: convertedValue.h,\r\n\t\t\t\ts: convertedValue.s,\r\n\t\t\t\tv: convertedValue.v,\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvStringColorPicker\":\r\n\t\t\tconst hsv = colord(value).toHsv();\r\n\t\t\tconvertedValue = \"hsv(\" + hsv.h + \", \" + hsv.s + \"%, \" + hsv.v + \"%)\";\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvaColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsv();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvaStringColorPicker\":\r\n\t\t\t// colord library doesn't provide .toHsvString() method yet.\r\n\t\t\tconst hsva = colord(value).toHsv();\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"hsva(\" +\r\n\t\t\t\thsva.h +\r\n\t\t\t\t\", \" +\r\n\t\t\t\thsva.s +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.v +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.a +\r\n\t\t\t\t\")\";\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tconvertedValue = colord(value).toHex();\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn convertedValue;\r\n}\r\n","import { useEffect, useRef, useState } from \"react\";\r\nimport { colord } from \"colord\";\r\nimport ColorPickerSwatches from \"./components/ColorPickerSwatches\";\r\nimport ColorPickerInput from \"./components/ColorPickerInput\";\r\nimport useWindowResize from \"./hooks/useWindowResize\";\r\nimport useFocusOutside from \"./hooks/useFocusOutside\";\r\nimport useClickOutside from \"./hooks/useClickOutside\";\r\nimport ColorPickerComponent from \"./components/ColorPickerComponent\";\r\nimport ControlHeader from \"./components/ControlHeader\";\r\nimport {\r\n\tColorControlLabelStyle,\r\n\tWpbfColorControlValue,\r\n} from \"./color-interface\";\r\nimport convertColorForInput from \"./utils/convert-color-for-input\";\r\nimport convertColorForPicker from \"./utils/convert-color-for-picker\";\r\n\r\n/**\r\n * The form component of Kirki React Colorful.\r\n */\r\nexport default function ColorForm(props: {\r\n\ttype: string;\r\n\tcontainer: HTMLElement;\r\n\tlabel: string;\r\n\tdescription: string;\r\n\tuseHueMode: boolean;\r\n\tpickerComponent: string;\r\n\tlabelStyle: ColorControlLabelStyle;\r\n\tcolorSwatches: Array<string | { color: string } | undefined>;\r\n\tvalue: WpbfColorControlValue;\r\n\tdefault: WpbfColorControlValue;\r\n\tformComponent?: string;\r\n\tremoveHeader?: boolean;\r\n\tisPopupOpen?: boolean;\r\n\tuseExternalPopupToggle?: boolean;\r\n\tonChange?: (value: WpbfColorControlValue) => void;\r\n\tonReset?: () => void;\r\n\toverrideUpdateComponentStateFn?: (\r\n\t\tfn: (val: WpbfColorControlValue) => void,\r\n\t) => void;\r\n\tsetNotificationContainer?: any;\r\n}) {\r\n\tconst {\r\n\t\tcontainer,\r\n\t\tuseHueMode,\r\n\t\tpickerComponent,\r\n\t\tformComponent,\r\n\t\tlabel,\r\n\t\tdescription,\r\n\t\tlabelStyle,\r\n\t\tuseExternalPopupToggle,\r\n\t} = props;\r\n\r\n\tconst [inputValue, setInputValue] = useState(() => {\r\n\t\treturn convertColorForInput(\r\n\t\t\tprops.value,\r\n\t\t\tuseHueMode,\r\n\t\t\tpickerComponent,\r\n\t\t\tformComponent,\r\n\t\t);\r\n\t});\r\n\r\n\tconst [pickerValue, setPickerValue] = useState(() => {\r\n\t\treturn convertColorForPicker(props.value, useHueMode, pickerComponent);\r\n\t});\r\n\r\n\tlet currentInputValue = inputValue;\r\n\tlet currentPickerValue = pickerValue;\r\n\r\n\t// This function will be called when this control's customizer value is changed.\r\n\tfunction updateComponentState(value: WpbfColorControlValue) {\r\n\t\tconst valueForInput = convertColorForInput(\r\n\t\t\tvalue,\r\n\t\t\tuseHueMode,\r\n\t\t\tpickerComponent,\r\n\t\t\tformComponent,\r\n\t\t);\r\n\r\n\t\tlet shouldChangeInputValue = false;\r\n\r\n\t\tif (typeof valueForInput === \"string\" || useHueMode) {\r\n\t\t\tshouldChangeInputValue = valueForInput !== inputValue;\r\n\t\t} else {\r\n\t\t\tshouldChangeInputValue =\r\n\t\t\t\tJSON.stringify(valueForInput) !== JSON.stringify(currentInputValue);\r\n\t\t}\r\n\r\n\t\tif (shouldChangeInputValue) {\r\n\t\t\tsetInputValue(valueForInput);\r\n\t\t}\r\n\r\n\t\tconst valueForPicker = convertColorForPicker(\r\n\t\t\tvalue,\r\n\t\t\tuseHueMode,\r\n\t\t\tpickerComponent,\r\n\t\t);\r\n\r\n\t\tlet shouldChangePickerValue: boolean;\r\n\r\n\t\tif (typeof valueForPicker === \"string\" || useHueMode) {\r\n\t\t\tshouldChangePickerValue = valueForPicker !== pickerValue;\r\n\t\t} else {\r\n\t\t\tshouldChangePickerValue =\r\n\t\t\t\tJSON.stringify(valueForPicker) !== JSON.stringify(currentPickerValue);\r\n\t\t}\r\n\r\n\t\tif (shouldChangePickerValue) {\r\n\t\t\tsetPickerValue(valueForPicker);\r\n\t\t}\r\n\t}\r\n\r\n\tprops.overrideUpdateComponentStateFn?.(updateComponentState);\r\n\r\n\tconst initialColor =\r\n\t\t\"\" !== props.default && \"undefined\" !== typeof props.default\r\n\t\t\t? props.default\r\n\t\t\t: props.value;\r\n\r\n\tfunction handleWindowResize() {\r\n\t\tsetPickerContainerStyle(getPickerContainerStyle());\r\n\t}\r\n\r\n\t// Reference to the form div.\r\n\tconst formRef = useRef<HTMLDivElement | null>(null);\r\n\r\n\t// Reference to the color picker popup.\r\n\tconst pickerRef = useRef<HTMLDivElement | null>(null);\r\n\r\n\t// Reference to the reset button.\r\n\tconst resetRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n\tconst [isPopupOpen, setIsPopupOpen] = useState(props.isPopupOpen ?? false);\r\n\r\n\t// On multicolor control, listen to `value` && `isPopupOpen` properties change.\r\n\tif (props.type && props.type === \"wpbf-multicolor\") {\r\n\t\tuseEffect(() => {\r\n\t\t\tsetInputValue(\r\n\t\t\t\tconvertColorForInput(\r\n\t\t\t\t\tprops.value,\r\n\t\t\t\t\tuseHueMode,\r\n\t\t\t\t\tpickerComponent,\r\n\t\t\t\t\tformComponent,\r\n\t\t\t\t),\r\n\t\t\t);\r\n\r\n\t\t\tsetPickerValue(\r\n\t\t\t\tconvertColorForPicker(props.value, useHueMode, pickerComponent),\r\n\t\t\t);\r\n\t\t}, [props.value]);\r\n\r\n\t\tuseEffect(() => {\r\n\t\t\tsetIsPopupOpen(props.isPopupOpen ?? false);\r\n\t\t}, [props.isPopupOpen]);\r\n\t}\r\n\r\n\tconst [pickerContainerStyle, setPickerContainerStyle] = useState({});\r\n\r\n\tconst getPickerContainerStyle = () => {\r\n\t\tlet pickerContainerStyle: Record<string, any> = {};\r\n\r\n\t\tif (\"default\" === labelStyle) {\r\n\t\t\treturn pickerContainerStyle;\r\n\t\t}\r\n\r\n\t\tconst rawPadding = window.getComputedStyle(\r\n\t\t\tcontainer.parentNode as HTMLElement,\r\n\t\t).paddingLeft;\r\n\r\n\t\tconst padding = parseInt(rawPadding, 10) * 2;\r\n\r\n\t\tpickerContainerStyle.width =\r\n\t\t\t(container.parentNode as HTMLElement).getBoundingClientRect().width -\r\n\t\t\tpadding;\r\n\r\n\t\tconst controlLeftOffset = (container.offsetLeft - 9) * -1;\r\n\r\n\t\tpickerContainerStyle.left = controlLeftOffset + \"px\";\r\n\r\n\t\treturn pickerContainerStyle;\r\n\t};\r\n\r\n\tfunction convertInputValueTo6Digits() {\r\n\t\tif (\r\n\t\t\ttypeof inputValue === \"string\" &&\r\n\t\t\t4 === inputValue.length &&\r\n\t\t\tinputValue.includes(\"#\")\r\n\t\t) {\r\n\t\t\tsetInputValue(colord(inputValue).toHex());\r\n\t\t}\r\n\t}\r\n\r\n\tfunction togglePopup() {\r\n\t\tif (useExternalPopupToggle) return;\r\n\r\n\t\tif (isPopupOpen) {\r\n\t\t\tclosePopup();\r\n\t\t} else {\r\n\t\t\topenPopup();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction openPopup() {\r\n\t\tif (isPopupOpen) return;\r\n\r\n\t\tsetPickerContainerStyle(getPickerContainerStyle());\r\n\t\tconvertInputValueTo6Digits();\r\n\t\tsetIsPopupOpen(true);\r\n\t}\r\n\r\n\tfunction closePopup() {\r\n\t\tif (!isPopupOpen) return;\r\n\r\n\t\tsetIsPopupOpen(false);\r\n\t\tsetTimeout(convertInputValueTo6Digits, 200);\r\n\t}\r\n\r\n\tuseWindowResize(handleWindowResize);\r\n\r\n\tif (!useExternalPopupToggle) {\r\n\t\t// Handle outside focus to close the picker popup.\r\n\t\tuseFocusOutside(formRef, closePopup);\r\n\r\n\t\t// Handle outside click to close the picker popup.\r\n\t\tuseClickOutside(pickerRef, resetRef, closePopup);\r\n\t}\r\n\r\n\tlet colorSwatches = props.colorSwatches;\r\n\r\n\tif (jQuery.wp && jQuery.wp.wpColorPicker) {\r\n\t\tconst wpColorPickerSwatches =\r\n\t\t\tjQuery.wp.wpColorPicker.prototype.options.palettes;\r\n\r\n\t\t// If 3rd parties applied custom colors to wpColorPicker swatches, let's use them.\r\n\t\tif (Array.isArray(wpColorPickerSwatches)) {\r\n\t\t\tif (wpColorPickerSwatches.length < 8) {\r\n\t\t\t\tfor (let i = wpColorPickerSwatches.length; i < 8; i++) {\r\n\t\t\t\t\tif (wpColorPickerSwatches[i]) {\r\n\t\t\t\t\t\twpColorPickerSwatches.push(colorSwatches[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcolorSwatches = wpColorPickerSwatches;\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div\r\n\t\t\t\tclassName={`wpbf-control-form ${useHueMode ? \"use-hue-mode\" : \"\"} has-${labelStyle}-label-style`}\r\n\t\t\t\tref={formRef}\r\n\t\t\t\ttabIndex={1}\r\n\t\t\t>\r\n\t\t\t\t{!props.removeHeader && (\r\n\t\t\t\t\t<ControlHeader\r\n\t\t\t\t\t\tlabel={label}\r\n\t\t\t\t\t\tdescription={description}\r\n\t\t\t\t\t\tlabelStyle={labelStyle}\r\n\t\t\t\t\t\tpickerComponent={pickerComponent}\r\n\t\t\t\t\t\tuseHueMode={useHueMode}\r\n\t\t\t\t\t\tinputValue={inputValue}\r\n\t\t\t\t\t\tisPopupOpen={isPopupOpen}\r\n\t\t\t\t\t\ttogglePicker={togglePopup}\r\n\t\t\t\t\t\tresetRef={resetRef}\r\n\t\t\t\t\t\tonResetButtonClick={() => {\r\n\t\t\t\t\t\t\tif (!initialColor) {\r\n\t\t\t\t\t\t\t\tcurrentInputValue = \"\";\r\n\t\t\t\t\t\t\t\tcurrentPickerValue = \"\";\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tprops.onReset?.();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tsetNotificationContainer={props.setNotificationContainer}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<div\r\n\t\t\t\t\tref={pickerRef}\r\n\t\t\t\t\tclassName={`${pickerComponent} colorPickerContainer ${isPopupOpen ? \"is-open\" : \"\"}`}\r\n\t\t\t\t\tstyle={pickerContainerStyle}\r\n\t\t\t\t>\r\n\t\t\t\t\t{!useHueMode && (\r\n\t\t\t\t\t\t<ColorPickerSwatches\r\n\t\t\t\t\t\t\tcolors={colorSwatches}\r\n\t\t\t\t\t\t\tonClick={(color) => {\r\n\t\t\t\t\t\t\t\tprops.onChange?.(color);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t<ColorPickerComponent\r\n\t\t\t\t\t\tpickerComponent={pickerComponent}\r\n\t\t\t\t\t\tvalue={pickerValue}\r\n\t\t\t\t\t\tonChange={(color) => {\r\n\t\t\t\t\t\t\tcurrentPickerValue = color;\r\n\t\t\t\t\t\t\tprops.onChange?.(color);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\r\n\t\t\t\t\t<ColorPickerInput\r\n\t\t\t\t\t\tpickerComponent={pickerComponent}\r\n\t\t\t\t\t\tuseHueMode={useHueMode}\r\n\t\t\t\t\t\tcolor={inputValue}\r\n\t\t\t\t\t\tonChange={(value) => {\r\n\t\t\t\t\t\t\tcurrentInputValue = value;\r\n\t\t\t\t\t\t\tprops.onChange?.(value);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import { useEffect } from \"react\";\r\n\r\nexport default function useWindowResize(handler: any) {\r\n\tuseEffect(() => {\r\n\t\tconst listener = (_e: any) => {\r\n\t\t\thandler();\r\n\t\t};\r\n\r\n\t\twindow.addEventListener(\"resize\", listener, true);\r\n\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener(\"resize\", listener, true);\r\n\t\t};\r\n\t}, [handler]);\r\n}\r\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import { colord } from \"colord\";\r\nimport { WpbfColorControlValue } from \"../color-interface\";\r\nimport { parseHueModeValue } from \"./misc\";\r\n\r\n/**\r\n * Convert the value for the customizer.\r\n *\r\n * @param {WpbfColorControlValue} value - The value to be converted.\r\n * @param {string} pickerComponent - The picker component name.\r\n * @param {string|undefined} formComponent - The form component name.\r\n *\r\n * @returns {WpbfColorControlValue} The converted value.\r\n */\r\nexport default function convertColorForCustomizer(\r\n\tvalue: WpbfColorControlValue,\r\n\tuseHueMode: boolean,\r\n\tpickerComponent: string,\r\n\tformComponent?: string,\r\n): WpbfColorControlValue {\r\n\tif (\"\" === value) return \"\";\r\n\r\n\tif (useHueMode) {\r\n\t\treturn parseHueModeValue(value);\r\n\t}\r\n\r\n\t// If hudeMode is false, but value is a number, then return empty string.\r\n\tif (typeof value === \"number\") return \"\";\r\n\r\n\tlet rgba;\r\n\tlet hsv;\r\n\tlet hsva;\r\n\tlet convertedValue;\r\n\r\n\tswitch (pickerComponent) {\r\n\t\t/**\r\n\t\t * The HexColorPicker is used by these condition:\r\n\t\t * 1. When formComponent is defined with HexColorPicker as the value.\r\n\t\t * 2. When formComponent is not defined but the \"alpha\" choice is not set or set to false (the old way).\r\n\t\t */\r\n\t\tcase \"HexColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"#\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toHex();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toRgb();\r\n\t\t\tconvertedValue = {\r\n\t\t\t\tr: convertedValue.r,\r\n\t\t\t\tg: convertedValue.g,\r\n\t\t\t\tb: convertedValue.b,\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbStringColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"rgb(\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toRgbString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"RgbaColorPicker\":\r\n\t\t\trgba = colord(value).toRgb();\r\n\t\t\tconvertedValue = rgba;\r\n\t\t\tbreak;\r\n\r\n\t\t/**\r\n\t\t * The RgbaStringColorPicker is used by these condition:\r\n\t\t * 1. When formComponent is defined with RgbaColorPicker as the value.\r\n\t\t * 2. When formComponent is not defined but the \"alpha\" choice is set to true.\r\n\t\t */\r\n\t\tcase \"RgbaStringColorPicker\":\r\n\t\t\trgba = colord(value).toRgb();\r\n\r\n\t\t\tif (rgba.a < 1) {\r\n\t\t\t\tconvertedValue =\r\n\t\t\t\t\t\"string\" === typeof value && value.includes(\"rgba\")\r\n\t\t\t\t\t\t? value\r\n\t\t\t\t\t\t: colord(value).toRgbString();\r\n\t\t\t} else {\r\n\t\t\t\t// When it uses the 2nd condition above, then the expected value is \"hex\".\r\n\t\t\t\tif (!formComponent) {\r\n\t\t\t\t\tconvertedValue =\r\n\t\t\t\t\t\t\"string\" === typeof value && value.includes(\"#\")\r\n\t\t\t\t\t\t\t? value\r\n\t\t\t\t\t\t\t: colord(value).toHex();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconvertedValue = colord(value).toRgbString();\r\n\r\n\t\t\t\t\t// Force to set the alpha channel value.\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tconvertedValue.includes(\"rgb\") &&\r\n\t\t\t\t\t\t!convertedValue.includes(\"rgba\")\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tconvertedValue = convertedValue.replace(\"rgb\", \"rgba\");\r\n\t\t\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsl();\r\n\t\t\tconvertedValue = {\r\n\t\t\t\th: convertedValue.h,\r\n\t\t\t\ts: convertedValue.s,\r\n\t\t\t\tl: convertedValue.l,\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslStringColorPicker\":\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"hsl(\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toHslString();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslaColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsl();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HslaStringColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHslString();\r\n\r\n\t\t\t// Force to set the alpha channel value.\r\n\t\t\tif (convertedValue.includes(\"hsl\") && !convertedValue.includes(\"hsla\")) {\r\n\t\t\t\tconvertedValue = convertedValue.replace(\"hsl\", \"hsla\");\r\n\t\t\t\tconvertedValue = convertedValue.replace(\")\", \", 1)\");\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsv();\r\n\t\t\tconvertedValue = {\r\n\t\t\t\th: convertedValue.h,\r\n\t\t\t\ts: convertedValue.s,\r\n\t\t\t\tv: convertedValue.v,\r\n\t\t\t};\r\n\t\t\tbreak;\r\n\r\n\t\t/**\r\n\t\t * The colord library doesn't provide .toHsvString() method yet.\r\n\t\t * This manual value-building will apply to \"HsvStringColorPicker\" and \"HsvaStringColorPicker\" stuff below.\r\n\t\t */\r\n\t\tcase \"HsvStringColorPicker\":\r\n\t\t\thsv = colord(value).toHsv();\r\n\t\t\tconvertedValue = \"hsv(\" + hsv.h + \", \" + hsv.s + \"%, \" + hsv.v + \"%)\";\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvaColorPicker\":\r\n\t\t\tconvertedValue = colord(value).toHsv();\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"HsvaStringColorPicker\":\r\n\t\t\thsva = colord(value).toHsv();\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"hsva(\" +\r\n\t\t\t\thsva.h +\r\n\t\t\t\t\", \" +\r\n\t\t\t\thsva.s +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.v +\r\n\t\t\t\t\"%, \" +\r\n\t\t\t\thsva.a +\r\n\t\t\t\t\")\";\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tconvertedValue =\r\n\t\t\t\t\"string\" === typeof value && value.includes(\"#\")\r\n\t\t\t\t\t? value\r\n\t\t\t\t\t: colord(value).toHex();\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn convertedValue;\r\n}\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport { WpbfColorControl, WpbfColorControlValue } from \"./color-interface\";\r\nimport ColorForm from \"./ColorForm\";\r\nimport { createRoot } from \"react-dom/client\";\r\nimport convertColorForCustomizer from \"./utils/convert-color-for-customizer\";\r\n\r\nconst ColorControl = window.wp.customize?.Control.extend<WpbfColorControl>({\r\n\tinitialize: function initialize(id, params) {\r\n\t\t// Bind functions to this control context for passing as React props.\r\n\t\tthis.setNotificationContainer = this.setNotificationContainer?.bind(this);\r\n\t\tthis.overrideUpdateComponentStateFn =\r\n\t\t\tthis.overrideUpdateComponentStateFn?.bind(this);\r\n\t\tthis.onChange = this.onChange?.bind(this);\r\n\t\tthis.onReset = this.onReset?.bind(this);\r\n\r\n\t\twindow.wp.customize?.Control.prototype.initialize.call(this, id, params);\r\n\r\n\t\tconst control = this;\r\n\r\n\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\tfunction handleOnRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\tif (control === removedControl) {\r\n\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\twindow.wp.customize?.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.wp.customize?.control.bind(\"removed\", handleOnRemoved);\r\n\t},\r\n\r\n\t/**\r\n\t * Set notification container and render.\r\n\t *\r\n\t * This is called when the React component is mounted.\r\n\t */\r\n\tsetNotificationContainer: function setNotificationContainer(el) {\r\n\t\tif (this.notifications) {\r\n\t\t\tthis.notifications.container = jQuery(el);\r\n\t\t\tthis.notifications.render();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Render the control into the DOM.\r\n\t *\r\n\t * This will be called from the Control#embed() method in the parent class.\r\n\t */\r\n\trenderContent: function renderContent() {\r\n\t\tif (!this.params) return;\r\n\t\tif (!this.container || !this.container.length) return;\r\n\r\n\t\tconst mode = this.params.mode;\r\n\t\tconst useHueMode = \"hue\" === mode;\r\n\t\tconst formComponent = this.params.formComponent;\r\n\r\n\t\tlet pickerComponent = \"\";\r\n\r\n\t\tif (formComponent) {\r\n\t\t\tpickerComponent = formComponent;\r\n\t\t} else {\r\n\t\t\tpickerComponent =\r\n\t\t\t\tmode === \"alpha\" ? \"RgbaStringColorPicker\" : \"HexColorPicker\";\r\n\t\t}\r\n\r\n\t\tpickerComponent = useHueMode ? \"HueColorPicker\" : pickerComponent;\r\n\r\n\t\tif (!this.root && this.container) {\r\n\t\t\tthis.root = createRoot(this.container[0]);\r\n\t\t}\r\n\r\n\t\tthis.root?.render(\r\n\t\t\t<ColorForm\r\n\t\t\t\ttype={this.params?.type}\r\n\t\t\t\tcontainer={this.container[0]}\r\n\t\t\t\tlabel={this.params.label}\r\n\t\t\t\tdescription={this.params.description}\r\n\t\t\t\tuseHueMode={useHueMode}\r\n\t\t\t\tformComponent={formComponent}\r\n\t\t\t\tpickerComponent={pickerComponent}\r\n\t\t\t\tlabelStyle={this.params.labelStyle}\r\n\t\t\t\tcolorSwatches={this.params.colorSwatches}\r\n\t\t\t\tvalue={this.params.value}\r\n\t\t\t\tdefault={this.params.default}\r\n\t\t\t\tonChange={(value) => this.onChange?.(value)}\r\n\t\t\t\tonReset={() => this.onReset?.()}\r\n\t\t\t\toverrideUpdateComponentStateFn={this.overrideUpdateComponentStateFn}\r\n\t\t\t\tsetNotificationContainer={this.setNotificationContainer}\r\n\t\t\t/>,\r\n\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t *\r\n\t * React is available to be used here instead of the customizer.Element abstraction.\r\n\t */\r\n\tready: function ready() {\r\n\t\tconst control = this;\r\n\r\n\t\t/**\r\n\t\t * Update component state when customizer setting changes.\r\n\t\t *\r\n\t\t * There was an issue (that's fixed):\r\n\t\t *\r\n\t\t * Let's say we have other color picker (\"x\" color picker) and this current color picker (\"y\" color picker).\r\n\t\t * Let's say there's a script that bind to that \"x\" color picker to make change to this \"y\" color picker.\r\n\t\t *\r\n\t\t * When \"x\" color picker is changed fast (by dragging the color, for example),\r\n\t\t * then the re-render of this \"y\" color picker will be messy.\r\n\t\t * There was something like \"function-call race\" between component re-render and function call inside the component.\r\n\t\t *\r\n\t\t * When that happens, the \"x\" color picker becomes unresponsive and un-usable.\r\n\t\t *\r\n\t\t * How we fixed that:\r\n\t\t * - Provide a updateColorPicker property to this file.\r\n\t\t * - Inside the component, assign the updateColorPicker with a function to update some states.\r\n\t\t * - Then inside the binding below, call updateColorPicker instead of re-rendering the component.\r\n\t\t *\r\n\t\t * The result: Even though the \"x\" color picker becomes very slow, it's still usable and responsive enough.\r\n\t\t */\r\n\t\tthis.setting?.bind((val: WpbfColorControlValue) => {\r\n\t\t\tcontrol.updateComponentState?.(val);\r\n\t\t});\r\n\t},\r\n\r\n\tupdateCustomizerSetting: function updateCustomizerSetting(val) {\r\n\t\tif (typeof val === \"undefined\") return;\r\n\t\tconst params = this.params;\r\n\t\tif (!params) return;\r\n\r\n\t\tconst mode = params.mode;\r\n\t\tconst useHueMode = \"hue\" === mode;\r\n\t\tconst formComponent = params.formComponent;\r\n\r\n\t\tlet pickerComponent = \"\";\r\n\r\n\t\tif (formComponent) {\r\n\t\t\tpickerComponent = formComponent;\r\n\t\t} else {\r\n\t\t\tpickerComponent =\r\n\t\t\t\tmode === \"alpha\" ? \"RgbaStringColorPicker\" : \"HexColorPicker\";\r\n\t\t}\r\n\r\n\t\tthis.setting?.set(\r\n\t\t\tconvertColorForCustomizer(\r\n\t\t\t\tval,\r\n\t\t\t\tuseHueMode,\r\n\t\t\t\tpickerComponent,\r\n\t\t\t\tformComponent,\r\n\t\t\t),\r\n\t\t);\r\n\t},\r\n\r\n\tonChange: function onChange(val) {\r\n\t\tthis.updateCustomizerSetting?.(val);\r\n\t},\r\n\r\n\tonReset: function onReset() {\r\n\t\tconst params = this.params;\r\n\t\tif (!params) return;\r\n\r\n\t\tconst initialColor =\r\n\t\t\t\"\" !== params.default && \"undefined\" !== typeof params.default\r\n\t\t\t\t? params.default\r\n\t\t\t\t: params.value;\r\n\r\n\t\tthis.updateCustomizerSetting?.(initialColor);\r\n\t},\r\n\r\n\t/**\r\n\t * This method will be overriden by the rendered component via overrideUpdateComponentStateFn.\r\n\t */\r\n\tupdateComponentState: function (val) {},\r\n\r\n\toverrideUpdateComponentStateFn: function overrideUpdateComponentStateFn(fn) {\r\n\t\tthis.updateComponentState = fn;\r\n\t},\r\n\r\n\t/**\r\n\t * Handle removal/de-registration of the control.\r\n\t *\r\n\t * This is essentially the inverse of the Control#embed() method.\r\n\t */\r\n\tdestroy: function destroy() {\r\n\t\tthis.root?.unmount();\r\n\t\tthis.root = undefined;\r\n\r\n\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\twindow.wp.customize?.Control.prototype.destroy?.call(this);\r\n\t},\r\n});\r\n\r\nexport default ColorControl;\r\n","import { useRef, useState } from \"react\";\r\nimport ColorForm from \"./ColorForm\";\r\nimport {\r\n\tWpbfMulticolorControlValue,\r\n\tColorControlLabelStyle,\r\n} from \"./color-interface\";\r\nimport ControlLabel from \"./components/ControlLabel\";\r\nimport ColorPickerCirleTrigger from \"./components/ColorPickerCircleTrigger\";\r\nimport convertColorForInput from \"./utils/convert-color-for-input\";\r\nimport useFocusOutside from \"./hooks/useFocusOutside\";\r\nimport useClickOutside from \"./hooks/useClickOutside\";\r\n\r\nexport default function MulticolorForm(props: {\r\n\tid: string;\r\n\tcontainer: HTMLElement;\r\n\tchoices: Record<string, string>;\r\n\tkeys: string[];\r\n\tlabel: string;\r\n\tdescription: string;\r\n\tuseHueMode: boolean;\r\n\tpickerComponent: string;\r\n\tlabelStyle: ColorControlLabelStyle;\r\n\tcolorSwatches: Array<string | { color: string } | undefined>;\r\n\tvalue: WpbfMulticolorControlValue;\r\n\tdefault: WpbfMulticolorControlValue;\r\n\tformComponent?: string;\r\n\tonChange?: (value: WpbfMulticolorControlValue) => void;\r\n\tonReset?: () => void;\r\n\toverrideUpdateComponentStateFn?: (\r\n\t\tfn: (val: WpbfMulticolorControlValue) => void,\r\n\t) => void;\r\n\tsetNotificationContainer?: any;\r\n}) {\r\n\tconst {\r\n\t\tcontainer,\r\n\t\tchoices,\r\n\t\tsetNotificationContainer,\r\n\t\tuseHueMode,\r\n\t\tpickerComponent,\r\n\t\tformComponent,\r\n\t\tlabel,\r\n\t\tdescription,\r\n\t} = props;\r\n\r\n\tconst [value, setValue] = useState<WpbfMulticolorControlValue>(props.value);\r\n\r\n\tconst [openedPopupKey, setOpenedPopupKey] = useState<string | undefined>(\r\n\t\tundefined,\r\n\t);\r\n\r\n\t// This function will be called when this control's customizer value is changed.\r\n\tfunction updateComponentState(value: WpbfMulticolorControlValue) {\r\n\t\tsetValue(value);\r\n\t}\r\n\r\n\tprops.overrideUpdateComponentStateFn?.(updateComponentState);\r\n\r\n\tfunction togglePopup(key: string) {\r\n\t\tif (openedPopupKey) {\r\n\t\t\tsetOpenedPopupKey(undefined);\r\n\t\t} else {\r\n\t\t\tsetOpenedPopupKey(key);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction closePopup() {\r\n\t\tsetOpenedPopupKey(undefined);\r\n\t}\r\n\r\n\t// Reference to the form div.\r\n\tconst formRef = useRef<HTMLDivElement | null>(null);\r\n\r\n\t// Reference to the color picker popup.\r\n\tconst pickerRef = useRef<HTMLDivElement | null>(null);\r\n\r\n\t// Reference to the reset button.\r\n\tconst resetRef = useRef<HTMLButtonElement | null>(null);\r\n\r\n\t// Handle outside focus to close the picker popup.\r\n\tuseFocusOutside(formRef, closePopup);\r\n\r\n\t// Handle outside click to close the picker popup.\r\n\tuseClickOutside(pickerRef, resetRef, closePopup);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className=\"wpbf-multicolor\" ref={formRef}>\r\n\t\t\t\t<div className=\"wpbf-control-cols\">\r\n\t\t\t\t\t<div className=\"wpbf-control-left-col\">\r\n\t\t\t\t\t\t<ControlLabel\r\n\t\t\t\t\t\t\tlabel={label}\r\n\t\t\t\t\t\t\tdescription={description}\r\n\t\t\t\t\t\t\tsetNotificationContainer={setNotificationContainer}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"wpbf-control-right-col\">\r\n\t\t\t\t\t\t<div className=\"wpbf-buttons\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tref={resetRef}\r\n\t\t\t\t\t\t\t\tclassName={`wpbf-control-reset${openedPopupKey ? \" is-shown\" : \"\"}`}\r\n\t\t\t\t\t\t\t\ttitle=\"Reset colors set\"\r\n\t\t\t\t\t\t\t\tonClick={() => props.onReset?.()}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<i className=\"dashicons dashicons-image-rotate\"></i>\r\n\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t{props.keys.map((key, i) => {\r\n\t\t\t\t\t\t\t\tconst circleColor = convertColorForInput(\r\n\t\t\t\t\t\t\t\t\tvalue[key] ?? \"\",\r\n\t\t\t\t\t\t\t\t\tuseHueMode,\r\n\t\t\t\t\t\t\t\t\tpickerComponent,\r\n\t\t\t\t\t\t\t\t\tformComponent,\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<ColorPickerCirleTrigger\r\n\t\t\t\t\t\t\t\t\t\tkey={`${key}-${i}`}\r\n\t\t\t\t\t\t\t\t\t\tcolor={circleColor}\r\n\t\t\t\t\t\t\t\t\t\tisPopupOpen={openedPopupKey === key}\r\n\t\t\t\t\t\t\t\t\t\ttooltip={choices[key] ?? undefined}\r\n\t\t\t\t\t\t\t\t\t\tonToggleButtonClick={() => togglePopup(key)}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div ref={pickerRef} className=\"wpbf-color-picker-popup\">\r\n\t\t\t\t\t{props.keys.map((key, i) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<ColorForm\r\n\t\t\t\t\t\t\t\tkey={`${key}-${i}`}\r\n\t\t\t\t\t\t\t\ttype=\"wpbf-multicolor\"\r\n\t\t\t\t\t\t\t\tcontainer={container}\r\n\t\t\t\t\t\t\t\tlabel={props.label}\r\n\t\t\t\t\t\t\t\tdescription={props.description}\r\n\t\t\t\t\t\t\t\tuseHueMode={useHueMode}\r\n\t\t\t\t\t\t\t\tformComponent={formComponent}\r\n\t\t\t\t\t\t\t\tpickerComponent={pickerComponent}\r\n\t\t\t\t\t\t\t\tlabelStyle=\"none\"\r\n\t\t\t\t\t\t\t\tcolorSwatches={props.colorSwatches}\r\n\t\t\t\t\t\t\t\tvalue={value[key] ?? \"\"}\r\n\t\t\t\t\t\t\t\tdefault={props.default[key]}\r\n\t\t\t\t\t\t\t\tsetNotificationContainer={props.setNotificationContainer}\r\n\t\t\t\t\t\t\t\tremoveHeader={true}\r\n\t\t\t\t\t\t\t\tisPopupOpen={openedPopupKey === key}\r\n\t\t\t\t\t\t\t\tuseExternalPopupToggle={true}\r\n\t\t\t\t\t\t\t\tonChange={(newValue) => {\r\n\t\t\t\t\t\t\t\t\tconst val = { ...value };\r\n\t\t\t\t\t\t\t\t\tval[key] = newValue;\r\n\r\n\t\t\t\t\t\t\t\t\tprops.onChange?.(val);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport {\r\n\tWpbfMulticolorControlValue,\r\n\tWpbfMulticolorControl,\r\n} from \"./color-interface\";\r\nimport MulticolorForm from \"./MulticolorForm\";\r\nimport { createRoot } from \"react-dom/client\";\r\nimport convertColorForCustomizer from \"./utils/convert-color-for-customizer\";\r\n\r\nconst MulticolorControl =\r\n\twindow.wp.customize?.Control.extend<WpbfMulticolorControl>({\r\n\t\tinitialize: function initialize(id, params) {\r\n\t\t\t// Bind functions to this control context for passing as React props.\r\n\t\t\tthis.setNotificationContainer = this.setNotificationContainer?.bind(this);\r\n\t\t\tthis.overrideUpdateComponentStateFn =\r\n\t\t\t\tthis.overrideUpdateComponentStateFn?.bind(this);\r\n\t\t\tthis.onChange = this.onChange?.bind(this);\r\n\t\t\tthis.onReset = this.onReset?.bind(this);\r\n\r\n\t\t\twindow.wp.customize?.Control.prototype.initialize.call(this, id, params);\r\n\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\tfunction handleOnRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\tif (control === removedControl) {\r\n\t\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\t\twindow.wp.customize?.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\twindow.wp.customize?.control.bind(\"removed\", handleOnRemoved);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set notification container and render.\r\n\t\t *\r\n\t\t * This is called when the React component is mounted.\r\n\t\t */\r\n\t\tsetNotificationContainer: function setNotificationContainer(el) {\r\n\t\t\tif (this.notifications) {\r\n\t\t\t\tthis.notifications.container = jQuery(el);\r\n\t\t\t\tthis.notifications.render();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Render the control into the DOM.\r\n\t\t *\r\n\t\t * This will be called from the Control#embed() method in the parent class.\r\n\t\t */\r\n\t\trenderContent: function renderContent() {\r\n\t\t\tif (!this.params) return;\r\n\t\t\tif (!this.container || !this.container.length) return;\r\n\r\n\t\t\tconst mode = this.params.mode;\r\n\t\t\tconst useHueMode = \"hue\" === mode;\r\n\t\t\tconst formComponent = this.params.formComponent;\r\n\r\n\t\t\tlet pickerComponent = \"\";\r\n\r\n\t\t\tif (formComponent) {\r\n\t\t\t\tpickerComponent = formComponent;\r\n\t\t\t} else {\r\n\t\t\t\tpickerComponent =\r\n\t\t\t\t\tmode === \"alpha\" ? \"RgbaStringColorPicker\" : \"HexColorPicker\";\r\n\t\t\t}\r\n\r\n\t\t\tpickerComponent = useHueMode ? \"HueColorPicker\" : pickerComponent;\r\n\r\n\t\t\tif (!this.root && this.container) {\r\n\t\t\t\tthis.root = createRoot(this.container[0]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.root?.render(\r\n\t\t\t\t<MulticolorForm\r\n\t\t\t\t\tid={this.setting?.id ?? \"\"}\r\n\t\t\t\t\tcontainer={this.container[0]}\r\n\t\t\t\t\tchoices={this.params.choices}\r\n\t\t\t\t\tkeys={Object.keys(this.params.choices)}\r\n\t\t\t\t\tlabel={this.params.label}\r\n\t\t\t\t\tdescription={this.params.description}\r\n\t\t\t\t\tuseHueMode={useHueMode}\r\n\t\t\t\t\tformComponent={formComponent}\r\n\t\t\t\t\tpickerComponent={pickerComponent}\r\n\t\t\t\t\tlabelStyle={this.params.labelStyle}\r\n\t\t\t\t\tcolorSwatches={this.params.colorSwatches}\r\n\t\t\t\t\tvalue={this.params.value}\r\n\t\t\t\t\tdefault={this.params.default}\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonReset={this.onReset}\r\n\t\t\t\t\toverrideUpdateComponentStateFn={this.overrideUpdateComponentStateFn}\r\n\t\t\t\t\tsetNotificationContainer={this.setNotificationContainer}\r\n\t\t\t\t/>,\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t\t *\r\n\t\t * React is available to be used here instead of the window.wp.customize?.Element abstraction.\r\n\t\t */\r\n\t\tready: function ready() {\r\n\t\t\t/**\r\n\t\t\t * Update component state when customizer setting changes.\r\n\t\t\t */\r\n\t\t\tthis.setting?.bind((val: WpbfMulticolorControlValue) => {\r\n\t\t\t\tthis.updateComponentState?.(val);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tonChange: function (val) {\r\n\t\t\tthis.updateCustomizerSetting?.(val);\r\n\t\t},\r\n\r\n\t\tonReset: function () {\r\n\t\t\tconst params = this.params;\r\n\t\t\tif (!params) return;\r\n\r\n\t\t\tconst initialColor =\r\n\t\t\t\t\"undefined\" !== typeof params.default &&\r\n\t\t\t\tObject.keys(params.default).length > 0\r\n\t\t\t\t\t? params.default\r\n\t\t\t\t\t: params.value;\r\n\r\n\t\t\tthis.updateCustomizerSetting?.(initialColor);\r\n\t\t},\r\n\r\n\t\tupdateCustomizerSetting: function (val) {\r\n\t\t\tif (typeof val === \"undefined\") return;\r\n\t\t\tconst params = this.params;\r\n\t\t\tif (!params) return;\r\n\r\n\t\t\tconst mode = params.mode;\r\n\t\t\tconst useHueMode = \"hue\" === mode;\r\n\t\t\tconst formComponent = params.formComponent;\r\n\r\n\t\t\tlet pickerComponent = \"\";\r\n\r\n\t\t\tif (formComponent) {\r\n\t\t\t\tpickerComponent = formComponent;\r\n\t\t\t} else {\r\n\t\t\t\tpickerComponent =\r\n\t\t\t\t\tmode === \"alpha\" ? \"RgbaStringColorPicker\" : \"HexColorPicker\";\r\n\t\t\t}\r\n\r\n\t\t\tconst value: WpbfMulticolorControlValue = {};\r\n\r\n\t\t\tfor (const key in val) {\r\n\t\t\t\tif (!val.hasOwnProperty(key)) continue;\r\n\r\n\t\t\t\tvalue[key] = convertColorForCustomizer(\r\n\t\t\t\t\tval[key],\r\n\t\t\t\t\tuseHueMode,\r\n\t\t\t\t\tpickerComponent,\r\n\t\t\t\t\tformComponent,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tthis.setting?.set(value);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will be overriden by the rendered component via overrideUpdateComponentStateFn.\r\n\t\t */\r\n\t\tupdateComponentState: function (val) {},\r\n\r\n\t\toverrideUpdateComponentStateFn: function overrideUpdateComponentStateFn(\r\n\t\t\tfn,\r\n\t\t) {\r\n\t\t\tthis.updateComponentState = fn;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t *\r\n\t\t * This is essentially the inverse of the Control#embed() method.\r\n\t\t */\r\n\t\tdestroy: function destroy() {\r\n\t\t\tthis.root?.unmount();\r\n\t\t\tthis.root = undefined;\r\n\r\n\t\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\t\tif (window.wp.customize?.Control.prototype.destroy) {\r\n\t\t\t\twindow.wp.customize?.Control.prototype.destroy.call(this);\r\n\t\t\t}\r\n\t\t},\r\n\t});\r\n\r\nexport default MulticolorControl;\r\n","/**\r\n * Encode a specific type of object as JSON string or return an empty string if failed.\r\n *\r\n * @param {T} value - The value to encode.\r\n * @return {string} The JSON encoded version of the value.\r\n */\r\nexport function encodeJsonOrDefault<T>(value: T): string {\r\n\ttry {\r\n\t\treturn JSON.stringify(value);\r\n\t} catch (e) {\r\n\t\treturn \"\";\r\n\t}\r\n}\r\n\r\n/**\r\n * Parse a JSON string or return undefined if failed.\r\n *\r\n * @param {string | null | undefined} jsonStr - The JSON string to parse.\r\n * @return {T | undefined} The parsed value or undefined if failed.\r\n */\r\nexport function parseJsonOrUndefined<T>(\r\n\tjsonStr: string | null | undefined | T,\r\n): T | undefined {\r\n\tif (\"\" === jsonStr || !jsonStr) {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tif (typeof jsonStr !== \"string\") {\r\n\t\treturn jsonStr;\r\n\t}\r\n\r\n\ttry {\r\n\t\treturn JSON.parse(jsonStr);\r\n\t} catch (e) {\r\n\t\treturn undefined;\r\n\t}\r\n}\r\n","import { limitNumber, makeNumberUnitPair } from \"../../Generic/src/number-util\";\r\nimport { parseJsonOrUndefined } from \"../../Generic/src/string-util\";\r\nimport { DevicesValue } from \"./responsive-interface\";\r\n\r\n/**\r\n * Make an empty `DevicesValue` object.\r\n *\r\n * @param {string[]} devices - The allowed devices.\r\n *\r\n * @return {DevicesValue} Empty `DevicesValue` object.\r\n */\r\nfunction makeEmptyDevicesValue(devices: string[]): DevicesValue {\r\n\tconst value: DevicesValue = {};\r\n\r\n\tdevices.forEach((device) => {\r\n\t\tvalue[device] = \"\";\r\n\t});\r\n\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * Make a `DevicesValue` object from a JSON encoded string or `DevicesValue` object.\r\n *\r\n * @export\r\n *\r\n * @param {string[]} devices - The allowed devices.\r\n * @param {(string | DevicesValue)} value - The value to convert.\r\n * @param {number|undefined|null} min - The minimum value.\r\n * @param {number|undefined|null} max - The maximum value.\r\n *\r\n * @return {DevicesValue}\r\n */\r\nexport function makeDevicesValue(\r\n\tfieldType: string,\r\n\tdevices: string[],\r\n\tvalue: string | DevicesValue,\r\n\tmin?: number | null,\r\n\tmax?: number | null,\r\n): DevicesValue {\r\n\tconst valueObject =\r\n\t\t\"string\" === typeof value\r\n\t\t\t? parseJsonOrUndefined<DevicesValue>(value)\r\n\t\t\t: value;\r\n\r\n\tif (!valueObject) {\r\n\t\treturn makeEmptyDevicesValue(devices);\r\n\t}\r\n\r\n\tconst devicesValue: DevicesValue = {};\r\n\r\n\tdevices.forEach((device) => {\r\n\t\tif (!valueObject.hasOwnProperty(device)) {\r\n\t\t\tdevicesValue[device] = \"\";\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet val = valueObject[device];\r\n\r\n\t\tif (fieldType === \"number\") {\r\n\t\t\tval = parseNumberValue(valueObject[device], min, max);\r\n\t\t}\r\n\r\n\t\tdevicesValue[device] =\r\n\t\t\t\"string\" !== typeof val && \"number\" !== typeof val ? \"\" : val;\r\n\t});\r\n\r\n\treturn devicesValue;\r\n}\r\n\r\n/**\r\n * Make a value for an input field.\r\n *\r\n * @export\r\n *\r\n * @param {string | number} value - The value to convert.\r\n * @param {number|undefined|null} min - The minimum value.\r\n * @param {number|undefined|null} max - The maximum value.\r\n *\r\n * @return {string|number} The value for the input field.\r\n */\r\nexport function parseNumberValue(\r\n\tvalue: string | number,\r\n\tmin?: number | null,\r\n\tmax?: number | null,\r\n): string | number {\r\n\tlet strValue = String(value).trim();\r\n\r\n\tif (strValue === \"\") {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tconst startTypingNegative = strValue === \"-\";\r\n\tif (startTypingNegative) return \"-\";\r\n\r\n\tconst startTypingDecimal = strValue.endsWith(\".\");\r\n\tstrValue = startTypingDecimal ? strValue.replace(\".\", \"\") : strValue;\r\n\r\n\tconst valueObject = makeNumberUnitPair(value);\r\n\r\n\tif (\"\" === valueObject.number) {\r\n\t\treturn startTypingDecimal ? \"0.\" : \"\";\r\n\t}\r\n\r\n\tlet numeric: number | \"\" = valueObject.number;\r\n\r\n\tif (\"number\" === typeof min || \"number\" === typeof max) {\r\n\t\tnumeric = limitNumber(numeric, min, max);\r\n\t}\r\n\r\n\treturn startTypingDecimal ? numeric + \".\" : numeric;\r\n}\r\n","import { makeNumberUnitPair } from \"../../Generic/src/number-util\";\r\nimport { parseJsonOrUndefined } from \"../../Generic/src/string-util\";\r\nimport { MarginPaddingDimension, MarginPaddingValue } from \"./margin-padding-interface\";\r\n\r\n/**\r\n * Make a value for an input number field in margin/padding control.\r\n *\r\n * It shouldn't contain unit because it's a number field.\r\n *\r\n * @export\r\n *\r\n * @param {string | number} value - The value to convert.\r\n * @return {string|number} The value for the input field.\r\n */\r\nexport function makeMarginPaddingFieldValue(\r\n\tvalue: string | number,\r\n): string | number {\r\n\tlet strValue = String(value).trim();\r\n\r\n\tif (strValue === \"\") {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tconst startTypingNegative = strValue === \"-\";\r\n\tif (startTypingNegative) return \"-\";\r\n\r\n\tconst startTypingDecimal = strValue.endsWith(\".\");\r\n\tstrValue = startTypingDecimal ? strValue.replace(\".\", \"\") : strValue;\r\n\r\n\tconst valueObject = makeNumberUnitPair(value);\r\n\r\n\tif (\"\" === valueObject.number) {\r\n\t\treturn startTypingDecimal ? \"0.\" : \"\";\r\n\t}\r\n\r\n\tlet numeric = String(valueObject.number);\r\n\r\n\treturn startTypingDecimal ? numeric + \".\" : numeric;\r\n}\r\n\r\n/**\r\n * Create a `MarginPaddingValue` object without unit.\r\n *\r\n * Used for the input field's values in the customizer control.\r\n *\r\n * @param {string[]} dimensions - The allowed dimensions.\r\n * @param {MarginPaddingValue} value - The value to parse.\r\n *\r\n * @return {MarginPaddingValue} - The value as object (without unit).\r\n */\r\nexport function makeObjValueWithoutUnit(\r\n\tdimensions: string[],\r\n\tvalue: MarginPaddingValue,\r\n): MarginPaddingValue {\r\n\tconst newValue: Record<string, number | string> = {};\r\n\r\n\tfor (let i = 0; i < dimensions.length; i++) {\r\n\t\tconst dimension = dimensions[i];\r\n\t\tnewValue[dimension] = dimensions[i];\r\n\t}\r\n\r\n\tfor (const position in value) {\r\n\t\tif (!dimensions.includes(position)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!value.hasOwnProperty(position)) continue;\r\n\t\tif (!newValue.hasOwnProperty(position)) continue;\r\n\r\n\t\tconst positionValue = value[position];\r\n\r\n\t\tif (\"\" !== positionValue) {\r\n\t\t\tnewValue[position] = makeMarginPaddingFieldValue(positionValue);\r\n\t\t}\r\n\t}\r\n\r\n\treturn newValue as MarginPaddingValue;\r\n}\r\n\r\n/**\r\n * Create a `MarginPaddingValue` object with unit.\r\n *\r\n * Used for the customizer setting's value.\r\n *\r\n * @param {string[]} dimensions - The allowed dimensions.\r\n * @param {string} unit - The unit.\r\n * @param {MarginPaddingValue} value - The value to parse.\r\n *\r\n * @return {MarginPaddingValue} - The value as object (with unit).\r\n */\r\nexport function makeObjValueWithUnit(\r\n\tdimensions: string[],\r\n\tunit: string,\r\n\tvalue: MarginPaddingValue,\r\n): MarginPaddingValue {\r\n\tconst newValue: Record<string, number | string> = {};\r\n\r\n\tfor (let i = 0; i < dimensions.length; i++) {\r\n\t\tconst dimension = dimensions[i];\r\n\t\tnewValue[dimension] = dimensions[i];\r\n\t}\r\n\r\n\tfor (const position in value) {\r\n\t\tif (!dimensions.includes(position)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tif (!newValue.hasOwnProperty(position)) continue;\r\n\r\n\t\tconst positionValue = value[position as MarginPaddingDimension];\r\n\r\n\t\tif (\"\" !== positionValue) {\r\n\t\t\tconst singleValue = makeMarginPaddingFieldValue(positionValue);\r\n\t\t\tnewValue[position] = singleValue + unit;\r\n\t\t}\r\n\t}\r\n\r\n\treturn newValue as MarginPaddingValue;\r\n}\r\n\r\nexport function makeObjValueWithoutUnitFromJson(\r\n\tdimensions: string[],\r\n\tjsonStr: string | null | undefined,\r\n): MarginPaddingValue {\r\n\tconst value = parseJsonOrUndefined<MarginPaddingValue>(jsonStr);\r\n\r\n\tif (!value) {\r\n\t\treturn makeEmptyValueObj(dimensions);\r\n\t}\r\n\r\n\treturn makeObjValueWithoutUnit(dimensions, value);\r\n}\r\n\r\nexport function makeEmptyValueObj(dimensions: string[]): MarginPaddingValue {\r\n\tconst value: Record<string, number | string> = {};\r\n\r\n\tfor (let i = 0; i < dimensions.length; i++) {\r\n\t\tconst dimension = dimensions[i];\r\n\r\n\t\t// We allow empty strings for each dimension.\r\n\t\tvalue[dimension] = \"\";\r\n\t}\r\n\r\n\treturn value as MarginPaddingValue;\r\n}\r\n","export default function DeviceButtons(props: { devices: string[] }) {\r\n\treturn (\r\n\t\t<div className=\"wpbf-device-buttons\">\r\n\t\t\t{props.devices.map((device, index) => {\r\n\t\t\t\tconst deviceClassName = `dashicons dashicons-${device === \"mobile\" ? \"smartphone\" : device}`;\r\n\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\tclassName={`wpbf-device-button wpbf-device-button-${device} ${0 === index ? \" is-active\" : \"\"}`}\r\n\t\t\t\t\t\tdata-wpbf-device={device}\r\n\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<i className={deviceClassName}></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t);\r\n\t\t\t})}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import React, { useRef, useState } from \"react\";\r\nimport {\r\n\tMarginPaddingDimension,\r\n\tMarginPaddingDimensionValuePair,\r\n\tMarginPaddingValue,\r\n} from \"./margin-padding-interface\";\r\nimport {\r\n\tmakeObjValueWithoutUnit,\r\n\tmakeObjValueWithoutUnitFromJson,\r\n\tmakeObjValueWithUnit,\r\n} from \"./margin-padding-util\";\r\nimport DeviceButtons from \"../../Responsive/src/DeviceButtons\";\r\nimport { encodeJsonOrDefault } from \"../../Generic/src/string-util\";\r\n\r\nexport default function MarginPaddingForm(props: {\r\n\tid: string;\r\n\ttype: string;\r\n\tsubtype: string;\r\n\tlabel?: string;\r\n\tdescription?: string;\r\n\tdefault?: any;\r\n\tdefaultArray: MarginPaddingValue;\r\n\tvalueArray: MarginPaddingValue;\r\n\tunit: string;\r\n\tsaveAsJson: boolean;\r\n\tdontSaveUnit: boolean;\r\n\tdimensions: string[];\r\n\tdevices?: string[] | undefined;\r\n\tisResponsive: boolean;\r\n\tupdateCustomizerSetting?: (val: string | MarginPaddingValue) => void;\r\n\toverrideUpdateComponentStateFn?: (\r\n\t\tfn: (val: string | MarginPaddingValue) => void,\r\n\t) => void;\r\n\tsetNotificationContainer?: any;\r\n}) {\r\n\tconst [inputValues, setInputValues] = useState(() => {\r\n\t\treturn props.valueArray;\r\n\t});\r\n\r\n\tconst defaultDefined =\r\n\t\t\"\" !== props.default && \"undefined\" !== typeof props.default;\r\n\r\n\tfunction updateComponentState(val: string | MarginPaddingValue) {\r\n\t\tconst newVal =\r\n\t\t\ttypeof val === \"string\"\r\n\t\t\t\t? makeObjValueWithoutUnitFromJson(props.dimensions, val)\r\n\t\t\t\t: makeObjValueWithoutUnit(props.dimensions, val);\r\n\r\n\t\tsetInputValues(newVal);\r\n\t}\r\n\r\n\tprops.overrideUpdateComponentStateFn?.(updateComponentState);\r\n\r\n\tfunction handleInputChange(\r\n\t\te: React.ChangeEvent<HTMLInputElement>,\r\n\t\tdimension: string,\r\n\t) {\r\n\t\tif (!props.dimensions.includes(dimension)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!e.target) return;\r\n\r\n\t\tconst values = { ...inputValues };\r\n\t\tif (!values.hasOwnProperty(dimension)) return;\r\n\r\n\t\t/**\r\n\t\t * On input change, the value comes from a number field.\r\n\t\t * That means we can just use its value without the need to parse it.\r\n\t\t */\r\n\t\tvalues[dimension as MarginPaddingDimension] = e.target.value;\r\n\r\n\t\tsetInputValues(values);\r\n\t\tsaveToCustomizerSetting(values);\r\n\t}\r\n\r\n\tfunction handleResetButtonClick(\r\n\t\t_e: React.MouseEvent<HTMLButtonElement>,\r\n\t\tdevice?: string,\r\n\t) {\r\n\t\tconst defaultValues = defaultDefined\r\n\t\t\t? props.defaultArray\r\n\t\t\t: props.valueArray;\r\n\r\n\t\tif (!device) {\r\n\t\t\tsaveToCustomizerSetting(defaultValues);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst existingValues = { ...inputValues };\r\n\r\n\t\tfor (const dimension in existingValues) {\r\n\t\t\tif (!existingValues.hasOwnProperty(dimension)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst hasDeviceStr = dimension.includes(device + \"_\");\r\n\t\t\tif (!hasDeviceStr) continue;\r\n\r\n\t\t\tif (!defaultValues.hasOwnProperty(dimension)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\texistingValues[dimension as MarginPaddingDimension] =\r\n\t\t\t\tdefaultValues[dimension as MarginPaddingDimension];\r\n\t\t}\r\n\r\n\t\tsaveToCustomizerSetting(existingValues);\r\n\t}\r\n\r\n\tfunction saveToCustomizerSetting(val: MarginPaddingValue) {\r\n\t\t/**\r\n\t\t * The \"dontSaveUnit\" option is used to support PBF's old \"responsive_padding\" control.\r\n\t\t */\r\n\t\tconst newVal = props.dontSaveUnit\r\n\t\t\t? makeObjValueWithoutUnit(props.dimensions, val)\r\n\t\t\t: makeObjValueWithUnit(props.dimensions, props.unit, val);\r\n\r\n\t\t/**\r\n\t\t * The \"saveAsJson\" option is used to support PBF's old \"responsive_padding\" control.\r\n\t\t */\r\n\t\tif (props.saveAsJson) {\r\n\t\t\tprops.updateCustomizerSetting?.(\r\n\t\t\t\tencodeJsonOrDefault<MarginPaddingValue>(val),\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tprops.updateCustomizerSetting?.(newVal);\r\n\t}\r\n\r\n\tfunction makeMappable(device?: string) {\r\n\t\tconst items: MarginPaddingDimensionValuePair[] = [];\r\n\r\n\t\tfor (const dimension in inputValues) {\r\n\t\t\tif (!inputValues.hasOwnProperty(dimension)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!device) {\r\n\t\t\t\titems.push({\r\n\t\t\t\t\tdimension: dimension as MarginPaddingDimension,\r\n\t\t\t\t\tvalue: inputValues[dimension as MarginPaddingDimension],\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst hasDeviceStr = dimension.includes(device + \"_\");\r\n\t\t\tif (!hasDeviceStr) continue;\r\n\r\n\t\t\titems.push({\r\n\t\t\t\tdimension: dimension as MarginPaddingDimension,\r\n\t\t\t\tvalue: inputValues[dimension as MarginPaddingDimension],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn items;\r\n\t}\r\n\r\n\tfunction renderFields(\r\n\t\tdevice: string,\r\n\t\tgroup: MarginPaddingDimensionValuePair[],\r\n\t) {\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<button\r\n\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\tclassName=\"wpbf-control-reset\"\r\n\t\t\t\t\tonClick={(e) => handleResetButtonClick(e, device)}\r\n\t\t\t\t>\r\n\t\t\t\t\t<i className=\"dashicons dashicons-image-rotate\"></i>\r\n\t\t\t\t</button>\r\n\r\n\t\t\t\t<div className=\"wpbf-control-cols\">\r\n\t\t\t\t\t<div className=\"wpbf-control-left-col\">\r\n\t\t\t\t\t\t<div className=\"wpbf-control-fields\">\r\n\t\t\t\t\t\t\t{group.map((item, i) => {\r\n\t\t\t\t\t\t\t\tconst inputClassName = `wpbf-control-input wpbf-control-input${device ? `-${device}` : \"\"}-${item.dimension}`;\r\n\t\t\t\t\t\t\t\tconst inputId = `_customize-input-${props.id}${device ? `-${device}` : \"\"}-${item.dimension}`;\r\n\t\t\t\t\t\t\t\tconst label = device\r\n\t\t\t\t\t\t\t\t\t? item.dimension.replace(device + \"_\", \"\")\r\n\t\t\t\t\t\t\t\t\t: item.dimension;\r\n\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<div className=\"wpbf-control-field\" key={i}>\r\n\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\tid={inputId}\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t\t\t\t\tvalue={item.value || 0 === item.value ? item.value : \"\"}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={inputClassName}\r\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(e, item.dimension)}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<label className=\"wpbf-control-sublabel\" htmlFor={inputId}>\r\n\t\t\t\t\t\t\t\t\t\t\t{label}\r\n\t\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"wpbf-control-right-col\">\r\n\t\t\t\t\t\t<span ref={unitRef} className=\"wpbf-control-unit\">\r\n\t\t\t\t\t\t\t{props.unit}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\tfunction renderFieldGroups() {\r\n\t\tif (!props.isResponsive || !props.devices || !props.devices.length) {\r\n\t\t\treturn renderFields(\"\", makeMappable());\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t{props.devices.map((device, index) => {\r\n\t\t\t\t\tconst isActive = 0 === index;\r\n\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName={`wpbf-control-device wpbf-control-${device} ${isActive ? \"is-active\" : \"\"}`}\r\n\t\t\t\t\t\t\tdata-wpbf-device={device}\r\n\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{renderFields(device, makeMappable(device))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t})}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\tfunction renderDeviceButtons() {\r\n\t\tif (!props.isResponsive || !props.devices || !props.devices.length) {\r\n\t\t\treturn <></>;\r\n\t\t}\r\n\r\n\t\treturn <DeviceButtons devices={props.devices} />;\r\n\t}\r\n\r\n\tconst unitRef = useRef(null);\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<header className=\"wpbf-control-header\">\r\n\t\t\t\t{props.label && (\r\n\t\t\t\t\t<label\r\n\t\t\t\t\t\tclassName=\"customize-control-title\"\r\n\t\t\t\t\t\thtmlFor={`wpbf-control-input-${props.type}-top`}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<span className=\"customize-control-title\">{props.label}</span>\r\n\t\t\t\t\t</label>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{renderDeviceButtons()}\r\n\t\t\t</header>\r\n\r\n\t\t\t{props.description && (\r\n\t\t\t\t<span\r\n\t\t\t\t\tclassName=\"customize-control-description description\"\r\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: props.description }}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"customize-control-notifications-container\"\r\n\t\t\t\tref={props.setNotificationContainer}\r\n\t\t\t/>\r\n\r\n\t\t\t<div className=\"wpbf-control-form\">{renderFieldGroups()}</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import MarginPaddingForm from \"./MarginPaddingForm\";\r\nimport { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport {\r\n\tMarginPaddingValue,\r\n\tWpbfMarginPaddingControl,\r\n} from \"./margin-padding-interface\";\r\nimport { createRoot } from \"react-dom/client\";\r\nimport { makeObjValueWithoutUnitFromJson } from \"./margin-padding-util\";\r\n\r\nexport default function MarginPaddingControl(customizer: WpbfCustomize) {\r\n\treturn customizer.Control.extend<WpbfMarginPaddingControl>({\r\n\t\tinitialize: function initialize(id, params) {\r\n\t\t\t// Bind functions to this control context for passing as React props.\r\n\t\t\tthis.setNotificationContainer = this.setNotificationContainer?.bind(this);\r\n\t\t\tthis.overrideUpdateComponentStateFn =\r\n\t\t\t\tthis.overrideUpdateComponentStateFn?.bind(this);\r\n\t\t\tthis.updateCustomizerSetting = this.updateCustomizerSetting?.bind(this);\r\n\r\n\t\t\tcustomizer.Control.prototype.initialize.call(this, id, params);\r\n\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\tfunction onRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\tif (control === removedControl) {\r\n\t\t\t\t\tcontrol.destroy?.();\r\n\t\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\t\tcustomizer.control.unbind(\"removed\", onRemoved);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcustomizer.control.bind(\"removed\", onRemoved);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set notification container and render.\r\n\t\t *\r\n\t\t * This is called when the React component is mounted.\r\n\t\t */\r\n\t\tsetNotificationContainer: function setNotificationContainer(el) {\r\n\t\t\tif (this.notifications) this.notifications.container = jQuery(el);\r\n\t\t\tthis.notifications?.render();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Render the control into the DOM.\r\n\t\t *\r\n\t\t * This is called from the Control#embed() method in the parent class.\r\n\t\t */\r\n\t\trenderContent: function renderContent() {\r\n\t\t\tconst isResponsive =\r\n\t\t\t\t\"responsive-margin\" === this.params?.subtype ||\r\n\t\t\t\t\"responsive-padding\" === this.params?.subtype;\r\n\r\n\t\t\tif (!this.root && this.container) {\r\n\t\t\t\tthis.root = createRoot(this.container[0]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.root?.render(\r\n\t\t\t\t<MarginPaddingForm\r\n\t\t\t\t\tid={this.setting?.id ?? \"\"}\r\n\t\t\t\t\ttype={this.params?.type}\r\n\t\t\t\t\tsubtype={this.params?.subtype}\r\n\t\t\t\t\tlabel={this.params?.label}\r\n\t\t\t\t\tdescription={this.params?.description}\r\n\t\t\t\t\tdefault={this.params?.default}\r\n\t\t\t\t\tdefaultArray={this.params?.defaultArray}\r\n\t\t\t\t\tvalueArray={this.params?.valueArray}\r\n\t\t\t\t\tunit={this.params?.unit}\r\n\t\t\t\t\tsaveAsJson={this.params?.saveAsJson}\r\n\t\t\t\t\tdontSaveUnit={this.params?.dontSaveUnit}\r\n\t\t\t\t\tdimensions={this.params?.dimensions}\r\n\t\t\t\t\tdevices={this.params?.devices}\r\n\t\t\t\t\tisResponsive={isResponsive}\r\n\t\t\t\t\tupdateCustomizerSetting={this.updateCustomizerSetting}\r\n\t\t\t\t\toverrideUpdateComponentStateFn={this.overrideUpdateComponentStateFn}\r\n\t\t\t\t\tsetNotificationContainer={this.setNotificationContainer}\r\n\t\t\t\t/>,\r\n\t\t\t);\r\n\r\n\t\t\tif (isResponsive) {\r\n\t\t\t\tthis.container?.addClass(\"margin-padding-control\");\r\n\t\t\t\tthis.container?.data(\"control-subtype\", this.params?.subtype);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.params?.allowCollapse) {\r\n\t\t\t\tthis.container?.addClass(\"allowCollapse\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t\t *\r\n\t\t * React is available to be used here instead of the customizer.Element abstraction.\r\n\t\t */\r\n\t\tready: function ready() {\r\n\t\t\t// Update component value's state when customizer setting's value is changed.\r\n\t\t\tthis.setting?.bind((val) => {\r\n\t\t\t\tconst newVal =\r\n\t\t\t\t\ttypeof val === \"string\"\r\n\t\t\t\t\t\t? makeObjValueWithoutUnitFromJson(this.params?.dimensions, val)\r\n\t\t\t\t\t\t: val;\r\n\r\n\t\t\t\tthis.updateComponentState?.(newVal);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tupdateCustomizerSetting: function updateCustomizerSetting(val) {\r\n\t\t\tif (val === undefined) return;\r\n\t\t\tthis.setting?.set(val);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will be overriden by the rendered component via overrideUpdateComponentStateFn.\r\n\t\t */\r\n\t\tupdateComponentState: (_val: MarginPaddingValue | string) => {},\r\n\r\n\t\toverrideUpdateComponentStateFn: function overrideUpdateComponentStateFn(\r\n\t\t\tfn,\r\n\t\t) {\r\n\t\t\tthis.updateComponentState = fn;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t *\r\n\t\t * This is essentially the inverse of the Control#embed() method.\r\n\t\t *\r\n\t\t * @link https://core.trac.wordpress.org/ticket/31334\r\n\t\t */\r\n\t\tdestroy: function destroy() {\r\n\t\t\tthis.root?.unmount();\r\n\t\t\tthis.root = undefined;\r\n\r\n\t\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\t\tcustomizer.Control.prototype.destroy?.call(this);\r\n\t\t},\r\n\t});\r\n}\r\n","import ColorControl from \"./ColorControl\";\r\nimport MulticolorControl from \"./MulticolorControl\";\r\n\r\n// Register control type with Customizer.\r\nif (window.wp.customize) {\r\n\tif (ColorControl) {\r\n\t\twindow.wp.customize.controlConstructor[\"wpbf-color\"] = ColorControl;\r\n\t}\r\n\r\n\tif (MulticolorControl) {\r\n\t\twindow.wp.customize.controlConstructor[\"wpbf-multicolor\"] =\r\n\t\t\tMulticolorControl;\r\n\t}\r\n}\r\n","import { WpbfCustomizeSetting } from \"../../Base/src/base-interface\";\r\nimport { WpbfDimensionControl } from \"./dimension-interface\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\ndeclare var wpbfDimensionControlL10n: Record<string, string>;\r\n\r\nwp.customize.controlConstructor[\"wpbf-dimension\"] =\r\n\twp.customize.wpbfDynamicControl.extend<WpbfDimensionControl>({\r\n\t\tinitWpbfControl: function (\r\n\t\t\tthis: WpbfDimensionControl,\r\n\t\t\tcontrol?: WpbfDimensionControl,\r\n\t\t) {\r\n\t\t\tcontrol = control || this;\r\n\t\t\tlet value;\r\n\r\n\t\t\t// Notifications.\r\n\t\t\tcontrol.wpbfNotifications!();\r\n\r\n\t\t\t// Save the value\r\n\t\t\tcontrol.container.on(\"change keyup paste\", \"input\", function () {\r\n\t\t\t\tvalue = jQuery(this).val();\r\n\t\t\t\tcontrol.setting?.set(value);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handles notifications.\r\n\t\t */\r\n\t\twpbfNotifications: function (this: WpbfDimensionControl) {\r\n\t\t\tlet control = this;\r\n\r\n\t\t\tconst allowUnitless = control.params.allowUnitless;\r\n\r\n\t\t\twp.customize(control.id, function (setting) {\r\n\t\t\t\tsetting.bind(function (value) {\r\n\t\t\t\t\tconst code = \"long_title\";\r\n\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\t!control.validateCssValue!(value) &&\r\n\t\t\t\t\t\t(!allowUnitless || isNaN(value))\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tsetting.notifications.add(\r\n\t\t\t\t\t\t\tcode,\r\n\t\t\t\t\t\t\t// @ts-ignore - There's mistake in the type definition.\r\n\t\t\t\t\t\t\tnew wp.customize.Notification(code, {\r\n\t\t\t\t\t\t\t\ttype: \"warning\",\r\n\t\t\t\t\t\t\t\tmessage: wpbfDimensionControlL10n[\"invalid-value\"],\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t(setting as WpbfCustomizeSetting<any>).notifications.remove(code);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tvalidateCssValue: function (value: string | number) {\r\n\t\t\tconst control = this as WpbfDimensionControl;\r\n\t\t\tconst validUnits = [\r\n\t\t\t\t\"fr\",\r\n\t\t\t\t\"rem\",\r\n\t\t\t\t\"em\",\r\n\t\t\t\t\"ex\",\r\n\t\t\t\t\"%\",\r\n\t\t\t\t\"px\",\r\n\t\t\t\t\"cm\",\r\n\t\t\t\t\"mm\",\r\n\t\t\t\t\"in\",\r\n\t\t\t\t\"pt\",\r\n\t\t\t\t\"pc\",\r\n\t\t\t\t\"ch\",\r\n\t\t\t\t\"vh\",\r\n\t\t\t\t\"vw\",\r\n\t\t\t\t\"vmin\",\r\n\t\t\t\t\"vmax\",\r\n\t\t\t];\r\n\r\n\t\t\t// Whitelist values.\r\n\t\t\tif (\r\n\t\t\t\t!value ||\r\n\t\t\t\t\"\" === value ||\r\n\t\t\t\t0 === value ||\r\n\t\t\t\t\"0\" === value ||\r\n\t\t\t\t\"auto\" === value ||\r\n\t\t\t\t\"inherit\" === value ||\r\n\t\t\t\t\"initial\" === value\r\n\t\t\t) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tconst valueStr = typeof value === \"string\" ? value : value.toString();\r\n\r\n\t\t\t// Skip checking if calc().\r\n\t\t\tif (0 <= valueStr.indexOf(\"calc(\") && 0 <= valueStr.indexOf(\")\")) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tconst numericValue = parseFloat(valueStr);\r\n\r\n\t\t\tconst unit = valueStr.replace(numericValue.toString(), \"\");\r\n\r\n\t\t\t// Allow unitless.\r\n\t\t\tif (!unit) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for multiple values.\r\n\t\t\tconst multiples = valueStr.split(\" \");\r\n\t\t\tlet multiplesValid = true;\r\n\r\n\t\t\tif (2 <= multiples.length) {\r\n\t\t\t\tmultiples.forEach(function (item) {\r\n\t\t\t\t\tif (item && !control.validateCssValue!(item)) {\r\n\t\t\t\t\t\tmultiplesValid = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn multiplesValid;\r\n\t\t\t}\r\n\r\n\t\t\t// Check the validity of the numeric value and units.\r\n\t\t\treturn !isNaN(numericValue) && -1 !== validUnits.indexOf(unit);\r\n\t\t},\r\n\t});\r\n","import { WpbfEditorControl } from \"./editor-interface\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n\teditor: any;\r\n};\r\n\r\ndeclare var tinyMCE: any;\r\n\r\n/* global tinyMCE */\r\nwp.customize.controlConstructor[\"wpbf-editor\"] =\r\n\twp.customize.wpbfDynamicControl.extend<WpbfEditorControl>({\r\n\t\tinitWpbfControl: function (\r\n\t\t\tthis: WpbfEditorControl,\r\n\t\t\tctrl?: WpbfEditorControl,\r\n\t\t) {\r\n\t\t\tconst control = ctrl || this;\r\n\t\t\tconst element = control.container.find(\"textarea\");\r\n\t\t\tconst id = \"wpbf-editor-\" + control.id.replace(\"[\", \"\").replace(\"]\", \"\");\r\n\r\n\t\t\tconst defaultParams = {\r\n\t\t\t\ttinymce: {\r\n\t\t\t\t\twpautop: true,\r\n\t\t\t\t},\r\n\t\t\t\tquicktags: true,\r\n\t\t\t\tmediaButtons: true,\r\n\t\t\t};\r\n\r\n\t\t\t// Overwrite the default paramaters if choices is defined.\r\n\t\t\tif (wp.editor && wp.editor.initialize) {\r\n\t\t\t\twp.editor.initialize(\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tjQuery.extend({}, defaultParams, {\r\n\t\t\t\t\t\ttinymce: control.params.tinymce,\r\n\t\t\t\t\t\tquicktags: control.params.quicktags,\r\n\t\t\t\t\t}),\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tconst editor = tinyMCE.get(id);\r\n\r\n\t\t\tif (editor) {\r\n\t\t\t\teditor.onChange.add(function (ed: any) {\r\n\t\t\t\t\ted.save();\r\n\t\t\t\t\tconst content = editor.getContent();\r\n\t\t\t\t\telement.val(content).trigger(\"change\");\r\n\t\t\t\t\twp.customize.instance(control.id).set(content);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t});\r\n","import { WpbfGenericControl } from \"./generic-interface\";\r\nimport {\r\n\tlimitNumber,\r\n\tlimitNumberWithUnit,\r\n\tnormalizeMaxValue,\r\n} from \"./number-util\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\nwp.customize.controlConstructor[\"wpbf-generic\"] =\r\n\twp.customize.wpbfDynamicControl.extend<WpbfGenericControl>({\r\n\t\tinitWpbfControl: function (\r\n\t\t\tthis: WpbfGenericControl,\r\n\t\t\tcontrol?: WpbfGenericControl,\r\n\t\t) {\r\n\t\t\tcontrol = control || this;\r\n\t\t\tconst params = control.params;\r\n\r\n\t\t\tif (\"wpbf-generic\" !== params.type) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst inputSelector = \".wpbf-control-form input\";\r\n\t\t\tconst textareaSelector = \".wpbf-control-form textarea\";\r\n\r\n\t\t\tcontrol.container\r\n\t\t\t\t.find(`${inputSelector}, ${textareaSelector}`)\r\n\t\t\t\t.on(\"input\", function () {\r\n\t\t\t\t\tlet fieldValue: string | number =\r\n\t\t\t\t\t\tthis instanceof HTMLInputElement ||\r\n\t\t\t\t\t\tthis instanceof HTMLTextAreaElement\r\n\t\t\t\t\t\t\t? this.value\r\n\t\t\t\t\t\t\t: \"\";\r\n\r\n\t\t\t\t\tif (\"number\" === params.subtype || \"number-unit\" === params.subtype) {\r\n\t\t\t\t\t\tparams.max = normalizeMaxValue(params.min, params.max);\r\n\r\n\t\t\t\t\t\tfieldValue =\r\n\t\t\t\t\t\t\t\"number\" === params.subtype\r\n\t\t\t\t\t\t\t\t? limitNumber(fieldValue, params.min, params.max)\r\n\t\t\t\t\t\t\t\t: limitNumberWithUnit(fieldValue, params.min, params.max);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontrol.setting?.set(fieldValue);\r\n\t\t\t\t});\r\n\t\t},\r\n\t});\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport { WpbfAssocArrayControl } from \"./generic-interface\";\r\n\r\nif (window.wp.customize) {\r\n\tsetupAssocArrayControl(window.wp.customize);\r\n}\r\n\r\nfunction setupAssocArrayControl(customizer: WpbfCustomize) {\r\n\tcustomizer.controlConstructor[\"wpbf-assoc-array\"] =\r\n\t\tcustomizer.wpbfDynamicControl.extend<WpbfAssocArrayControl>({\r\n\t\t\tinitWpbfControl: function (\r\n\t\t\t\tthis: WpbfAssocArrayControl,\r\n\t\t\t\tcontrol?: WpbfAssocArrayControl,\r\n\t\t\t) {\r\n\t\t\t\tcontrol = control || this;\r\n\t\t\t\tif (!control) return;\r\n\r\n\t\t\t\tcontrol.setting?.bind((value: Record<string, any>) => {\r\n\t\t\t\t\tcontrol.updateComponentState?.(value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\t\tfunction onRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\t\tif (control === removedControl) {\r\n\t\t\t\t\t\tcontrol?.destroy?.();\r\n\t\t\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\t\t\tcustomizer.control.unbind(\"removed\", onRemoved);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcustomizer.control.bind(\"removed\", onRemoved);\r\n\t\t\t},\r\n\r\n\t\t\tupdateComponentState: function (\r\n\t\t\t\tthis: WpbfAssocArrayControl,\r\n\t\t\t\tvalue: Record<string, any>,\r\n\t\t\t) {\r\n\t\t\t\tconst fields = this.container[0].querySelectorAll(\r\n\t\t\t\t\t\".wpbf-control-form input[data-setting-prop]\",\r\n\t\t\t\t);\r\n\t\t\t\tif (!fields.length) return;\r\n\r\n\t\t\t\tfields.forEach((field) => {\r\n\t\t\t\t\tif (!(field instanceof HTMLInputElement)) return;\r\n\t\t\t\t\tconst prop = field.dataset.settingProp;\r\n\t\t\t\t\tif (!prop || !value[prop]) return;\r\n\t\t\t\t\tfield.value = value[prop];\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tready: function () {\r\n\t\t\t\tif (!this.container) return;\r\n\r\n\t\t\t\tthis.currentValue = this.setting?.get();\r\n\r\n\t\t\t\tconst fields = this.container[0].querySelectorAll(\r\n\t\t\t\t\t\"input[data-setting-prop]\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tfields.forEach((field) => {\r\n\t\t\t\t\tif (!(field instanceof HTMLInputElement)) return;\r\n\r\n\t\t\t\t\tfield.addEventListener(\"change\", (e) => {\r\n\t\t\t\t\t\tconst values: Record<string, any> = {};\r\n\r\n\t\t\t\t\t\tfields.forEach((field) => {\r\n\t\t\t\t\t\t\tif (!(field instanceof HTMLInputElement)) return;\r\n\t\t\t\t\t\t\tconst prop = field.dataset.settingProp;\r\n\t\t\t\t\t\t\tif (!prop) return;\r\n\t\t\t\t\t\t\tvalues[prop] = field.value;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tthis.setting?.set(values);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tthis.setting?.bind((val) => {\r\n\t\t\t\t\tcontrol.updateComponentState?.(val);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tdestroy: function () {},\r\n\t\t});\r\n}\r\n","import { encodeJsonOrDefault } from \"./string-util\";\r\nimport { WpbfResponsiveGenericControl } from \"./generic-interface\";\r\nimport {\r\n\tlimitNumber,\r\n\tlimitNumberWithUnit,\r\n\tnormalizeMaxValue,\r\n} from \"./number-util\";\r\nimport { makeDevicesValue } from \"../../Responsive/src/responsive-util\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\nwp.customize.controlConstructor[\"wpbf-responsive-generic\"] =\r\n\twp.customize.wpbfDynamicControl.extend<WpbfResponsiveGenericControl>(\r\n\t\t{\r\n\t\t\tinitWpbfControl: function (\r\n\t\t\t\tthis: WpbfResponsiveGenericControl,\r\n\t\t\t\tcontrol?: WpbfResponsiveGenericControl,\r\n\t\t\t) {\r\n\t\t\t\tcontrol = control || this;\r\n\t\t\t\tconst params = control.params;\r\n\r\n\t\t\t\tif (\"wpbf-responsive-generic\" !== params.type) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst inputSelector = \".wpbf-control-form input\";\r\n\t\t\t\tconst textareaSelector = \".wpbf-control-form textarea\";\r\n\r\n\t\t\t\tcontrol.container\r\n\t\t\t\t\t.find(`${inputSelector}, ${textareaSelector}`)\r\n\t\t\t\t\t.on(\"input\", function (e) {\r\n\t\t\t\t\t\tconst existingValue = control.setting?.get();\r\n\r\n\t\t\t\t\t\tconst valueRecord =\r\n\t\t\t\t\t\t\t\"string\" === typeof existingValue\r\n\t\t\t\t\t\t\t\t? makeDevicesValue(\r\n\t\t\t\t\t\t\t\t\t\tparams.subtype,\r\n\t\t\t\t\t\t\t\t\t\tparams.devices,\r\n\t\t\t\t\t\t\t\t\t\texistingValue,\r\n\t\t\t\t\t\t\t\t\t\tparams.min,\r\n\t\t\t\t\t\t\t\t\t\tparams.max,\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t: existingValue;\r\n\r\n\t\t\t\t\t\tconst parent = this.parentNode;\r\n\r\n\t\t\t\t\t\tconst device =\r\n\t\t\t\t\t\t\tparent instanceof HTMLElement\r\n\t\t\t\t\t\t\t\t? parent.dataset.wpbfDevice\r\n\t\t\t\t\t\t\t\t: undefined;\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t!device ||\r\n\t\t\t\t\t\t\t!valueRecord ||\r\n\t\t\t\t\t\t\t!valueRecord.hasOwnProperty(device)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet fieldValue: string | number =\r\n\t\t\t\t\t\t\tthis instanceof HTMLInputElement ||\r\n\t\t\t\t\t\t\tthis instanceof HTMLTextAreaElement\r\n\t\t\t\t\t\t\t\t? this.value\r\n\t\t\t\t\t\t\t\t: \"\";\r\n\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\"number\" === params.subtype ||\r\n\t\t\t\t\t\t\t\"number-unit\" === params.subtype\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tparams.max = normalizeMaxValue(params.min, params.max);\r\n\r\n\t\t\t\t\t\t\tfieldValue =\r\n\t\t\t\t\t\t\t\t\"number\" === params.subtype\r\n\t\t\t\t\t\t\t\t\t? limitNumber(fieldValue, params.min, params.max)\r\n\t\t\t\t\t\t\t\t\t: limitNumberWithUnit(fieldValue, params.min, params.max);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvalueRecord[device] = fieldValue;\r\n\r\n\t\t\t\t\t\tconst customizerValue = params.saveAsJson\r\n\t\t\t\t\t\t\t? encodeJsonOrDefault(valueRecord)\r\n\t\t\t\t\t\t\t: valueRecord;\r\n\r\n\t\t\t\t\t\tcontrol.setting?.set(customizerValue);\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t},\r\n\t);\r\n","import MarginPaddingControl from \"./MarginPaddingControl\";\r\n\r\nif (window.wp.customize) {\r\n\twindow.wp.customize.controlConstructor[\"wpbf-margin-padding\"] =\r\n\t\tMarginPaddingControl(window.wp.customize);\r\n\r\n\twindow.wp.customize.controlConstructor[\"wpbf-responsive-margin-padding\"] =\r\n\t\tMarginPaddingControl(window.wp.customize);\r\n}\r\n","import _ from \"lodash\";\r\nimport i18n from \"@wordpress/i18n/build-types/default-i18n\";\r\nimport { WpbfImageControl } from \"./image-interface\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n\tmedia: any;\r\n\ti18n: typeof i18n;\r\n};\r\n\r\nwp.customize.controlConstructor[\"wpbf-image\"] =\r\n\twp.customize.wpbfDynamicControl.extend({\r\n\t\tinitWpbfControl: function (\r\n\t\t\tthis: WpbfImageControl,\r\n\t\t\tctrl?: WpbfImageControl,\r\n\t\t) {\r\n\t\t\tconst control = ctrl || this;\r\n\t\t\tconst params = control.params;\r\n\r\n\t\t\tconst saveAs = params.saveAs;\r\n\t\t\tconst defaultSrc = params.defaultSrc;\r\n\t\t\tconst valueSrc = params.valueSrc;\r\n\r\n\t\t\tconst box = control.container[0].querySelector(\".attachment-media-view\");\r\n\r\n\t\t\tconst preview: HTMLElement | null =\r\n\t\t\t\tbox?.querySelector(\".thumbnail\") ?? null;\r\n\r\n\t\t\tconst selectButton: HTMLButtonElement | null =\r\n\t\t\t\tbox?.querySelector(\".button-add-media\") ?? null;\r\n\r\n\t\t\tconst changeButton: HTMLButtonElement | null =\r\n\t\t\t\tbox?.querySelector(\".change-button\") ?? null;\r\n\r\n\t\t\tconst removeButton: HTMLButtonElement | null =\r\n\t\t\t\tbox?.querySelector(\".remove-button\") ?? null;\r\n\r\n\t\t\tconst defaultButton: HTMLButtonElement | null =\r\n\t\t\t\tbox?.querySelector(\".default-button\") ?? null;\r\n\r\n\t\t\thandleButtonsDisplay();\r\n\r\n\t\t\tlet previewUrl = valueSrc.url;\r\n\r\n\t\t\tif (preview && previewUrl) {\r\n\t\t\t\tpreview.innerHTML =\r\n\t\t\t\t\t'<img class=\"attachment-thumb\" src=\"' + previewUrl + '\" alt=\"\" />';\r\n\t\t\t}\r\n\r\n\t\t\tselectButton?.addEventListener(\"click\", openMediaLibrary);\r\n\t\t\tchangeButton?.addEventListener(\"click\", openMediaLibrary);\r\n\t\t\tremoveButton?.addEventListener(\"click\", removeImage);\r\n\t\t\tdefaultButton?.addEventListener(\"click\", useDefaultValue);\r\n\r\n\t\t\tfunction openMediaLibrary() {\r\n\t\t\t\tconst selectedImage = wp\r\n\t\t\t\t\t.media({ multiple: false })\r\n\t\t\t\t\t.open()\r\n\t\t\t\t\t.on(\"select\", function () {\r\n\t\t\t\t\t\t// This will return the selected image from the \"Media Uploader\", the result is an object.\r\n\t\t\t\t\t\tconst uploadedImage = selectedImage\r\n\t\t\t\t\t\t\t.state()\r\n\t\t\t\t\t\t\t.get(\"selection\")\r\n\t\t\t\t\t\t\t.first();\r\n\r\n\t\t\t\t\t\tconst jsonImg = uploadedImage.toJSON();\r\n\r\n\t\t\t\t\t\tvalueSrc.id = jsonImg.id;\r\n\t\t\t\t\t\tvalueSrc.url = jsonImg.url;\r\n\t\t\t\t\t\tvalueSrc.width = jsonImg.width;\r\n\t\t\t\t\t\tvalueSrc.height = jsonImg.height;\r\n\r\n\t\t\t\t\t\tpreviewUrl = jsonImg.url;\r\n\r\n\t\t\t\t\t\tif (!_.isUndefined(jsonImg.sizes)) {\r\n\t\t\t\t\t\t\tvalueSrc.url = jsonImg.sizes.full.url;\r\n\t\t\t\t\t\t\tpreviewUrl = jsonImg.sizes.full.url;\r\n\r\n\t\t\t\t\t\t\tif (!_.isUndefined(jsonImg.sizes.medium)) {\r\n\t\t\t\t\t\t\t\tpreviewUrl = jsonImg.sizes.medium.url;\r\n\t\t\t\t\t\t\t} else if (!_.isUndefined(jsonImg.sizes.thumbnail)) {\r\n\t\t\t\t\t\t\t\tpreviewUrl = jsonImg.sizes.thumbnail.url;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (\"array\" === saveAs) {\r\n\t\t\t\t\t\t\tcontrol.setting?.set(valueSrc);\r\n\t\t\t\t\t\t} else if (\"id\" === saveAs) {\r\n\t\t\t\t\t\t\tcontrol.setting?.set(valueSrc.id);\r\n\t\t\t\t\t\t} else if (\"url\" === saveAs) {\r\n\t\t\t\t\t\t\tcontrol.setting?.set(valueSrc.url);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (preview) {\r\n\t\t\t\t\t\t\tpreview.innerHTML =\r\n\t\t\t\t\t\t\t\t'<img class=\"attachment-thumb\" src=\"' +\r\n\t\t\t\t\t\t\t\tpreviewUrl +\r\n\t\t\t\t\t\t\t\t'\" alt=\"\" />';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\thandleButtonsDisplay();\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfunction removeImage() {\r\n\t\t\t\temptyValue();\r\n\r\n\t\t\t\tif (\"array\" === saveAs) {\r\n\t\t\t\t\tcontrol.setting?.set(valueSrc);\r\n\t\t\t\t} else if (\"id\" === saveAs) {\r\n\t\t\t\t\tcontrol.setting?.set(0);\r\n\t\t\t\t} else if (\"url\" === saveAs) {\r\n\t\t\t\t\tcontrol.setting?.set(\"\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (preview) {\r\n\t\t\t\t\tpreview.innerHTML = wp.i18n.__(\"No image selected\", \"wpbf\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandleButtonsDisplay();\r\n\t\t\t}\r\n\r\n\t\t\tfunction useDefaultValue() {\r\n\t\t\t\tcontrol.setting?.set(defaultSrc);\r\n\r\n\t\t\t\tif (preview) {\r\n\t\t\t\t\tpreview.innerHTML =\r\n\t\t\t\t\t\t'<img class=\"attachment-thumb\" src=\"' +\r\n\t\t\t\t\t\tcontrol.params.default +\r\n\t\t\t\t\t\t'\" alt=\"\" />';\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandleButtonsDisplay();\r\n\t\t\t}\r\n\r\n\t\t\tfunction emptyValue() {\r\n\t\t\t\tvalueSrc.id = 0;\r\n\t\t\t\tvalueSrc.url = \"\";\r\n\t\t\t\tvalueSrc.width = 0;\r\n\t\t\t\tvalueSrc.height = 0;\r\n\t\t\t}\r\n\r\n\t\t\tfunction handleButtonsDisplay() {\r\n\t\t\t\tif (valueSrc.url) {\r\n\t\t\t\t\tif (preview) preview.classList.remove(\"hidden\");\r\n\t\t\t\t\tif (removeButton) removeButton.classList.remove(\"hidden\");\r\n\t\t\t\t\tif (selectButton) selectButton.classList.add(\"hidden\");\r\n\t\t\t\t\tif (changeButton) changeButton.classList.remove(\"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (preview) preview.classList.add(\"hidden\");\r\n\t\t\t\t\tif (removeButton) removeButton.classList.add(\"hidden\");\r\n\t\t\t\t\tif (selectButton) selectButton.classList.remove(\"hidden\");\r\n\t\t\t\t\tif (changeButton) changeButton.classList.add(\"hidden\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (valueSrc.id === defaultSrc.id) {\r\n\t\t\t\t\tif (defaultButton) defaultButton.classList.add(\"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (defaultButton) defaultButton.classList.remove(\"hidden\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t});\r\n","declare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\nwp.customize.controlConstructor[\"wpbf-radio\"] =\r\n\twp.customize.wpbfDynamicControl.extend({});\r\n\r\nwp.customize.controlConstructor[\"wpbf-radio-buttonset\"] =\r\n\twp.customize.wpbfDynamicControl.extend({});\r\n\r\nwp.customize.controlConstructor[\"wpbf-radio-image\"] =\r\n\twp.customize.wpbfDynamicControl.extend({});\r\n","import _ from \"lodash\";\r\nimport jQuery from \"jquery\";\r\nimport {\r\n\tWpbfRepeaterControl,\r\n\tWpbfRepeaterRow,\r\n} from \"./repeater-interface\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\nexport default class RepeaterRow implements WpbfRepeaterRow {\r\n\trowIndex: number;\r\n\tcontainer: JQuery<HTMLElement>;\r\n\tlabel: Record<string, string>;\r\n\theader: JQuery<HTMLElement>;\r\n\tcontrol: WpbfRepeaterControl;\r\n\r\n\tconstructor(\r\n\t\trowIndex: number,\r\n\t\tcontainer: JQuery<HTMLElement>,\r\n\t\tlabel: Record<string, string>,\r\n\t\tcontrol: WpbfRepeaterControl,\r\n\t) {\r\n\t\tthis.rowIndex = rowIndex;\r\n\t\tthis.container = container;\r\n\t\tthis.label = label;\r\n\t\tthis.header = this.container.find(\".repeater-row-header\");\r\n\t\tthis.control = control;\r\n\r\n\t\tthis.header.on(\"click\", () => this.toggleMinimize());\r\n\r\n\t\tthis.container.on(\"click\", \".repeater-row-remove\", () => this.remove());\r\n\r\n\t\tthis.header.on(\"mousedown\", () =>\r\n\t\t\tthis.container.trigger(\"row:start-dragging\"),\r\n\t\t);\r\n\r\n\t\tthis.container.on(\r\n\t\t\t\"keyup change\",\r\n\t\t\t\"input, select, textarea\",\r\n\t\t\t(e: JQuery.TriggeredEvent) =>\r\n\t\t\t\tthis.container.trigger(\"row:update\", [\r\n\t\t\t\t\tthis.rowIndex,\r\n\t\t\t\t\tjQuery(e.target).data(\"field\"),\r\n\t\t\t\t\te.target,\r\n\t\t\t\t]),\r\n\t\t);\r\n\r\n\t\tthis.setRowIndex(this.rowIndex);\r\n\t}\r\n\r\n\tsetRowIndex = (rowNum: number): void => {\r\n\t\tthis.rowIndex = rowNum;\r\n\t\tthis.container.attr(\"data-row\", rowNum);\r\n\t\tthis.container.data(\"row\", rowNum);\r\n\t\tthis.updateLabel();\r\n\t};\r\n\r\n\ttoggleMinimize = (): void => {\r\n\t\tthis.container.toggleClass(\"minimized\");\r\n\t\tthis.header\r\n\t\t\t.find(\".dashicons\")\r\n\t\t\t.toggleClass(\"dashicons-arrow-up dashicons-arrow-down\");\r\n\t};\r\n\r\n\tremove = (): void => {\r\n\t\tthis.container.slideUp(300, () => {\r\n\t\t\tthis.container.detach();\r\n\t\t});\r\n\t\tthis.container.trigger(\"row:remove\", [this.rowIndex]);\r\n\t};\r\n\r\n\tupdateLabel = (): void => {\r\n\t\tif (\"field\" === this.label.type) {\r\n\t\t\tconst rowLabelField = this.container[0].querySelector(\r\n\t\t\t\t`.repeater-field [data-field=\"${this.label.field}\"]`,\r\n\t\t\t);\r\n\r\n\t\t\tif (\r\n\t\t\t\trowLabelField &&\r\n\t\t\t\trowLabelField instanceof HTMLInputElement &&\r\n\t\t\t\ttypeof rowLabelField.value === \"string\"\r\n\t\t\t) {\r\n\t\t\t\tlet rowLabel: string = rowLabelField.value;\r\n\r\n\t\t\t\tif (rowLabel !== \"\") {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tthis.control.params.fields[this.label.field] &&\r\n\t\t\t\t\t\tthis.control.params.fields[this.label.field].type\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tthis.control.params.fields[this.label.field].type === \"select\" &&\r\n\t\t\t\t\t\t\tthis.control.params.fields[this.label.field].choices &&\r\n\t\t\t\t\t\t\tthis.control.params.fields[this.label.field].choices[rowLabel]\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\trowLabel =\r\n\t\t\t\t\t\t\t\tthis.control.params.fields[this.label.field].choices[rowLabel];\r\n\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t(this.control.params.fields[this.label.field].type === \"radio\" ||\r\n\t\t\t\t\t\t\t\tthis.control.params.fields[this.label.field].type ===\r\n\t\t\t\t\t\t\t\t\t\"radio-image\") &&\r\n\t\t\t\t\t\t\tthis.rowIndex >= 0\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tconst rowLabelRadioField = this.container.find(\r\n\t\t\t\t\t\t\t\t`${this.control.selector} [data-row=\"${this.rowIndex}\"] .repeater-field [data-field=\"${this.label.field}\"]:checked`,\r\n\t\t\t\t\t\t\t)[0] as HTMLInputElement;\r\n\r\n\t\t\t\t\t\t\tif (rowLabelRadioField) {\r\n\t\t\t\t\t\t\t\trowLabel = rowLabelRadioField.value;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.header.find(\".repeater-row-label\").text(rowLabel);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.header\r\n\t\t\t.find(\".repeater-row-label\")\r\n\t\t\t.text(`${this.label.value} ${this.rowIndex + 1}`);\r\n\t};\r\n}\r\n","/**\r\n * SharedFontDataAdapter - Custom Select2 DataAdapter for shared global font data.\r\n *\r\n * This adapter extends ArrayAdapter and overrides `_normalizeItem` to AVOID\r\n * using $.extend() for each item. This reduces memory from ~7MB to ~500KB\r\n * for 24 typography controls using the same font list.\r\n *\r\n * Key optimization: The original _normalizeItem creates deep copies of each\r\n * item using $.extend(). We override it to return a minimal object without\r\n * deep cloning the original data.\r\n */\r\n\r\nimport { SelectControlChoice } from \"./select-interface\";\r\n\r\ndeclare const jQuery: JQueryStatic;\r\n\r\n// Select2 AMD modules - will be loaded at runtime\r\nlet Utils: any;\r\nlet ArrayAdapter: any;\r\n\r\n/**\r\n * Initialize the adapter by requiring Select2 AMD modules.\r\n * Must be called before using createSharedFontDataAdapter.\r\n */\r\nfunction initializeSelect2Modules(): boolean {\r\n\tif (Utils && ArrayAdapter) return true;\r\n\r\n\tconst select2Amd = (jQuery.fn as any).select2?.amd;\r\n\tif (!select2Amd) {\r\n\t\tconsole.error(\"SharedFontDataAdapter: Select2 AMD not available\");\r\n\t\treturn false;\r\n\t}\r\n\r\n\ttry {\r\n\t\tUtils = select2Amd.require(\"select2/utils\");\r\n\t\tArrayAdapter = select2Amd.require(\"select2/data/array\");\r\n\t\treturn true;\r\n\t} catch (e) {\r\n\t\tconsole.error(\"SharedFontDataAdapter: Failed to load Select2 modules\", e);\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Create a SharedFontDataAdapter class for the given global variable.\r\n *\r\n * @param globalVarName - Name of the window property containing font data\r\n * @param initialSelectedValues - Currently selected value(s)\r\n * @returns A Select2 DataAdapter class\r\n */\r\nexport function createSharedFontDataAdapter(\r\n\tglobalVarName: string,\r\n\tinitialSelectedValues: string[],\r\n): any {\r\n\tif (!initializeSelect2Modules()) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Get reference to global data - NO COPY\r\n\tconst globalData = (window as any)[globalVarName] as SelectControlChoice[];\r\n\tif (!globalData || !Array.isArray(globalData)) {\r\n\t\tconsole.error(`SharedFontDataAdapter: Global variable \"${globalVarName}\" not found or not an array`);\r\n\t\treturn null;\r\n\t}\r\n\r\n\t// Track initial selection state - ensure all values are strings for consistent matching\r\n\tconst selectedIdsSet = new Set<string>(\r\n\t\tinitialSelectedValues.map((v) => String(v)),\r\n\t);\r\n\r\n\t/**\r\n\t * Pre-process the data to add selection state WITHOUT mutating original data.\r\n\t * This creates a shallow structure that references original text/id values.\r\n\t */\r\n\tfunction prepareDataWithSelection(\r\n\t\titems: SelectControlChoice[],\r\n\t): SelectControlChoice[] {\r\n\t\treturn items.map((item) => {\r\n\t\t\t// Create shallow copy with selection state\r\n\t\t\tconst prepared: SelectControlChoice = {\r\n\t\t\t\tid: item.id,\r\n\t\t\t\ttext: item.text,\r\n\t\t\t\tdisabled: item.disabled,\r\n\t\t\t\tselected: item.id ? selectedIdsSet.has(item.id) : undefined,\r\n\t\t\t};\r\n\r\n\t\t\tif (item.children && item.children.length) {\r\n\t\t\t\tprepared.children = item.children.map((child) => ({\r\n\t\t\t\t\tid: child.id,\r\n\t\t\t\t\ttext: child.text,\r\n\t\t\t\t\tdisabled: child.disabled,\r\n\t\t\t\t\tselected: selectedIdsSet.has(child.id),\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\r\n\t\t\treturn prepared;\r\n\t\t});\r\n\t}\r\n\r\n\t// Prepare data once with selection state\r\n\tconst preparedData = prepareDataWithSelection(globalData);\r\n\r\n\t/**\r\n\t * SharedFontDataAdapter extends ArrayAdapter\r\n\t */\r\n\tfunction SharedFontDataAdapter(\r\n\t\tthis: any,\r\n\t\t$element: JQuery,\r\n\t\toptions: any,\r\n\t) {\r\n\t\t// Set the data to our prepared data with selection state\r\n\t\tthis._dataToConvert = preparedData;\r\n\r\n\t\t// Call parent's parent constructor (SelectAdapter), skipping ArrayAdapter's\r\n\t\t// constructor which would try to get data from options\r\n\t\tconst SelectAdapter = Object.getPrototypeOf(ArrayAdapter.prototype);\r\n\t\tSelectAdapter.constructor.call(this, $element, options);\r\n\t}\r\n\r\n\t// Extend ArrayAdapter\r\n\tUtils.Extend(SharedFontDataAdapter, ArrayAdapter);\r\n\r\n\t/**\r\n\t * Override _normalizeItem to avoid $.extend() copying.\r\n\t * This is the key memory optimization.\r\n\t *\r\n\t * Original does: return $.extend({}, defaults, item);\r\n\t * We do: return minimal object without deep cloning\r\n\t */\r\n\tSharedFontDataAdapter.prototype._normalizeItem = function (\r\n\t\titem: SelectControlChoice,\r\n\t) {\r\n\t\t// Handle primitives (not expected for font data, but for safety)\r\n\t\tif (item !== Object(item)) {\r\n\t\t\treturn {\r\n\t\t\t\tid: String(item),\r\n\t\t\t\ttext: String(item),\r\n\t\t\t\tselected: false,\r\n\t\t\t\tdisabled: false,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Return a minimal object with required properties\r\n\t\t// Don't use $.extend() - that's what causes memory bloat\r\n\t\treturn {\r\n\t\t\tid: item.id !== undefined ? String(item.id) : undefined,\r\n\t\t\ttext: item.text !== undefined ? String(item.text) : \"\",\r\n\t\t\tselected: !!item.selected,\r\n\t\t\tdisabled: !!item.disabled,\r\n\t\t\tchildren: item.children, // Keep reference, don't copy\r\n\t\t};\r\n\t};\r\n\r\n\treturn SharedFontDataAdapter;\r\n}\r\n","import { ChangeEvent, MouseEvent, useRef } from \"react\";\r\n\r\nexport default function SliderForm(props: {\r\n\tid: string;\r\n\tmin: number;\r\n\tmax: number;\r\n\tstep: number;\r\n\tlabel?: string;\r\n\tdescription?: string;\r\n\tdefault?: string | number;\r\n\tvalue?: string | number;\r\n\tupdateCustomizerSetting?: (val: string | number) => void;\r\n\toverrideUpdateComponentStateFn?: (fn: (val: string | number) => void) => void;\r\n\tsetNotificationContainer?: any;\r\n}) {\r\n\tlet trigger = \"\";\r\n\r\n\tconst sliderRef: React.MutableRefObject<HTMLInputElement | null> =\r\n\t\tuseRef(null);\r\n\tconst valueRef: React.MutableRefObject<HTMLDivElement | null> = useRef(null);\r\n\r\n\tfunction updateComponentState(value: string | number) {\r\n\t\tconst val = String(value);\r\n\r\n\t\tif (\"slider\" === trigger) {\r\n\t\t\tif (valueRef && valueRef.current) {\r\n\t\t\t\tvalueRef.current.textContent = val;\r\n\t\t\t}\r\n\t\t} else if (\"input\" === trigger) {\r\n\t\t\tif (sliderRef && sliderRef.current) {\r\n\t\t\t\tsliderRef.current.value = val;\r\n\t\t\t}\r\n\t\t} else if (\"reset\" === trigger) {\r\n\t\t\tif (valueRef && valueRef.current) {\r\n\t\t\t\tvalueRef.current.textContent = val;\r\n\t\t\t}\r\n\r\n\t\t\tif (sliderRef && sliderRef.current) {\r\n\t\t\t\tsliderRef.current.value = val;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprops.overrideUpdateComponentStateFn?.(updateComponentState);\r\n\r\n\tfunction parseValue(value: string | number | undefined) {\r\n\t\tconst safeValue = \"undefined\" === typeof value ? 0 : value;\r\n\t\tconst numericValue =\r\n\t\t\ttypeof safeValue === \"string\" ? parseFloat(safeValue) : safeValue;\r\n\r\n\t\tif (isNaN(numericValue)) {\r\n\t\t\treturn props.min;\r\n\t\t}\r\n\r\n\t\tconst parsedValue = numericValue < props.min ? props.min : numericValue;\r\n\r\n\t\treturn parsedValue > props.max ? props.max : parsedValue;\r\n\t}\r\n\r\n\tfunction handleInputChange(e: ChangeEvent<HTMLInputElement>) {\r\n\t\tconst target = e.target;\r\n\t\ttrigger = \"range\" === target.type ? \"slider\" : \"input\";\r\n\r\n\t\tconst value = parseValue(target.value);\r\n\r\n\t\tif (\"input\" === trigger) target.value = value.toString();\r\n\t\tprops.updateCustomizerSetting?.(value);\r\n\t}\r\n\r\n\tfunction handleResetButtonClick(_e: MouseEvent) {\r\n\t\tconst defaultExists =\r\n\t\t\t\"undefined\" !== typeof props.default && \"\" !== props.default;\r\n\r\n\t\tif (defaultExists) {\r\n\t\t\tconst defaultValue = parseValue(props.default);\r\n\r\n\t\t\tif (sliderRef && sliderRef.current) {\r\n\t\t\t\tsliderRef.current.value = defaultValue.toString();\r\n\t\t\t}\r\n\r\n\t\t\tif (valueRef && valueRef.current) {\r\n\t\t\t\tvalueRef.current.textContent = defaultValue.toString();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst valueExists =\r\n\t\t\t\t\"undefined\" !== typeof props.value && \"\" !== props.value;\r\n\r\n\t\t\tif (valueExists) {\r\n\t\t\t\tconst value = parseValue(props.value);\r\n\r\n\t\t\t\tif (sliderRef && sliderRef.current) {\r\n\t\t\t\t\tsliderRef.current.value = value.toString();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (valueRef && valueRef.current) {\r\n\t\t\t\t\tvalueRef.current.textContent = value.toString();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (sliderRef && sliderRef.current) {\r\n\t\t\t\t\tsliderRef.current.value = props.min.toString();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (valueRef && valueRef.current) {\r\n\t\t\t\t\tvalueRef.current.textContent = \"\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttrigger = \"reset\";\r\n\t\tconst renderedValue = parseValue(sliderRef.current?.value);\r\n\r\n\t\tif (sliderRef && sliderRef.current) {\r\n\t\t\tprops.updateCustomizerSetting?.(renderedValue);\r\n\t\t}\r\n\t}\r\n\r\n\t// Preparing for the template.\r\n\tconst fieldId = `wpbf-control-input-${props.id}`;\r\n\tconst value = parseValue(props.value);\r\n\r\n\treturn (\r\n\t\t<div className=\"wpbf-control-form\" tabIndex={1}>\r\n\t\t\t<label className=\"wpbf-control-label\" htmlFor={fieldId}>\r\n\t\t\t\t<span className=\"customize-control-title\">{props.label}</span>\r\n\t\t\t\t<span\r\n\t\t\t\t\tclassName=\"customize-control-description description\"\r\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: props.description ?? \"\" }}\r\n\t\t\t\t/>\r\n\t\t\t</label>\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"customize-control-notifications-container\"\r\n\t\t\t\tref={props.setNotificationContainer}\r\n\t\t\t></div>\r\n\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tclassName=\"wpbf-control-reset\"\r\n\t\t\t\tonClick={handleResetButtonClick}\r\n\t\t\t>\r\n\t\t\t\t<i className=\"dashicons dashicons-image-rotate\"></i>\r\n\t\t\t</button>\r\n\r\n\t\t\t<div className=\"wpbf-control-cols\">\r\n\t\t\t\t<div className=\"wpbf-control-left-col\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tref={sliderRef}\r\n\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\tid={fieldId}\r\n\t\t\t\t\t\tdefaultValue={value}\r\n\t\t\t\t\t\tmin={props.min}\r\n\t\t\t\t\t\tmax={props.max}\r\n\t\t\t\t\t\tstep={props.step}\r\n\t\t\t\t\t\tclassName=\"wpbf-control-slider\"\r\n\t\t\t\t\t\tonChange={handleInputChange}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"wpbf-control-right-col\">\r\n\t\t\t\t\t<div className=\"wpbf-control-value\" ref={valueRef}>\r\n\t\t\t\t\t\t{value}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import { DevicesValue } from \"../../Responsive/src/responsive-interface\";\r\nimport { parseJsonOrUndefined } from \"../../Generic/src/string-util\";\r\nimport { makeLimitedNumberUnitPair } from \"../../Generic/src/number-util\";\r\n\r\n/**\r\n * Make a value for an input field.\r\n *\r\n * @export\r\n *\r\n * @param {(string | number)} value - The value to convert.\r\n * @param {number} min - The minimum value.\r\n * @param {number} max - The maximum value.\r\n *\r\n * @return {string|number} The value for the input field.\r\n */\r\nexport function makeValueForInput(\r\n\tvalue: string | number,\r\n\tmin: number,\r\n\tmax: number,\r\n): string | number {\r\n\tlet strValue = String(value).trim();\r\n\r\n\tconst isTypingNegative = strValue === \"-\";\r\n\tif (isTypingNegative) return \"-\";\r\n\r\n\tconst isTypingDecimal = strValue.endsWith(\".\");\r\n\tstrValue = isTypingDecimal ? strValue.replace(\".\", \"\") : strValue;\r\n\r\n\tconst valueObject = makeLimitedNumberUnitPair(value, min, max);\r\n\r\n\tif (\"\" === valueObject.number) {\r\n\t\treturn isTypingDecimal ? \"0.\" : \"\";\r\n\t}\r\n\r\n\tlet numeric = String(valueObject.number);\r\n\r\n\t/**\r\n\t * Having `isTypingDecimal` means, the latest char is a decimal point.\r\n\t * No unit is allowed before the decimal point.\r\n\t */\r\n\tif (isTypingDecimal) return numeric + \".\";\r\n\r\n\treturn valueObject.unit\r\n\t\t? numeric +\r\n\t\t\t\t(valueObject.hasTrailingDotBeforeUnit ? \".\" : \"\") +\r\n\t\t\t\tvalueObject.unit\r\n\t\t: numeric;\r\n}\r\n\r\n/**\r\n * Make a value for a range-slider field.\r\n *\r\n * @export\r\n *\r\n * @param {(string | number)} value - The value to convert.\r\n * @param {number} min - The minimum value.\r\n * @param {number} max - The maximum value.\r\n *\r\n * @return {number} The value for the slider.\r\n */\r\nexport function makeValueForSlider(\r\n\tvalue: string | number,\r\n\tmin: number,\r\n\tmax: number,\r\n): number {\r\n\tconst valueObject = makeLimitedNumberUnitPair(value, min, max);\r\n\r\n\treturn \"\" === valueObject.number ? min : valueObject.number;\r\n}\r\n\r\n/**\r\n * Make an empty `DevicesValue` object.\r\n *\r\n * @param {string[]} devices - The allowed devices.\r\n *\r\n * @return {DevicesValue} Empty `DevicesValue` object.\r\n */\r\nfunction makeEmptyDevicesValue(devices: string[]): DevicesValue {\r\n\tconst value: DevicesValue = {};\r\n\r\n\tdevices.forEach((device) => {\r\n\t\tvalue[device] = \"\";\r\n\t});\r\n\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * Make a `DevicesValue` object from a JSON encoded string or `DevicesValue` object.\r\n *\r\n * @export\r\n *\r\n * @param {string[]} devices - The allowed devices.\r\n * @param {(string | DevicesValue)} value - The value to convert.\r\n * @param {number} min - The minimum value.\r\n * @param {number} max - The maximum value.\r\n *\r\n * @return {DevicesValue}\r\n */\r\nexport function makeDevicesValue(\r\n\tdevices: string[],\r\n\tvalue: string | DevicesValue,\r\n\tmin: number,\r\n\tmax: number,\r\n): DevicesValue {\r\n\tconst valueObject =\r\n\t\t\"string\" === typeof value\r\n\t\t\t? parseJsonOrUndefined<DevicesValue>(value)\r\n\t\t\t: value;\r\n\r\n\tif (!valueObject) {\r\n\t\treturn makeEmptyDevicesValue(devices);\r\n\t}\r\n\r\n\tconst devicesValue: DevicesValue = {};\r\n\r\n\tdevices.forEach((device) => {\r\n\t\tif (!valueObject.hasOwnProperty(device)) {\r\n\t\t\tdevicesValue[device] = \"\";\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst val = makeValueForInput(valueObject[device], min, max);\r\n\r\n\t\tdevicesValue[device] =\r\n\t\t\t\"string\" !== typeof val && \"number\" !== typeof val ? \"\" : val;\r\n\t});\r\n\r\n\treturn devicesValue;\r\n}\r\n","import { ChangeEvent, MouseEvent, useRef } from \"react\";\r\nimport { makeValueForInput, makeValueForSlider } from \"./slider-util\";\r\nimport {\r\n\tlimitNumber,\r\n\tmakeLimitedNumberUnitPair,\r\n} from \"../../Generic/src/number-util\";\r\n\r\nexport default function InputSliderForm(props: {\r\n\tid: string;\r\n\tmin: number;\r\n\tmax: number;\r\n\tstep: number;\r\n\tlabel: string | undefined;\r\n\tdescription: string | undefined;\r\n\tdefault: string | number;\r\n\tvalue: string | number;\r\n\tsetNotificationContainer: any;\r\n\toverrideUpdateComponentStateFn?: (fn: (val: string | number) => void) => void;\r\n\tupdateCustomizerSetting?: (val: string | number) => void;\r\n}) {\r\n\tlet trigger = \"\";\r\n\r\n\tfunction updateComponentState(val: string | number) {\r\n\t\tif (\"slider\" === trigger) {\r\n\t\t\tsetInputRefValue(makeValueForInput(val, props.min, props.max));\r\n\t\t} else if (\"input\" === trigger) {\r\n\t\t\tsetSliderRefValue(makeValueForSlider(val, props.min, props.max));\r\n\t\t} else if (\"reset\" === trigger) {\r\n\t\t\tsetSliderRefValue(val === \"\" ? props.min : val);\r\n\t\t\tsetInputRefValue(val);\r\n\t\t}\r\n\t}\r\n\r\n\tprops.overrideUpdateComponentStateFn?.(updateComponentState);\r\n\r\n\tfunction handleInputChange(e: ChangeEvent<HTMLInputElement>) {\r\n\t\ttrigger = \"input\";\r\n\r\n\t\tprops.updateCustomizerSetting?.(\r\n\t\t\tmakeValueForInput(e.target.value, props.min, props.max),\r\n\t\t);\r\n\t}\r\n\r\n\tconst sliderRef = useRef<HTMLInputElement | null>(null);\r\n\tconst inputRef = useRef<HTMLInputElement | null>(null);\r\n\r\n\tfunction handleSliderChange(e: ChangeEvent<HTMLInputElement>) {\r\n\t\ttrigger = \"slider\";\r\n\r\n\t\tconst value = parseFloat(e.target.value);\r\n\t\tconst limitedValue = limitNumber(value, props.min, props.max);\r\n\r\n\t\tif (!inputRef || !inputRef.current) return;\r\n\r\n\t\t// Since range field doesn't have unit, we're going to get the unit from the input field.\r\n\t\tconst numberValuePair = makeLimitedNumberUnitPair(\r\n\t\t\tinputRef.current.value,\r\n\t\t\tprops.min,\r\n\t\t\tprops.max,\r\n\t\t);\r\n\r\n\t\tconst valueForInput = String(limitedValue) + numberValuePair.unit;\r\n\t\tprops.updateCustomizerSetting?.(valueForInput);\r\n\t}\r\n\r\n\tfunction setInputRefValue(value: string | number) {\r\n\t\tif (!inputRef || !inputRef.current) return;\r\n\t\tinputRef.current.value = String(value);\r\n\t}\r\n\r\n\tfunction setSliderRefValue(value: string | number) {\r\n\t\tif (!sliderRef || !sliderRef.current) return;\r\n\t\tsliderRef.current.value = String(value);\r\n\t}\r\n\r\n\tfunction handleResetButtonClick(e: MouseEvent) {\r\n\t\tlet valueToSave: string | number = \"\";\r\n\r\n\t\tif (\"\" !== props.default && \"undefined\" !== typeof props.default) {\r\n\t\t\tvalueToSave = props.default;\r\n\t\t} else {\r\n\t\t\tif (\"\" !== props.value) {\r\n\t\t\t\tvalueToSave = props.value;\r\n\t\t\t} else {\r\n\t\t\t\tvalueToSave = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttrigger = \"reset\";\r\n\r\n\t\tprops.updateCustomizerSetting?.(valueToSave);\r\n\t}\r\n\r\n\t// Preparing for the template.\r\n\tconst fieldId = `wpbf-control-input-${props.id}`;\r\n\tconst sliderValue = makeValueForSlider(props.value, props.min, props.max);\r\n\tconst inputValue = makeValueForInput(props.value, props.min, props.max);\r\n\r\n\treturn (\r\n\t\t<div className=\"wpbf-control-form\" tabIndex={1}>\r\n\t\t\t{props.label || props.description ? (\r\n\t\t\t\t<label className=\"wpbf-control-label\" htmlFor={fieldId}>\r\n\t\t\t\t\t{props.label && (\r\n\t\t\t\t\t\t<span className=\"customize-control-title\">{props.label}</span>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{props.description && (\r\n\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\tclassName=\"customize-control-description description\"\r\n\t\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: props.description }}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</label>\r\n\t\t\t) : null}\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"customize-control-notifications-container\"\r\n\t\t\t\tref={props.setNotificationContainer}\r\n\t\t\t></div>\r\n\r\n\t\t\t<button\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tclassName=\"wpbf-control-reset\"\r\n\t\t\t\tonClick={handleResetButtonClick}\r\n\t\t\t>\r\n\t\t\t\t<i className=\"dashicons dashicons-image-rotate\"></i>\r\n\t\t\t</button>\r\n\r\n\t\t\t<div className=\"wpbf-control-cols\">\r\n\t\t\t\t<div className=\"wpbf-control-left-col\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tref={sliderRef}\r\n\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\tid={fieldId}\r\n\t\t\t\t\t\tdefaultValue={sliderValue}\r\n\t\t\t\t\t\tmin={props.min}\r\n\t\t\t\t\t\tmax={props.max}\r\n\t\t\t\t\t\tstep={props.step}\r\n\t\t\t\t\t\tclassName=\"wpbf-control-input-slider wpbf-pro-control-input-slider\"\r\n\t\t\t\t\t\tonChange={handleSliderChange}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"wpbf-control-right-col\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tref={inputRef}\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tdefaultValue={inputValue}\r\n\t\t\t\t\t\tclassName=\"wpbf-control-input\"\r\n\t\t\t\t\t\tonChange={handleInputChange}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n}\r\n","import { ChangeEvent, MouseEvent, useState, useEffect } from \"react\";\r\nimport DeviceButtons from \"../../Responsive/src/DeviceButtons\";\r\nimport {\r\n\tmakeDevicesValue,\r\n\tmakeValueForInput,\r\n\tmakeValueForSlider,\r\n} from \"./slider-util\";\r\nimport { DevicesValue } from \"../../Responsive/src/responsive-interface\";\r\nimport { encodeJsonOrDefault } from \"../../Generic/src/string-util\";\r\nimport { makeLimitedNumberUnitPair } from \"../../Generic/src/number-util\";\r\n\r\ndeclare var wp: { customize: WpbfCustomize };\r\n\r\nexport default function ResponsiveInputSliderForm(props: {\r\n\tid: string;\r\n\toverrideUpdateComponentStateFn?: (\r\n\t\tfn: (val: string | DevicesValue) => void,\r\n\t) => void;\r\n\tupdateCustomizerSetting?: (val: string | DevicesValue) => void;\r\n\tsetNotificationContainer: any;\r\n\tsaveAsJson: boolean;\r\n\tdevices: string[];\r\n\tlabel: string | undefined;\r\n\tdescription: string | undefined;\r\n\tmin: number;\r\n\tmax: number;\r\n\tstep: number;\r\n\tdefault: string | DevicesValue;\r\n\tvalue: string | DevicesValue;\r\n}) {\r\n\tconst defaultValue = makeDevicesValue(\r\n\t\tprops.devices,\r\n\t\tprops.default,\r\n\t\tprops.min,\r\n\t\tprops.max,\r\n\t);\r\n\r\n\tconst [actualValue, setActualValue] = useState(\r\n\t\tmakeDevicesValue(props.devices, props.value, props.min, props.max),\r\n\t);\r\n\r\n\t// Track the active device based on wp.customize.previewedDevice\r\n\tconst [activeDevice, setActiveDevice] = useState(\r\n\t\ttypeof wp !== \"undefined\" && wp.customize?.previewedDevice?.get()\r\n\t\t\t? wp.customize.previewedDevice.get()\r\n\t\t\t: props.devices[0],\r\n\t);\r\n\r\n\t// Listen to preview device changes\r\n\tuseEffect(() => {\r\n\t\tif (typeof wp === \"undefined\" || !wp.customize?.previewedDevice) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst callback = (device: string) => {\r\n\t\t\tif (props.devices.includes(device)) {\r\n\t\t\t\tsetActiveDevice(device);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\twp.customize.previewedDevice.bind(callback);\r\n\r\n\t\treturn () => {\r\n\t\t\twp.customize.previewedDevice.unbind(callback);\r\n\t\t};\r\n\t}, [props.devices]);\r\n\r\n\t/**\r\n\t * This function will be called when the value from the customizer setting changes.\r\n\t * This can be from either it's own control or from another control that is linked to it.\r\n\t *\r\n\t * @param {string|DevicesValue} val - The value from customizer setting.\r\n\t */\r\n\tfunction updateComponentState(val: string | DevicesValue) {\r\n\t\tconst devicesValue = makeDevicesValue(\r\n\t\t\tprops.devices,\r\n\t\t\tval,\r\n\t\t\tprops.min,\r\n\t\t\tprops.max,\r\n\t\t);\r\n\r\n\t\tsetActualValue(devicesValue);\r\n\t}\r\n\r\n\tprops.overrideUpdateComponentStateFn?.(updateComponentState);\r\n\r\n\tfunction updateCustomizerSetting(val: DevicesValue) {\r\n\t\tconst valueToSave = props.saveAsJson\r\n\t\t\t? encodeJsonOrDefault<DevicesValue>(val)\r\n\t\t\t: val;\r\n\r\n\t\tprops.updateCustomizerSetting?.(valueToSave);\r\n\t}\r\n\r\n\tfunction handleInputChange(e: ChangeEvent<HTMLInputElement>, device: string) {\r\n\t\tconst devicesValue = actualValue;\r\n\r\n\t\tif (!devicesValue.hasOwnProperty(device)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fieldValue = makeValueForInput(e.target.value, props.min, props.max);\r\n\t\tdevicesValue[device] = fieldValue;\r\n\r\n\t\tupdateCustomizerSetting(devicesValue);\r\n\t}\r\n\r\n\tfunction handleSliderChange(\r\n\t\te: ChangeEvent<HTMLInputElement>,\r\n\t\tdevice: string,\r\n\t) {\r\n\t\tconst devicesValue = actualValue;\r\n\r\n\t\tif (!devicesValue.hasOwnProperty(device)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fieldValue = makeValueForSlider(e.target.value, props.min, props.max);\r\n\t\tconst existingValue = devicesValue[device];\r\n\r\n\t\tif (existingValue === fieldValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Since range field doesn't have unit, we're going to get the unit from the input field.\r\n\t\tconst numberUnitPair = makeLimitedNumberUnitPair(\r\n\t\t\texistingValue,\r\n\t\t\tprops.min,\r\n\t\t\tprops.max,\r\n\t\t);\r\n\r\n\t\tif (numberUnitPair.number === fieldValue) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdevicesValue[device] = numberUnitPair.unit\r\n\t\t\t? fieldValue + numberUnitPair.unit\r\n\t\t\t: fieldValue;\r\n\r\n\t\tupdateCustomizerSetting(devicesValue);\r\n\t}\r\n\r\n\tfunction handleResetButtonClick(\r\n\t\te: MouseEvent<HTMLButtonElement>,\r\n\t\tdevice: string,\r\n\t) {\r\n\t\tconst devicesValue = actualValue;\r\n\r\n\t\tif (\r\n\t\t\t!devicesValue.hasOwnProperty(device) ||\r\n\t\t\t!defaultValue.hasOwnProperty(device)\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tdevicesValue[device] = defaultValue[device];\r\n\r\n\t\tupdateCustomizerSetting(devicesValue);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<header className=\"wpbf-control-header\">\r\n\t\t\t\t{props.label && (\r\n\t\t\t\t\t<label\r\n\t\t\t\t\t\tclassName=\"customize-control-title\"\r\n\t\t\t\t\t\thtmlFor={`wpbf-control-input-${props.id}`}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<span className=\"customize-control-title\">{props.label}</span>\r\n\t\t\t\t\t</label>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<DeviceButtons devices={props.devices} />\r\n\t\t\t</header>\r\n\r\n\t\t\t{props.description && (\r\n\t\t\t\t<span\r\n\t\t\t\t\tclassName=\"customize-control-description description\"\r\n\t\t\t\t\tdangerouslySetInnerHTML={{ __html: props.description }}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"customize-control-notifications-container\"\r\n\t\t\t\tref={props.setNotificationContainer}\r\n\t\t\t></div>\r\n\r\n\t\t\t<div className=\"wpbf-control-form\">\r\n\t\t\t\t{props.devices.map((device, deviceIndex) => {\r\n\t\t\t\t\tconst isActive = device === activeDevice;\r\n\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tclassName={`wpbf-control-device wpbf-control-${device} ${isActive ? \"is-active\" : \"\"}`}\r\n\t\t\t\t\t\t\tdata-wpbf-device={device}\r\n\t\t\t\t\t\t\tkey={deviceIndex}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{actualValue.hasOwnProperty(device) && (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"wpbf-control-reset\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => handleResetButtonClick(e, device)}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<i className=\"dashicons dashicons-image-rotate\"></i>\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"wpbf-control-cols\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"wpbf-control-left-col\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"range\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tid={`wpbf-control-input-${props.id}-${device}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={makeValueForSlider(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactualValue[device],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.min,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.max,\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tmin={props.min}\r\n\t\t\t\t\t\t\t\t\t\t\t\tmax={props.max}\r\n\t\t\t\t\t\t\t\t\t\t\t\tstep={props.step}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"wpbf-control-input-slider wpbf-pro-control-input-slider\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => handleSliderChange(e, device)}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"wpbf-control-right-col\">\r\n\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={makeValueForInput(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactualValue[device],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.min,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops.max,\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"wpbf-control-input\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(e, device)}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n}\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport {\r\n\tFontProperties,\r\n\tFontProperty,\r\n\tFontVariantsCollection,\r\n\tGoogleFontEntity,\r\n\tGoogleFontsCollection,\r\n\tLabelValuePair,\r\n\tWpbfCustomizeTypographyControlValue,\r\n} from \"./typography-interface\";\r\nimport {\r\n\tSelectControlChoice,\r\n\tWpbfSelectControl,\r\n} from \"../../Select/src/select-interface\";\r\nimport { WpbfAssocArrayControl } from \"../../Generic/src/generic-interface\";\r\nimport { isNumeric } from \"../../Generic/src/number-util\";\r\n\r\n/**\r\n * These var declarations are for the global variables that are set in the PHP file.\r\n * That means, the `undefined` union has to be added to the declaration to be safer.\r\n */\r\ndeclare var wpbfFontProperties: FontProperties | undefined;\r\ndeclare var wpbfTypographyControlIds: string[] | undefined;\r\ndeclare var wpbfGoogleFonts: GoogleFontsCollection | undefined;\r\ndeclare var wpbfFontVariantOptions: FontVariantsCollection | undefined;\r\ndeclare var wpbfFieldsFontVariants:\r\n\t| Record<string, Record<string, LabelValuePair[]>>\r\n\t| undefined;\r\n\r\nwindow.wp.customize?.bind(\"ready\", function () {\r\n\tif (!window.wp.customize) return;\r\n\tsetupTypographyFields(window.wp.customize);\r\n});\r\n\r\nfunction setupTypographyFields(customizer: WpbfCustomize) {\r\n\tif (!Array.isArray(wpbfTypographyControlIds)) return;\r\n\r\n\twpbfTypographyControlIds.forEach((id) => {\r\n\t\tif (!customizer.control(id)) return;\r\n\r\n\t\t// Register hook once per typography control (not on every font change).\r\n\t\twindow.wp.hooks.addAction(\r\n\t\t\t\"wpbf.dynamicControl.initWpbfControl\",\r\n\t\t\t\"wpbf/typography/\" + id,\r\n\t\t\tfunction (controlInit: AnyWpbfCustomizeControl) {\r\n\t\t\t\tconst variantControlId = id + \"[variant]\";\r\n\t\t\t\tif (variantControlId === controlInit.id) {\r\n\t\t\t\t\t// Variant control initialized.\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\tcustomizer(id, function (setting) {\r\n\t\t\tcomposeFontProperties(id, undefined, undefined, undefined);\r\n\r\n\t\t\tsetting.bind(function (value) {\r\n\t\t\t\tcomposeFontProperties(id, value, undefined, undefined);\r\n\t\t\t});\r\n\r\n\t\t\tlistenFontPropertyFieldsChange(id);\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction listenFontPropertyFieldsChange(typographyControlId: string) {\r\n\tif (!Array.isArray(wpbfFontProperties)) return;\r\n\r\n\twpbfFontProperties.forEach((property) => {\r\n\t\tconst propertyControlId = `${typographyControlId}[${property}]`;\r\n\t\tif (!window.wp.customize?.control(propertyControlId)) return;\r\n\r\n\t\twindow.wp.customize?.(propertyControlId, function (setting) {\r\n\t\t\tsetting.bind(function (value) {\r\n\t\t\t\tcomposeFontProperties(\r\n\t\t\t\t\ttypographyControlId,\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\tproperty,\r\n\t\t\t\t\tvalue,\r\n\t\t\t\t\ttrue,\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction findGoogleFont(fontFamily: string): GoogleFontEntity | undefined {\r\n\tif (!wpbfGoogleFonts) return undefined;\r\n\tif (wpbfGoogleFonts.items[fontFamily]) {\r\n\t\treturn wpbfGoogleFonts.items[fontFamily];\r\n\t}\r\n\r\n\treturn undefined;\r\n}\r\n\r\nfunction variantFoundInChoices(\r\n\tvariantValue: string,\r\n\tvariants: SelectControlChoice[],\r\n) {\r\n\treturn variants.some((variant) => variant.id == variantValue);\r\n}\r\n\r\nfunction composeFontProperties(\r\n\tid: string,\r\n\tval?: WpbfCustomizeTypographyControlValue,\r\n\ttriggerPropertyName?: FontProperty,\r\n\ttriggerPropertyValue?: string,\r\n\ttriggerChange?: boolean,\r\n) {\r\n\tconst control: WpbfAssocArrayControl | undefined =\r\n\t\twindow.wp.customize?.control(id);\r\n\tif (!control || !control.setting) return;\r\n\r\n\tval = val || control.setting.get();\r\n\r\n\tconst value = { ...val };\r\n\r\n\tif (\"font-backup\" in value) delete value[\"font-backup\"];\r\n\r\n\tif (\"undefined\" === typeof value) return;\r\n\tif (\"string\" !== typeof value[\"font-family\"]) return;\r\n\r\n\tif (\r\n\t\ttriggerPropertyName === \"font-family\" ||\r\n\t\ttriggerPropertyName === \"variant\"\r\n\t) {\r\n\t\tvalue[triggerPropertyName] = triggerPropertyValue;\r\n\t}\r\n\r\n\tlet variantValue = !value.variant ? \"regular\" : value.variant;\r\n\tvalue.variant = variantValue;\r\n\r\n\tconst maybeVariantControl = window.wp.customize?.control(id + \"[variant]\");\r\n\r\n\tconst variantControl =\r\n\t\tmaybeVariantControl &&\r\n\t\t\"wpbf-enhanced-select\" === maybeVariantControl.params.type\r\n\t\t\t? (maybeVariantControl as WpbfSelectControl)\r\n\t\t\t: undefined;\r\n\r\n\tif (\r\n\t\tvariantControl &&\r\n\t\t(triggerPropertyName === undefined || triggerPropertyName === \"font-family\")\r\n\t) {\r\n\t\tconst variantChoices = collectVariantChoices(id, value);\r\n\r\n\t\t// Hide/show variant options depending on which are available for this font-family.\r\n\t\tif (variantChoices.length > 1 && control.active()) {\r\n\t\t\tvariantControl.activate();\r\n\t\t} else {\r\n\t\t\t// If there's only 1 variant to choose from, we can hide the control.\r\n\t\t\tvariantControl.deactivate();\r\n\t\t}\r\n\r\n\t\tconst updatedOptionValue = variantFoundInChoices(\r\n\t\t\tvariantValue,\r\n\t\t\tvariantChoices,\r\n\t\t)\r\n\t\t\t? variantValue\r\n\t\t\t: \"regular\";\r\n\r\n\t\t// Update the `variantValue` with the updated option value.\r\n\t\tvariantValue = updatedOptionValue;\r\n\r\n\t\tconst $variantSelectbox = variantControl.container?.find(\".wpbf-select2\");\r\n\r\n\t\t$variantSelectbox?.empty();\r\n\t\t$variantSelectbox?.append(\r\n\t\t\tvariantChoices.map((choice) => {\r\n\t\t\t\treturn new Option(choice.text, choice.id, false, false);\r\n\t\t\t}),\r\n\t\t);\r\n\t\t$variantSelectbox?.val(variantValue);\r\n\t\tvalue[\"variant\"] = variantValue;\r\n\t}\r\n\r\n\t// Set the font-style value.\r\n\tif (-1 !== variantValue.indexOf(\"i\")) {\r\n\t\tvalue[\"font-style\"] = \"italic\";\r\n\t} else {\r\n\t\tvalue[\"font-style\"] = \"normal\";\r\n\t}\r\n\r\n\t// Set the font-weight value.\r\n\tvalue[\"font-weight\"] =\r\n\t\t\"regular\" === variantValue || \"italic\" === variantValue\r\n\t\t\t? 400\r\n\t\t\t: isNumeric(variantValue)\r\n\t\t\t\t? parseInt(variantValue, 10)\r\n\t\t\t\t: 400;\r\n\r\n\tif (triggerChange) {\r\n\t\t// value[\"random\"] = Date.now();\r\n\t}\r\n\r\n\tcontrol.setting.set(value);\r\n}\r\n\r\nfunction collectVariantChoices(\r\n\tid: string,\r\n\tvalue: WpbfCustomizeTypographyControlValue,\r\n) {\r\n\tconst fontFamily = value[\"font-family\"];\r\n\tif (!fontFamily) return [];\r\n\r\n\tconst googleFont = findGoogleFont(fontFamily);\r\n\r\n\tconst variantChoices: SelectControlChoice[] = [];\r\n\r\n\tif (googleFont) {\r\n\t\tif (!wpbfFontVariantOptions) return variantChoices;\r\n\t\tlet googleFontVariants = googleFont.variants;\r\n\r\n\t\tlet i = 0;\r\n\r\n\t\tfor (; i < wpbfFontVariantOptions.complete.length; ++i) {\r\n\t\t\tif (\r\n\t\t\t\t!googleFontVariants.includes(wpbfFontVariantOptions.complete[i].value)\r\n\t\t\t) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvariantChoices.push({\r\n\t\t\t\ttext: wpbfFontVariantOptions.complete[i].label,\r\n\t\t\t\tid: wpbfFontVariantOptions.complete[i].value,\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tlet fieldVariantKey = id.replace(/]/g, \"\");\r\n\t\tfieldVariantKey = fieldVariantKey.replace(/\\[/g, \"_\");\r\n\r\n\t\tconst customVariantsGroup =\r\n\t\t\twpbfFieldsFontVariants && wpbfFieldsFontVariants[fieldVariantKey]\r\n\t\t\t\t? wpbfFieldsFontVariants[fieldVariantKey]\r\n\t\t\t\t: undefined;\r\n\r\n\t\tif (customVariantsGroup && \"object\" === typeof customVariantsGroup) {\r\n\t\t\tfor (const variantFamily in customVariantsGroup) {\r\n\t\t\t\tif (!customVariantsGroup.hasOwnProperty(variantFamily)) continue;\r\n\t\t\t\tif (value[\"font-family\"] !== variantFamily) continue;\r\n\r\n\t\t\t\tconst variants = customVariantsGroup[variantFamily];\r\n\t\t\t\tif (!variants.length) continue;\r\n\r\n\t\t\t\tlet i = 0;\r\n\r\n\t\t\t\tfor (; i < variants.length; ++i) {\r\n\t\t\t\t\tvariantChoices.push({\r\n\t\t\t\t\t\ttext: variants[i].label,\r\n\t\t\t\t\t\tid: variants[i].value,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvariantChoices.length = 0;\r\n\t\t\tif (!wpbfFontVariantOptions) return variantChoices;\r\n\r\n\t\t\tlet i = 0;\r\n\r\n\t\t\tfor (; i < wpbfFontVariantOptions.standard.length; ++i) {\r\n\t\t\t\tvariantChoices.push({\r\n\t\t\t\t\ttext: wpbfFontVariantOptions.standard[i].label,\r\n\t\t\t\t\tid: wpbfFontVariantOptions.standard[i].value,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn variantChoices;\r\n}\r\n","import {\r\n\tRepeaterImageSelectOptions,\r\n\tWpbfRepeaterControl,\r\n\tWpbfRepeaterRow,\r\n} from \"./repeater-interface\";\r\nimport RepeaterRow from \"./repeater-row\";\r\nimport _ from \"lodash\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n\tmedia: any;\r\n};\r\n\r\nwp.customize.controlConstructor[\"wpbf-repeater\"] =\r\n\twp.customize.Control.extend<WpbfRepeaterControl>({\r\n\t\t// When we're finished loading continue processing\r\n\t\tready: function (this: WpbfRepeaterControl): void {\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// Handle control removal - trigger destroy when control is removed.\r\n\t\t\tfunction handleOnRemoved(removedControl: WpbfRepeaterControl) {\r\n\t\t\t\tif (control === removedControl) {\r\n\t\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\t\twp.customize.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twp.customize.control.bind(\"removed\", handleOnRemoved);\r\n\r\n\t\t\tthis.initWpbfControl?.();\r\n\t\t},\r\n\r\n\t\trows: [],\r\n\r\n\t\tcurrentIndex: 0,\r\n\r\n\t\trepeaterFieldsContainer: undefined,\r\n\r\n\t\tsettingField: undefined,\r\n\r\n\t\trepeaterTemplate: undefined,\r\n\r\n\t\tinitWpbfControl: function (\r\n\t\t\tthis: WpbfRepeaterControl,\r\n\t\t\tctrl?: WpbfRepeaterControl,\r\n\t\t) {\r\n\t\t\tconst control = ctrl || this;\r\n\r\n\t\t\t// The current value set in Control Class (set in Kirki_Customize_Repeater_Control::to_json() function)\r\n\t\t\tconst settingValueFromParams = control.params.value;\r\n\r\n\t\t\t// The hidden field that keeps the data saved (though we never update it)\r\n\t\t\tcontrol.settingField = control.container\r\n\t\t\t\t.find(\"[data-customize-setting-link]\")\r\n\t\t\t\t.first();\r\n\r\n\t\t\t// Set the field value for the first time, we'll fill it up later\r\n\t\t\tcontrol.setValue?.([], false);\r\n\r\n\t\t\t// The DIV that holds all the rows\r\n\t\t\tcontrol.repeaterFieldsContainer = control.container\r\n\t\t\t\t.find(\".repeater-fields\")\r\n\t\t\t\t.first();\r\n\r\n\t\t\t// Set number of rows to 0\r\n\t\t\tcontrol.currentIndex = 0;\r\n\r\n\t\t\t// Save the rows objects\r\n\t\t\tcontrol.rows = [];\r\n\r\n\t\t\t// Default limit.\r\n\t\t\tlet limit: number | boolean = false;\r\n\r\n\t\t\tif (\"number\" === typeof control.params.limit) {\r\n\t\t\t\tlimit = 0 >= control.params.limit ? false : control.params.limit;\r\n\t\t\t}\r\n\r\n\t\t\tlet theNewRow;\r\n\r\n\t\t\tcontrol.container?.on(\"click\", \"button.repeater-add\", (e) => {\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t!limit ||\r\n\t\t\t\t\t(\"number\" === typeof control.currentIndex &&\r\n\t\t\t\t\t\tcontrol.currentIndex < limit)\r\n\t\t\t\t) {\r\n\t\t\t\t\ttheNewRow = control.addRow?.();\r\n\t\t\t\t\ttheNewRow?.toggleMinimize();\r\n\t\t\t\t\tcontrol.initColorPicker?.();\r\n\t\t\t\t\tif (theNewRow) control.initSelect?.(theNewRow);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tjQuery(control.selector + \" .limit\").addClass(\"highlight\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcontrol.container?.on(\"click\", \".repeater-row-remove\", function () {\r\n\t\t\t\tif (\"number\" === typeof control.currentIndex) {\r\n\t\t\t\t\tcontrol.currentIndex--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t!limit ||\r\n\t\t\t\t\t(\"number\" === typeof control.currentIndex &&\r\n\t\t\t\t\t\tcontrol.currentIndex < limit)\r\n\t\t\t\t) {\r\n\t\t\t\t\tjQuery(control.selector + \" .limit\").removeClass(\"highlight\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tcontrol.container?.on(\r\n\t\t\t\t\"click keypress\",\r\n\t\t\t\t\".repeater-field-image .upload-button,.repeater-field-cropped_image .upload-button,.repeater-field-upload .upload-button\",\r\n\t\t\t\tfunction (e: JQuery.TriggeredEvent) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tcontrol.$thisButton = jQuery(this);\r\n\t\t\t\t\tcontrol.openFrame?.(e);\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tcontrol.container?.on(\r\n\t\t\t\t\"click keypress\",\r\n\t\t\t\t\".repeater-field-image .remove-button,.repeater-field-cropped_image .remove-button\",\r\n\t\t\t\tfunction (e: JQuery.TriggeredEvent) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tcontrol.$thisButton = jQuery(this);\r\n\t\t\t\t\tcontrol.removeImage?.(e);\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\tcontrol.container?.on(\r\n\t\t\t\t\"click keypress\",\r\n\t\t\t\t\".repeater-field-upload .remove-button\",\r\n\t\t\t\tfunction (e: JQuery.TriggeredEvent) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tcontrol.$thisButton = jQuery(this);\r\n\t\t\t\t\tcontrol.removeFile?.(e);\r\n\t\t\t\t},\r\n\t\t\t);\r\n\r\n\t\t\t/**\r\n\t\t\t * Function that loads the Mustache template\r\n\t\t\t */\r\n\t\t\tcontrol.repeaterTemplate = _.memoize(function () {\r\n\t\t\t\t/*\r\n\t\t\t\t * Underscore's default ERB-style templates are incompatible with PHP\r\n\t\t\t\t * when asp_tags is enabled, so WordPress uses Mustache-inspired templating syntax.\r\n\t\t\t\t *\r\n\t\t\t\t * @see trac ticket #22344.\r\n\t\t\t\t */\r\n\t\t\t\tconst options = {\r\n\t\t\t\t\tevaluate: /<#([\\s\\S]+?)#>/g,\r\n\t\t\t\t\tinterpolate: /\\{\\{\\{([\\s\\S]+?)\\}\\}\\}/g,\r\n\t\t\t\t\tescape: /\\{\\{([^\\}]+?)\\}\\}(?!\\})/g,\r\n\t\t\t\t\tvariable: \"data\",\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn function (data: any) {\r\n\t\t\t\t\tconst compiled = _.template(\r\n\t\t\t\t\t\tcontrol.container\r\n\t\t\t\t\t\t\t.find(\".customize-control-repeater-content\")\r\n\t\t\t\t\t\t\t.first()\r\n\t\t\t\t\t\t\t.html(),\r\n\t\t\t\t\t\toptions,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\treturn compiled(data);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * When we load the control, the fields have not been filled up.\r\n\t\t\t * This is the first time that we create all the rows.\r\n\t\t\t */\r\n\t\t\tif (settingValueFromParams.length) {\r\n\t\t\t\tlet i = 0;\r\n\r\n\t\t\t\tfor (i = 0; i < settingValueFromParams.length; i++) {\r\n\t\t\t\t\ttheNewRow = control.addRow?.(settingValueFromParams[i]);\r\n\t\t\t\t\tcontrol.initColorPicker?.();\r\n\r\n\t\t\t\t\tif (theNewRow) {\r\n\t\t\t\t\t\tcontrol.initSelect?.(theNewRow, settingValueFromParams[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcontrol.repeaterFieldsContainer?.sortable({\r\n\t\t\t\thandle: \".repeater-row-header\",\r\n\t\t\t\tupdate: function () {\r\n\t\t\t\t\tcontrol.sort?.();\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Open the media modal.\r\n\t\t *\r\n\t\t * @param {JQuery.TriggeredEvent} event - The JS event.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\topenFrame: function (event: JQuery.TriggeredEvent): void {\r\n\t\t\tif (wp.customize.utils.isKeydownButNotEnterEvent(event)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.$thisButton\r\n\t\t\t\t\t?.closest(\".repeater-field\")\r\n\t\t\t\t\t.hasClass(\"repeater-field-cropped_image\")\r\n\t\t\t) {\r\n\t\t\t\tthis.initCropperFrame?.();\r\n\t\t\t} else {\r\n\t\t\t\tthis.initFrame?.();\r\n\t\t\t}\r\n\r\n\t\t\tthis.frame.open();\r\n\t\t},\r\n\r\n\t\tinitFrame: function (): void {\r\n\t\t\tconst libMediaType = this.getMimeType();\r\n\r\n\t\t\tthis.frame = wp.media({\r\n\t\t\t\tstates: [\r\n\t\t\t\t\tnew wp.media.controller.Library({\r\n\t\t\t\t\t\tlibrary: wp.media.query({ type: libMediaType }),\r\n\t\t\t\t\t\tmultiple: false,\r\n\t\t\t\t\t\tdate: false,\r\n\t\t\t\t\t}),\r\n\t\t\t\t],\r\n\t\t\t});\r\n\r\n\t\t\t// When a file is selected, run a callback.\r\n\t\t\tthis.frame.on(\"select\", this.onSelect, this);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Create a media modal select frame, and store it so the instance can be reused when needed.\r\n\t\t * This is mostly a copy/paste of Core api.CroppedImageControl in /wp-admin/js/customize-control.js\r\n\t\t */\r\n\t\tinitCropperFrame: function (this: WpbfRepeaterControl): void {\r\n\t\t\t// We get the field id from which this was called.\r\n\t\t\tconst currentFieldId = this.$thisButton\r\n\t\t\t\t?.siblings(\"input.hidden-field\")\r\n\t\t\t\t.attr(\"data-field\");\r\n\t\t\tconst attrs = [\"width\", \"height\", \"flex_width\", \"flex_height\"]; // A list of attributes to look for\r\n\t\t\tconst libMediaType = this.getMimeType();\r\n\r\n\t\t\t// Make sure we got it\r\n\t\t\tif (_.isString(currentFieldId) && \"\" !== currentFieldId) {\r\n\t\t\t\t// Make fields is defined and only do the hack for cropped_image\r\n\t\t\t\tif (\r\n\t\t\t\t\t_.isObject(this.params.fields[currentFieldId]) &&\r\n\t\t\t\t\t\"cropped_image\" === this.params.fields[currentFieldId].type\r\n\t\t\t\t) {\r\n\t\t\t\t\t// Iterate over the list of attributes.\r\n\t\t\t\t\tfor (const attr of attrs) {\r\n\t\t\t\t\t\t// If the attribute exists in the field\r\n\t\t\t\t\t\tif (undefined !== this.params.fields[currentFieldId][attr]) {\r\n\t\t\t\t\t\t\t// Set the attribute in the main object\r\n\t\t\t\t\t\t\tthis.params[attr] = this.params.fields[currentFieldId][attr];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.frame = wp.media({\r\n\t\t\t\tbutton: {\r\n\t\t\t\t\ttext: \"Select and Crop\",\r\n\t\t\t\t\tclose: false,\r\n\t\t\t\t},\r\n\t\t\t\tstates: [\r\n\t\t\t\t\tnew wp.media.controller.Library({\r\n\t\t\t\t\t\tlibrary: wp.media.query({ type: libMediaType }),\r\n\t\t\t\t\t\tmultiple: false,\r\n\t\t\t\t\t\tdate: false,\r\n\t\t\t\t\t\tsuggestedWidth: this.params.width,\r\n\t\t\t\t\t\tsuggestedHeight: this.params.height,\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tnew wp.media.controller.CustomizeImageCropper({\r\n\t\t\t\t\t\timgSelectOptions: this.calculateImageSelectOptions,\r\n\t\t\t\t\t\tcontrol: this,\r\n\t\t\t\t\t}),\r\n\t\t\t\t],\r\n\t\t\t});\r\n\r\n\t\t\tthis.frame.on(\"select\", this.onSelectForCrop, this);\r\n\t\t\tthis.frame.on(\"cropped\", this.onCropped, this);\r\n\t\t\tthis.frame.on(\"skippedcrop\", this.onSkippedCrop, this);\r\n\t\t},\r\n\r\n\t\tonSelect: function (): void {\r\n\t\t\tconst attachment = this.frame.state().get(\"selection\").first().toJSON();\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.$thisButton\r\n\t\t\t\t\t?.closest(\".repeater-field\")\r\n\t\t\t\t\t.hasClass(\"repeater-field-upload\")\r\n\t\t\t) {\r\n\t\t\t\tthis.setFileInRepeaterField?.(attachment);\r\n\t\t\t} else {\r\n\t\t\t\tthis.setImageInRepeaterField?.(attachment);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After an image is selected in the media modal, switch to the cropper\r\n\t\t * state if the image isn't the right size.\r\n\t\t */\r\n\r\n\t\tonSelectForCrop: function (this: WpbfRepeaterControl) {\r\n\t\t\tconst attachment = this.frame.state().get(\"selection\").first().toJSON();\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.params.width === attachment.width &&\r\n\t\t\t\tthis.params.height === attachment.height &&\r\n\t\t\t\t!this.params.flex_width &&\r\n\t\t\t\t!this.params.flex_height\r\n\t\t\t) {\r\n\t\t\t\tthis.setImageInRepeaterField?.(attachment);\r\n\t\t\t} else {\r\n\t\t\t\tthis.frame.setState(\"cropper\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After the image has been cropped, apply the cropped image data to the setting.\r\n\t\t *\r\n\t\t * @param {object} croppedImage Cropped attachment data.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tonCropped: function (croppedImage: object): void {\r\n\t\t\tthis.setImageInRepeaterField?.(croppedImage);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Returns a set of options, computed from the attached image data and\r\n\t\t * control-specific data, to be fed to the imgAreaSelect plugin in\r\n\t\t * wp.media.view.Cropper.\r\n\t\t *\r\n\t\t * @param {wp.media.model.Attachment} attachment - The attachment from the WP API.\r\n\t\t * @param {wp.media.controller.Cropper} controller - Media controller.\r\n\t\t * @returns {object} - Options.\r\n\t\t */\r\n\t\tcalculateImageSelectOptions: function (\r\n\t\t\tthis: WpbfRepeaterControl,\r\n\t\t\tattachment: any,\r\n\t\t\tcontroller: any,\r\n\t\t): object {\r\n\t\t\tconst control = controller.get(\"control\");\r\n\t\t\tconst flexWidth = !!parseInt(control.params.flex_width, 10);\r\n\t\t\tconst flexHeight = !!parseInt(control.params.flex_height, 10);\r\n\t\t\tconst realWidth = attachment.get(\"width\");\r\n\t\t\tconst realHeight = attachment.get(\"height\");\r\n\t\t\tlet xInit = parseInt(control.params.width, 10);\r\n\t\t\tlet yInit = parseInt(control.params.height, 10);\r\n\t\t\tconst ratio = xInit / yInit;\r\n\t\t\tconst xImg = realWidth;\r\n\t\t\tconst yImg = realHeight;\r\n\t\t\tlet x1;\r\n\t\t\tlet y1;\r\n\r\n\t\t\tcontroller.set(\r\n\t\t\t\t\"canSkipCrop\",\r\n\t\t\t\t!control.mustBeCropped(\r\n\t\t\t\t\tflexWidth,\r\n\t\t\t\t\tflexHeight,\r\n\t\t\t\t\txInit,\r\n\t\t\t\t\tyInit,\r\n\t\t\t\t\trealWidth,\r\n\t\t\t\t\trealHeight,\r\n\t\t\t\t),\r\n\t\t\t);\r\n\r\n\t\t\tif (xImg / yImg > ratio) {\r\n\t\t\t\tyInit = yImg;\r\n\t\t\t\txInit = yInit * ratio;\r\n\t\t\t} else {\r\n\t\t\t\txInit = xImg;\r\n\t\t\t\tyInit = xInit / ratio;\r\n\t\t\t}\r\n\r\n\t\t\tx1 = (xImg - xInit) / 2;\r\n\t\t\ty1 = (yImg - yInit) / 2;\r\n\r\n\t\t\tconst imgSelectOptions: RepeaterImageSelectOptions = {\r\n\t\t\t\thandles: true,\r\n\t\t\t\tkeys: true,\r\n\t\t\t\tinstance: true,\r\n\t\t\t\tpersistent: true,\r\n\t\t\t\timageWidth: realWidth,\r\n\t\t\t\timageHeight: realHeight,\r\n\t\t\t\taspectRatio: \"\",\r\n\t\t\t\tmaxHeight: false,\r\n\t\t\t\tmaxWidth: false,\r\n\t\t\t\tx1: x1,\r\n\t\t\t\ty1: y1,\r\n\t\t\t\tx2: xInit + x1,\r\n\t\t\t\ty2: yInit + y1,\r\n\t\t\t};\r\n\r\n\t\t\tif (false === flexHeight && false === flexWidth) {\r\n\t\t\t\timgSelectOptions.aspectRatio = xInit + \":\" + yInit;\r\n\t\t\t}\r\n\r\n\t\t\tif (false === flexHeight) {\r\n\t\t\t\timgSelectOptions.maxHeight = yInit;\r\n\t\t\t}\r\n\r\n\t\t\tif (false === flexWidth) {\r\n\t\t\t\timgSelectOptions.maxWidth = xInit;\r\n\t\t\t}\r\n\r\n\t\t\treturn imgSelectOptions;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return whether the image must be cropped, based on required dimensions.\r\n\t\t *\r\n\t\t * @param {bool} flexW - The flex-width.\r\n\t\t * @param {bool} flexH - The flex-height.\r\n\t\t * @param {int}  dstW - Initial point distance in the X axis.\r\n\t\t * @param {int}  dstH - Initial point distance in the Y axis.\r\n\t\t * @param {int}  imgW - Width.\r\n\t\t * @param {int}  imgH - Height.\r\n\t\t *\r\n\t\t * @returns {bool} - Whether the image must be cropped or not based on required dimensions.\r\n\t\t */\r\n\t\tmustBeCropped: function (\r\n\t\t\tflexW: boolean,\r\n\t\t\tflexH: boolean,\r\n\t\t\tdstW: number,\r\n\t\t\tdstH: number,\r\n\t\t\timgW: number,\r\n\t\t\timgH: number,\r\n\t\t): boolean {\r\n\t\t\treturn !(\r\n\t\t\t\t(true === flexW && true === flexH) ||\r\n\t\t\t\t(true === flexW && dstH === imgH) ||\r\n\t\t\t\t(true === flexH && dstW === imgW) ||\r\n\t\t\t\t(dstW === imgW && dstH === imgH) ||\r\n\t\t\t\timgW <= dstW\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * If cropping was skipped, apply the image data directly to the setting.\r\n\t\t *\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tonSkippedCrop: function (): void {\r\n\t\t\tconst attachment = this.frame.state().get(\"selection\").first().toJSON();\r\n\t\t\tthis.setImageInRepeaterField?.(attachment);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Updates the setting and re-renders the control UI.\r\n\t\t *\r\n\t\t * @param {Record<string, any>} attachment - The attachment object.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tsetImageInRepeaterField: function (attachment: Record<string, any>): void {\r\n\t\t\tconst $targetDiv = this.$thisButton?.closest(\r\n\t\t\t\t\".repeater-field-image,.repeater-field-cropped_image\",\r\n\t\t\t);\r\n\r\n\t\t\t$targetDiv\r\n\t\t\t\t?.find(\".wpbf-image-attachment\")\r\n\t\t\t\t.html('<img src=\"' + attachment.url + '\">')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.slideDown(\"slow\");\r\n\r\n\t\t\t$targetDiv?.find(\".hidden-field\").val(attachment.id);\r\n\t\t\tthis.$thisButton?.text(this.$thisButton.data(\"alt-label\"));\r\n\t\t\t$targetDiv?.find(\".remove-button\").show();\r\n\r\n\t\t\t//This will activate the save button\r\n\t\t\t$targetDiv?.find(\"input, textarea, select\").trigger(\"change\");\r\n\t\t\tthis.frame.close();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Updates the setting and re-renders the control UI.\r\n\t\t *\r\n\t\t * @param {Record<string, any>} attachment - The attachment object.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tsetFileInRepeaterField: function (attachment: Record<string, any>): void {\r\n\t\t\tconst $targetDiv = this.$thisButton?.closest(\".repeater-field-upload\");\r\n\r\n\t\t\t$targetDiv\r\n\t\t\t\t?.find(\".wpbf-file-attachment\")\r\n\t\t\t\t.html(\r\n\t\t\t\t\t'<span class=\"file\"><span class=\"dashicons dashicons-media-default\"></span> ' +\r\n\t\t\t\t\t\tattachment.filename +\r\n\t\t\t\t\t\t\"</span>\",\r\n\t\t\t\t)\r\n\t\t\t\t.hide()\r\n\t\t\t\t.slideDown(\"slow\");\r\n\r\n\t\t\t$targetDiv?.find(\".hidden-field\").val(attachment.id);\r\n\t\t\tthis.$thisButton?.text(this.$thisButton.data(\"alt-label\"));\r\n\t\t\t$targetDiv?.find(\".upload-button\").show();\r\n\t\t\t$targetDiv?.find(\".remove-button\").show();\r\n\r\n\t\t\t// This will activate the save button.\r\n\t\t\t$targetDiv?.find(\"input, textarea, select\").trigger(\"change\");\r\n\t\t\tthis.frame.close();\r\n\t\t},\r\n\r\n\t\tgetMimeType: function (this: WpbfRepeaterControl) {\r\n\t\t\t// We get the field id from which this was called\r\n\t\t\tconst currentFieldId = this.$thisButton\r\n\t\t\t\t?.siblings(\"input.hidden-field\")\r\n\t\t\t\t.attr(\"data-field\");\r\n\r\n\t\t\t// Make sure we got it\r\n\t\t\tif (_.isString(currentFieldId) && \"\" !== currentFieldId) {\r\n\t\t\t\t// Make fields is defined and only do the hack for cropped_image\r\n\t\t\t\tif (\r\n\t\t\t\t\t_.isObject(this.params.fields[currentFieldId]) &&\r\n\t\t\t\t\t\"upload\" === this.params.fields[currentFieldId].type\r\n\t\t\t\t) {\r\n\t\t\t\t\t// If the attribute exists in the field\r\n\t\t\t\t\tif (undefined !== this.params.fields[currentFieldId].mime_type) {\r\n\t\t\t\t\t\t// Set the attribute in the main object\r\n\t\t\t\t\t\treturn this.params.fields[currentFieldId].mime_type;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn \"image\";\r\n\t\t},\r\n\r\n\t\tremoveImage: function (event) {\r\n\t\t\tif (wp.customize.utils.isKeydownButNotEnterEvent(event)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst $targetDiv = this.$thisButton?.closest(\r\n\t\t\t\t\".repeater-field-image,.repeater-field-cropped_image,.repeater-field-upload\",\r\n\t\t\t);\r\n\t\t\tconst $uploadButton = $targetDiv?.find(\".upload-button\");\r\n\r\n\t\t\t$targetDiv?.find(\".wpbf-image-attachment\").slideUp(\"fast\", function () {\r\n\t\t\t\tjQuery(this).show().html(jQuery(this).data(\"placeholder\"));\r\n\t\t\t});\r\n\t\t\t$targetDiv?.find(\".hidden-field\").val(\"\");\r\n\t\t\t$uploadButton?.text($uploadButton.data(\"label\"));\r\n\t\t\tthis.$thisButton?.hide();\r\n\r\n\t\t\t$targetDiv?.find(\"input, textarea, select\").trigger(\"change\");\r\n\t\t},\r\n\r\n\t\tremoveFile: function (event) {\r\n\t\t\tif (wp.customize.utils.isKeydownButNotEnterEvent(event)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst $targetDiv = this.$thisButton?.closest(\".repeater-field-upload\");\r\n\t\t\tconst $uploadButton = $targetDiv?.find(\".upload-button\");\r\n\r\n\t\t\t$targetDiv?.find(\".wpbf-file-attachment\").slideUp(\"fast\", function () {\r\n\t\t\t\tjQuery(this).show().html(jQuery(this).data(\"placeholder\"));\r\n\t\t\t});\r\n\t\t\t$targetDiv?.find(\".hidden-field\").val(\"\");\r\n\t\t\t$uploadButton?.text($uploadButton.data(\"label\"));\r\n\t\t\tthis.$thisButton?.hide();\r\n\r\n\t\t\t$targetDiv?.find(\"input, textarea, select\").trigger(\"change\");\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get the current value of the setting\r\n\t\t *\r\n\t\t * @returns {Record<string, any>[]} - Returns the value.\r\n\t\t */\r\n\t\tgetValue: function (): Record<string, any>[] {\r\n\t\t\t/**\r\n\t\t\t * The setting value returned via PHP will be associative array\r\n\t\t\t * because we handle it via PHP in `RepeaterSetting` class.\r\n\t\t\t *\r\n\t\t\t * TS type equivalent of that assoc-array is Record<string, any>.\r\n\t\t\t *\r\n\t\t\t * But the control.setting.get() in JS will return string\r\n\t\t\t * because it will be taken from the linked (hidden) setting field.\r\n\t\t\t */\r\n\t\t\tconst hiddenFieldValue = this.setting?.get();\r\n\r\n\t\t\tconst stringValue =\r\n\t\t\t\thiddenFieldValue === undefined || \"string\" !== typeof hiddenFieldValue\r\n\t\t\t\t\t? \"\"\r\n\t\t\t\t\t: hiddenFieldValue;\r\n\r\n\t\t\t// The setting is saved in JSON.\r\n\t\t\treturn JSON.parse(decodeURI(stringValue));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set a new value for the setting\r\n\t\t *\r\n\t\t * @param {Record<string, any>} newValue - The new value.\r\n\t\t * @param {bool} refresh - If we want to refresh the previewer or not\r\n\t\t * @param {bool} filtering - If we want to filter or not.\r\n\t\t *\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tsetValue: function (\r\n\t\t\tthis: WpbfRepeaterControl,\r\n\t\t\tnewValue: Record<string, any>,\r\n\t\t\trefresh?: boolean,\r\n\t\t\tfiltering?: boolean,\r\n\t\t): void {\r\n\t\t\t// We need to filter the values after the first load to remove data requrired for diplay but that we don't want to save in DB\r\n\t\t\tconst filteredValue = newValue;\r\n\t\t\tconst filter: string[] = [];\r\n\r\n\t\t\tif (filtering) {\r\n\t\t\t\tfor (const fieldId in this.params.fields) {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tthis.params.fields.hasOwnProperty(fieldId) &&\r\n\t\t\t\t\t\tthis.params.fields[fieldId].type &&\r\n\t\t\t\t\t\t[\"image\", \"cropped_image\", \"upload\"].includes(\r\n\t\t\t\t\t\t\tthis.params.fields[fieldId].type,\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tfilter.push(fieldId);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tjQuery.each(newValue, function (key: string, value: any) {\r\n\t\t\t\t\tjQuery.each(filter, function (idx: number, field: string) {\r\n\t\t\t\t\t\tif (undefined !== value[field] && undefined !== value[field].id) {\r\n\t\t\t\t\t\t\tfilteredValue[key][field] = value[field].id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.setting?.set(encodeURI(JSON.stringify(filteredValue)));\r\n\r\n\t\t\tif (refresh) {\r\n\t\t\t\t// Trigger the change event on the hidden field so\r\n\t\t\t\t// previewer refresh the website on Customizer\r\n\t\t\t\tthis.settingField?.trigger(\"change\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Add a new row to repeater settings based on the structure.\r\n\t\t *\r\n\t\t * @param {Record<string, Record<string, any>>} data - (Optional) object of field => value pairs (undefined if you want to get the default values)\r\n\t\t * @returns {WpbfRepeaterRow|undefined} - Returns the new row.\r\n\t\t */\r\n\t\taddRow: function (\r\n\t\t\tthis: WpbfRepeaterControl,\r\n\t\t\tdata?: Record<string, Record<string, any>>,\r\n\t\t): WpbfRepeaterRow | undefined {\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// Get the current setting value.\r\n\t\t\tconst settingValue = this.getValue?.();\r\n\r\n\t\t\t// Saves the new setting data.\r\n\t\t\tconst newRowSetting: Record<string, any> = {};\r\n\r\n\t\t\t// The template for the new row (defined on Kirki_Customize_Repeater_Control::render_content() ).\r\n\t\t\tlet template = control.repeaterTemplate?.();\r\n\r\n\t\t\tif (template) {\r\n\t\t\t\t/**\r\n\t\t\t\t * Data to pass to the template.\r\n\t\t\t\t *\r\n\t\t\t\t * The control structure is going to define the new fields.\r\n\t\t\t\t * We need to clone control.params.fields.\r\n\t\t\t\t * Assigning it could result in a reference assignment.\r\n\t\t\t\t */\r\n\t\t\t\tlet templateData = jQuery.extend(true, {}, control.params.fields);\r\n\r\n\t\t\t\t// But if we have passed data, we'll use the data values instead\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tlet fieldId;\r\n\r\n\t\t\t\t\tfor (fieldId in data) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tdata.hasOwnProperty(fieldId) &&\r\n\t\t\t\t\t\t\ttemplateData.hasOwnProperty(fieldId)\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\ttemplateData[fieldId].default = data[fieldId];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// ? I don't know if this is necessary. Furthermore, it has type error.\r\n\t\t\t\t// templateData.index = this.currentIndex;\r\n\r\n\t\t\t\t// Append the template content\r\n\t\t\t\ttemplate = template(templateData);\r\n\r\n\t\t\t\t// Create a new row object and append the element\r\n\t\t\t\tconst newRow: WpbfRepeaterRow = new RepeaterRow(\r\n\t\t\t\t\tcontrol.currentIndex ?? 0,\r\n\t\t\t\t\tjQuery(template).appendTo(control.repeaterFieldsContainer!),\r\n\t\t\t\t\tcontrol.params.rowLabel!,\r\n\t\t\t\t\tcontrol,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tnewRow.container.on(\r\n\t\t\t\t\t\"row:remove\",\r\n\t\t\t\t\tfunction (e: JQuery.TriggeredEvent, rowIndex: number) {\r\n\t\t\t\t\t\tcontrol.deleteRow?.(rowIndex);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\r\n\t\t\t\tnewRow.container.on(\r\n\t\t\t\t\t\"row:update\",\r\n\t\t\t\t\tfunction (\r\n\t\t\t\t\t\te: JQuery.TriggeredEvent,\r\n\t\t\t\t\t\trowIndex: number,\r\n\t\t\t\t\t\tfieldName: string,\r\n\t\t\t\t\t\telement: HTMLInputElement | HTMLTextAreaElement,\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tcontrol.updateField?.call(control, e, rowIndex, fieldName, element);\r\n\t\t\t\t\t\tnewRow.updateLabel?.();\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Add the row to rows collection\r\n\t\t\t\tif (undefined !== this.currentIndex && undefined !== this.rows) {\r\n\t\t\t\t\tthis.rows[this.currentIndex] = newRow;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet fieldId;\r\n\r\n\t\t\t\tfor (fieldId in templateData) {\r\n\t\t\t\t\tif (templateData.hasOwnProperty(fieldId)) {\r\n\t\t\t\t\t\tnewRowSetting[fieldId] = templateData[fieldId].default;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (undefined !== settingValue) {\r\n\t\t\t\t\tif (undefined !== this.currentIndex) {\r\n\t\t\t\t\t\tsettingValue[this.currentIndex] = newRowSetting;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.setValue?.(settingValue, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (undefined !== this.currentIndex) this.currentIndex++;\r\n\r\n\t\t\t\treturn newRow;\r\n\t\t\t}\r\n\r\n\t\t\treturn undefined;\r\n\t\t},\r\n\r\n\t\tsort: function (): void {\r\n\t\t\tconst control = this;\r\n\r\n\t\t\tif (!control.getValue) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst $rows = this.repeaterFieldsContainer?.find(\".repeater-row\");\r\n\t\t\tconst newOrder: any[] = [];\r\n\t\t\tconst settings = control.getValue();\r\n\t\t\tconst newRows: WpbfRepeaterRow[] = [];\r\n\t\t\tconst newSettings: any[] = [];\r\n\r\n\t\t\t$rows?.each(function (i: number, element: HTMLElement) {\r\n\t\t\t\tnewOrder.push(jQuery(element).data(\"row\"));\r\n\t\t\t});\r\n\r\n\t\t\tjQuery.each(newOrder, function (newPosition, oldPosition) {\r\n\t\t\t\tif (control.rows) {\r\n\t\t\t\t\tnewRows[newPosition] = control.rows[oldPosition];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnewRows[newPosition].setRowIndex(newPosition);\r\n\r\n\t\t\t\tnewSettings[newPosition] = settings[oldPosition];\r\n\t\t\t});\r\n\r\n\t\t\tcontrol.rows = newRows;\r\n\t\t\tcontrol.setValue?.(newSettings);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Delete a row in the repeater setting\r\n\t\t *\r\n\t\t * @param {number} index - Position of the row in the complete Setting Array\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tdeleteRow: function (index: number): void {\r\n\t\t\tif (undefined === this.rows) return;\r\n\t\t\tif (!this.getValue) return;\r\n\r\n\t\t\tconst currentSettings = this.getValue();\r\n\r\n\t\t\tif (currentSettings[index]) {\r\n\t\t\t\t// Find the row\r\n\t\t\t\tconst row = this.rows[index];\r\n\r\n\t\t\t\tif (row) {\r\n\t\t\t\t\t// Remove the row settings\r\n\t\t\t\t\tdelete currentSettings[index];\r\n\r\n\t\t\t\t\t// Remove the row from the rows collection\r\n\t\t\t\t\tdelete this.rows[index];\r\n\r\n\t\t\t\t\t// Update the new setting values\r\n\t\t\t\t\tthis.setValue?.(currentSettings, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remap the row numbers\r\n\t\t\tfor (let prop in this.rows) {\r\n\t\t\t\tif (this.rows.hasOwnProperty(prop) && this.rows[prop]) {\r\n\t\t\t\t\tthis.rows[prop].updateLabel();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Update a single field inside a row.\r\n\t\t * Triggered when a field has changed\r\n\t\t *\r\n\t\t * @param {JQuery.TriggeredEvent} e - Event object\r\n\t\t * @param {number} rowIndex - The row's index as an integer.\r\n\t\t * @param {string} fieldId - The field ID.\r\n\t\t * @param {HTMLInputElement | HTMLTextAreaElement} element - The element's identifier, or jQuery object of the element.\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tupdateField: function (\r\n\t\t\tthis: WpbfRepeaterControl,\r\n\t\t\te: JQuery.TriggeredEvent,\r\n\t\t\trowIndex: number,\r\n\t\t\tfieldId: string,\r\n\t\t\telement: HTMLInputElement | HTMLTextAreaElement,\r\n\t\t): void {\r\n\t\t\tif (!this.getValue) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (undefined === this.rows || !this.rows[rowIndex]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.params.fields[fieldId]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst type = this.params.fields[fieldId].type;\r\n\t\t\tconst row = this.rows[rowIndex];\r\n\t\t\tconst currentSettings = this.getValue();\r\n\r\n\t\t\tconst $el = jQuery(element);\r\n\r\n\t\t\tif (undefined === currentSettings[row.rowIndex][fieldId]) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (\"checkbox\" === type) {\r\n\t\t\t\tcurrentSettings[row.rowIndex][fieldId] = $el.is(\":checked\");\r\n\t\t\t} else {\r\n\t\t\t\t// Update the settings\r\n\t\t\t\tcurrentSettings[row.rowIndex][fieldId] = $el.val();\r\n\t\t\t}\r\n\r\n\t\t\tthis.setValue?.(currentSettings, true);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Init the color picker on color fields\r\n\t\t * Called after AddRow\r\n\t\t *\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tinitColorPicker: function (this: WpbfRepeaterControl): void {\r\n\t\t\tconst control = this;\r\n\t\t\tconst colorPicker = control.container?.find(\".wpbf-classic-color-picker\");\r\n\t\t\tconst fieldId = colorPicker?.data(\"field\");\r\n\t\t\tconst options: Record<string, any> = {};\r\n\r\n\t\t\t// We check if the color palette parameter is defined.\r\n\t\t\tif (\r\n\t\t\t\tundefined !== fieldId &&\r\n\t\t\t\tundefined !== control.params.fields[fieldId] &&\r\n\t\t\t\tundefined !== control.params.fields[fieldId].palettes &&\r\n\t\t\t\t_.isObject(control.params.fields[fieldId].palettes)\r\n\t\t\t) {\r\n\t\t\t\toptions.palettes = control.params.fields[fieldId].palettes;\r\n\t\t\t}\r\n\r\n\t\t\t// When the color picker value is changed we update the value of the field\r\n\t\t\toptions.change = (event: any, ui: any) => {\r\n\t\t\t\tif (!control.getValue) return;\r\n\r\n\t\t\t\tconst currentPicker = jQuery(event.target);\r\n\t\t\t\tconst row = currentPicker.closest(\".repeater-row\");\r\n\t\t\t\tconst rowIndex = row.data(\"row\");\r\n\t\t\t\tconst currentSettings = control.getValue();\r\n\t\t\t\tconst value =\r\n\t\t\t\t\tui.color._alpha < 1 ? ui.color.to_s() : ui.color.toString();\r\n\r\n\t\t\t\tcurrentSettings[rowIndex][currentPicker.data(\"field\")] = value;\r\n\t\t\t\tcontrol.setValue?.(currentSettings, true);\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * By default if the alpha is 1, the input will be rgb.\r\n\t\t\t\t * We setTimeout to 50ms to prevent race value set.\r\n\t\t\t\t */\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tevent.target.value = value;\r\n\t\t\t\t}, 50);\r\n\t\t\t};\r\n\r\n\t\t\t// Init the color picker\r\n\t\t\tif (colorPicker && colorPicker.length > 0) {\r\n\t\t\t\t(colorPicker as any).wpColorPicker(options);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Init the dropdown-pages field.\r\n\t\t * Called after AddRow\r\n\t\t *\r\n\t\t * @param {WpbfRepeaterRow} theNewRow the row that was added to the repeater\r\n\t\t * @param {Record<string, any>} data the data for the row if we're initializing a pre-existing row\r\n\t\t *\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tinitSelect: function (\r\n\t\t\tthis: WpbfRepeaterControl,\r\n\t\t\ttheNewRow: WpbfRepeaterRow,\r\n\t\t\tdata?: Record<string, any>,\r\n\t\t): void {\r\n\t\t\tconst control = this;\r\n\t\t\tconst dropdown = theNewRow.container.find(\".repeater-field select\");\r\n\r\n\t\t\tif (0 === dropdown.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst dataField = dropdown.data(\"field\");\r\n\r\n\t\t\tdata = data || {};\r\n\t\t\tdata[dataField] = data[dataField] || \"\";\r\n\r\n\t\t\tjQuery(dropdown).val(data[dataField] || jQuery(dropdown).val());\r\n\r\n\t\t\tthis.container.on(\"change\", \".repeater-field select\", function (event) {\r\n\t\t\t\tif (!control.getValue) return;\r\n\r\n\t\t\t\tconst currentDropdown = jQuery(event.target);\r\n\t\t\t\tconst row = currentDropdown.closest(\".repeater-row\");\r\n\t\t\t\tconst rowIndex = row.data(\"row\");\r\n\t\t\t\tconst currentSettings = control.getValue();\r\n\r\n\t\t\t\tcurrentSettings[rowIndex][currentDropdown.data(\"field\")] =\r\n\t\t\t\t\tjQuery(this).val();\r\n\t\t\t\tcontrol.setValue?.(currentSettings);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t * Cleans up jQuery Sortable, event handlers, wp.media frame,\r\n\t\t * color pickers, and row objects.\r\n\t\t *\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tdestroy: function (this: WpbfRepeaterControl): void {\r\n\t\t\t// Destroy jQuery Sortable on the repeater fields container.\r\n\t\t\tif (this.repeaterFieldsContainer?.data(\"ui-sortable\")) {\r\n\t\t\t\tthis.repeaterFieldsContainer.sortable(\"destroy\");\r\n\t\t\t}\r\n\r\n\t\t\t// Unbind all container events (handles lines 68-127, 940).\r\n\t\t\tthis.container?.off();\r\n\r\n\t\t\t// Destroy wp.media frame if it exists.\r\n\t\t\tif (this.frame) {\r\n\t\t\t\tthis.frame.off();\r\n\t\t\t\tthis.frame.dispose?.();\r\n\t\t\t\tthis.frame = undefined;\r\n\t\t\t}\r\n\r\n\t\t\t// Destroy color pickers.\r\n\t\t\tthis.container?.find(\".wpbf-classic-color-picker\").each(function () {\r\n\t\t\t\tconst $picker = jQuery(this);\r\n\t\t\t\tif ($picker.data(\"wpColorPicker\")) {\r\n\t\t\t\t\t($picker as any).wpColorPicker(\"destroy\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Clean up row objects - unbind event handlers and clear references.\r\n\t\t\tif (this.rows) {\r\n\t\t\t\tfor (const index in this.rows) {\r\n\t\t\t\t\tconst row = this.rows[index];\r\n\t\t\t\t\tif (row) {\r\n\t\t\t\t\t\trow.container?.off();\r\n\t\t\t\t\t\trow.header?.off();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.rows = [];\r\n\t\t\t}\r\n\r\n\t\t\t// Clear memoized template function.\r\n\t\t\tthis.repeaterTemplate = undefined;\r\n\r\n\t\t\t// Clear other references.\r\n\t\t\tthis.settingField = undefined;\r\n\t\t\tthis.repeaterFieldsContainer = undefined;\r\n\t\t},\r\n\t});\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport { WpbfSelectControl } from \"./select-interface\";\r\nimport { createSharedFontDataAdapter } from \"./shared-font-data-adapter\";\r\n\r\nif (window.wp.customize) {\r\n\tsetupSelectControl(window.wp.customize);\r\n}\r\n\r\nfunction setupSelectControl(customizer: WpbfCustomize) {\r\n\tcustomizer.controlConstructor[\"wpbf-enhanced-select\"] =\r\n\t\tcustomizer.Control.extend<WpbfSelectControl>({\r\n\t\t\t/**\r\n\t\t\t * Initialize.\r\n\t\t\t */\r\n\t\t\tinitialize: function (id, params) {\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tcustomizer.Control.prototype.initialize.call(control, id, params);\r\n\r\n\t\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\t\tfunction onRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\t\tif (control === removedControl) {\r\n\t\t\t\t\t\tcontrol?.destroy?.();\r\n\t\t\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\t\t\tcustomizer.control.unbind(\"removed\", onRemoved);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcustomizer.control.bind(\"removed\", onRemoved);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Set notification container and render.\r\n\t\t\t */\r\n\t\t\tsetNotificationContainer: function (el) {\r\n\t\t\t\tif (!this.notifications) return;\r\n\t\t\t\tthis.notifications.container = jQuery(el);\r\n\t\t\t\tthis.notifications.render();\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Render the control into the DOM.\r\n\t\t\t *\r\n\t\t\t * This is called from the Control#embed() method in the parent class.\r\n\t\t\t */\r\n\t\t\trenderContent: function () {\r\n\t\t\t\tif (!this.params) return;\r\n\t\t\t\tconst params = this.params;\r\n\r\n\t\t\t\tconst labelTemplate = `\r\n\t\t\t\t<label class=\"customize-control-title\" for=\"wpbf-control-input-${this.id}\">\r\n\t\t\t\t\t<span className=\"customize-control-title\">${params.label}</span>\r\n\t\t\t\t</label>\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tconst labelDescriptionTemplate = `\r\n\t\t\t\t<div class=\"customize-control-description description\">\r\n\t\t\t\t\t${params.description}\r\n\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tconst headerTemplate = `\r\n\t\t\t\t<header clas=\"wpbf-control-header\">\r\n\t\t\t\t\t${params.label ? labelTemplate : \"\"}\r\n\t\t\t\t\t${params.description ? labelDescriptionTemplate : \"\"}\r\n\t\t\t\t\t<div class=\"customize-control-notifications-container\"></div>\r\n\t\t\t\t</header>\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tconst formTemplate = `\r\n\t\t\t\t<div class=\"wpbf-control-form\">\r\n\t\t\t\t\t<select class=\"wpbf-select2\"${params.multiple ? \" multiple\" : \"\"}></select>\r\n\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tlet template = headerTemplate + formTemplate;\r\n\r\n\t\t\t\tif (params.layoutStyle === \"horizontal\") {\r\n\t\t\t\t\ttemplate = `\r\n\t\t\t\t\t<div class=\"wpbf-control-cols\">\r\n\t\t\t\t\t\t<div class=\"wpbf-control-left-col wpbf-w50\">\r\n\t\t\t\t\t\t\t${headerTemplate}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div class=\"wpbf-control-right-col wpbf-flex wpbf-content-end wpbf-w50\">\r\n\t\t\t\t\t\t\t${formTemplate}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.container?.html(template);\r\n\r\n\t\t\t\tconst notificationsContainer = document.querySelector(\r\n\t\t\t\t\t`#customize-control-${this.id} .customize-control-notifications-container`,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tnotificationsContainer &&\r\n\t\t\t\t\tnotificationsContainer instanceof HTMLElement\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.setNotificationContainer?.(notificationsContainer);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst $selectbox = this.container?.find(\".wpbf-select2\");\r\n\r\n\t\t\t\t$selectbox?.on(\"change.select2\", (e) => {\r\n\t\t\t\t\tconst selectedOptions = $selectbox?.select2(\"data\");\r\n\r\n\t\t\t\t\tconst values = selectedOptions?.map((option) => option.id);\r\n\t\t\t\t\tlet value = null;\r\n\r\n\t\t\t\t\tif (values?.length) {\r\n\t\t\t\t\t\tvalue = params.multiple ? values : values[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue = params.multiple ? [] : \"\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.setting?.set(value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tconst choicesGlobalVar = params.choicesGlobalVar;\r\n\r\n\t\t\t\t// Check if we should use the shared data adapter (for global font data)\r\n\t\t\t\tconst hasGlobalData =\r\n\t\t\t\t\tchoicesGlobalVar && choicesGlobalVar in window;\r\n\r\n\t\t\t\tif (hasGlobalData) {\r\n\t\t\t\t\t// Use custom adapter that shares global data without copying\r\n\t\t\t\t\tconst value = this.setting?.get();\r\n\t\t\t\t\tconst selectedValues = !Array.isArray(value)\r\n\t\t\t\t\t\t? value\r\n\t\t\t\t\t\t\t? [value]\r\n\t\t\t\t\t\t\t: []\r\n\t\t\t\t\t\t: value;\r\n\r\n\t\t\t\t\tconst SharedAdapter = createSharedFontDataAdapter(\r\n\t\t\t\t\t\tchoicesGlobalVar,\r\n\t\t\t\t\t\tselectedValues,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (SharedAdapter) {\r\n\t\t\t\t\t\t$selectbox?.select2({\r\n\t\t\t\t\t\t\tplaceholder: params.placeholder,\r\n\t\t\t\t\t\t\tallowClear: params.clearable,\r\n\t\t\t\t\t\t\tmultiple: params.multiple,\r\n\t\t\t\t\t\t\tmaximumSelectionLength: params.multiple\r\n\t\t\t\t\t\t\t\t? params.maxSelections\r\n\t\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\t\tdataAdapter: SharedAdapter,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Fallback to standard behavior if adapter creation failed\r\n\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\"SharedFontDataAdapter creation failed, using default\",\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\t$selectbox?.select2({\r\n\t\t\t\t\t\t\tplaceholder: params.placeholder,\r\n\t\t\t\t\t\t\tallowClear: params.clearable,\r\n\t\t\t\t\t\t\tmultiple: params.multiple,\r\n\t\t\t\t\t\t\tmaximumSelectionLength: params.multiple\r\n\t\t\t\t\t\t\t\t? params.maxSelections\r\n\t\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\tdata: (window as any)[choicesGlobalVar] ?? params.choices,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Standard behavior for non-global data\r\n\t\t\t\t\t$selectbox?.select2({\r\n\t\t\t\t\t\tplaceholder: params.placeholder,\r\n\t\t\t\t\t\tallowClear: params.clearable,\r\n\t\t\t\t\t\tmultiple: params.multiple,\r\n\t\t\t\t\t\tmaximumSelectionLength: params.multiple\r\n\t\t\t\t\t\t\t? params.maxSelections\r\n\t\t\t\t\t\t\t: undefined,\r\n\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\tdata: params.choices,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t\t\t */\r\n\t\t\tready: function () {\r\n\t\t\t\t// Update component state when customizer setting changes.\r\n\t\t\t\tthis.setting?.bind((val) => {\r\n\t\t\t\t\tif (this.updateComponentState) {\r\n\t\t\t\t\t\tlet value = val;\r\n\r\n\t\t\t\t\t\tif (undefined === value) {\r\n\t\t\t\t\t\t\tvalue = this.params?.multiple ? [] : \"\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.updateComponentState(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tupdateComponentState: function (value) {\r\n\t\t\t\tconst $selectbox = this.container?.find(\".wpbf-select2\");\r\n\t\t\t\t$selectbox?.val(value);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Handle removal/de-registration of the control.\r\n\t\t\t *\r\n\t\t\t * This is essentially the inverse of the Control#embed() method.\r\n\t\t\t *\r\n\t\t\t * @link https://core.trac.wordpress.org/ticket/31334\r\n\t\t\t */\r\n\t\t\tdestroy: function destroy() {\r\n\t\t\t\tconst $selectbox = this.container?.find(\".wpbf-select2\");\r\n\t\t\t\t$selectbox?.off(\"change.select2\");\r\n\t\t\t\t$selectbox?.select2(\"destroy\");\r\n\r\n\t\t\t\tthis.container?.html(\"\");\r\n\r\n\t\t\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\t\t\tif (customizer.Control.prototype.destroy) {\r\n\t\t\t\t\tcustomizer.Control.prototype.destroy.call(this);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n}\r\n","import SliderControl from \"./SliderControl\";\r\n\r\nif (window.wp.customize) {\r\n\twindow.wp.customize.controlConstructor[\"wpbf-slider\"] = SliderControl(\r\n\t\twindow.wp.customize,\r\n\t);\r\n}\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport { createRoot } from \"react-dom/client\";\r\nimport SliderForm from \"./SliderForm\";\r\nimport { WpbfSliderControl, WpbfSliderControlParams } from \"./slider-interface\";\r\n\r\nexport default function SliderControl(customizer: WpbfCustomize) {\r\n\treturn customizer.Control.extend<WpbfSliderControl>({\r\n\t\tinitialize: function (id: string, params: WpbfSliderControlParams) {\r\n\t\t\t// Bind functions to this control context for passing as React props.\r\n\t\t\tthis.setNotificationContainer = this.setNotificationContainer?.bind(this);\r\n\t\t\tthis.overrideUpdateComponentStateFn =\r\n\t\t\t\tthis.overrideUpdateComponentStateFn?.bind(this);\r\n\t\t\tthis.updateCustomizerSetting = this.updateCustomizerSetting?.bind(this);\r\n\r\n\t\t\tcustomizer.Control.prototype.initialize.call(this, id, params);\r\n\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\tfunction handleOnRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\tif (control !== removedControl) return;\r\n\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\tcustomizer.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t}\r\n\r\n\t\t\tcustomizer.control.bind(\"removed\", handleOnRemoved);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set notification container and render.\r\n\t\t *\r\n\t\t * This will be called when the React component is mounted.\r\n\t\t */\r\n\t\tsetNotificationContainer: function setNotificationContainer(el) {\r\n\t\t\tif (this.notifications) this.notifications.container = jQuery(el);\r\n\t\t\tthis.notifications?.render();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Render the control into the DOM.\r\n\t\t *\r\n\t\t * This will be called from the Control#embed() method in the parent class.\r\n\t\t */\r\n\t\trenderContent: function renderContent() {\r\n\t\t\tif (!this.root && this.container) {\r\n\t\t\t\tthis.root = createRoot(this.container[0]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.root?.render(\r\n\t\t\t\t<SliderForm\r\n\t\t\t\t\tid={this.setting?.id ?? \"\"}\r\n\t\t\t\t\tmin={this.params?.min}\r\n\t\t\t\t\tmax={this.params?.max}\r\n\t\t\t\t\tstep={this.params?.step}\r\n\t\t\t\t\tlabel={this.params?.label}\r\n\t\t\t\t\tdescription={this.params?.description}\r\n\t\t\t\t\tdefault={this.params?.default}\r\n\t\t\t\t\tvalue={this.params?.value}\r\n\t\t\t\t\tupdateCustomizerSetting={this.updateCustomizerSetting}\r\n\t\t\t\t\toverrideUpdateComponentStateFn={this.overrideUpdateComponentStateFn}\r\n\t\t\t\t\tsetNotificationContainer={this.setNotificationContainer}\r\n\t\t\t\t/>,\r\n\t\t\t);\r\n\r\n\t\t\tif (this.params?.allowCollapse) {\r\n\t\t\t\tthis.container?.addClass(\"allowCollapse\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t\t *\r\n\t\t * React is available to be used here instead of the customizer.Element abstraction.\r\n\t\t */\r\n\t\tready: function ready() {\r\n\t\t\t// Update component's state when customizer setting's value is changed.\r\n\t\t\tthis.setting?.bind((val) => {\r\n\t\t\t\tthis.updateComponentState?.(val);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tupdateCustomizerSetting: function updateCustomizerSetting(val) {\r\n\t\t\tif (val === undefined) return;\r\n\t\t\tthis.setting?.set(val);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will be overriden by the rendered component via overrideUpdateComponentStateFn.\r\n\t\t */\r\n\t\tupdateComponentState: function (val) {},\r\n\r\n\t\toverrideUpdateComponentStateFn: function overrideUpdateComponentStateFn(\r\n\t\t\tfn,\r\n\t\t) {\r\n\t\t\tthis.updateComponentState = fn;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t *\r\n\t\t * This is essentially the inverse of the Control#embed() method.\r\n\t\t *\r\n\t\t * @link https://core.trac.wordpress.org/ticket/31334\r\n\t\t */\r\n\t\tdestroy: function destroy() {\r\n\t\t\tthis.root?.unmount();\r\n\t\t\tthis.root = undefined;\r\n\r\n\t\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\t\tcustomizer.Control.prototype.destroy?.call(this);\r\n\t\t},\r\n\t});\r\n}\r\n","import InputSliderControl from \"./InputSliderControl\";\r\n\r\nif (window.wp.customize) {\r\n\twindow.wp.customize.controlConstructor[\"wpbf-input-slider\"] =\r\n\t\tInputSliderControl(window.wp.customize);\r\n}\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport { createRoot } from \"react-dom/client\";\r\nimport InputSliderForm from \"./InputSliderForm\";\r\nimport {\r\n\tWpbfInputSliderControl,\r\n\tWpbfInputSliderControlParams,\r\n} from \"./slider-interface\";\r\n\r\nexport default function InputSliderControl(customizer: WpbfCustomize) {\r\n\treturn customizer.Control.extend<WpbfInputSliderControl>({\r\n\t\tinitialize: function (id: string, params: WpbfInputSliderControlParams) {\r\n\t\t\t// Bind functions to this control context for passing as React props.\r\n\t\t\tthis.setNotificationContainer = this.setNotificationContainer?.bind(this);\r\n\t\t\tthis.overrideUpdateComponentStateFn =\r\n\t\t\t\tthis.overrideUpdateComponentStateFn?.bind(this);\r\n\t\t\tthis.updateCustomizerSetting = this.updateCustomizerSetting?.bind(this);\r\n\r\n\t\t\tcustomizer.Control.prototype.initialize.call(this, id, params);\r\n\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\tfunction handleOnRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\tif (control !== removedControl) return;\r\n\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\tcustomizer.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t}\r\n\r\n\t\t\tcustomizer.control.bind(\"removed\", handleOnRemoved);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set notification container and render.\r\n\t\t *\r\n\t\t * This will be called when the React component is mounted.\r\n\t\t */\r\n\t\tsetNotificationContainer: function setNotificationContainer(el) {\r\n\t\t\tif (this.notifications) this.notifications.container = jQuery(el);\r\n\t\t\tthis.notifications?.render();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Render the control into the DOM.\r\n\t\t *\r\n\t\t * This will be called from the Control#embed() method in the parent class.\r\n\t\t */\r\n\t\trenderContent: function renderContent() {\r\n\t\t\tif (!this.root && this.container) {\r\n\t\t\t\tthis.root = createRoot(this.container[0]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.root?.render(\r\n\t\t\t\t<InputSliderForm\r\n\t\t\t\t\tid={this.setting?.id ?? \"\"}\r\n\t\t\t\t\tmin={this.params?.min}\r\n\t\t\t\t\tmax={this.params?.max}\r\n\t\t\t\t\tstep={this.params?.step}\r\n\t\t\t\t\tlabel={this.params?.label}\r\n\t\t\t\t\tdescription={this.params?.description}\r\n\t\t\t\t\tdefault={this.params?.default ?? \"\"}\r\n\t\t\t\t\tvalue={this.params?.value ?? \"\"}\r\n\t\t\t\t\tsetNotificationContainer={this.setNotificationContainer}\r\n\t\t\t\t\toverrideUpdateComponentStateFn={this.overrideUpdateComponentStateFn}\r\n\t\t\t\t\tupdateCustomizerSetting={this.updateCustomizerSetting}\r\n\t\t\t\t/>,\r\n\t\t\t);\r\n\r\n\t\t\tif (this.params?.allowCollapse) {\r\n\t\t\t\tthis.container?.addClass(\"allowCollapse\");\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t\t *\r\n\t\t * React is available to be used here instead of the customizer.Element abstraction.\r\n\t\t */\r\n\t\tready: function ready() {\r\n\t\t\t// Update component value's state when customizer setting's value is changed.\r\n\t\t\tthis.setting?.bind((val) => {\r\n\t\t\t\tthis.updateComponentState?.(val);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tupdateCustomizerSetting: function updateCustomizerSetting(val) {\r\n\t\t\tif (val === undefined) return;\r\n\t\t\tthis.setting?.set(val);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will be overriden by the rendered component.\r\n\t\t */\r\n\t\tupdateComponentState: function (val) {},\r\n\r\n\t\toverrideUpdateComponentStateFn: function overrideUpdateComponentStateFn(\r\n\t\t\tfn,\r\n\t\t) {\r\n\t\t\tthis.updateComponentState = fn;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t *\r\n\t\t * This is essentially the inverse of the Control#embed() method.\r\n\t\t *\r\n\t\t * @link https://core.trac.wordpress.org/ticket/31334\r\n\t\t */\r\n\t\tdestroy: function destroy(this: WpbfInputSliderControl) {\r\n\t\t\tthis.root?.unmount();\r\n\t\t\tthis.root = undefined;\r\n\r\n\t\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\t\tcustomizer.Control.prototype.destroy?.call(this);\r\n\t\t},\r\n\t});\r\n}\r\n","import ResponsiveInputSliderControl from \"./ResponsiveInputSliderControl\";\r\n\r\nif (window.wp.customize) {\r\n\t// Register control type with Customizer.\r\n\twindow.wp.customize.controlConstructor[\"wpbf-responsive-input-slider\"] =\r\n\t\tResponsiveInputSliderControl(window.wp.customize);\r\n}\r\n","import { AnyWpbfCustomizeControl } from \"../../Base/src/base-interface\";\r\nimport { createRoot } from \"react-dom/client\";\r\nimport ResponsiveInputSliderForm from \"./ResponsiveInputSliderForm\";\r\nimport {\r\n\tWpbfResponsiveInputSliderControl,\r\n\tWpbfResponsiveInputSliderControlParams,\r\n} from \"./slider-interface\";\r\nimport { DevicesValue } from \"../../Responsive/src/responsive-interface\";\r\n\r\nexport default function ResponsiveInputSliderControl(\r\n\tcustomizer: WpbfCustomize,\r\n) {\r\n\treturn customizer.Control.extend<WpbfResponsiveInputSliderControl>({\r\n\t\tinitialize: function (\r\n\t\t\tid: string,\r\n\t\t\tparams: WpbfResponsiveInputSliderControlParams,\r\n\t\t) {\r\n\t\t\t// Bind functions to this control context for passing as React props.\r\n\t\t\tthis.setNotificationContainer = this.setNotificationContainer?.bind(this);\r\n\t\t\tthis.overrideUpdateComponentStateFn =\r\n\t\t\t\tthis.overrideUpdateComponentStateFn?.bind(this);\r\n\t\t\tthis.updateCustomizerSetting = this.updateCustomizerSetting?.bind(this);\r\n\r\n\t\t\tcustomizer.Control.prototype.initialize.call(this, id, params);\r\n\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// The following should be eliminated with <https://core.trac.wordpress.org/ticket/31334>.\r\n\t\t\tfunction handleOnRemoved(removedControl: AnyWpbfCustomizeControl) {\r\n\t\t\t\tif (control !== removedControl) return;\r\n\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\tcustomizer.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t}\r\n\r\n\t\t\tcustomizer.control.bind(\"removed\", handleOnRemoved);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set notification container and render.\r\n\t\t *\r\n\t\t * This will be called when the React component is mounted.\r\n\t\t */\r\n\t\tsetNotificationContainer: function setNotificationContainer(el) {\r\n\t\t\tif (this.notifications) this.notifications.container = jQuery(el);\r\n\t\t\tthis.notifications?.render();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Render the control into the DOM.\r\n\t\t *\r\n\t\t * This will be called from the Control#embed() method in the parent class.\r\n\t\t */\r\n\t\trenderContent: function renderContent() {\r\n\t\t\tif (!this.root && this.container) {\r\n\t\t\t\tthis.root = createRoot(this.container[0]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.root?.render(\r\n\t\t\t\t<ResponsiveInputSliderForm\r\n\t\t\t\t\tid={this.setting?.id ?? \"\"}\r\n\t\t\t\t\tmin={this.params?.min}\r\n\t\t\t\t\tmax={this.params?.max}\r\n\t\t\t\t\tstep={this.params?.step}\r\n\t\t\t\t\tlabel={this.params?.label}\r\n\t\t\t\t\tdescription={this.params?.description}\r\n\t\t\t\t\tdefault={this.params?.default ?? \"\"}\r\n\t\t\t\t\tvalue={this.params?.value ?? \"\"}\r\n\t\t\t\t\toverrideUpdateComponentStateFn={this.overrideUpdateComponentStateFn}\r\n\t\t\t\t\tupdateCustomizerSetting={this.updateCustomizerSetting}\r\n\t\t\t\t\tsetNotificationContainer={this.setNotificationContainer}\r\n\t\t\t\t\tdevices={this.params?.devices}\r\n\t\t\t\t\tsaveAsJson={this.params?.saveAsJson}\r\n\t\t\t\t/>,\r\n\t\t\t);\r\n\r\n\t\t\tthis.container?.addClass(\"allowCollapse\");\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * After control has been first rendered, start re-rendering when setting changes.\r\n\t\t *\r\n\t\t * React is available to be used here instead of the customizer.Element abstraction.\r\n\t\t */\r\n\t\tready: function ready() {\r\n\t\t\t/**\r\n\t\t\t * Update component value's state when customizer setting's value is changed.\r\n\t\t\t */\r\n\t\t\tthis.setting?.bind((val: string | DevicesValue) => {\r\n\t\t\t\tthis.updateComponentState?.(val);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tupdateCustomizerSetting: function updateCustomizerSetting(val) {\r\n\t\t\tif (val === undefined) return;\r\n\t\t\tthis.setting?.set(val);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This method will be overriden by the rendered component.\r\n\t\t */\r\n\t\tupdateComponentState: (val: string | DevicesValue) => {},\r\n\r\n\t\toverrideUpdateComponentStateFn: function overrideUpdateComponentStateFn(\r\n\t\t\tfn,\r\n\t\t) {\r\n\t\t\tthis.updateComponentState = fn;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t *\r\n\t\t * This is essentially the inverse of the Control#embed() method.\r\n\t\t *\r\n\t\t * @link https://core.trac.wordpress.org/ticket/31334\r\n\t\t */\r\n\t\tdestroy: function destroy() {\r\n\t\t\tthis.root?.unmount();\r\n\t\t\tthis.root = undefined;\r\n\r\n\t\t\t// Call destroy method in parent if it exists (as of #31334).\r\n\t\t\tcustomizer.Control.prototype.destroy?.call(this);\r\n\t\t},\r\n\t});\r\n}\r\n","import { WpbfSortableControl } from \"./sortable-interface\";\r\nimport _ from \"lodash\";\r\n\r\ndeclare var wp: {\r\n\tcustomize: WpbfCustomize;\r\n};\r\n\r\nwp.customize.controlConstructor[\"wpbf-sortable\"] =\r\n\twp.customize.Control.extend<WpbfSortableControl>({\r\n\t\tready: function (this: WpbfSortableControl) {\r\n\t\t\tconst control = this;\r\n\r\n\t\t\t// Handle control removal - trigger destroy when control is removed.\r\n\t\t\tfunction handleOnRemoved(removedControl: WpbfSortableControl) {\r\n\t\t\t\tif (control === removedControl) {\r\n\t\t\t\t\tif (control.destroy) control.destroy();\r\n\t\t\t\t\tcontrol.container?.remove();\r\n\t\t\t\t\twp.customize.control.unbind(\"removed\", handleOnRemoved);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twp.customize.control.bind(\"removed\", handleOnRemoved);\r\n\r\n\t\t\t// Init sortable.\r\n\t\t\tjQuery(control.container.find(\"ul.sortable\").first())\r\n\t\t\t\t.sortable({\r\n\t\t\t\t\t// Update value when we stop sorting.\r\n\t\t\t\t\tupdate: function () {\r\n\t\t\t\t\t\tif (control.setting) {\r\n\t\t\t\t\t\t\tcontrol.setting.set(control.getNewValues!());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t\t.disableSelection()\r\n\t\t\t\t.find(\"li\")\r\n\t\t\t\t.each(function () {\r\n\t\t\t\t\t// Enable/disable options when we click on the eye of Thundera.\r\n\t\t\t\t\tjQuery(this)\r\n\t\t\t\t\t\t.find(\"i.visibility\")\r\n\t\t\t\t\t\t.on(\"click\", function () {\r\n\t\t\t\t\t\t\tjQuery(this)\r\n\t\t\t\t\t\t\t\t.toggleClass(\"dashicons-visibility-faint\")\r\n\t\t\t\t\t\t\t\t.parents(\"li:eq(0)\")\r\n\t\t\t\t\t\t\t\t.toggleClass(\"invisible\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", function () {\r\n\t\t\t\t\t// Update value on click.\r\n\t\t\t\t\tcontrol.setting?.set(control.getNewValues!());\r\n\t\t\t\t});\r\n\t\t},\r\n\r\n\t\tgetNewValues: function (this: WpbfSortableControl) {\r\n\t\t\tconst control = this;\r\n\t\t\tconst items = control.container.find(\"li\");\r\n\t\t\tconst newVal: any[] = [];\r\n\r\n\t\t\t_.each(items, function (item) {\r\n\t\t\t\tif (!item.classList.contains(\"invisible\")) {\r\n\t\t\t\t\tnewVal.push(item.dataset.value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn newVal;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Handle removal/de-registration of the control.\r\n\t\t * Cleans up jQuery Sortable instance and event handlers.\r\n\t\t *\r\n\t\t * @returns {void}\r\n\t\t */\r\n\t\tdestroy: function (this: WpbfSortableControl): void {\r\n\t\t\t// Destroy jQuery Sortable on the sortable list.\r\n\t\t\tconst $sortable = this.container?.find(\"ul.sortable\");\r\n\t\t\tif ($sortable?.data(\"ui-sortable\")) {\r\n\t\t\t\t$sortable.sortable(\"destroy\");\r\n\t\t\t}\r\n\r\n\t\t\t// Unbind all container events.\r\n\t\t\tthis.container?.off();\r\n\t\t},\r\n\t});\r\n","import { BuilderValue, WpbfBuilderControl } from \"./builder-interface\";\r\n\r\n(function () {\r\n\tif (!window.wp.customize) return;\r\n\r\n\twindow.wp.customize.controlConstructor[\"wpbf-builder\"] =\r\n\t\twindow.wp.customize.wpbfDynamicControl.extend<WpbfBuilderControl>({\r\n\t\t\tisSaving: false,\r\n\r\n\t\t\tform: undefined,\r\n\r\n\t\t\tdraggableData: undefined,\r\n\r\n\t\t\temptyWidgetItemMarkup:\r\n\t\t\t\t\"<div class='widget-item empty-widget-item'>&nbsp;</div>\",\r\n\r\n\t\t\tavailableWidgetsPanel: undefined,\r\n\r\n\t\t\tbuilderPanel: undefined,\r\n\r\n\t\t\tinitWpbfControl: function (\r\n\t\t\t\tthis: WpbfBuilderControl,\r\n\t\t\t\tcontrol?: WpbfBuilderControl,\r\n\t\t\t) {\r\n\t\t\t\tcontrol = control || this;\r\n\t\t\t\tif (!control) return;\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Listen to customizer setting change event.\r\n\t\t\t\t * Update component state when customizer setting changed.\r\n\t\t\t\t */\r\n\t\t\t\tcontrol.setting?.bind((value: Record<string, any>) => {\r\n\t\t\t\t\tcontrol.updateComponentState?.(value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcontrol.buildAvailableWidgetsPanel?.();\r\n\t\t\t\tcontrol.buildBuilderPanel?.();\r\n\t\t\t\tcontrol.initDraggable?.();\r\n\t\t\t\tcontrol.initDroppable?.();\r\n\r\n\t\t\t\t// Timeout to wait for the elements to be rendered.\r\n\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\tcontrol.initSortable?.();\r\n\t\t\t\t}, 1);\r\n\t\t\t},\r\n\r\n\t\t\tisSortableEmpty: function (sortableEl) {\r\n\t\t\t\tconst children = this.findHtmlEls?.(sortableEl, \".widget-item\");\r\n\r\n\t\t\t\tif (!children || !children.length) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tconst child = children[i];\r\n\r\n\t\t\t\t\tif (child.classList.contains(\"empty-widget-item\")) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.classList.contains(\"ui-sortable-placeholder\")) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.classList.contains(\"ui-sortable-helper\")) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\r\n\t\t\tisWidgetActive: function (widgetKey) {\r\n\t\t\t\tif (!this.params) return false;\r\n\t\t\t\treturn this.params.builder.activeWidgetKeys.includes(widgetKey);\r\n\t\t\t},\r\n\r\n\t\t\tfindWidgetByKey: function (widgetKey) {\r\n\t\t\t\tif (!this.params) return undefined;\r\n\r\n\t\t\t\tconst availableWidgets = this.params.builder.availableWidgets;\r\n\t\t\t\tif (!availableWidgets.length) return undefined;\r\n\r\n\t\t\t\tfor (const widget of availableWidgets) {\r\n\t\t\t\t\tif (widget.key === widgetKey) {\r\n\t\t\t\t\t\treturn widget;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn undefined;\r\n\t\t\t},\r\n\r\n\t\t\tbuildAvailableWidgetsPanel: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tif (!control.container) return;\r\n\r\n\t\t\t\tconst params = control.params;\r\n\t\t\t\tif (!params) return;\r\n\r\n\t\t\t\tconst availableWidgetsPanel = control.findHtmlEl?.(\r\n\t\t\t\t\tcontrol.container[0],\r\n\t\t\t\t\t\".available-widgets-panel\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!availableWidgetsPanel) return;\r\n\r\n\t\t\t\tcontrol.availableWidgetsPanel = availableWidgetsPanel;\r\n\r\n\t\t\t\tjQuery(document.body).append('<div class=\"widget-drag-helper\"></div>');\r\n\r\n\t\t\t\tconst availableWidgets = params.builder.availableWidgets;\r\n\r\n\t\t\t\tconst $availableWidgetListEl = jQuery(\"<div></div>\")\r\n\t\t\t\t\t.addClass(\"builder-widgets available-widgets\")\r\n\t\t\t\t\t.appendTo(control.availableWidgetsPanel);\r\n\r\n\t\t\t\t// Build the available widgets list based on `availableWidgets`.\r\n\t\t\t\tavailableWidgets.forEach((widget) => {\r\n\t\t\t\t\tconst widgetKey = widget.key;\r\n\r\n\t\t\t\t\tconst $widgetItem = jQuery(\"<div></div>\");\r\n\r\n\t\t\t\t\t$widgetItem\r\n\t\t\t\t\t\t.addClass(\r\n\t\t\t\t\t\t\t`widget-item widget-item-${widgetKey} ${control.isWidgetActive?.(widgetKey) ? \"disabled\" : \"\"}`,\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.attr(\"data-widget-key\", widgetKey)\r\n\t\t\t\t\t\t.attr(\"draggable\", \"true\")\r\n\t\t\t\t\t\t.html(`<span class=\"widget-label\">${widget.label}</span>`)\r\n\t\t\t\t\t\t.on(\"click\", function (e) {\r\n\t\t\t\t\t\t\tcontrol.handleWidgetClick?.(this, widget);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.appendTo($availableWidgetListEl);\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tbuildBuilderPanel: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst params = control.params;\r\n\t\t\t\tif (!params) return;\r\n\r\n\t\t\t\tconst availableRows = params.builder.availableRows;\r\n\t\t\t\tconst availableWidgets = params.builder.availableWidgets;\r\n\t\t\t\tif (!availableRows || !availableWidgets) return;\r\n\r\n\t\t\t\tconst customizePreview = control.findHtmlEl?.(\"#customize-preview\");\r\n\t\t\t\tif (!customizePreview) return;\r\n\r\n\t\t\t\t// Create the panel.\r\n\t\t\t\tconst $builderPanel = jQuery(\"<div></div>\")\r\n\t\t\t\t\t.addClass(`wpbf-builder-panel ${params.id}-builder-panel`)\r\n\t\t\t\t\t.attr(\"data-wpbf-builder-panel\", params.id)\r\n\t\t\t\t\t.insertAfter(customizePreview);\r\n\r\n\t\t\t\tavailableRows.forEach((row) => {\r\n\t\t\t\t\t// Build the row.\r\n\t\t\t\t\tconst $row = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t.addClass(`builder-row`)\r\n\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\r\n\t\t\t\t\t\t.appendTo($builderPanel);\r\n\r\n\t\t\t\t\t// Build the inner row.\r\n\t\t\t\t\tconst $innerRow = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t.addClass(`builder-inner-row`)\r\n\t\t\t\t\t\t.appendTo($row);\r\n\r\n\t\t\t\t\t// Build the row label (tooltip)\r\n\t\t\t\t\tjQuery(\"<div></div>\")\r\n\t\t\t\t\t\t.addClass(\"row-label\")\r\n\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\r\n\t\t\t\t\t\t.text(row.label)\r\n\t\t\t\t\t\t.appendTo($row);\r\n\r\n\t\t\t\t\t// Build the row setting button.\r\n\t\t\t\t\tjQuery(\"<button></button>\")\r\n\t\t\t\t\t\t.addClass(\"row-setting-button\")\r\n\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\r\n\t\t\t\t\t\t.html('<i class=\"dashicons dashicons-admin-generic\"></i>')\r\n\t\t\t\t\t\t.on(\"click\", () => control.handleRowSettingClick?.(row.key))\r\n\t\t\t\t\t\t.appendTo($row);\r\n\r\n\t\t\t\t\tconst matchedRow = params.value[row.key];\r\n\r\n\t\t\t\t\trow.columns.forEach((column, columnIndex) => {\r\n\t\t\t\t\t\tlet columnPosClass = \"\";\r\n\r\n\t\t\t\t\t\tif (column.key.endsWith(\"_start\")) {\r\n\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-start\";\r\n\t\t\t\t\t\t} else if (column.key.endsWith(\"_end\")) {\r\n\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-end\";\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (columnIndex !== 0 && columnIndex !== row.columns.length - 1) {\r\n\t\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-center column-middle\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (columnIndex === 0) {\r\n\t\t\t\t\t\t\tcolumnPosClass += \" column-start wpbf-content-start\";\r\n\t\t\t\t\t\t} else if (columnIndex === row.columns.length - 1) {\r\n\t\t\t\t\t\t\tcolumnPosClass += \" column-end wpbf-content-end\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst $widgetListEl = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\r\n\t\t\t\t\t\t\t\t`builder-widgets builder-column sortable-widgets wpbf-flex ${columnPosClass}`,\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.attr(\"data-column-key\", column.key)\r\n\t\t\t\t\t\t\t.appendTo($innerRow);\r\n\r\n\t\t\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\r\n\r\n\t\t\t\t\t\tif (!matchedRow || !Object.keys(matchedRow).length) {\r\n\t\t\t\t\t\t\t$widgetListEl.addClass(emptyWidgetListClass);\r\n\t\t\t\t\t\t\t$widgetListEl.html(control.emptyWidgetItemMarkup ?? \"\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst matchedColumn = matchedRow[column.key];\r\n\r\n\t\t\t\t\t\tif (!matchedColumn || !matchedColumn.length) {\r\n\t\t\t\t\t\t\t$widgetListEl.addClass(emptyWidgetListClass);\r\n\t\t\t\t\t\t\t$widgetListEl.html(control.emptyWidgetItemMarkup ?? \"\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Build the widget list based on `matchedColumn`.\r\n\t\t\t\t\t\tmatchedColumn.forEach((widgetKey) => {\r\n\t\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(widgetKey, true);\r\n\t\t\t\t\t\t\tif (!newWidgetItem) return;\r\n\r\n\t\t\t\t\t\t\t$widgetListEl.append(newWidgetItem);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcontrol.bindCustomizeSection?.(row.key);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcontrol.builderPanel = $builderPanel[0];\r\n\t\t\t},\r\n\r\n\t\t\thandleRowSettingClick: function (rowKey) {\r\n\t\t\t\tconst controlId = this.params?.id;\r\n\t\t\t\tif (!controlId) return;\r\n\r\n\t\t\t\twindow.wp.customize?.section(\r\n\t\t\t\t\t`${controlId}_${rowKey}_section`,\r\n\t\t\t\t\tfunction (section) {\r\n\t\t\t\t\t\tsection.expand(section.params);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t},\r\n\r\n\t\t\tbindCustomizeSection: function (rowKey) {\r\n\t\t\t\tconst controlId = this.params?.id;\r\n\t\t\t\tif (!controlId) return;\r\n\r\n\t\t\t\twindow.wp.customize?.section(\r\n\t\t\t\t\t`${controlId}_${rowKey}_section`,\r\n\t\t\t\t\tfunction (section) {\r\n\t\t\t\t\t\tsection.expanded.bind(function (expanded) {\r\n\t\t\t\t\t\t\tconst row = document.querySelector(\r\n\t\t\t\t\t\t\t\t`.builder-row[data-row-key=\"${rowKey}\"]`,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tif (!row) return;\r\n\r\n\t\t\t\t\t\t\tif (expanded) {\r\n\t\t\t\t\t\t\t\trow.classList.add(\"is-active\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trow.classList.remove(\"is-active\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t},\r\n\r\n\t\t\thandleWidgetClick: function (widgetEl, widgetData) {\r\n\t\t\t\t// If this is from the available widgets panel.\r\n\t\t\t\tif (!widgetEl.classList.contains(\"ui-sortable-handle\")) {\r\n\t\t\t\t\tif (!widgetEl.classList.contains(\"disabled\")) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!widgetData.section) return;\r\n\r\n\t\t\t\tconst connectedSection = window.wp.customize?.section(\r\n\t\t\t\t\twidgetData.section,\r\n\t\t\t\t);\r\n\t\t\t\tif (!connectedSection || !connectedSection.params) return;\r\n\r\n\t\t\t\tconnectedSection.expand(connectedSection.params);\r\n\t\t\t},\r\n\r\n\t\t\tinitDraggable: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst params = control.params;\r\n\r\n\t\t\t\tif (!params) return;\r\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\r\n\r\n\t\t\t\tconst dragHelper = control.findHtmlEl?.(\".widget-drag-helper\");\r\n\t\t\t\tif (!dragHelper) return;\r\n\r\n\t\t\t\tconst availableWidgetItems = control.findHtmlEls?.(\r\n\t\t\t\t\tcontrol.availableWidgetsPanel,\r\n\t\t\t\t\t\".widget-item\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!availableWidgetItems || !availableWidgetItems.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tavailableWidgetItems.forEach((item) => {\r\n\t\t\t\t\tif (!(item instanceof HTMLElement)) return;\r\n\r\n\t\t\t\t\titem.addEventListener(\"dragstart\", function (e) {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\r\n\t\t\t\t\t\tdocument.body.classList.add(\"is-dragging-widget\");\r\n\t\t\t\t\t\titem.classList.add(\"is-dragging\");\r\n\t\t\t\t\t\tdragHelper.classList.add(\"is-shown\");\r\n\r\n\t\t\t\t\t\tconst widgetKey = item.dataset.widgetKey;\r\n\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Set the data to be transferred.\r\n\t\t\t\t\t\t * We use both e.dataTransfer and control.draggableData to store the data.\r\n\t\t\t\t\t\t * Because e.dataTransfer can't be accessed from \"dragenter\" and \"dragover\" event.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tcontrol.draggableData = { widgetKey };\r\n\t\t\t\t\t\te.dataTransfer?.setData(\"text\", JSON.stringify({ widgetKey }));\r\n\r\n\t\t\t\t\t\tdragHelper.innerHTML = item.outerHTML;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * The visualDragHelper is a direct body child element with position: fixed, left: 0, and top: 0.\r\n\t\t\t\t\t\t * We need to set the position of the dragVisualHelper to be in the same position of current `item` (.wiget-item).\r\n\t\t\t\t\t\t * Meaning, we need to get the top and left position of the current event element and set the fixed position of the dragVisualHelper.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tconst draggedElRect = item.getBoundingClientRect();\r\n\t\t\t\t\t\tconst draggedElFixedLeftPos = draggedElRect.left;\r\n\t\t\t\t\t\tconst draggedElFixedTopPos = draggedElRect.top;\r\n\r\n\t\t\t\t\t\tdragHelper.style.left = draggedElFixedLeftPos + \"px\";\r\n\t\t\t\t\t\tdragHelper.style.top = draggedElFixedTopPos + \"px\";\r\n\r\n\t\t\t\t\t\tconst dragHelperInnerEl = control.findHtmlEl?.(\r\n\t\t\t\t\t\t\tdragHelper,\r\n\t\t\t\t\t\t\t\".widget-item\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tconst innerElRect = dragHelperInnerEl?.getBoundingClientRect();\r\n\t\t\t\t\t\tconst dragHelperInnerElWidth = innerElRect?.width || 80;\r\n\r\n\t\t\t\t\t\tdragHelper.style.width = dragHelperInnerElWidth + \"px\";\r\n\r\n\t\t\t\t\t\te.dataTransfer?.setDragImage(dragHelper, 0, 0);\r\n\r\n\t\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t\tdragHelper.classList.remove(\"is-shown\");\r\n\t\t\t\t\t\t}, 10);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\titem.addEventListener(\"dragend\", function (e) {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\titem.classList.remove(\"is-dragging\");\r\n\t\t\t\t\t\tdocument.body.classList.remove(\"is-dragging-widget\");\r\n\r\n\t\t\t\t\t\tdragHelper.classList.remove(\"is-shown\");\r\n\t\t\t\t\t\tdragHelper.innerHTML = \"\";\r\n\t\t\t\t\t\tdragHelper.removeAttribute(\"style\");\r\n\r\n\t\t\t\t\t\tcontrol.draggableData = undefined;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tinitDroppable: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst params = control.params;\r\n\r\n\t\t\t\tif (!params) return;\r\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\r\n\r\n\t\t\t\tconst builderDropZones = control.findHtmlEls?.(\r\n\t\t\t\t\tcontrol.builderPanel,\r\n\t\t\t\t\t\".builder-column\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!builderDropZones || !builderDropZones.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbuilderDropZones.forEach((dropZone) => {\r\n\t\t\t\t\tdropZone.addEventListener(\"dragenter\", function (e) {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tdropZone.classList.add(\"dragover\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// This empty block is necessary to let the dropZone accept the drop event.\r\n\t\t\t\t\tdropZone.addEventListener(\"dragover\", function (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdropZone.addEventListener(\"dragleave\", function (e) {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tdropZone.classList.remove(\"dragover\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdropZone.addEventListener(\"drop\", function (e) {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tdropZone.classList.remove(\"dragover\");\r\n\r\n\t\t\t\t\t\tconst widgetItem = control.getWidgetItemFromDraggableData?.(e);\r\n\t\t\t\t\t\tif (!widgetItem) return;\r\n\r\n\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\r\n\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(widgetKey, true);\r\n\t\t\t\t\t\tif (!newWidgetItem) return;\r\n\r\n\t\t\t\t\t\tconst temporaryWidgetItem = dropZone.querySelector(\r\n\t\t\t\t\t\t\t\".ui-sortable-placeholder.from-available-widgets\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (temporaryWidgetItem) {\r\n\t\t\t\t\t\t\tdropZone.removeChild(temporaryWidgetItem);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (dropZone.classList.contains(\"column-end\")) {\r\n\t\t\t\t\t\t\tdropZone.insertBefore(newWidgetItem, dropZone.firstChild);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdropZone.appendChild(newWidgetItem);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst emptyWidgetItem =\r\n\t\t\t\t\t\t\tdropZone.querySelector(\".empty-widget-item\");\r\n\r\n\t\t\t\t\t\tif (emptyWidgetItem) {\r\n\t\t\t\t\t\t\temptyWidgetItem.remove();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Now refresh the sortable.\r\n\t\t\t\t\t\tjQuery(dropZone).sortable(\"refresh\");\r\n\r\n\t\t\t\t\t\twidgetItem.classList.add(\"disabled\");\r\n\t\t\t\t\t\tcontrol.draggableData = undefined;\r\n\t\t\t\t\t\tcontrol.updateCustomizerSetting?.();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tparseDraggableData: function (e) {\r\n\t\t\t\tconst data = e.dataTransfer?.getData(\"text\");\r\n\t\t\t\tif (!data) return undefined;\r\n\r\n\t\t\t\tlet parsedJson: undefined | Record<string, any> = undefined;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tparsedJson = JSON.parse(data);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(\"Error parsing JSON data:\", e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!parsedJson) return undefined;\r\n\r\n\t\t\t\treturn parsedJson;\r\n\t\t\t},\r\n\r\n\t\t\tgetWidgetItemFromDraggableData: function (e) {\r\n\t\t\t\tconst data = e.dataTransfer?.getData(\"text\");\r\n\t\t\t\tif (!data) return undefined;\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tconst parsedJson = this.parseDraggableData?.(e);\r\n\t\t\t\tif (!parsedJson) return undefined;\r\n\r\n\t\t\t\tconst widgetKey = parsedJson.widgetKey;\r\n\t\t\t\tif (!widgetKey) return undefined;\r\n\r\n\t\t\t\tconst widgetItem = control.findHtmlEl?.(\r\n\t\t\t\t\tthis.availableWidgetsPanel,\r\n\t\t\t\t\t`.widget-item[data-widget-key=\"${widgetKey}\"]`,\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn widgetItem;\r\n\t\t\t},\r\n\r\n\t\t\tcreateWidgetItem: function (widgetKey, insideBuilderPanel) {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst widgetData = control.findWidgetByKey?.(widgetKey);\r\n\t\t\t\tif (!widgetData) return undefined;\r\n\r\n\t\t\t\tconst widgetItemToClone = control.findHtmlEl?.(\r\n\t\t\t\t\tcontrol.availableWidgetsPanel,\r\n\t\t\t\t\t`.widget-item[data-widget-key=\"${widgetKey}\"]`,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!widgetItemToClone) return undefined;\r\n\r\n\t\t\t\tconst newWidgetItem = widgetItemToClone.cloneNode(true);\r\n\t\t\t\tif (!(newWidgetItem instanceof HTMLElement)) return undefined;\r\n\r\n\t\t\t\tnewWidgetItem.classList.remove(\"disabled\");\r\n\t\t\t\tnewWidgetItem.classList.remove(\"is-dragging\");\r\n\t\t\t\tnewWidgetItem.removeAttribute(\"draggable\");\r\n\r\n\t\t\t\tif (insideBuilderPanel) {\r\n\t\t\t\t\tconst deleteButton = document.createElement(\"button\");\r\n\t\t\t\t\tdeleteButton.type = \"button\";\r\n\t\t\t\t\tdeleteButton.className = \"widget-button delete-widget-button\";\r\n\t\t\t\t\tdeleteButton.innerHTML = '<i class=\"dashicons dashicons-no-alt\"></i>';\r\n\t\t\t\t\tnewWidgetItem.appendChild(deleteButton);\r\n\r\n\t\t\t\t\tdeleteButton.addEventListener(\"click\", function (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\tcontrol.handleDeleteActiveWidget?.(\r\n\t\t\t\t\t\t\tnewWidgetItem,\r\n\t\t\t\t\t\t\twidgetItemToClone,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tnewWidgetItem.addEventListener(\"click\", function (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tcontrol.handleWidgetClick?.(this, widgetData);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn newWidgetItem;\r\n\t\t\t},\r\n\r\n\t\t\tinitSortable: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst params = control.params;\r\n\r\n\t\t\t\tif (!params) return;\r\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\r\n\r\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\r\n\t\t\t\tconst $builderPanel = jQuery(control.builderPanel);\r\n\r\n\t\t\t\t// Scope sortable to this specific builder panel only.\r\n\t\t\t\tconst $sortableWidgets = $builderPanel.find(\".sortable-widgets\");\r\n\t\t\t\tconst $builderColumns = $builderPanel.find(\".builder-column\");\r\n\r\n\t\t\t\t$sortableWidgets.sortable({\r\n\t\t\t\t\tconnectWith: $builderColumns,\r\n\t\t\t\t\tplaceholder: \"widget-item\",\r\n\t\t\t\t\tstart: function (e, ui) {\r\n\t\t\t\t\t\tdocument.body.classList.add(\"is-sorting-widget\");\r\n\r\n\t\t\t\t\t\tconst labelEl = control.findHtmlEl?.(ui.item[0], \".widget-label\");\r\n\r\n\t\t\t\t\t\tif (labelEl) {\r\n\t\t\t\t\t\t\tui.placeholder[0].appendChild(labelEl.cloneNode(true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tupdate: function (e, ui) {\r\n\t\t\t\t\t\tconst sortableEl = e.target;\r\n\t\t\t\t\t\tif (!(sortableEl instanceof HTMLElement)) return;\r\n\r\n\t\t\t\t\t\tcontrol.checkSortableContent?.(sortableEl);\r\n\t\t\t\t\t\tcontrol.updateCustomizerSetting?.();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstop: function (e, ui) {\r\n\t\t\t\t\t\tdocument.body.classList.remove(\"is-sorting-widget\");\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$builderPanel.find(\".builder-column.column-middle\").on(\r\n\t\t\t\t\t\"sortover\",\r\n\t\t\t\t\tfunction (e, ui) {\r\n\t\t\t\t\t\tconst target = e.target;\r\n\t\t\t\t\t\ttarget.classList.remove(emptyWidgetListClass);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\r\n\t\t\t\t$builderPanel\r\n\t\t\t\t\t.find(\".builder-column.column-middle\")\r\n\t\t\t\t\t.on(\"sortout\", function (e, ui) {\r\n\t\t\t\t\t\tcontrol.checkSortableContent?.(e.target);\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\thandleDeleteActiveWidget: function (activeWidgetEl, availableWidgetEl) {\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tavailableWidgetEl?.classList.remove(\"disabled\");\r\n\r\n\t\t\t\tconst sortableEL = activeWidgetEl.closest(\".sortable-widgets\");\r\n\r\n\t\t\t\tactiveWidgetEl.remove();\r\n\r\n\t\t\t\tif (sortableEL instanceof HTMLElement) {\r\n\t\t\t\t\tcontrol.checkSortableContent?.(sortableEL);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (sortableEL) {\r\n\t\t\t\t\tjQuery(sortableEL).sortable(\"refresh\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontrol.updateCustomizerSetting?.();\r\n\t\t\t},\r\n\r\n\t\t\tcheckSortableContent: function (sortableEl) {\r\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\r\n\t\t\t\tconst emptyWidgetItemClass = \"empty-widget-item\";\r\n\r\n\t\t\t\tconst emptyWidgetItem = sortableEl.querySelector(\r\n\t\t\t\t\t\".\" + emptyWidgetItemClass,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (this.isSortableEmpty?.(sortableEl)) {\r\n\t\t\t\t\tsortableEl.classList.add(emptyWidgetListClass);\r\n\r\n\t\t\t\t\tif (!emptyWidgetItem) {\r\n\t\t\t\t\t\tjQuery(sortableEl).append(this.emptyWidgetItemMarkup ?? \"\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsortableEl.classList.remove(emptyWidgetListClass);\r\n\r\n\t\t\t\t\tif (emptyWidgetItem) {\r\n\t\t\t\t\t\temptyWidgetItem.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tdestroySortable: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\r\n\r\n\t\t\t\tjQuery(\".builder-column\").sortable(\"destroy\");\r\n\t\t\t},\r\n\r\n\t\t\tupdateCustomizerSetting: function () {\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tif (control.isSaving) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontrol.isSaving = true;\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tconst builderRows = control.findHtmlEls?.(\r\n\t\t\t\t\t\tcontrol.builderPanel,\r\n\t\t\t\t\t\t\".builder-row\",\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (!builderRows || !builderRows.length) {\r\n\t\t\t\t\t\tcontrol.isSaving = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst values: BuilderValue = {};\r\n\r\n\t\t\t\t\tbuilderRows.forEach((row) => {\r\n\t\t\t\t\t\tconst rowKey = row.dataset.rowKey;\r\n\t\t\t\t\t\tif (!rowKey) return;\r\n\r\n\t\t\t\t\t\tvalues[rowKey] = {};\r\n\r\n\t\t\t\t\t\tconst sortableColumns = control.findHtmlEls?.(\r\n\t\t\t\t\t\t\trow,\r\n\t\t\t\t\t\t\t\".builder-column.sortable-widgets\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (!sortableColumns || !sortableColumns.length) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsortableColumns.forEach((column) => {\r\n\t\t\t\t\t\t\tconst columnKey = column.dataset.columnKey;\r\n\t\t\t\t\t\t\tif (!columnKey) return;\r\n\r\n\t\t\t\t\t\t\tvalues[rowKey][columnKey] = [];\r\n\r\n\t\t\t\t\t\t\tconst widgetItems = control.findHtmlEls?.(column, \".widget-item\");\r\n\r\n\t\t\t\t\t\t\tif (!widgetItems || !widgetItems.length) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\twidgetItems.forEach((widgetItem) => {\r\n\t\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"empty-widget-item\")) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"ui-sortable-placeholder\")) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\r\n\t\t\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\t\t\tvalues[rowKey][columnKey].push(widgetKey);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tcontrol.setting?.set(values);\r\n\t\t\t\t\tcontrol.isSaving = false;\r\n\t\t\t\t}, 1);\r\n\t\t\t},\r\n\r\n\t\t\tupdateComponentState: function (\r\n\t\t\t\tthis: WpbfBuilderControl,\r\n\t\t\t\tvalue: Record<string, any>,\r\n\t\t\t) {\r\n\t\t\t\t// Update available-widgets & sortable-widgets.\r\n\t\t\t},\r\n\t\t});\r\n})();\r\n","import {\r\n\tResponsiveBuilderValue,\r\n\tWpbfResponsiveBuilderControl,\r\n} from \"./builder-interface\";\r\n\r\n(function (customizer: WpbfCustomize | undefined) {\r\n\tconst allowedDevices = [\"desktop\", \"mobile\"];\r\n\r\n\tif (!customizer) return;\r\n\r\n\tcustomizer.controlConstructor[\"wpbf-responsive-builder\"] =\r\n\t\tcustomizer.wpbfDynamicControl.extend<WpbfResponsiveBuilderControl>({\r\n\t\t\tisSaving: false,\r\n\r\n\t\t\tdraggableData: undefined,\r\n\r\n\t\t\temptyWidgetItemMarkup:\r\n\t\t\t\t\"<div class='widget-item empty-widget-item'>&nbsp;</div>\",\r\n\r\n\t\t\tavailableWidgetsPanels: {\r\n\t\t\t\tdesktop: undefined,\r\n\t\t\t\tmobile: undefined,\r\n\t\t\t},\r\n\r\n\t\t\tbuilderPanel: undefined,\r\n\r\n\t\t\tinitWpbfControl: function (ctrl) {\r\n\t\t\t\tconst control = ctrl ?? this;\r\n\t\t\t\tif (!control) return;\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Listen to customizer setting change event.\r\n\t\t\t\t * Update component state when customizer setting changed.\r\n\t\t\t\t */\r\n\t\t\t\tcontrol.setting?.bind((value) => {\r\n\t\t\t\t\tcontrol.updateComponentState?.(value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcontrol.buildAvailableWidgetsPanel?.();\r\n\t\t\t\tcontrol.buildBuilderPanel?.();\r\n\t\t\t\tcontrol.initDraggable?.();\r\n\t\t\t\tcontrol.initDroppable?.();\r\n\r\n\t\t\t\t// Timeout to wait for the elements to be rendered.\r\n\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\tcontrol.initSortable?.();\r\n\t\t\t\t}, 1);\r\n\t\t\t},\r\n\r\n\t\t\tisSortableEmpty: function (sortableEl) {\r\n\t\t\t\tconst children = this.findHtmlEls?.(sortableEl, \".widget-item\");\r\n\r\n\t\t\t\tif (!children || !children.length) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\r\n\t\t\t\t\tconst child = children[i];\r\n\r\n\t\t\t\t\tif (child.classList.contains(\"empty-widget-item\")) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.classList.contains(\"ui-sortable-placeholder\")) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.classList.contains(\"ui-sortable-helper\")) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\r\n\t\t\tisWidgetActive: function (widgetKey, device) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t!this.params ||\r\n\t\t\t\t\t!device ||\r\n\t\t\t\t\t(device !== \"desktop\" && device !== \"mobile\")\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst activeWidgetKeys = this.params.builder[device].activeWidgetKeys;\r\n\t\t\t\tif (!activeWidgetKeys.length) return false;\r\n\r\n\t\t\t\treturn activeWidgetKeys.includes(widgetKey);\r\n\t\t\t},\r\n\r\n\t\t\tfindWidgetByKey: function (widgetKey, device) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t!this.params ||\r\n\t\t\t\t\t!device ||\r\n\t\t\t\t\t(device !== \"desktop\" && device !== \"mobile\")\r\n\t\t\t\t) {\r\n\t\t\t\t\treturn undefined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst availableWidgets = this.params.builder[device].availableWidgets;\r\n\t\t\t\tif (!availableWidgets.length) return undefined;\r\n\r\n\t\t\t\tfor (const widget of availableWidgets) {\r\n\t\t\t\t\tif (widget.key === widgetKey) {\r\n\t\t\t\t\t\treturn widget;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn undefined;\r\n\t\t\t},\r\n\r\n\t\t\tbuildAvailableWidgetsPanel: function () {\r\n\t\t\t\tif (!this.container) return;\r\n\r\n\t\t\t\tconst params = this.params;\r\n\t\t\t\tif (!params) return;\r\n\r\n\t\t\t\tconst controlForm = this.findHtmlEl?.(\r\n\t\t\t\t\tthis.container[0],\r\n\t\t\t\t\t\".wpbf-control-form\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!controlForm) return;\r\n\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tif (!this.availableWidgetsPanels) return;\r\n\r\n\t\t\t\tfor (const device in params.builder) {\r\n\t\t\t\t\tif (!params.builder.hasOwnProperty(device)) continue;\r\n\t\t\t\t\tif (device !== \"desktop\" && device !== \"mobile\") continue;\r\n\t\t\t\t\tif (!params.builder[device].availableWidgets.length) continue;\r\n\r\n\t\t\t\t\tconst $availableWidgetPanel = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t.addClass(\"available-widgets-panel\")\r\n\t\t\t\t\t\t.attr(\"data-device\", device)\r\n\t\t\t\t\t\t.appendTo(controlForm);\r\n\r\n\t\t\t\t\tthis.availableWidgetsPanels[device] = $availableWidgetPanel[0];\r\n\r\n\t\t\t\t\tconst $availableWidgetListEl = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t.addClass(\"builder-widgets available-widgets\")\r\n\t\t\t\t\t\t.appendTo(this.availableWidgetsPanels[device]);\r\n\r\n\t\t\t\t\tconst availableWidgets = params.builder[device].availableWidgets;\r\n\r\n\t\t\t\t\t// Build the available widgets list based on `availableWidgets`.\r\n\t\t\t\t\tavailableWidgets.forEach((widget) => {\r\n\t\t\t\t\t\tconst widgetKey = widget.key;\r\n\r\n\t\t\t\t\t\tjQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\r\n\t\t\t\t\t\t\t\t`widget-item widget-item-${widgetKey} ${control.isWidgetActive?.(widgetKey, device) ? \"disabled\" : \"\"}`,\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.attr(\"data-widget-key\", widgetKey)\r\n\t\t\t\t\t\t\t.attr(\"draggable\", \"true\")\r\n\t\t\t\t\t\t\t.html(`<span class=\"widget-label\">${widget.label}</span>`)\r\n\t\t\t\t\t\t\t.on(\"click\", function (e) {\r\n\t\t\t\t\t\t\t\tcontrol.handleWidgetClick?.(this, widget);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.appendTo($availableWidgetListEl);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tjQuery(document.body).append('<div class=\"widget-drag-helper\"></div>');\r\n\t\t\t},\r\n\r\n\t\t\tbuildBuilderPanel: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst params = control.params;\r\n\t\t\t\tif (!params) return;\r\n\r\n\t\t\t\tconst customizePreview = control.findHtmlEl?.(\"#customize-preview\");\r\n\t\t\t\tif (!customizePreview) return;\r\n\r\n\t\t\t\t// Create the panel.\r\n\t\t\t\tconst $builderPanel = jQuery(\"<div></div>\")\r\n\t\t\t\t\t.addClass(`wpbf-builder-panel ${params.id}-builder-panel`)\r\n\t\t\t\t\t.attr(\"data-wpbf-builder-panel\", params.id)\r\n\t\t\t\t\t.insertAfter(customizePreview);\r\n\r\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\r\n\r\n\t\t\t\tfor (const device in params.builder) {\r\n\t\t\t\t\tif (!params.builder.hasOwnProperty(device)) continue;\r\n\t\t\t\t\tif (device !== \"desktop\" && device !== \"mobile\") continue;\r\n\t\t\t\t\tif (!params.builder[device].availableWidgets.length) continue;\r\n\r\n\t\t\t\t\tconst $builderSlotsEl = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t.addClass(\"wpbf-builder-slots\")\r\n\t\t\t\t\t\t.attr(\"data-device\", device)\r\n\t\t\t\t\t\t.appendTo($builderPanel);\r\n\r\n\t\t\t\t\tconst availableWidgets = params.builder[device].availableWidgets;\r\n\t\t\t\t\tif (!availableWidgets.length) return;\r\n\r\n\t\t\t\t\tlet $mobileBuilderRows: JQuery<HTMLElement> | undefined = undefined;\r\n\r\n\t\t\t\t\tif (params.builder[device].availableSlots.offcanvas) {\r\n\t\t\t\t\t\t$builderSlotsEl.addClass(`wpbf-flex wpbf-content-center`);\r\n\r\n\t\t\t\t\t\tconst $builderOffcanvas = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\"builder-offcanvas\")\r\n\t\t\t\t\t\t\t.appendTo($builderSlotsEl);\r\n\r\n\t\t\t\t\t\t// Check if this is a premium-locked offcanvas (desktop only when not premium).\r\n\t\t\t\t\t\tconst isLockedOffcanvas =\r\n\t\t\t\t\t\t\tdevice === \"desktop\" && !params.isPremium;\r\n\r\n\t\t\t\t\t\tif (isLockedOffcanvas) {\r\n\t\t\t\t\t\t\t$builderOffcanvas.addClass(\"wpbf-premium-locked\");\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst $builderInnerOffcanvas = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\"builder-inner-offcanvas sortable-group\")\r\n\t\t\t\t\t\t\t.appendTo($builderOffcanvas);\r\n\r\n\t\t\t\t\t\t// Build the row setting button.\r\n\t\t\t\t\t\tjQuery(\"<button></button>\")\r\n\t\t\t\t\t\t\t.attr(\"type\", \"button\")\r\n\t\t\t\t\t\t\t.addClass(\"row-setting-button\")\r\n\t\t\t\t\t\t\t.html(\r\n\t\t\t\t\t\t\t\t`<i class=\"dashicons dashicons-admin-generic\"></i><span class=\"button-label\">${params.builder[device].availableSlots.offcanvas.label}</span>`,\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.on(\"click\", () =>\r\n\t\t\t\t\t\t\t\tcontrol.handleRowSettingClick?.(\r\n\t\t\t\t\t\t\t\t\tparams.builder[device].availableSlots.offcanvas.key,\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.appendTo($builderInnerOffcanvas);\r\n\r\n\t\t\t\t\t\tconst $offcanvasWidgetsEl = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\"builder-widgets active-widgets dotted-border\")\r\n\t\t\t\t\t\t\t.appendTo($builderInnerOffcanvas);\r\n\r\n\t\t\t\t\t\t// Add premium overlay for locked desktop offcanvas.\r\n\t\t\t\t\t\tif (isLockedOffcanvas) {\r\n\t\t\t\t\t\t\t$offcanvasWidgetsEl.addClass(\"wpbf-premium-locked-dropzone\");\r\n\r\n\t\t\t\t\t\t\tjQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t\t.addClass(\"wpbf-premium-overlay\")\r\n\t\t\t\t\t\t\t\t.html(\r\n\t\t\t\t\t\t\t\t\t`<div class=\"wpbf-premium-overlay-content\">\r\n\t\t\t\t\t\t\t\t\t\t<span class=\"dashicons dashicons-lock\"></span>\r\n\t\t\t\t\t\t\t\t\t\t<p>Premium Feature</p>\r\n\t\t\t\t\t\t\t\t\t</div>`,\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t.appendTo($offcanvasWidgetsEl);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (params.value && !isLockedOffcanvas) {\r\n\t\t\t\t\t\t\t// Build the widget list based on `params.value`.\r\n\t\t\t\t\t\t\tparams.value[device].offcanvas?.forEach((widgetKey) => {\r\n\t\t\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(\r\n\t\t\t\t\t\t\t\t\twidgetKey,\r\n\t\t\t\t\t\t\t\t\ttrue,\r\n\t\t\t\t\t\t\t\t\tdevice,\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tif (!newWidgetItem) return;\r\n\r\n\t\t\t\t\t\t\t\t$offcanvasWidgetsEl.append(newWidgetItem);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$mobileBuilderRows = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\"builder-rows\")\r\n\t\t\t\t\t\t\t.appendTo($builderSlotsEl);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst availableSlots = params.builder[device].availableSlots;\r\n\t\t\t\t\tif (!availableSlots.rows.length) continue;\r\n\r\n\t\t\t\t\tconst $rowsWrapper = $mobileBuilderRows\r\n\t\t\t\t\t\t? $mobileBuilderRows\r\n\t\t\t\t\t\t: $builderSlotsEl;\r\n\r\n\t\t\t\t\tavailableSlots.rows.forEach((row) => {\r\n\t\t\t\t\t\t// Build the row.\r\n\t\t\t\t\t\tconst $row = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(`builder-row sortable-group`)\r\n\t\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\r\n\t\t\t\t\t\t\t.appendTo($rowsWrapper);\r\n\r\n\t\t\t\t\t\t// Build the inner row.\r\n\t\t\t\t\t\tconst $innerRow = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(`builder-inner-row dotted-border`)\r\n\t\t\t\t\t\t\t.appendTo($row);\r\n\r\n\t\t\t\t\t\t// Build the row label (tooltip)\r\n\t\t\t\t\t\tjQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t.addClass(\"row-label\")\r\n\t\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\r\n\t\t\t\t\t\t\t.text(row.label)\r\n\t\t\t\t\t\t\t.appendTo($row);\r\n\r\n\t\t\t\t\t\t// Build the row setting button.\r\n\t\t\t\t\t\tjQuery(\"<button></button>\")\r\n\t\t\t\t\t\t\t.addClass(\"row-setting-button\")\r\n\t\t\t\t\t\t\t.attr(\"type\", \"button\")\r\n\t\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\r\n\t\t\t\t\t\t\t.html('<i class=\"dashicons dashicons-admin-generic\"></i>')\r\n\t\t\t\t\t\t\t.on(\"click\", () => control.handleRowSettingClick?.(row.key))\r\n\t\t\t\t\t\t\t.appendTo($row);\r\n\r\n\t\t\t\t\t\tconst matchedRow = params.value\r\n\t\t\t\t\t\t\t? params.value[device].rows[row.key]\r\n\t\t\t\t\t\t\t: undefined;\r\n\r\n\t\t\t\t\t\trow.columns.forEach((column, columnIndex) => {\r\n\t\t\t\t\t\t\tlet columnPosClass = \"\";\r\n\r\n\t\t\t\t\t\t\tif (column.key.endsWith(\"_start\")) {\r\n\t\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-start\";\r\n\t\t\t\t\t\t\t} else if (column.key.endsWith(\"_end\")) {\r\n\t\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-end\";\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\tcolumnIndex !== 0 &&\r\n\t\t\t\t\t\t\t\t\tcolumnIndex !== row.columns.length - 1\r\n\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-center column-middle\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (columnIndex === 0) {\r\n\t\t\t\t\t\t\t\tcolumnPosClass += \" column-start wpbf-content-start\";\r\n\t\t\t\t\t\t\t} else if (columnIndex === row.columns.length - 1) {\r\n\t\t\t\t\t\t\t\tcolumnPosClass += \" column-end wpbf-content-end\";\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst $widgetListEl = jQuery(\"<div></div>\")\r\n\t\t\t\t\t\t\t\t.addClass(\r\n\t\t\t\t\t\t\t\t\t`builder-column builder-widgets active-widgets wpbf-flex ${columnPosClass}`,\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t.attr(\"data-column-key\", column.key)\r\n\t\t\t\t\t\t\t\t.appendTo($innerRow);\r\n\r\n\t\t\t\t\t\t\tif (!matchedRow || !Object.keys(matchedRow).length) {\r\n\t\t\t\t\t\t\t\t$widgetListEl.addClass(emptyWidgetListClass);\r\n\t\t\t\t\t\t\t\t$widgetListEl.html(control.emptyWidgetItemMarkup ?? \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst matchedColumn = matchedRow[column.key];\r\n\r\n\t\t\t\t\t\t\tif (!matchedColumn || !matchedColumn.length) {\r\n\t\t\t\t\t\t\t\t$widgetListEl.addClass(emptyWidgetListClass);\r\n\t\t\t\t\t\t\t\t$widgetListEl.html(control.emptyWidgetItemMarkup ?? \"\");\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Build the widget list based on `matchedColumn`.\r\n\t\t\t\t\t\t\tmatchedColumn.forEach((widgetKey) => {\r\n\t\t\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(\r\n\t\t\t\t\t\t\t\t\twidgetKey,\r\n\t\t\t\t\t\t\t\t\ttrue,\r\n\t\t\t\t\t\t\t\t\tdevice,\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\tif (!newWidgetItem) return;\r\n\r\n\t\t\t\t\t\t\t\t$widgetListEl.append(newWidgetItem);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcontrol.bindCustomizeSection?.(row.key);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontrol.builderPanel = $builderPanel[0];\r\n\t\t\t},\r\n\r\n\t\t\thandleRowSettingClick: function (rowKey) {\r\n\t\t\t\tconst controlId = this.params?.id;\r\n\t\t\t\tif (!controlId) return;\r\n\r\n\t\t\t\tcustomizer?.section(\r\n\t\t\t\t\t`${controlId}_${rowKey}_section`,\r\n\t\t\t\t\tfunction (section) {\r\n\t\t\t\t\t\tsection.expand(section.params);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t},\r\n\r\n\t\t\tbindCustomizeSection: function (rowKey) {\r\n\t\t\t\tconst controlId = this.params?.id;\r\n\t\t\t\tif (!controlId) return;\r\n\r\n\t\t\t\tcustomizer?.section(\r\n\t\t\t\t\t`${controlId}_${rowKey}_section`,\r\n\t\t\t\t\tfunction (section) {\r\n\t\t\t\t\t\tsection.expanded.bind(function (expanded) {\r\n\t\t\t\t\t\t\tconst row = document.querySelector(\r\n\t\t\t\t\t\t\t\t`.builder-row[data-row-key=\"${rowKey}\"]`,\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tif (!row) return;\r\n\r\n\t\t\t\t\t\t\tif (expanded) {\r\n\t\t\t\t\t\t\t\trow.classList.add(\"is-active\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trow.classList.remove(\"is-active\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\t\t\t},\r\n\r\n\t\t\thandleWidgetClick: function (widgetEl, widgetData) {\r\n\t\t\t\t// If this is from the available widgets panel.\r\n\t\t\t\tif (!widgetEl.classList.contains(\"ui-sortable-handle\")) {\r\n\t\t\t\t\tif (!widgetEl.classList.contains(\"disabled\")) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!widgetData.section) return;\r\n\r\n\t\t\t\tconst connectedSection = customizer?.section(widgetData.section);\r\n\t\t\t\tif (!connectedSection || !connectedSection.params) return;\r\n\r\n\t\t\t\tconnectedSection.expand(connectedSection.params);\r\n\t\t\t},\r\n\r\n\t\t\tinitDraggable: function () {\r\n\t\t\t\tif (!this.params || !this.container || !this.builderPanel) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst dragHelper = this.findHtmlEl?.(\".widget-drag-helper\");\r\n\t\t\t\tif (!dragHelper) return;\r\n\r\n\t\t\t\tconst availableWidgetItems = this.findHtmlEls?.(\r\n\t\t\t\t\tthis.container[0],\r\n\t\t\t\t\t\".widget-item\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!availableWidgetItems || !availableWidgetItems.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tavailableWidgetItems.forEach((item) => {\r\n\t\t\t\t\tif (!(item instanceof HTMLElement)) return;\r\n\r\n\t\t\t\t\titem.addEventListener(\"dragstart\", (e) => {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\r\n\t\t\t\t\t\tdocument.body.classList.add(\"is-dragging-widget\");\r\n\t\t\t\t\t\titem.classList.add(\"is-dragging\");\r\n\t\t\t\t\t\tdragHelper.classList.add(\"is-shown\");\r\n\r\n\t\t\t\t\t\tconst widgetKey = item.dataset.widgetKey;\r\n\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Set the data to be transferred.\r\n\t\t\t\t\t\t * We use both e.dataTransfer and control.draggableData to store the data.\r\n\t\t\t\t\t\t * Because e.dataTransfer can't be accessed from \"dragenter\" and \"dragover\" event.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tcontrol.draggableData = { widgetKey };\r\n\t\t\t\t\t\te.dataTransfer?.setData(\"text\", JSON.stringify({ widgetKey }));\r\n\r\n\t\t\t\t\t\tdragHelper.innerHTML = item.outerHTML;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * The visualDragHelper is a direct body child element with position: fixed, left: 0, and top: 0.\r\n\t\t\t\t\t\t * We need to set the position of the dragVisualHelper to be in the same position of current `item` (.wiget-item).\r\n\t\t\t\t\t\t * Meaning, we need to get the top and left position of the current event element and set the fixed position of the dragVisualHelper.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tconst draggedElRect = item.getBoundingClientRect();\r\n\t\t\t\t\t\tconst draggedElFixedLeftPos = draggedElRect.left;\r\n\t\t\t\t\t\tconst draggedElFixedTopPos = draggedElRect.top;\r\n\r\n\t\t\t\t\t\tdragHelper.style.left = draggedElFixedLeftPos + \"px\";\r\n\t\t\t\t\t\tdragHelper.style.top = draggedElFixedTopPos + \"px\";\r\n\r\n\t\t\t\t\t\tconst dragHelperInnerEl = control.findHtmlEl?.(\r\n\t\t\t\t\t\t\tdragHelper,\r\n\t\t\t\t\t\t\t\".widget-item\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tconst innerElRect = dragHelperInnerEl?.getBoundingClientRect();\r\n\t\t\t\t\t\tconst dragHelperInnerElWidth = innerElRect?.width || 80;\r\n\r\n\t\t\t\t\t\tdragHelper.style.width = dragHelperInnerElWidth + \"px\";\r\n\r\n\t\t\t\t\t\te.dataTransfer?.setDragImage(dragHelper, 0, 0);\r\n\r\n\t\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t\tdragHelper.classList.remove(\"is-shown\");\r\n\t\t\t\t\t\t}, 10);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\titem.addEventListener(\"dragend\", (e) => {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\titem.classList.remove(\"is-dragging\");\r\n\t\t\t\t\t\tdocument.body.classList.remove(\"is-dragging-widget\");\r\n\r\n\t\t\t\t\t\tdragHelper.classList.remove(\"is-shown\");\r\n\t\t\t\t\t\tdragHelper.innerHTML = \"\";\r\n\t\t\t\t\t\tdragHelper.removeAttribute(\"style\");\r\n\r\n\t\t\t\t\t\tcontrol.draggableData = undefined;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tinitDroppable: function () {\r\n\t\t\t\tif (!this.builderPanel) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst builderDropZones = this.findHtmlEls?.(\r\n\t\t\t\t\tthis.builderPanel,\r\n\t\t\t\t\t\".active-widgets\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!builderDropZones || !builderDropZones.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tbuilderDropZones.forEach((dropZone) => {\r\n\t\t\t\t\t// Skip premium-locked dropzones.\r\n\t\t\t\t\tconst isLockedDropzone =\r\n\t\t\t\t\t\tdropZone.classList.contains(\"wpbf-premium-locked-dropzone\");\r\n\r\n\t\t\t\t\tdropZone.addEventListener(\"dragenter\", (e) => {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\t// Don't show dragover state for locked dropzones.\r\n\t\t\t\t\t\tif (isLockedDropzone) return;\r\n\r\n\t\t\t\t\t\tdropZone.classList.add(\"dragover\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// This empty block is necessary to let the dropZone accept the drop event.\r\n\t\t\t\t\tdropZone.addEventListener(\"dragover\", (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdropZone.addEventListener(\"dragleave\", (e) => {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tdropZone.classList.remove(\"dragover\");\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tdropZone.addEventListener(\"drop\", (e) => {\r\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\r\n\t\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t\tdropZone.classList.remove(\"dragover\");\r\n\r\n\t\t\t\t\t\t// Block drops on premium-locked dropzones.\r\n\t\t\t\t\t\tif (isLockedDropzone) return;\r\n\r\n\t\t\t\t\t\tconst widgetItem = control.getWidgetItemFromDraggableData?.(e);\r\n\t\t\t\t\t\tif (!widgetItem) return;\r\n\r\n\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\r\n\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\tconst area = dropZone.closest(\".wpbf-builder-slots\");\r\n\t\t\t\t\t\tif (!(area instanceof HTMLElement)) return;\r\n\r\n\t\t\t\t\t\tconst device = area.dataset.device;\r\n\r\n\t\t\t\t\t\tif (!device || (device !== \"desktop\" && device !== \"mobile\")) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(\r\n\t\t\t\t\t\t\twidgetKey,\r\n\t\t\t\t\t\t\ttrue,\r\n\t\t\t\t\t\t\tdevice,\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (!newWidgetItem) return;\r\n\r\n\t\t\t\t\t\tconst temporaryWidgetItem = dropZone.querySelector(\r\n\t\t\t\t\t\t\t\".ui-sortable-placeholder.from-available-widgets\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (temporaryWidgetItem) {\r\n\t\t\t\t\t\t\tdropZone.removeChild(temporaryWidgetItem);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (dropZone.classList.contains(\"column-end\")) {\r\n\t\t\t\t\t\t\tdropZone.insertBefore(newWidgetItem, dropZone.firstChild);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdropZone.appendChild(newWidgetItem);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst emptyWidgetItem =\r\n\t\t\t\t\t\t\tdropZone.querySelector(\".empty-widget-item\");\r\n\r\n\t\t\t\t\t\tif (emptyWidgetItem) {\r\n\t\t\t\t\t\t\temptyWidgetItem.remove();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Now refresh the sortable.\r\n\t\t\t\t\t\tjQuery(dropZone).sortable(\"refresh\");\r\n\r\n\t\t\t\t\t\twidgetItem.classList.add(\"disabled\");\r\n\t\t\t\t\t\tcontrol.draggableData = undefined;\r\n\t\t\t\t\t\tcontrol.updateCustomizerSetting?.();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tparseDraggableData: function (e) {\r\n\t\t\t\tconst data = e.dataTransfer?.getData(\"text\");\r\n\t\t\t\tif (!data) return undefined;\r\n\r\n\t\t\t\tlet parsedJson: undefined | Record<string, any> = undefined;\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tparsedJson = JSON.parse(data);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(\"Error parsing JSON data:\", e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!parsedJson) return undefined;\r\n\r\n\t\t\t\treturn parsedJson;\r\n\t\t\t},\r\n\r\n\t\t\tgetWidgetItemFromDraggableData: function (e) {\r\n\t\t\t\tconst data = e.dataTransfer?.getData(\"text\");\r\n\t\t\t\tif (!data) return undefined;\r\n\t\t\t\tif (!this.container) return undefined;\r\n\r\n\t\t\t\tconst parsedJson = this.parseDraggableData?.(e);\r\n\t\t\t\tif (!parsedJson) return undefined;\r\n\r\n\t\t\t\tconst widgetKey = parsedJson.widgetKey;\r\n\t\t\t\tif (!widgetKey) return undefined;\r\n\r\n\t\t\t\tconst widgetItem = this.findHtmlEl?.(\r\n\t\t\t\t\tthis.container[0],\r\n\t\t\t\t\t`.widget-item[data-widget-key=\"${widgetKey}\"]`,\r\n\t\t\t\t);\r\n\r\n\t\t\t\treturn widgetItem;\r\n\t\t\t},\r\n\r\n\t\t\tcreateWidgetItem: function (widgetKey, insideBuilderPanel, device) {\r\n\t\t\t\tif (!this.container) return undefined;\r\n\r\n\t\t\t\tconst widgetData = this.findWidgetByKey?.(widgetKey, device);\r\n\t\t\t\tif (!widgetData) return undefined;\r\n\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tconst widgetItemToClone = this.findHtmlEl?.(\r\n\t\t\t\t\tthis.container[0],\r\n\t\t\t\t\t`.widget-item[data-widget-key=\"${widgetKey}\"]`,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (!widgetItemToClone) return undefined;\r\n\r\n\t\t\t\tconst newWidgetItem = widgetItemToClone.cloneNode(true);\r\n\t\t\t\tif (!(newWidgetItem instanceof HTMLElement)) return undefined;\r\n\r\n\t\t\t\tnewWidgetItem.classList.remove(\"disabled\");\r\n\t\t\t\tnewWidgetItem.classList.remove(\"is-dragging\");\r\n\t\t\t\tnewWidgetItem.removeAttribute(\"draggable\");\r\n\r\n\t\t\t\tif (insideBuilderPanel) {\r\n\t\t\t\t\tconst deleteButton = document.createElement(\"button\");\r\n\t\t\t\t\tdeleteButton.type = \"button\";\r\n\t\t\t\t\tdeleteButton.className = \"widget-button delete-widget-button\";\r\n\t\t\t\t\tdeleteButton.innerHTML = '<i class=\"dashicons dashicons-no-alt\"></i>';\r\n\t\t\t\t\tnewWidgetItem.appendChild(deleteButton);\r\n\r\n\t\t\t\t\tdeleteButton.addEventListener(\"click\", (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\tcontrol.handleDeleteActiveWidget?.(\r\n\t\t\t\t\t\t\tnewWidgetItem,\r\n\t\t\t\t\t\t\twidgetItemToClone,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tnewWidgetItem.addEventListener(\"click\", function (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tcontrol.handleWidgetClick?.(this, widgetData);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn newWidgetItem;\r\n\t\t\t},\r\n\r\n\t\t\tinitSortable: function () {\r\n\t\t\t\tconst control = this;\r\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\r\n\r\n\t\t\t\tif (!this.builderPanel) return;\r\n\t\t\t\tconst $builderPanel = jQuery(this.builderPanel);\r\n\r\n\t\t\t\t// Scope sortable to this specific builder panel only.\r\n\t\t\t\tconst $activeWidgets = $builderPanel.find(\r\n\t\t\t\t\t\".active-widgets:not(.wpbf-premium-locked-dropzone)\",\r\n\t\t\t\t);\r\n\r\n\t\t\t\t$activeWidgets.sortable({\r\n\t\t\t\t\tconnectWith: $activeWidgets,\r\n\t\t\t\t\tplaceholder: \"widget-item\",\r\n\t\t\t\t\tstart: function (e, ui) {\r\n\t\t\t\t\t\tdocument.body.classList.add(\"is-sorting-widget\");\r\n\r\n\t\t\t\t\t\tconst labelEl = control.findHtmlEl?.(ui.item[0], \".widget-label\");\r\n\r\n\t\t\t\t\t\tif (labelEl) {\r\n\t\t\t\t\t\t\tui.placeholder[0].appendChild(labelEl.cloneNode(true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tupdate: function (e, ui) {\r\n\t\t\t\t\t\tconst sortableEl = e.target;\r\n\t\t\t\t\t\tif (!(sortableEl instanceof HTMLElement)) return;\r\n\r\n\t\t\t\t\t\tcontrol.checkSortableContent?.(sortableEl);\r\n\t\t\t\t\t\tcontrol.updateCustomizerSetting?.();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstop: function (e, ui) {\r\n\t\t\t\t\t\tdocument.body.classList.remove(\"is-sorting-widget\");\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$builderPanel.find(\".builder-column.column-middle\").on(\r\n\t\t\t\t\t\"sortover\",\r\n\t\t\t\t\tfunction (e, ui) {\r\n\t\t\t\t\t\tconst target = e.target;\r\n\t\t\t\t\t\ttarget.classList.remove(emptyWidgetListClass);\r\n\t\t\t\t\t},\r\n\t\t\t\t);\r\n\r\n\t\t\t\t$builderPanel\r\n\t\t\t\t\t.find(\".builder-column.column-middle\")\r\n\t\t\t\t\t.on(\"sortout\", function (e, ui) {\r\n\t\t\t\t\t\tcontrol.checkSortableContent?.(e.target);\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\thandleDeleteActiveWidget: function (activeWidgetEl, availableWidgetEl) {\r\n\t\t\t\tconst control = this;\r\n\r\n\t\t\t\tavailableWidgetEl?.classList.remove(\"disabled\");\r\n\r\n\t\t\t\tconst sortableEL = activeWidgetEl.closest(\".active-widgets\");\r\n\r\n\t\t\t\tactiveWidgetEl.remove();\r\n\r\n\t\t\t\tif (sortableEL instanceof HTMLElement) {\r\n\t\t\t\t\tcontrol.checkSortableContent?.(sortableEL);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (sortableEL) {\r\n\t\t\t\t\tjQuery(sortableEL).sortable(\"refresh\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontrol.updateCustomizerSetting?.();\r\n\t\t\t},\r\n\r\n\t\t\tcheckSortableContent: function (sortableEl) {\r\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\r\n\t\t\t\tconst emptyWidgetItemClass = \"empty-widget-item\";\r\n\r\n\t\t\t\tconst emptyWidgetItem = sortableEl.querySelector(\r\n\t\t\t\t\t\".\" + emptyWidgetItemClass,\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (this.isSortableEmpty?.(sortableEl)) {\r\n\t\t\t\t\tsortableEl.classList.add(emptyWidgetListClass);\r\n\r\n\t\t\t\t\tif (!emptyWidgetItem) {\r\n\t\t\t\t\t\tjQuery(sortableEl).append(this.emptyWidgetItemMarkup ?? \"\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsortableEl.classList.remove(emptyWidgetListClass);\r\n\r\n\t\t\t\t\tif (emptyWidgetItem) {\r\n\t\t\t\t\t\temptyWidgetItem.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tdestroySortable: function () {\r\n\t\t\t\tif (!this.builderPanel) return;\r\n\t\t\t\tjQuery(\".wpbf-builder-panel .active-widgets\").sortable(\"destroy\");\r\n\t\t\t},\r\n\r\n\t\t\tupdateCustomizerSetting: function () {\r\n\t\t\t\tif (this.isSaving) return;\r\n\t\t\t\tthis.isSaving = true;\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!this.availableWidgetsPanels) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst newValue: ResponsiveBuilderValue = {\r\n\t\t\t\t\t\tdesktop: { offcanvas: [], rows: {} },\r\n\t\t\t\t\t\tmobile: { offcanvas: [], rows: {} },\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tfor (const device of allowedDevices) {\r\n\t\t\t\t\t\tif (device !== \"desktop\" && device !== \"mobile\") {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst deviceBuilderPanel = this.findHtmlEl?.(\r\n\t\t\t\t\t\t\tthis.builderPanel,\r\n\t\t\t\t\t\t\t`.wpbf-builder-slots[data-device=\"${device}\"]`,\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (!deviceBuilderPanel) return;\r\n\r\n\t\t\t\t\t\tconst sortableEl = this.findHtmlEl?.(\r\n\t\t\t\t\t\t\tdeviceBuilderPanel,\r\n\t\t\t\t\t\t\t\".builder-offcanvas .active-widgets\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tconst widgetItems = this.findHtmlEls?.(sortableEl, \".widget-item\");\r\n\r\n\t\t\t\t\t\twidgetItems?.forEach((widgetItem) => {\r\n\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"empty-widget-item\")) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"ui-sortable-placeholder\")) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\r\n\t\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\t\tif (!newValue[device].offcanvas) {\r\n\t\t\t\t\t\t\t\tnewValue[device].offcanvas = [];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tnewValue[device].offcanvas.push(widgetKey);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tconst builderRows = this.findHtmlEls?.(\r\n\t\t\t\t\t\t\tdeviceBuilderPanel,\r\n\t\t\t\t\t\t\t\".builder-row\",\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tif (!builderRows || !builderRows.length) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbuilderRows.forEach((row) => {\r\n\t\t\t\t\t\t\tconst rowKey = row.dataset.rowKey;\r\n\t\t\t\t\t\t\tif (!rowKey) return;\r\n\r\n\t\t\t\t\t\t\tconst sortableColumns = this.findHtmlEls?.(\r\n\t\t\t\t\t\t\t\trow,\r\n\t\t\t\t\t\t\t\t\".active-widgets\",\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tif (!sortableColumns || !sortableColumns.length) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tnewValue[device].rows[rowKey] = {};\r\n\r\n\t\t\t\t\t\t\tsortableColumns.forEach((column) => {\r\n\t\t\t\t\t\t\t\tconst columnKey = column.dataset.columnKey;\r\n\t\t\t\t\t\t\t\tif (!columnKey) return;\r\n\r\n\t\t\t\t\t\t\t\tnewValue[device].rows[rowKey][columnKey] = [];\r\n\r\n\t\t\t\t\t\t\t\tconst widgetItems = this.findHtmlEls?.(column, \".widget-item\");\r\n\r\n\t\t\t\t\t\t\t\tif (!widgetItems || !widgetItems.length) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\twidgetItems.forEach((widgetItem) => {\r\n\t\t\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"empty-widget-item\")) {\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\twidgetItem.classList.contains(\"ui-sortable-placeholder\")\r\n\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\r\n\t\t\t\t\t\t\t\t\tif (!widgetKey) return;\r\n\r\n\t\t\t\t\t\t\t\t\tnewValue[device].rows[rowKey][columnKey].push(widgetKey);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.setting?.set(newValue);\r\n\t\t\t\t\tthis.isSaving = false;\r\n\t\t\t\t}, 1);\r\n\t\t\t},\r\n\r\n\t\t\t// Update available-widgets & active-widgets.\r\n\t\t\tupdateComponentState: function (value) {},\r\n\t\t});\r\n})(window.wp.customize);\r\n"],"names":["isRuleSatisfied","actualValue","operator","expectedValue","trim","toLowerCase","compareInOperator","Array","isArray","expectedValueArray","found","actualValueArray","i","length","includes","_","isObject","actualValueObj","isUndefined","prop","hasOwnProperty","indexOf","wpbfInjectTooltip","control","each","wpbfCustomizerTooltips","tooltip","id","container","find","target","document","querySelector","classList","add","trigger","createElement","innerHTML","content","appendChild","customizer","forEachEl","selector","handler","NodeList","elms","querySelectorAll","elm","HTMLElement","switchPreviewButtons","device","el","HTMLButtonElement","dataset","wpbfDevice","remove","wpbfSetting","label","HTMLLabelElement","htmlFor","window","wp","customize","wpbfDynamicControl","Control","extend","initialize","params","this","type","className","splits","split","$content","jQuery","attr","replace","wrapperAttrs","val","key","propertyElements","prototype","call","hooks","doAction","_setUpSettingRootLinks","node","settingKey","customizeSettingLink","setting","element","Element","elements","push","sync","set","_setUpSettingPropertyLinks","nodes","propertyName","data","bind","newPropertyValue","newSetting","clone","newValue","get","ready","deferred","embedded","done","initWpbfControl","embed","sectionId","section","expanded","settings","autofocus","actuallyEmbed","state","renderContent","resolve","focus","args","ctrl","on","value","destroy","off","updateCustomizerSetting","findHtmlEl","elOrSelector","result","findHtmlEls","from","filter","sectionNames","tooltipStyleTag","sidebarOverlay","head","forEach","sectionName","contentContainer","scrollHeight","clientHeight","wpbfSetupTooltips","wpbfCustomizerControlDependencies","globalControlDependencies","reversedControlDependencies","dependantControlId","controlDependencies","dependency","dependencySettingId","listenDependencyControl","rules","handleRulesCondition","ruleSet","hideControl","dependantDependencies","showControl","otherRulesSatisfied","dependantDependency","dependantDependencySettingId","controlId","wpbfParentTabId","contains","removeClass","addClass","onChangeActive","completeCallback","hasClass","setupControlDependencies","Value","to","_value","_setter","apply","arguments","validate","isEqual","_dirty","callbacks","fireWith","previewedDevice","e","controlConstructor","is","currentValue","values","field","HTMLInputElement","updateComponentState","checked","r","grad","turn","rad","Math","PI","t","n","pow","round","u","isFinite","a","g","b","o","s","toString","h","max","min","v","floor","l","d","f","c","p","m","y","string","exec","parseInt","substr","Number","object","N","M","H","$","j","parsed","x","rgba","isValid","brightness","isDark","isLight","toHex","toRgb","toRgbString","toHsl","toHslString","toHsv","invert","w","saturate","desaturate","grayscale","lighten","darken","rotate","hue","alpha","ColorPickerSwatches","props","colors","onClick","jsx","children","map","clr","index","color","style","backgroundColor","normalizeMaxValue","isNumeric","char","isNaN","parseFloat","improperNumeric","limitNumber","parsedValue","makeNumberUnitPair","number","unit","strValue","String","negativeSign","unitMatch","match","getUnit","numeric","hasTrailingDot","endsWith","hasTrailingDotBeforeUnit","makeLimitedNumberUnitPair","valueObject","limitNumberWithUnit","numberAndUnit","limitedNumber","colorBgImgData","parseHueModeValue","hueValue","colord","hexColorFromHueModeValue","ColorPickerInput","onChange","pickerComponent","useHueMode","setValue","useState","useEffect","handleInputChange","useCallback","pattern","RegExp","test","previewWrapperBgImg","jsxs","backgroundImage","spellCheck","useFocusOutside","ref","listener","current","addEventListener","removeEventListener","useClickOutside","pickerRef","resetRef","startedWhenMounted","startedInside","event","validateEventStart","Object","assign","keys","ownerDocument","defaultView","self","getBoundingClientRect","identifier","touches","left","pageX","pageXOffset","width","top","pageY","pageYOffset","height","preventDefault","memo","onMove","onKey","buttons","nativeEvent","changedTouches","which","keyCode","C","E","onTouchStart","onMouseDown","onKeyDown","tabIndex","role","Boolean","join","substring","q","k","I","O","A","z","L","B","D","K","S","T","hsva","F","P","Y","toHsva","equal","fromHsva","V","J","Map","Q","has","__webpack_nonce__","setAttribute","U","colorModel","defaultColor","W","Z","ee","re","oe","ae","le","ue","ce","ie","se","fe","ve","de","he","me","ge","pe","be","_e","xe","Ce","Ee","He","Me","Ne","we","ye","ColorPickerComponent","HexColorPicker","RgbColorPicker","RgbStringColorPicker","RgbaColorPicker","RgbaStringColorPicker","HslColorPicker","HslStringColorPicker","HslaColorPicker","HslaStringColorPicker","HsvColorPicker","HsvStringColorPicker","HsvaColorPicker","HsvaStringColorPicker","ColorPickerCirleTrigger","isPopupOpen","onResetButtonClick","onToggleButtonClick","triggerButtonBgImage","Fragment","ControlLabel","description","setNotificationContainer","dangerouslySetInnerHTML","__html","ControlHeader","labelStyle","renderLabel","renderTrigger","useTooltip","inputValue","togglePicker","convertColorForInput","formComponent","hsv","convertedValue","convertColorForPicker","ColorForm","useExternalPopupToggle","setInputValue","pickerValue","setPickerValue","currentInputValue","currentPickerValue","overrideUpdateComponentStateFn","valueForInput","shouldChangeInputValue","JSON","stringify","valueForPicker","shouldChangePickerValue","initialColor","default","formRef","useRef","setIsPopupOpen","pickerContainerStyle","setPickerContainerStyle","getPickerContainerStyle","rawPadding","getComputedStyle","parentNode","paddingLeft","padding","controlLeftOffset","offsetLeft","convertInputValueTo6Digits","closePopup","setTimeout","colorSwatches","wpColorPicker","wpColorPickerSwatches","options","palettes","removeHeader","openPopup","onReset","require$$0","client","createRoot","hydrateRoot","convertColorForCustomizer","ColorControl","handleOnRemoved","removedControl","unbind","notifications","render","mode","root","fn","unmount","MulticolorForm","choices","openedPopupKey","setOpenedPopupKey","title","circleColor","togglePopup","MulticolorControl","encodeJsonOrDefault","parseJsonOrUndefined","jsonStr","parse","makeDevicesValue","fieldType","devices","makeEmptyDevicesValue","devicesValue","startTypingDecimal","parseNumberValue","makeMarginPaddingFieldValue","makeObjValueWithoutUnit","dimensions","position","positionValue","makeObjValueWithoutUnitFromJson","makeEmptyValueObj","DeviceButtons","deviceClassName","MarginPaddingForm","inputValues","setInputValues","valueArray","defaultDefined","saveToCustomizerSetting","newVal","dontSaveUnit","singleValue","makeObjValueWithUnit","saveAsJson","makeMappable","items","dimension","renderFields","group","defaultValues","defaultArray","existingValues","handleResetButtonClick","item","inputClassName","inputId","unitRef","isResponsive","isActive","MarginPaddingControl","onRemoved","subtype","allowCollapse","_val","wpbfNotifications","allowUnitless","code","validateCssValue","Notification","message","wpbfDimensionControlL10n","valueStr","numericValue","multiples","multiplesValid","defaultParams","tinymce","wpautop","quicktags","mediaButtons","editor","tinyMCE","ed","save","getContent","instance","fieldValue","HTMLTextAreaElement","fields","settingProp","setupAssocArrayControl","existingValue","valueRecord","parent","customizerValue","saveAs","defaultSrc","valueSrc","box","preview","selectButton","changeButton","removeButton","defaultButton","handleButtonsDisplay","previewUrl","url","openMediaLibrary","selectedImage","media","multiple","open","jsonImg","first","toJSON","sizes","full","medium","thumbnail","i18n","__","RepeaterRow","constructor","rowIndex","__publicField","rowNum","updateLabel","toggleClass","header","slideUp","detach","rowLabelField","rowLabel","rowLabelRadioField","text","toggleMinimize","setRowIndex","Utils","ArrayAdapter","createSharedFontDataAdapter","globalVarName","initialSelectedValues","select2Amd","select2","amd","console","error","require","initializeSelect2Modules","globalData","selectedIdsSet","Set","preparedData","prepared","disabled","selected","child","SharedFontDataAdapter","$element","_dataToConvert","getPrototypeOf","Extend","_normalizeItem","SliderForm","sliderRef","valueRef","parseValue","safeValue","textContent","fieldId","defaultValue","renderedValue","step","makeValueForInput","isTypingDecimal","makeValueForSlider","InputSliderForm","setInputRefValue","setSliderRefValue","inputRef","sliderValue","valueToSave","limitedValue","numberValuePair","ResponsiveInputSliderForm","setActualValue","activeDevice","setActiveDevice","callback","deviceIndex","numberUnitPair","handleSliderChange","composeFontProperties","triggerPropertyName","triggerPropertyValue","triggerChange","variantValue","variant","maybeVariantControl","variantControl","variantChoices","fontFamily","googleFont","wpbfGoogleFonts","findGoogleFont","wpbfFontVariantOptions","googleFontVariants","variants","complete","fieldVariantKey","customVariantsGroup","wpbfFieldsFontVariants","variantFamily","standard","collectVariantChoices","active","activate","deactivate","some","variantFoundInChoices","$variantSelectbox","empty","append","choice","Option","rows","currentIndex","repeaterFieldsContainer","settingField","repeaterTemplate","settingValueFromParams","theNewRow","limit","addRow","initColorPicker","initSelect","$thisButton","openFrame","removeImage","removeFile","memoize","evaluate","interpolate","escape","variable","template","html","compiled","sortable","handle","update","sort","utils","isKeydownButNotEnterEvent","closest","initCropperFrame","initFrame","frame","libMediaType","getMimeType","states","controller","Library","library","query","date","onSelect","currentFieldId","siblings","attrs","isString","button","close","suggestedWidth","suggestedHeight","CustomizeImageCropper","imgSelectOptions","calculateImageSelectOptions","onSelectForCrop","onCropped","onSkippedCrop","attachment","setFileInRepeaterField","setImageInRepeaterField","flex_width","flex_height","setState","croppedImage","flexWidth","flexHeight","realWidth","realHeight","xInit","yInit","ratio","xImg","yImg","x1","y1","mustBeCropped","handles","persistent","imageWidth","imageHeight","aspectRatio","maxHeight","maxWidth","x2","y2","flexW","flexH","dstW","dstH","imgW","imgH","$targetDiv","hide","slideDown","show","filename","mime_type","$uploadButton","getValue","hiddenFieldValue","stringValue","decodeURI","refresh","filtering","filteredValue","idx","encodeURI","settingValue","newRowSetting","templateData","newRow","appendTo","deleteRow","fieldName","updateField","$rows","newOrder","newRows","newSettings","newPosition","oldPosition","currentSettings","row","$el","colorPicker","change","ui","currentPicker","_alpha","to_s","dropdown","dataField","currentDropdown","dispose","$picker","labelTemplate","labelDescriptionTemplate","headerTemplate","formTemplate","layoutStyle","notificationsContainer","$selectbox","selectedOptions","option","choicesGlobalVar","SharedAdapter","placeholder","allowClear","clearable","maximumSelectionLength","maxSelections","dataAdapter","warn","setupSelectControl","SliderControl","InputSliderControl","ResponsiveInputSliderControl","getNewValues","disableSelection","parents","$sortable","wpbfTypographyControlIds","addAction","controlInit","typographyControlId","wpbfFontProperties","property","propertyControlId","listenFontPropertyFieldsChange","setupTypographyFields","isSaving","form","draggableData","emptyWidgetItemMarkup","availableWidgetsPanel","builderPanel","buildAvailableWidgetsPanel","buildBuilderPanel","initDraggable","initDroppable","initSortable","isSortableEmpty","sortableEl","isWidgetActive","widgetKey","builder","activeWidgetKeys","findWidgetByKey","availableWidgets","widget","body","$availableWidgetListEl","handleWidgetClick","availableRows","customizePreview","$builderPanel","insertAfter","$row","$innerRow","handleRowSettingClick","matchedRow","columns","column","columnIndex","columnPosClass","$widgetListEl","emptyWidgetListClass","matchedColumn","newWidgetItem","createWidgetItem","bindCustomizeSection","rowKey","expand","widgetEl","widgetData","connectedSection","dragHelper","availableWidgetItems","DragEvent","dataTransfer","setData","outerHTML","draggedElRect","draggedElFixedLeftPos","draggedElFixedTopPos","dragHelperInnerEl","innerElRect","dragHelperInnerElWidth","setDragImage","removeAttribute","builderDropZones","dropZone","widgetItem","getWidgetItemFromDraggableData","temporaryWidgetItem","removeChild","insertBefore","firstChild","emptyWidgetItem","parseDraggableData","getData","parsedJson","insideBuilderPanel","widgetItemToClone","cloneNode","deleteButton","stopPropagation","handleDeleteActiveWidget","$sortableWidgets","$builderColumns","connectWith","start","labelEl","checkSortableContent","stop","activeWidgetEl","availableWidgetEl","sortableEL","destroySortable","builderRows","sortableColumns","columnKey","widgetItems","allowedDevices","availableWidgetsPanels","desktop","mobile","controlForm","$availableWidgetPanel","$builderSlotsEl","$mobileBuilderRows","availableSlots","offcanvas","$builderOffcanvas","isLockedOffcanvas","isPremium","$builderInnerOffcanvas","$offcanvasWidgetsEl","$rowsWrapper","isLockedDropzone","area","$activeWidgets","deviceBuilderPanel"],"mappings":"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","x_google_ignoreList":[6,13,22]}