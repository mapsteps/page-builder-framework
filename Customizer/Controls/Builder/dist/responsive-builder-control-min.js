var e;e=["desktop","mobile"],window.wp.customize&&(window.wp.customize.controlConstructor["wpbf-responsive-builder"]=window.wp.customize.wpbfDynamicControl.extend({isSaving:!1,form:void 0,draggableData:void 0,emptyWidgetItemMarkup:"<div class='widget-item empty-widget-item'>&nbsp;</div>",availableWidgetsPanels:{desktop:void 0,mobile:void 0},builderPanel:void 0,initWpbfControl:function(e){var i,t,a,l,n,d=null!=e?e:this;d&&(null===(i=d.setting)||void 0===i||i.bind(function(e){var i;null===(i=d.updateComponentState)||void 0===i||i.call(d,e)}),null===(t=d.buildAvailableWidgetsPanel)||void 0===t||t.call(d),null===(a=d.buildBuilderPanel)||void 0===a||a.call(d),null===(l=d.initDraggable)||void 0===l||l.call(d),null===(n=d.initDroppable)||void 0===n||n.call(d),window.setTimeout(function(){var e;null===(e=d.initSortable)||void 0===e||e.call(d)},1))},isSortableEmpty:function(e){var i,t=null===(i=this.findHtmlEls)||void 0===i?void 0:i.call(this,e,".widget-item");if(!t||!t.length)return!0;for(var a=0;a<t.length;a++){var l=t[a];if(!(l.classList.contains("empty-widget-item")||l.classList.contains("ui-sortable-placeholder"))&&!l.classList.contains("ui-sortable-helper"))return!1}return!0},isWidgetActive:function(e,i){if(!this.params||!i||"desktop"!==i&&"mobile"!==i)return!1;var t=this.params.builder[i].activeWidgetKeys;return!!t.length&&t.includes(e)},findWidgetByKey:function(e,i){if(this.params&&i&&("desktop"===i||"mobile"===i)){var t=this.params.builder[i].availableWidgets;if(t.length){var a=!0,l=!1,n=void 0;try{for(var d,o=t[Symbol.iterator]();!(a=(d=o.next()).done);a=!0){var r=d.value;if(r.key===e)return r}}catch(e){l=!0,n=e}finally{try{a||null==o.return||o.return()}finally{if(l)throw n}}}}},buildAvailableWidgetsPanel:function(){var e,i=this;if(this.container){var t=this.params;if(t){for(var a in t.builder)e=this,function(a){if(t.builder.hasOwnProperty(a)&&("desktop"===a||"mobile"===a)&&t.builder[a].availableWidgets.length){var l,n=null===(l=e.findHtmlEl)||void 0===l?void 0:l.call(e,e.container[0],".available-widgets-panel[data-device='"+a+"']");if(n&&e.availableWidgetsPanels&&e.availableWidgetsPanels[a]){e.availableWidgetsPanels[a]=n;var d=jQuery("<div></div>").addClass("builder-widgets available-widgets").appendTo(e.availableWidgetsPanels[a]);t.builder[a].availableWidgets.forEach(function(e){var t,a=e.key;jQuery("<div></div>").addClass("widget-item widget-item-".concat(a," ").concat((null===(t=i.isWidgetActive)||void 0===t?void 0:t.call(i,a))?"disabled":"")).attr("data-widget-key",a).attr("draggable","true").html('<span class="widget-label">'.concat(e.label,"</span>")).on("click",function(t){var a;null===(a=i.handleWidgetClick)||void 0===a||a.call(i,this,e)}).appendTo(d)})}}}(a);jQuery(document.body).append('<div class="widget-drag-helper"></div>')}}},buildBuilderPanel:function(){var e,i=function(e){if(!a.builder.hasOwnProperty(e)||"desktop"!==e&&"mobile"!==e||!a.builder[e].availableWidgets.length)return"continue";if(d.data("device",e),!a.builder[e].availableWidgets.length)return{v:void 0};var i=void 0;if("mobile"===e&&a.builder[e].availableSlots.sidebar)return d.addClass("wpbf-flex wpbf-content-center"),jQuery("<div></div>").addClass("builder-sidebar builder-widgets active-widgets").text(a.builder[e].availableSlots.sidebar.label).appendTo(d),i=jQuery("<div></div>").addClass("builder-rows").appendTo(d),"continue";var l=a.builder[e].availableSlots;if(!l.rows.length)return"continue";var n="mobile"===e&&i?i:d;l.rows.forEach(function(i){var l,d=jQuery("<div></div>").addClass("builder-row").attr("data-row-key",i.key).appendTo(n),o=jQuery("<div></div>").addClass("builder-inner-row").appendTo(d);jQuery("<div></div>").addClass("row-label").attr("data-row-key",i.key).text(i.label).appendTo(d),jQuery("<button></button>").addClass("row-setting-button").attr("data-row-key",i.key).html('<i class="dashicons dashicons-admin-generic"></i>').on("click",function(){var e;return null===(e=t.handleRowSettingClick)||void 0===e?void 0:e.call(t,i.key)}).appendTo(d);var r=a.value[e].rows[i.key];i.columns.forEach(function(e,a){var l,n,d="";e.key.endsWith("_start")?d="wpbf-content-start":e.key.endsWith("_end")?d="wpbf-content-end":0!==a&&a!==i.columns.length-1&&(d="wpbf-content-center column-middle"),0===a?d+=" column-start wpbf-content-start":a===i.columns.length-1&&(d+=" column-end wpbf-content-end");var s=jQuery("<div></div>").addClass("builder-column builder-widgets active-widgets wpbf-flex ".concat(d)).attr("data-column-key",e.key).appendTo(o),c="empty-widget-list";if(!r||!Object.keys(r).length){s.addClass(c),s.html(null!==(l=t.emptyWidgetItemMarkup)&&void 0!==l?l:"");return}var v=r[e.key];if(!v||!v.length){s.addClass(c),s.html(null!==(n=t.emptyWidgetItemMarkup)&&void 0!==n?n:"");return}v.forEach(function(e){var i,a=null===(i=t.createWidgetItem)||void 0===i?void 0:i.call(t,e,!0);a&&s.append(a)})}),null===(l=t.bindCustomizeSection)||void 0===l||l.call(t,i.key)})},t=this,a=t.params;if(a){var l=null===(e=t.findHtmlEl)||void 0===e?void 0:e.call(t,"#customize-preview");if(l){var n=jQuery("<div></div>").addClass("wpbf-builder-panel ".concat(a.id,"-builder-panel")).attr("data-wpbf-builder-panel",a.id).insertAfter(l),d=jQuery("<div></div>").addClass("wpbf-builder-slots is-hidden").appendTo(n);for(var o in a.builder){var r=i(o);if("object"==(r&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r))return r.v}t.builderPanel=n[0]}}},handleRowSettingClick:function(e){var i;null===(i=window.wp.customize)||void 0===i||i.section("wpbf_header_builder_".concat(e,"_section"),function(e){e.expand(e.params)})},bindCustomizeSection:function(e){var i;null===(i=window.wp.customize)||void 0===i||i.section("wpbf_header_builder_".concat(e,"_section"),function(i){i.expanded.bind(function(i){var t=document.querySelector('.builder-row[data-row-key="'.concat(e,'"]'));t&&(i?t.classList.add("is-active"):t.classList.remove("is-active"))})})},handleWidgetClick:function(e,i){if((e.classList.contains("ui-sortable-handle")||e.classList.contains("disabled"))&&i.section){var t,a=null===(t=window.wp.customize)||void 0===t?void 0:t.section(i.section);a&&a.params&&a.expand(a.params)}},initDraggable:function(){var e,i,t=this;if(t.params&&t.availableWidgetsPanel&&t.builderPanel){var a=null===(e=t.findHtmlEl)||void 0===e?void 0:e.call(t,".widget-drag-helper");if(a){var l=null===(i=t.findHtmlEls)||void 0===i?void 0:i.call(t,t.availableWidgetsPanel,".widget-item");l&&l.length&&l.forEach(function(e){e instanceof HTMLElement&&(e.addEventListener("dragstart",function(i){if(i instanceof DragEvent){document.body.classList.add("is-dragging-widget"),e.classList.add("is-dragging"),a.classList.add("is-shown");var l,n,d,o=e.dataset.widgetKey;if(o){t.draggableData={widgetKey:o},null===(l=i.dataTransfer)||void 0===l||l.setData("text",JSON.stringify({widgetKey:o})),a.innerHTML=e.outerHTML;var r=e.getBoundingClientRect(),s=r.left,c=r.top;a.style.left=s+"px",a.style.top=c+"px";var v=null===(n=t.findHtmlEl)||void 0===n?void 0:n.call(t,a,".widget-item"),u=null==v?void 0:v.getBoundingClientRect(),g=(null==u?void 0:u.width)||80;a.style.width=g+"px",null===(d=i.dataTransfer)||void 0===d||d.setDragImage(a,0,0),window.setTimeout(function(){a.classList.remove("is-shown")},10)}}}),e.addEventListener("dragend",function(i){i instanceof DragEvent&&(i.preventDefault(),e.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),a.classList.remove("is-shown"),a.innerHTML="",a.removeAttribute("style"),t.draggableData=void 0)}))})}}},initDroppable:function(){var e,i=this;if(i.params&&i.availableWidgetsPanel&&i.builderPanel){var t=null===(e=i.findHtmlEls)||void 0===e?void 0:e.call(i,i.builderPanel,".active-widgets");t&&t.length&&t.forEach(function(e){e.addEventListener("dragenter",function(i){i instanceof DragEvent&&(i.preventDefault(),e.classList.add("dragover"))}),e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("dragleave",function(i){i instanceof DragEvent&&(i.preventDefault(),e.classList.remove("dragover"))}),e.addEventListener("drop",function(t){if(t instanceof DragEvent){t.preventDefault(),e.classList.remove("dragover");var a,l,n,d=null===(a=i.getWidgetItemFromDraggableData)||void 0===a?void 0:a.call(i,t);if(d){var o=d.dataset.widgetKey;if(o){var r=null===(l=i.createWidgetItem)||void 0===l?void 0:l.call(i,o,!0);if(r){var s=e.querySelector(".ui-sortable-placeholder.from-available-widgets");s&&e.removeChild(s),e.classList.contains("column-end")?e.insertBefore(r,e.firstChild):e.appendChild(r);var c=e.querySelector(".empty-widget-item");c&&c.remove(),jQuery(e).sortable("refresh"),d.classList.add("disabled"),i.draggableData=void 0,null===(n=i.updateCustomizerSetting)||void 0===n||n.call(i)}}}}})})}},parseDraggableData:function(e){var i,t=null===(i=e.dataTransfer)||void 0===i?void 0:i.getData("text");if(t){var a=void 0;try{a=JSON.parse(t)}catch(e){console.error("Error parsing JSON data:",e)}if(a)return a}},getWidgetItemFromDraggableData:function(e){if(null===(i=e.dataTransfer)||void 0===i?void 0:i.getData("text")){var i,t,a,l=null===(t=this.parseDraggableData)||void 0===t?void 0:t.call(this,e);if(l){var n=l.widgetKey;if(n)return null===(a=this.findHtmlEl)||void 0===a?void 0:a.call(this,this.availableWidgetsPanel,'.widget-item[data-widget-key="'.concat(n,'"]'))}}},createWidgetItem:function(e,i){var t,a,l=this,n=null===(t=l.findWidgetByKey)||void 0===t?void 0:t.call(l,e);if(n){var d=null===(a=l.findHtmlEl)||void 0===a?void 0:a.call(l,l.availableWidgetsPanel,'.widget-item[data-widget-key="'.concat(e,'"]'));if(d){var o=d.cloneNode(!0);if(o instanceof HTMLElement){if(o.classList.remove("disabled"),o.classList.remove("is-dragging"),o.removeAttribute("draggable"),i){var r=document.createElement("button");r.type="button",r.className="widget-button delete-widget-button",r.innerHTML='<i class="dashicons dashicons-no-alt"></i>',o.appendChild(r),r.addEventListener("click",function(e){var i;e.preventDefault(),e.stopPropagation(),null===(i=l.handleDeleteActiveWidget)||void 0===i||i.call(l,o,d)}),o.addEventListener("click",function(e){var i;e.preventDefault(),null===(i=l.handleWidgetClick)||void 0===i||i.call(l,this,n)})}return o}}}},initSortable:function(){var e=this;e.params&&e.availableWidgetsPanel&&e.builderPanel&&(jQuery(".active-widgets").sortable({connectWith:".active-widgets",placeholder:"widget-item",start:function(i,t){document.body.classList.add("is-sorting-widget");var a,l=null===(a=e.findHtmlEl)||void 0===a?void 0:a.call(e,t.item[0],".widget-label");l&&t.placeholder[0].appendChild(l.cloneNode(!0))},update:function(i,t){var a,l,n=i.target;n instanceof HTMLElement&&(null===(a=e.checkSortableContent)||void 0===a||a.call(e,n),null===(l=e.updateCustomizerSetting)||void 0===l||l.call(e))},stop:function(e,i){document.body.classList.remove("is-sorting-widget")}}),jQuery(".builder-column.column-middle").on("sortover",function(e,i){e.target.classList.remove("empty-widget-list")}),jQuery(".builder-column.column-middle").on("sortout",function(i,t){var a;null===(a=e.checkSortableContent)||void 0===a||a.call(e,i.target)}))},handleDeleteActiveWidget:function(e,i){null==i||i.classList.remove("disabled");var t,a,l=e.closest(".active-widgets");e.remove(),l instanceof HTMLElement&&(null===(t=this.checkSortableContent)||void 0===t||t.call(this,l)),l&&jQuery(l).sortable("refresh"),null===(a=this.updateCustomizerSetting)||void 0===a||a.call(this)},checkSortableContent:function(e){var i,t,a="empty-widget-list",l=e.querySelector(".empty-widget-item");(null===(i=this.isSortableEmpty)||void 0===i?void 0:i.call(this,e))?(e.classList.add(a),l||jQuery(e).append(null!==(t=this.emptyWidgetItemMarkup)&&void 0!==t?t:"")):(e.classList.remove(a),l&&l.remove())},destroySortable:function(){this.availableWidgetsPanel&&this.builderPanel&&jQuery(".active-widgets").sortable("destroy")},updateCustomizerSetting:function(){var i=this;i.isSaving||(i.isSaving=!0,setTimeout(function(){if(i.availableWidgetsPanels){var t={desktop:{rows:{}},mobile:{sidebar:[],rows:{}}},a=!0,l=!1,n=void 0;try{for(var d,o,r=e[Symbol.iterator]();!(a=(o=r.next()).done);a=!0)!function(){var e=o.value;if(i.availableWidgetsPanels.hasOwnProperty(e)&&("desktop"===e||"mobile"===e)){if("mobile"===e){var a,l,n,d=null===(l=i.findHtmlEl)||void 0===l?void 0:l.call(i,".builder-sidebar.active-widgets"),r=null===(n=i.findHtmlEls)||void 0===n?void 0:n.call(i,d,".widget-item");null==r||r.forEach(function(i){if(!(i.classList.contains("empty-widget-item")||i.classList.contains("ui-sortable-placeholder"))){var a=i.dataset.widgetKey;a&&t[e].sidebar.push(a)}})}var s=null===(a=i.findHtmlEls)||void 0===a?void 0:a.call(i,i.availableWidgetsPanels[e],".builder-row");s&&s.length&&s.forEach(function(a){var l,n=a.dataset.rowKey;if(n){var d=null===(l=i.findHtmlEls)||void 0===l?void 0:l.call(i,a,".active-widgets");d&&d.length&&d.forEach(function(a){var l,d=a.dataset.columnKey;if(d){t[e].rows[n][d]=[];var o=null===(l=i.findHtmlEls)||void 0===l?void 0:l.call(i,a,".widget-item");o&&o.length&&o.forEach(function(i){if(!(i.classList.contains("empty-widget-item")||i.classList.contains("ui-sortable-placeholder"))){var a=i.dataset.widgetKey;a&&t[e].rows[n][d].push(a)}})}})}})}}()}catch(e){l=!0,n=e}finally{try{a||null==r.return||r.return()}finally{if(l)throw n}}null===(d=i.setting)||void 0===d||d.set(t),i.isSaving=!1}},1))},updateComponentState:function(e){}}));
//# sourceMappingURL=responsive-builder-control-min.js.map
