!function(){"use strict";!function(t){const e=["desktop","mobile"];t&&(t.controlConstructor["wpbf-responsive-builder"]=t.wpbfDynamicControl.extend({isSaving:!1,draggableData:void 0,emptyWidgetItemMarkup:"<div class='widget-item empty-widget-item'>&nbsp;</div>",availableWidgetsPanels:{desktop:void 0,mobile:void 0},builderPanel:void 0,initWpbfControl:function(t){const e=t??this;e&&(e.setting?.bind(t=>{e.updateComponentState?.(t)}),e.buildAvailableWidgetsPanel?.(),e.buildBuilderPanel?.(),e.initDraggable?.(),e.initDroppable?.(),window.setTimeout(()=>{e.initSortable?.()},1))},isSortableEmpty:function(t){const e=this.findHtmlEls?.(t,".widget-item");if(!e||!e.length)return!0;for(let i=0;i<e.length;i++){const t=e[i];if(!t.classList.contains("empty-widget-item")&&(!t.classList.contains("ui-sortable-placeholder")&&!t.classList.contains("ui-sortable-helper")))return!1}return!0},isWidgetActive:function(t,e){if(!this.params||!e||"desktop"!==e&&"mobile"!==e)return!1;const i=this.params.builder[e].activeWidgetKeys;return!!i.length&&i.includes(t)},findWidgetByKey:function(t,e){if(!this.params||!e||"desktop"!==e&&"mobile"!==e)return;const i=this.params.builder[e].availableWidgets;if(i.length)for(const n of i)if(n.key===t)return n},buildAvailableWidgetsPanel:function(){if(!this.container)return;const t=this.params;if(!t)return;const e=this.findHtmlEl?.(this.container[0],".wpbf-control-form");if(!e)return;const i=this;if(this.availableWidgetsPanels){for(const n in t.builder){if(!t.builder.hasOwnProperty(n))continue;if("desktop"!==n&&"mobile"!==n)continue;if(!t.builder[n].availableWidgets.length)continue;const a=jQuery("<div></div>").addClass("available-widgets-panel").attr("data-device",n).appendTo(e);this.availableWidgetsPanels[n]=a[0];const s=jQuery("<div></div>").addClass("builder-widgets available-widgets").appendTo(this.availableWidgetsPanels[n]);t.builder[n].availableWidgets.forEach(t=>{const e=t.key;jQuery("<div></div>").addClass(`widget-item widget-item-${e} ${i.isWidgetActive?.(e,n)?"disabled":""}`).attr("data-widget-key",e).attr("draggable","true").html(`<span class="widget-label">${t.label}</span>`).on("click",function(e){i.handleWidgetClick?.(this,t)}).appendTo(s)})}jQuery(document.body).append('<div class="widget-drag-helper"></div>')}},buildBuilderPanel:function(){const t=this,e=t.params;if(!e)return;const i=t.findHtmlEl?.("#customize-preview");if(!i)return;const n=jQuery("<div></div>").addClass(`wpbf-builder-panel ${e.id}-builder-panel`).attr("data-wpbf-builder-panel",e.id).insertAfter(i),a="empty-widget-list";for(const s in e.builder){if(!e.builder.hasOwnProperty(s))continue;if("desktop"!==s&&"mobile"!==s)continue;if(!e.builder[s].availableWidgets.length)continue;const i=jQuery("<div></div>").addClass("wpbf-builder-slots").attr("data-device",s).appendTo(n);if(!e.builder[s].availableWidgets.length)return;let d;if(e.builder[s].availableSlots.offcanvas){i.addClass("wpbf-flex wpbf-content-center");const n=jQuery("<div></div>").addClass("builder-offcanvas").appendTo(i),a=jQuery("<div></div>").addClass("builder-inner-offcanvas sortable-group").appendTo(n);jQuery("<button></button>").attr("type","button").addClass("row-setting-button").html(`<i class="dashicons dashicons-admin-generic"></i><span class="button-label">${e.builder[s].availableSlots.offcanvas.label}</span>`).on("click",()=>t.handleRowSettingClick?.(e.builder[s].availableSlots.offcanvas.key)).appendTo(a);const r=jQuery("<div></div>").addClass("builder-widgets active-widgets dotted-border").appendTo(a);e.value&&e.value[s].offcanvas?.forEach(e=>{const i=t.createWidgetItem?.(e,!0,s);i&&r.append(i)}),d=jQuery("<div></div>").addClass("builder-rows").appendTo(i)}const r=e.builder[s].availableSlots;if(!r.rows.length)continue;const o=d||i;r.rows.forEach(i=>{const n=jQuery("<div></div>").addClass("builder-row sortable-group").attr("data-row-key",i.key).appendTo(o),d=jQuery("<div></div>").addClass("builder-inner-row dotted-border").appendTo(n);jQuery("<div></div>").addClass("row-label").attr("data-row-key",i.key).text(i.label).appendTo(n),jQuery("<button></button>").addClass("row-setting-button").attr("type","button").attr("data-row-key",i.key).html('<i class="dashicons dashicons-admin-generic"></i>').on("click",()=>t.handleRowSettingClick?.(i.key)).appendTo(n);const r=e.value?e.value[s].rows[i.key]:void 0;i.columns.forEach((e,n)=>{let o="";e.key.endsWith("_start")?o="wpbf-content-start":e.key.endsWith("_end")?o="wpbf-content-end":0!==n&&n!==i.columns.length-1&&(o="wpbf-content-center column-middle"),0===n?o+=" column-start wpbf-content-start":n===i.columns.length-1&&(o+=" column-end wpbf-content-end");const l=jQuery("<div></div>").addClass(`builder-column builder-widgets active-widgets wpbf-flex ${o}`).attr("data-column-key",e.key).appendTo(d);if(!r||!Object.keys(r).length)return l.addClass(a),void l.html(t.emptyWidgetItemMarkup??"");const c=r[e.key];if(!c||!c.length)return l.addClass(a),void l.html(t.emptyWidgetItemMarkup??"");c.forEach(e=>{const i=t.createWidgetItem?.(e,!0,s);i&&l.append(i)})}),t.bindCustomizeSection?.(i.key)})}t.builderPanel=n[0]},handleRowSettingClick:function(e){t?.section(`wpbf_header_builder_${e}_section`,function(t){t.expand(t.params)})},bindCustomizeSection:function(e){t?.section(`wpbf_header_builder_${e}_section`,function(t){t.expanded.bind(function(t){const i=document.querySelector(`.builder-row[data-row-key="${e}"]`);i&&(t?i.classList.add("is-active"):i.classList.remove("is-active"))})})},handleWidgetClick:function(e,i){if(!e.classList.contains("ui-sortable-handle")&&!e.classList.contains("disabled"))return;if(!i.section)return;const n=t?.section(i.section);n&&n.params&&n.expand(n.params)},initDraggable:function(){if(!this.params||!this.container||!this.builderPanel)return;const t=this.findHtmlEl?.(".widget-drag-helper");if(!t)return;const e=this.findHtmlEls?.(this.container[0],".widget-item");if(!e||!e.length)return;const i=this;e.forEach(e=>{e instanceof HTMLElement&&(e.addEventListener("dragstart",n=>{if(!(n instanceof DragEvent))return;document.body.classList.add("is-dragging-widget"),e.classList.add("is-dragging"),t.classList.add("is-shown");const a=e.dataset.widgetKey;if(!a)return;i.draggableData={widgetKey:a},n.dataTransfer?.setData("text",JSON.stringify({widgetKey:a})),t.innerHTML=e.outerHTML;const s=e.getBoundingClientRect(),d=s.left,r=s.top;t.style.left=d+"px",t.style.top=r+"px";const o=i.findHtmlEl?.(t,".widget-item"),l=o?.getBoundingClientRect(),c=l?.width||80;t.style.width=c+"px",n.dataTransfer?.setDragImage(t,0,0),window.setTimeout(()=>{t.classList.remove("is-shown")},10)}),e.addEventListener("dragend",n=>{n instanceof DragEvent&&(n.preventDefault(),e.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),t.classList.remove("is-shown"),t.innerHTML="",t.removeAttribute("style"),i.draggableData=void 0)}))})},initDroppable:function(){if(!this.builderPanel)return;const t=this.findHtmlEls?.(this.builderPanel,".active-widgets");if(!t||!t.length)return;const e=this;t.forEach(t=>{t.addEventListener("dragenter",e=>{e instanceof DragEvent&&(e.preventDefault(),t.classList.add("dragover"))}),t.addEventListener("dragover",t=>{t.preventDefault()}),t.addEventListener("dragleave",e=>{e instanceof DragEvent&&(e.preventDefault(),t.classList.remove("dragover"))}),t.addEventListener("drop",i=>{if(!(i instanceof DragEvent))return;i.preventDefault(),t.classList.remove("dragover");const n=e.getWidgetItemFromDraggableData?.(i);if(!n)return;const a=n.dataset.widgetKey;if(!a)return;const s=t.closest(".wpbf-builder-slots");if(!(s instanceof HTMLElement))return;const d=s.dataset.device;if(!d||"desktop"!==d&&"mobile"!==d)return;const r=e.createWidgetItem?.(a,!0,d);if(!r)return;const o=t.querySelector(".ui-sortable-placeholder.from-available-widgets");o&&t.removeChild(o),t.classList.contains("column-end")?t.insertBefore(r,t.firstChild):t.appendChild(r);const l=t.querySelector(".empty-widget-item");l&&l.remove(),jQuery(t).sortable("refresh"),n.classList.add("disabled"),e.draggableData=void 0,e.updateCustomizerSetting?.()})})},parseDraggableData:function(t){const e=t.dataTransfer?.getData("text");if(!e)return;let i;try{i=JSON.parse(e)}catch(n){console.error("Error parsing JSON data:",n)}return i||void 0},getWidgetItemFromDraggableData:function(t){const e=t.dataTransfer?.getData("text");if(!e)return;if(!this.container)return;const i=this.parseDraggableData?.(t);if(!i)return;const n=i.widgetKey;if(!n)return;const a=this.findHtmlEl?.(this.container[0],`.widget-item[data-widget-key="${n}"]`);return a},createWidgetItem:function(t,e,i){if(!this.container)return;const n=this.findWidgetByKey?.(t,i);if(!n)return;const a=this,s=this.findHtmlEl?.(this.container[0],`.widget-item[data-widget-key="${t}"]`);if(!s)return;const d=s.cloneNode(!0);if(d instanceof HTMLElement){if(d.classList.remove("disabled"),d.classList.remove("is-dragging"),d.removeAttribute("draggable"),e){const t=document.createElement("button");t.type="button",t.className="widget-button delete-widget-button",t.innerHTML='<i class="dashicons dashicons-no-alt"></i>',d.appendChild(t),t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),a.handleDeleteActiveWidget?.(d,s)}),d.addEventListener("click",function(t){t.preventDefault(),a.handleWidgetClick?.(this,n)})}return d}},initSortable:function(){const t=this;jQuery(".active-widgets").sortable({connectWith:".active-widgets",placeholder:"widget-item",start:function(e,i){document.body.classList.add("is-sorting-widget");const n=t.findHtmlEl?.(i.item[0],".widget-label");n&&i.placeholder[0].appendChild(n.cloneNode(!0))},update:function(e,i){const n=e.target;n instanceof HTMLElement&&(t.checkSortableContent?.(n),t.updateCustomizerSetting?.())},stop:function(t,e){document.body.classList.remove("is-sorting-widget")}}),jQuery(".builder-column.column-middle").on("sortover",function(t,e){t.target.classList.remove("empty-widget-list")}),jQuery(".builder-column.column-middle").on("sortout",function(e,i){t.checkSortableContent?.(e.target)})},handleDeleteActiveWidget:function(t,e){const i=this;e?.classList.remove("disabled");const n=t.closest(".active-widgets");t.remove(),n instanceof HTMLElement&&i.checkSortableContent?.(n),n&&jQuery(n).sortable("refresh"),i.updateCustomizerSetting?.()},checkSortableContent:function(t){const e="empty-widget-list",i=t.querySelector(".empty-widget-item");this.isSortableEmpty?.(t)?(t.classList.add(e),i||jQuery(t).append(this.emptyWidgetItemMarkup??"")):(t.classList.remove(e),i&&i.remove())},destroySortable:function(){this.builderPanel&&jQuery(".wpbf-builder-panel .active-widgets").sortable("destroy")},updateCustomizerSetting:function(){this.isSaving||(this.isSaving=!0,setTimeout(()=>{if(!this.availableWidgetsPanels)return;const t={desktop:{offcanvas:[],rows:{}},mobile:{offcanvas:[],rows:{}}};for(const i of e){if("desktop"!==i&&"mobile"!==i)continue;const e=this.findHtmlEl?.(this.builderPanel,`.wpbf-builder-slots[data-device="${i}"]`);if(!e)return;const n=this.findHtmlEl?.(e,".builder-offcanvas .active-widgets"),a=this.findHtmlEls?.(n,".widget-item");a?.forEach(e=>{if(e.classList.contains("empty-widget-item"))return;if(e.classList.contains("ui-sortable-placeholder"))return;const n=e.dataset.widgetKey;n&&(t[i].offcanvas||(t[i].offcanvas=[]),t[i].offcanvas.push(n))});const s=this.findHtmlEls?.(e,".builder-row");s&&s.length&&s.forEach(e=>{const n=e.dataset.rowKey;if(!n)return;const a=this.findHtmlEls?.(e,".active-widgets");a&&a.length&&(t[i].rows[n]={},a.forEach(e=>{const a=e.dataset.columnKey;if(!a)return;t[i].rows[n][a]=[];const s=this.findHtmlEls?.(e,".widget-item");s&&s.length&&s.forEach(e=>{if(e.classList.contains("empty-widget-item"))return;if(e.classList.contains("ui-sortable-placeholder"))return;const s=e.dataset.widgetKey;s&&t[i].rows[n][a].push(s)})}))})}this.setting?.set(t),this.isSaving=!1},1))},updateComponentState:function(t){}}))}(window.wp.customize)}();
//# sourceMappingURL=responsive-builder-control-min.js.map
