var e;e=["desktop","mobile"],window.wp.customize&&(window.wp.customize.controlConstructor["wpbf-responsive-builder"]=window.wp.customize.wpbfDynamicControl.extend({isSaving:!1,draggableData:void 0,emptyWidgetItemMarkup:"<div class='widget-item empty-widget-item'>&nbsp;</div>",availableWidgetsPanels:{desktop:void 0,mobile:void 0},builderPanel:void 0,initWpbfControl:function(e){var t,i,a,l,n,d=null!=e?e:this;d&&(null===(t=d.setting)||void 0===t||t.bind(function(e){var t;null===(t=d.updateComponentState)||void 0===t||t.call(d,e)}),null===(i=d.buildAvailableWidgetsPanel)||void 0===i||i.call(d),null===(a=d.buildBuilderPanel)||void 0===a||a.call(d),null===(l=d.initDraggable)||void 0===l||l.call(d),null===(n=d.initDroppable)||void 0===n||n.call(d),window.setTimeout(function(){var e;null===(e=d.initSortable)||void 0===e||e.call(d)},1))},isSortableEmpty:function(e){var t,i=null===(t=this.findHtmlEls)||void 0===t?void 0:t.call(this,e,".widget-item");if(!i||!i.length)return!0;for(var a=0;a<i.length;a++){var l=i[a];if(!(l.classList.contains("empty-widget-item")||l.classList.contains("ui-sortable-placeholder"))&&!l.classList.contains("ui-sortable-helper"))return!1}return!0},isWidgetActive:function(e,t){if(!this.params||!t||"desktop"!==t&&"mobile"!==t)return!1;var i=this.params.builder[t].activeWidgetKeys;return!!i.length&&i.includes(e)},findWidgetByKey:function(e,t){if(this.params&&t&&("desktop"===t||"mobile"===t)){var i=this.params.builder[t].availableWidgets;if(i.length){var a=!0,l=!1,n=void 0;try{for(var d,o=i[Symbol.iterator]();!(a=(d=o.next()).done);a=!0){var r=d.value;if(r.key===e)return r}}catch(e){l=!0,n=e}finally{try{a||null==o.return||o.return()}finally{if(l)throw n}}}}},buildAvailableWidgetsPanel:function(){if(this.container){var e,t,i=this.params;if(i){var a=null===(e=this.findHtmlEl)||void 0===e?void 0:e.call(this,this.container[0],".wpbf-control-form");if(a){var l=this;for(var n in i.builder)t=this,function(e){if(i.builder.hasOwnProperty(e)&&("desktop"===e||"mobile"===e)&&i.builder[e].availableWidgets.length){var n=jQuery("<div></div>").addClass("available-widgets-panel").attr("data-device",e).appendTo(a);if(t.availableWidgetsPanels&&t.availableWidgetsPanels[e]){t.availableWidgetsPanels[e]=n[0];var d=jQuery("<div></div>").addClass("builder-widgets available-widgets").appendTo(t.availableWidgetsPanels[e]);i.builder[e].availableWidgets.forEach(function(e){var t,i=e.key;jQuery("<div></div>").addClass("widget-item widget-item-".concat(i," ").concat((null===(t=l.isWidgetActive)||void 0===t?void 0:t.call(l,i))?"disabled":"")).attr("data-widget-key",i).attr("draggable","true").html('<span class="widget-label">'.concat(e.label,"</span>")).on("click",function(t){var i;null===(i=l.handleWidgetClick)||void 0===i||i.call(l,this,e)}).appendTo(d)})}}}(n);jQuery(document.body).append('<div class="widget-drag-helper"></div>')}}}},buildBuilderPanel:function(){var e,t=function(e){if(!a.builder.hasOwnProperty(e)||"desktop"!==e&&"mobile"!==e||!a.builder[e].availableWidgets.length)return"continue";if(d.data("device",e),!a.builder[e].availableWidgets.length)return{v:void 0};var t=void 0;if("mobile"===e&&a.builder[e].availableSlots.sidebar){d.addClass("wpbf-flex wpbf-content-center");var l=jQuery("<div></div>").addClass("builder-sidebar builder-widgets active-widgets").text(a.builder[e].availableSlots.sidebar.label).appendTo(d);t=jQuery("<div></div>").addClass("builder-rows").appendTo(d),a.value&&a.value[e].sidebar.forEach(function(e){var t,a=null===(t=i.createWidgetItem)||void 0===t?void 0:t.call(i,e,!0);a&&l.append(a)})}var n=a.builder[e].availableSlots;if(!n.rows.length)return"continue";var r="mobile"===e&&t?t:d;n.rows.forEach(function(t){var l,n=jQuery("<div></div>").addClass("builder-row").attr("data-row-key",t.key).appendTo(r),d=jQuery("<div></div>").addClass("builder-inner-row").appendTo(n);jQuery("<div></div>").addClass("row-label").attr("data-row-key",t.key).text(t.label).appendTo(n),jQuery("<button></button>").addClass("row-setting-button").attr("data-row-key",t.key).html('<i class="dashicons dashicons-admin-generic"></i>').on("click",function(){var e;return null===(e=i.handleRowSettingClick)||void 0===e?void 0:e.call(i,t.key)}).appendTo(n);var s=a.value?a.value[e].rows[t.key]:void 0;t.columns.forEach(function(e,a){var l,n,r="";e.key.endsWith("_start")?r="wpbf-content-start":e.key.endsWith("_end")?r="wpbf-content-end":0!==a&&a!==t.columns.length-1&&(r="wpbf-content-center column-middle"),0===a?r+=" column-start wpbf-content-start":a===t.columns.length-1&&(r+=" column-end wpbf-content-end");var c=jQuery("<div></div>").addClass("builder-column builder-widgets active-widgets wpbf-flex ".concat(r)).attr("data-column-key",e.key).appendTo(d);if(!s||!Object.keys(s).length){c.addClass(o),c.html(null!==(l=i.emptyWidgetItemMarkup)&&void 0!==l?l:"");return}var v=s[e.key];if(!v||!v.length){c.addClass(o),c.html(null!==(n=i.emptyWidgetItemMarkup)&&void 0!==n?n:"");return}v.forEach(function(e){var t,a=null===(t=i.createWidgetItem)||void 0===t?void 0:t.call(i,e,!0);a&&c.append(a)})}),null===(l=i.bindCustomizeSection)||void 0===l||l.call(i,t.key)})},i=this,a=i.params;if(a){var l=null===(e=i.findHtmlEl)||void 0===e?void 0:e.call(i,"#customize-preview");if(l){var n=jQuery("<div></div>").addClass("wpbf-builder-panel ".concat(a.id,"-builder-panel")).attr("data-wpbf-builder-panel",a.id).insertAfter(l),d=jQuery("<div></div>").addClass("wpbf-builder-slots").appendTo(n),o="empty-widget-list";for(var r in a.builder){var s=t(r);if("object"==(s&&"undefined"!=typeof Symbol&&s.constructor===Symbol?"symbol":typeof s))return s.v}i.builderPanel=n[0]}}},handleRowSettingClick:function(e){var t;null===(t=window.wp.customize)||void 0===t||t.section("wpbf_header_builder_".concat(e,"_section"),function(e){e.expand(e.params)})},bindCustomizeSection:function(e){var t;null===(t=window.wp.customize)||void 0===t||t.section("wpbf_header_builder_".concat(e,"_section"),function(t){t.expanded.bind(function(t){var i=document.querySelector('.builder-row[data-row-key="'.concat(e,'"]'));i&&(t?i.classList.add("is-active"):i.classList.remove("is-active"))})})},handleWidgetClick:function(e,t){if((e.classList.contains("ui-sortable-handle")||e.classList.contains("disabled"))&&t.section){var i,a=null===(i=window.wp.customize)||void 0===i?void 0:i.section(t.section);a&&a.params&&a.expand(a.params)}},initDraggable:function(){if(this.params&&this.container&&this.builderPanel){var e,t,i=null===(e=this.findHtmlEl)||void 0===e?void 0:e.call(this,".widget-drag-helper");if(i){var a=null===(t=this.findHtmlEls)||void 0===t?void 0:t.call(this,this.container[0],".widget-item");if(a&&a.length){var l=this;a.forEach(function(e){e instanceof HTMLElement&&(e.addEventListener("dragstart",function(t){if(t instanceof DragEvent){document.body.classList.add("is-dragging-widget"),e.classList.add("is-dragging"),i.classList.add("is-shown");var a,n,d,o=e.dataset.widgetKey;if(o){l.draggableData={widgetKey:o},null===(a=t.dataTransfer)||void 0===a||a.setData("text",JSON.stringify({widgetKey:o})),i.innerHTML=e.outerHTML;var r=e.getBoundingClientRect(),s=r.left,c=r.top;i.style.left=s+"px",i.style.top=c+"px";var v=null===(n=l.findHtmlEl)||void 0===n?void 0:n.call(l,i,".widget-item"),u=null==v?void 0:v.getBoundingClientRect(),f=(null==u?void 0:u.width)||80;i.style.width=f+"px",null===(d=t.dataTransfer)||void 0===d||d.setDragImage(i,0,0),window.setTimeout(function(){i.classList.remove("is-shown")},10)}}}),e.addEventListener("dragend",function(t){t instanceof DragEvent&&(t.preventDefault(),e.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),i.classList.remove("is-shown"),i.innerHTML="",i.removeAttribute("style"),l.draggableData=void 0)}))})}}}},initDroppable:function(){if(this.builderPanel){var e,t=null===(e=this.findHtmlEls)||void 0===e?void 0:e.call(this,this.builderPanel,".active-widgets");if(t&&t.length){var i=this;t.forEach(function(e){e.addEventListener("dragenter",function(t){t instanceof DragEvent&&(t.preventDefault(),e.classList.add("dragover"))}),e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("dragleave",function(t){t instanceof DragEvent&&(t.preventDefault(),e.classList.remove("dragover"))}),e.addEventListener("drop",function(t){if(t instanceof DragEvent){t.preventDefault(),e.classList.remove("dragover");var a,l,n,d=null===(a=i.getWidgetItemFromDraggableData)||void 0===a?void 0:a.call(i,t);if(d){var o=d.dataset.widgetKey;if(o){var r=null===(l=i.createWidgetItem)||void 0===l?void 0:l.call(i,o,!0);if(r){var s=e.querySelector(".ui-sortable-placeholder.from-available-widgets");s&&e.removeChild(s),e.classList.contains("column-end")?e.insertBefore(r,e.firstChild):e.appendChild(r);var c=e.querySelector(".empty-widget-item");c&&c.remove(),jQuery(e).sortable("refresh"),d.classList.add("disabled"),i.draggableData=void 0,null===(n=i.updateCustomizerSetting)||void 0===n||n.call(i)}}}}})})}}},parseDraggableData:function(e){var t,i=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text");if(i){var a=void 0;try{a=JSON.parse(i)}catch(e){console.error("Error parsing JSON data:",e)}if(a)return a}},getWidgetItemFromDraggableData:function(e){if((null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text"))&&this.container){var t,i,a,l=null===(i=this.parseDraggableData)||void 0===i?void 0:i.call(this,e);if(l){var n=l.widgetKey;if(n)return null===(a=this.findHtmlEl)||void 0===a?void 0:a.call(this,this.container[0],'.widget-item[data-widget-key="'.concat(n,'"]'))}}},createWidgetItem:function(e,t){if(this.container){var i,a,l=null===(i=this.findWidgetByKey)||void 0===i?void 0:i.call(this,e);if(l){var n=this,d=null===(a=this.findHtmlEl)||void 0===a?void 0:a.call(this,this.container[0],'.widget-item[data-widget-key="'.concat(e,'"]'));if(d){var o=d.cloneNode(!0);if(o instanceof HTMLElement){if(o.classList.remove("disabled"),o.classList.remove("is-dragging"),o.removeAttribute("draggable"),t){var r=document.createElement("button");r.type="button",r.className="widget-button delete-widget-button",r.innerHTML='<i class="dashicons dashicons-no-alt"></i>',o.appendChild(r),r.addEventListener("click",function(e){var t;e.preventDefault(),e.stopPropagation(),null===(t=n.handleDeleteActiveWidget)||void 0===t||t.call(n,o,d)}),o.addEventListener("click",function(e){var t;e.preventDefault(),null===(t=n.handleWidgetClick)||void 0===t||t.call(n,this,l)})}return o}}}}},initSortable:function(){var e=this;jQuery(".active-widgets").sortable({connectWith:".active-widgets",placeholder:"widget-item",start:function(t,i){document.body.classList.add("is-sorting-widget");var a,l=null===(a=e.findHtmlEl)||void 0===a?void 0:a.call(e,i.item[0],".widget-label");l&&i.placeholder[0].appendChild(l.cloneNode(!0))},update:function(t,i){var a,l,n=t.target;n instanceof HTMLElement&&(null===(a=e.checkSortableContent)||void 0===a||a.call(e,n),null===(l=e.updateCustomizerSetting)||void 0===l||l.call(e))},stop:function(e,t){document.body.classList.remove("is-sorting-widget")}}),jQuery(".builder-column.column-middle").on("sortover",function(e,t){e.target.classList.remove("empty-widget-list")}),jQuery(".builder-column.column-middle").on("sortout",function(t,i){var a;null===(a=e.checkSortableContent)||void 0===a||a.call(e,t.target)})},handleDeleteActiveWidget:function(e,t){null==t||t.classList.remove("disabled");var i,a,l=e.closest(".active-widgets");e.remove(),l instanceof HTMLElement&&(null===(i=this.checkSortableContent)||void 0===i||i.call(this,l)),l&&jQuery(l).sortable("refresh"),null===(a=this.updateCustomizerSetting)||void 0===a||a.call(this)},checkSortableContent:function(e){var t,i,a="empty-widget-list",l=e.querySelector(".empty-widget-item");(null===(t=this.isSortableEmpty)||void 0===t?void 0:t.call(this,e))?(e.classList.add(a),l||jQuery(e).append(null!==(i=this.emptyWidgetItemMarkup)&&void 0!==i?i:"")):(e.classList.remove(a),l&&l.remove())},destroySortable:function(){this.builderPanel&&jQuery(".wpbf-builder-panel .active-widgets").sortable("destroy")},updateCustomizerSetting:function(){var t=this;t.isSaving||(t.isSaving=!0,setTimeout(function(){if(t.availableWidgetsPanels){var i={desktop:{rows:{}},mobile:{sidebar:[],rows:{}}},a=!0,l=!1,n=void 0;try{for(var d,o,r=e[Symbol.iterator]();!(a=(o=r.next()).done);a=!0)!function(){var e=o.value;if(t.availableWidgetsPanels.hasOwnProperty(e)&&("desktop"===e||"mobile"===e)){if("mobile"===e){var a,l,n,d=null===(l=t.findHtmlEl)||void 0===l?void 0:l.call(t,".builder-sidebar.active-widgets"),r=null===(n=t.findHtmlEls)||void 0===n?void 0:n.call(t,d,".widget-item");null==r||r.forEach(function(t){if(!(t.classList.contains("empty-widget-item")||t.classList.contains("ui-sortable-placeholder"))){var a=t.dataset.widgetKey;a&&i[e].sidebar.push(a)}})}var s=null===(a=t.findHtmlEls)||void 0===a?void 0:a.call(t,t.availableWidgetsPanels[e],".builder-row");s&&s.length&&s.forEach(function(a){var l,n=a.dataset.rowKey;if(n){var d=null===(l=t.findHtmlEls)||void 0===l?void 0:l.call(t,a,".active-widgets");d&&d.length&&d.forEach(function(a){var l,d=a.dataset.columnKey;if(d){i[e].rows[n][d]=[];var o=null===(l=t.findHtmlEls)||void 0===l?void 0:l.call(t,a,".widget-item");o&&o.length&&o.forEach(function(t){if(!(t.classList.contains("empty-widget-item")||t.classList.contains("ui-sortable-placeholder"))){var a=t.dataset.widgetKey;a&&i[e].rows[n][d].push(a)}})}})}})}}()}catch(e){l=!0,n=e}finally{try{a||null==r.return||r.return()}finally{if(l)throw n}}null===(d=t.setting)||void 0===d||d.set(i),t.isSaving=!1}},1))},updateComponentState:function(e){}}));
//# sourceMappingURL=responsive-builder-control-min.js.map
