window.wp.customize&&(window.wp.customize.controlConstructor["wpbf-builder"]=window.wp.customize.wpbfDynamicControl.extend({isSaving:!1,form:void 0,draggableData:void 0,emptyWidgetItemMarkup:"<div class='widget-item empty-widget-item'>&nbsp;</div>",availableWidgetsPanel:void 0,builderPanel:void 0,initWpbfControl:function(e){var t,i,a,l,n;(e=e||this)&&(null===(t=e.setting)||void 0===t||t.bind(function(t){var i;null===(i=e.updateComponentState)||void 0===i||i.call(e,t)}),null===(i=e.buildAvailableWidgetsPanel)||void 0===i||i.call(e),null===(a=e.buildBuilderPanel)||void 0===a||a.call(e),null===(l=e.initDraggable)||void 0===l||l.call(e),null===(n=e.initDroppable)||void 0===n||n.call(e),window.setTimeout(function(){var t;null===(t=e.initSortable)||void 0===t||t.call(e)},1))},isSortableEmpty:function(e){var t,i=null===(t=this.findHtmlEls)||void 0===t?void 0:t.call(this,e,".widget-item");if(!i||!i.length)return!0;for(var a=0;a<i.length;a++){var l=i[a];if(!(l.classList.contains("empty-widget-item")||l.classList.contains("ui-sortable-placeholder"))&&!l.classList.contains("ui-sortable-helper"))return!1}return!0},isWidgetActive:function(e){return!!this.params&&this.params.builder.activeWidgetKeys.includes(e)},findWidgetByKey:function(e){if(this.params){var t=this.params.builder.availableWidgets;if(t.length){var i=!0,a=!1,l=void 0;try{for(var n,d=t[Symbol.iterator]();!(i=(n=d.next()).done);i=!0){var o=n.value;if(o.key===e)return o}}catch(e){a=!0,l=e}finally{try{i||null==d.return||d.return()}finally{if(a)throw l}}}}},buildAvailableWidgetsPanel:function(){var e,t=this;if(t.container){var i=t.params;if(i){var a=null===(e=t.findHtmlEl)||void 0===e?void 0:e.call(t,t.container[0],".available-widgets-panel");if(a){t.availableWidgetsPanel=a,jQuery(document.body).append('<div class="widget-drag-helper"></div>');var l=i.builder.availableWidgets,n=jQuery("<div></div>").addClass("builder-widgets available-widgets").appendTo(t.availableWidgetsPanel);l.forEach(function(e){var i,a=e.key;jQuery("<div></div>").addClass("widget-item widget-item-".concat(a," ").concat((null===(i=t.isWidgetActive)||void 0===i?void 0:i.call(t,a))?"disabled":"")).attr("data-widget-key",a).attr("draggable","true").html('<span class="widget-label">'.concat(e.label,"</span>")).on("click",function(i){var a;null===(a=t.handleWidgetClick)||void 0===a||a.call(t,this,e)}).appendTo(n)})}}}},buildBuilderPanel:function(){var e,t=this,i=t.params;if(i){var a=i.builder.availableRows,l=i.builder.availableWidgets;if(a&&l){var n=null===(e=t.findHtmlEl)||void 0===e?void 0:e.call(t,"#customize-preview");if(n){var d=jQuery("<div></div>").addClass("wpbf-builder-panel ".concat(i.id,"-builder-panel")).attr("data-wpbf-builder-panel",i.id).insertAfter(n);a.forEach(function(e){var a,l=jQuery("<div></div>").addClass("builder-row").attr("data-row-key",e.key).appendTo(d),n=jQuery("<div></div>").addClass("builder-inner-row").appendTo(l);jQuery("<div></div>").addClass("row-label").attr("data-row-key",e.key).text(e.label).appendTo(l),jQuery("<button></button>").addClass("row-setting-button").attr("data-row-key",e.key).html('<i class="dashicons dashicons-admin-generic"></i>').on("click",function(){var i;return null===(i=t.handleRowSettingClick)||void 0===i?void 0:i.call(t,e.key)}).appendTo(l);var o=i.value[e.key];e.columns.forEach(function(i,a){var l,d,r="";i.key.endsWith("_start")?r="wpbf-content-start":i.key.endsWith("_end")?r="wpbf-content-end":0!==a&&a!==e.columns.length-1&&(r="wpbf-content-center column-middle"),0===a?r+=" column-start wpbf-content-start":a===e.columns.length-1&&(r+=" column-end wpbf-content-end");var s=jQuery("<div></div>").addClass("builder-widgets builder-column sortable-widgets wpbf-flex ".concat(r)).attr("data-column-key",i.key).appendTo(n),c="empty-widget-list";if(!o||!Object.keys(o).length){s.addClass(c),s.html(null!==(l=t.emptyWidgetItemMarkup)&&void 0!==l?l:"");return}var u=o[i.key];if(!u||!u.length){s.addClass(c),s.html(null!==(d=t.emptyWidgetItemMarkup)&&void 0!==d?d:"");return}u.forEach(function(e){var i,a=null===(i=t.createWidgetItem)||void 0===i?void 0:i.call(t,e,!0);a&&s.append(a)})}),null===(a=t.bindCustomizeSection)||void 0===a||a.call(t,e.key)}),t.builderPanel=d[0]}}}},handleRowSettingClick:function(e){var t;null===(t=window.wp.customize)||void 0===t||t.section("wpbf_header_builder_".concat(e,"_section"),function(e){e.expand(e.params)})},bindCustomizeSection:function(e){var t;null===(t=window.wp.customize)||void 0===t||t.section("wpbf_header_builder_".concat(e,"_section"),function(t){t.expanded.bind(function(t){var i=document.querySelector('.builder-row[data-row-key="'.concat(e,'"]'));i&&(t?i.classList.add("is-active"):i.classList.remove("is-active"))})})},handleWidgetClick:function(e,t){if((e.classList.contains("ui-sortable-handle")||e.classList.contains("disabled"))&&t.section){var i,a=null===(i=window.wp.customize)||void 0===i?void 0:i.section(t.section);a&&a.params&&a.expand(a.params)}},initDraggable:function(){var e,t,i=this;if(i.params&&i.availableWidgetsPanel&&i.builderPanel){var a=null===(e=i.findHtmlEl)||void 0===e?void 0:e.call(i,".widget-drag-helper");if(a){var l=null===(t=i.findHtmlEls)||void 0===t?void 0:t.call(i,i.availableWidgetsPanel,".widget-item");l&&l.length&&l.forEach(function(e){e instanceof HTMLElement&&(e.addEventListener("dragstart",function(t){if(t instanceof DragEvent){document.body.classList.add("is-dragging-widget"),e.classList.add("is-dragging"),a.classList.add("is-shown");var l,n,d,o=e.dataset.widgetKey;if(o){i.draggableData={widgetKey:o},null===(l=t.dataTransfer)||void 0===l||l.setData("text",JSON.stringify({widgetKey:o})),a.innerHTML=e.outerHTML;var r=e.getBoundingClientRect(),s=r.left,c=r.top;a.style.left=s+"px",a.style.top=c+"px";var u=null===(n=i.findHtmlEl)||void 0===n?void 0:n.call(i,a,".widget-item"),v=null==u?void 0:u.getBoundingClientRect(),g=(null==v?void 0:v.width)||80;a.style.width=g+"px",null===(d=t.dataTransfer)||void 0===d||d.setDragImage(a,0,0),window.setTimeout(function(){a.classList.remove("is-shown")},10)}}}),e.addEventListener("dragend",function(t){t instanceof DragEvent&&(t.preventDefault(),e.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),a.classList.remove("is-shown"),a.innerHTML="",a.removeAttribute("style"),i.draggableData=void 0)}))})}}},initDroppable:function(){var e,t=this;if(t.params&&t.availableWidgetsPanel&&t.builderPanel){var i=null===(e=t.findHtmlEls)||void 0===e?void 0:e.call(t,t.builderPanel,".builder-column");i&&i.length&&i.forEach(function(e){e.addEventListener("dragenter",function(t){t instanceof DragEvent&&(t.preventDefault(),e.classList.add("dragover"))}),e.addEventListener("dragover",function(e){e.preventDefault()}),e.addEventListener("dragleave",function(t){t instanceof DragEvent&&(t.preventDefault(),e.classList.remove("dragover"))}),e.addEventListener("drop",function(i){if(i instanceof DragEvent){i.preventDefault(),e.classList.remove("dragover");var a,l,n,d=null===(a=t.getWidgetItemFromDraggableData)||void 0===a?void 0:a.call(t,i);if(d){var o=d.dataset.widgetKey;if(o){var r=null===(l=t.createWidgetItem)||void 0===l?void 0:l.call(t,o,!0);if(r){var s=e.querySelector(".ui-sortable-placeholder.from-available-widgets");s&&e.removeChild(s),e.classList.contains("column-end")?e.insertBefore(r,e.firstChild):e.appendChild(r);var c=e.querySelector(".empty-widget-item");c&&c.remove(),jQuery(e).sortable("refresh"),d.classList.add("disabled"),t.draggableData=void 0,null===(n=t.updateCustomizerSetting)||void 0===n||n.call(t)}}}}})})}},parseDraggableData:function(e){var t,i=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text");if(i){var a=void 0;try{a=JSON.parse(i)}catch(e){console.error("Error parsing JSON data:",e)}if(a)return a}},getWidgetItemFromDraggableData:function(e){if(null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text")){var t,i,a,l=null===(i=this.parseDraggableData)||void 0===i?void 0:i.call(this,e);if(l){var n=l.widgetKey;if(n)return null===(a=this.findHtmlEl)||void 0===a?void 0:a.call(this,this.availableWidgetsPanel,'.widget-item[data-widget-key="'.concat(n,'"]'))}}},createWidgetItem:function(e,t){var i,a,l=this,n=null===(i=l.findWidgetByKey)||void 0===i?void 0:i.call(l,e);if(n){var d=null===(a=l.findHtmlEl)||void 0===a?void 0:a.call(l,l.availableWidgetsPanel,'.widget-item[data-widget-key="'.concat(e,'"]'));if(d){var o=d.cloneNode(!0);if(o instanceof HTMLElement){if(o.classList.remove("disabled"),o.classList.remove("is-dragging"),o.removeAttribute("draggable"),t){var r=document.createElement("button");r.type="button",r.className="widget-button delete-widget-button",r.innerHTML='<i class="dashicons dashicons-no-alt"></i>',o.appendChild(r),r.addEventListener("click",function(e){var t;e.preventDefault(),e.stopPropagation(),null===(t=l.handleDeleteActiveWidget)||void 0===t||t.call(l,o,d)}),o.addEventListener("click",function(e){var t;e.preventDefault(),null===(t=l.handleWidgetClick)||void 0===t||t.call(l,this,n)})}return o}}}},initSortable:function(){var e=this;e.params&&e.availableWidgetsPanel&&e.builderPanel&&(jQuery(".sortable-widgets").sortable({connectWith:".builder-column",placeholder:"widget-item",start:function(t,i){document.body.classList.add("is-sorting-widget");var a,l=null===(a=e.findHtmlEl)||void 0===a?void 0:a.call(e,i.item[0],".widget-label");l&&i.placeholder[0].appendChild(l.cloneNode(!0))},update:function(t,i){var a,l,n=t.target;n instanceof HTMLElement&&(null===(a=e.checkSortableContent)||void 0===a||a.call(e,n),null===(l=e.updateCustomizerSetting)||void 0===l||l.call(e))},stop:function(e,t){document.body.classList.remove("is-sorting-widget")}}),jQuery(".builder-column.column-middle").on("sortover",function(e,t){e.target.classList.remove("empty-widget-list")}),jQuery(".builder-column.column-middle").on("sortout",function(t,i){var a;null===(a=e.checkSortableContent)||void 0===a||a.call(e,t.target)}))},handleDeleteActiveWidget:function(e,t){null==t||t.classList.remove("disabled");var i,a,l=e.closest(".sortable-widgets");e.remove(),l instanceof HTMLElement&&(null===(i=this.checkSortableContent)||void 0===i||i.call(this,l)),l&&jQuery(l).sortable("refresh"),null===(a=this.updateCustomizerSetting)||void 0===a||a.call(this)},checkSortableContent:function(e){var t,i,a="empty-widget-list",l=e.querySelector(".empty-widget-item");(null===(t=this.isSortableEmpty)||void 0===t?void 0:t.call(this,e))?(e.classList.add(a),l||jQuery(e).append(null!==(i=this.emptyWidgetItemMarkup)&&void 0!==i?i:"")):(e.classList.remove(a),l&&l.remove())},destroySortable:function(){this.availableWidgetsPanel&&this.builderPanel&&jQuery(".builder-column").sortable("destroy")},updateCustomizerSetting:function(){var e=this;e.isSaving||(e.isSaving=!0,setTimeout(function(){var t,i,a=null===(t=e.findHtmlEls)||void 0===t?void 0:t.call(e,e.builderPanel,".builder-row");if(!a||!a.length){e.isSaving=!1;return}var l={};a.forEach(function(t){var i,a=t.dataset.rowKey;if(a){l[a]={};var n=null===(i=e.findHtmlEls)||void 0===i?void 0:i.call(e,t,".builder-column.sortable-widgets");n&&n.length&&n.forEach(function(t){var i,n=t.dataset.columnKey;if(n){l[a][n]=[];var d=null===(i=e.findHtmlEls)||void 0===i?void 0:i.call(e,t,".widget-item");d&&d.length&&d.forEach(function(e){if(!(e.classList.contains("empty-widget-item")||e.classList.contains("ui-sortable-placeholder"))){var t=e.dataset.widgetKey;t&&l[a][n].push(t)}})}})}}),null===(i=e.setting)||void 0===i||i.set(l),e.isSaving=!1},1))},updateComponentState:function(e){}}));
//# sourceMappingURL=builder-control-min.js.map
