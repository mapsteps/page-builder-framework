!function(){function e(e){try{return JSON.stringify(e)}catch(e){return""}}let t=wp.customize.controlConstructor["wpbf-header-builder"]=wp.customize.wpbfDynamicControl.extend({form:void 0,valueField:void 0,availableWidgetsPanel:void 0,builderPanel:void 0,sortables:void 0,initWpbfControl:function(e){if(!(e=e||this)||"wpbf-header-builder"!==e.params.type)return;let t=document.querySelector(`#_customize-input-${e.id} .wpbf-control-form`);t instanceof HTMLElement&&(e.form=t),e.setting?.bind(t=>{e.updateComponentState?.(t)}),e.valueField=e.form?.querySelector("textarea"),e.valueField?.addEventListener("change",function(){if(!e.setting)return;let t=function(e){if(""!==e&&e)try{return JSON.parse(e)}catch(e){return}}(this.value);t&&e.setting.set(t)}),e.buildAvailableWidgetsPanel?.(),e.buildBuilderPanel?.(),window.setTimeout(()=>{e.initSortable?.()},1)},buildAvailableWidgetsPanel:function(){if(!this.container)return;let e=this.params;if(!e)return;let t=this.container[0].querySelector(".available-widgets-panel");if(!(t instanceof HTMLElement))return;this.availableWidgetsPanel=t,jQuery(document.body).append('<div class="widget-drag-helper"></div>');let i=e.headerBuilder.availableWidgets,a={};for(let t in e.value)e.value.hasOwnProperty(t)&&(a[t]=e.value[t]);let r=jQuery("<div></div>").addClass("header-builder-widgets available-widgets").appendTo(this.availableWidgetsPanel);for(let e in i)i.hasOwnProperty(e)&&jQuery("<div></div>").addClass(`widget-item widget-item-${e} ${a[e]?"disabled":""}`).attr("data-widget-key",e).attr("draggable","true").html(`<span class="widget-label">${i[e]}</span>`).appendTo(r)},buildBuilderPanel:function(){let e=this.params;if(!e)return;let t=e.headerBuilder.availableRows,i=e.headerBuilder.availableWidgets;if(!t||!i)return;let a=document.querySelector("#customize-preview");if(!(a instanceof HTMLElement))return;let r=jQuery("<div></div>").addClass("header-builder-panel").insertAfter(a);for(let a in t){if(!t.hasOwnProperty(a))continue;let n=jQuery("<div></div>").addClass(`builder-row builder-${a}`).attr("data-row-key",a).appendTo(r),l=jQuery("<div></div>").addClass(`header-builder-widgets builder-widgets builder-widgets-${a} sortable-widgets`).appendTo(n),d=e.value[a];if(d)for(let e in d)d.hasOwnProperty(e)&&jQuery("<div></div>").addClass(`widget-item widget-item-${e}`).attr("data-widget-key",e).html(`<span class="widget-label">${i[e]}</span>`).appendTo(l)}this.builderPanel=r[0]},initSortable:function(){let e=this;if(!e.params||!e.availableWidgetsPanel||!e.builderPanel)return;let t=document.querySelector(".widget-drag-helper");if(!(t instanceof HTMLElement))return;let i=e.availableWidgetsPanel?.querySelectorAll(".widget-item");i&&i.length&&i.forEach(e=>{e instanceof HTMLElement&&(e.addEventListener("dragstart",function(i){if(!(i instanceof DragEvent))return;document.body.classList.add("is-dragging-widget"),e.classList.add("is-dragging"),t.classList.add("is-shown");let a=e.dataset.widgetKey;i.dataTransfer?.setData("text",JSON.stringify({widgetKey:a})),t.innerHTML=e.outerHTML;let r=e.getBoundingClientRect(),n=r.left,l=r.top;t.style.left=n+"px",t.style.top=l+"px";let d=t.querySelector(".widget-item"),s=d?.getBoundingClientRect(),o=s?.width||80,u=s?.height||30;t.style.width=o+"px";let c=i.clientX-o/2,g=i.clientY-u/2;i.dataTransfer?.setDragImage(t,c,g),window.setTimeout(()=>{t.classList.remove("is-shown")},10)}),e.addEventListener("drag",function(e){}),e.addEventListener("dragend",function(i){i instanceof DragEvent&&(i.preventDefault(),e.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),t.classList.remove("is-shown"),t.innerHTML="",t.removeAttribute("style"))}))}),jQuery(".builder-widgets").sortable({connectWith:".sortable-widgets",helper:"clone",start:function(e,t){document.body.classList.add("is-dragging-widget")},update:function(e,t){},stop:function(e,t){document.body.classList.remove("is-dragging-widget")}});let a=e.builderPanel?.querySelectorAll(".builder-widgets");a&&a.length&&a.forEach(t=>{t instanceof HTMLElement&&(t.addEventListener("dragover",function(e){e instanceof DragEvent&&(t.classList.add("dragover"),e.preventDefault())}),t.addEventListener("dragleave",function(e){e instanceof DragEvent&&e.preventDefault()}),t.addEventListener("drop",function(i){if(!(i instanceof DragEvent))return;i.preventDefault();let a=i.dataTransfer?.getData("text");if(!a)return;let r=null;try{r=JSON.parse(a)}catch(e){console.error("Error parsing JSON data:",e),r=null}if(!r)return;let n=r.widgetKey;if(!n)return;let l=e.availableWidgetsPanel?.querySelector(`.widget-item[data-widget-key="${n}"]`);if(!l)return;let d=l.cloneNode(!0);t.appendChild(d),jQuery(".builder-widgets").sortable("refresh"),l.classList.add("disabled")}))})},destroySortable:function(){this.availableWidgetsPanel&&this.builderPanel&&jQuery(".builder-widgets").sortable("destroy")},updateComponentState:function(t){let i=this.form?.querySelector("textarea");i&&(i.value=e(t))},valuesEqual:function(t,i){return e(t)===e(i)}});wp.customize.controlConstructor["wpbf-header-builder"]=t}();
//# sourceMappingURL=builder-control-min.js.map
