!function(){function e(e){try{return JSON.stringify(e)}catch(e){return""}}let t=wp.customize.controlConstructor["wpbf-header-builder"]=wp.customize.wpbfDynamicControl.extend({form:void 0,valueField:void 0,availableWidgetsPanel:void 0,builderPanel:void 0,initWpbfControl:function(e){if(!(e=e||this))return;let t=document.querySelector(`#_customize-input-${e.id} .wpbf-control-form`);t instanceof HTMLElement&&(e.form=t),e.setting?.bind(t=>{e.updateComponentState?.(t)}),e.valueField=e.form?.querySelector("textarea"),e.valueField?.addEventListener("change",function(){if(!e.setting)return;let t=function(e){if(""!==e&&e)try{return JSON.parse(e)}catch(e){return}}(this.value);t&&e.setting.set(t)}),e.buildAvailableWidgetsPanel?.(),e.buildBuilderPanel?.(),e.initDraggable?.(),window.setTimeout(()=>{e.initSortable?.()},1)},isWidgetActive:function(e){if(!this.params)return!1;let t=this.params.value;if(!t)return!1;for(let i in t){if(!t.hasOwnProperty(i))continue;let a=t[i];if(a&&Object.keys(a).length)for(let t in a){if(!a.hasOwnProperty(t))continue;let i=a[t];if(i&&i.length&&i.includes(e))return!0}}return!1},findWidgetByKey:function(e){if(!this.params)return;let t=this.params.headerBuilder.availableWidgets;if(t.length){for(let i of t)if(i.key===e)return i}},buildAvailableWidgetsPanel:function(){let e=this;if(!e.container)return;let t=e.params;if(!t)return;let i=e.container[0].querySelector(".available-widgets-panel");if(!(i instanceof HTMLElement))return;e.availableWidgetsPanel=i,jQuery(document.body).append('<div class="widget-drag-helper"></div>');let a=t.headerBuilder.availableWidgets,r=jQuery("<div></div>").addClass("header-builder-widgets available-widgets").appendTo(e.availableWidgetsPanel);a.forEach(t=>{let i=t.key;jQuery("<div></div>").addClass(`widget-item widget-item-${i} ${e.isWidgetActive?.(i)?"disabled":""}`).attr("data-widget-key",i).attr("draggable","true").html(`<span class="widget-label">${t.label}</span>`).appendTo(r)})},buildBuilderPanel:function(){let e=this,t=e.params;if(!t)return;let i=t.headerBuilder.availableRows,a=t.headerBuilder.availableWidgets;if(!i||!a)return;let r=document.querySelector("#customize-preview");if(!(r instanceof HTMLElement))return;let n=jQuery("<div></div>").addClass("header-builder-panel").insertAfter(r),l="<div class='widget-item empty-widget-item'>&nbsp;</div>";i.forEach(i=>{let a=jQuery("<div></div>").addClass("builder-row").attr("data-row-key",i.key).appendTo(n),r=jQuery("<div></div>").addClass("builder-inner-row").appendTo(a);jQuery("<button></button>").addClass("row-setting-button").attr("data-row-key",i.key).html('<i class="dashicons dashicons-admin-generic"></i>').appendTo(a);let d=t.value[i.key];i.columns.forEach(t=>{let i=jQuery("<div></div>").addClass("header-builder-widgets builder-column sortable-widgets").attr("data-column-key",t.key).appendTo(r);if(!d||!Object.keys(d).length){i.html(l);return}let a=d[t.key];if(!a||!a.length){i.html(l);return}a.forEach(t=>{let a=e.findWidgetByKey?.(t);a&&jQuery("<div></div>").addClass(`widget-item widget-item-${t}`).attr("data-widget-key",t).html(`<span class="widget-label">${a.label}</span>`).appendTo(i)})})}),this.builderPanel=n[0]},initDraggable:function(){let e=this;if(!e.params||!e.availableWidgetsPanel||!e.builderPanel)return;let t=document.querySelector(".widget-drag-helper");if(!(t instanceof HTMLElement))return;let i=e.availableWidgetsPanel?.querySelectorAll(".widget-item");i&&i.length&&i.forEach(e=>{e instanceof HTMLElement&&(e.addEventListener("dragstart",function(i){if(!(i instanceof DragEvent))return;document.body.classList.add("is-dragging-widget"),e.classList.add("is-dragging"),t.classList.add("is-shown");let a=e.dataset.widgetKey;i.dataTransfer?.setData("text",JSON.stringify({widgetKey:a})),t.innerHTML=e.outerHTML;let r=e.getBoundingClientRect(),n=r.left,l=r.top;t.style.left=n+"px",t.style.top=l+"px";let d=t.querySelector(".widget-item"),s=d?.getBoundingClientRect(),o=s?.width||80;t.style.width=o+"px",i.dataTransfer?.setDragImage(t,0,0),window.setTimeout(()=>{t.classList.remove("is-shown")},10)}),e.addEventListener("drag",function(e){}),e.addEventListener("dragend",function(i){i instanceof DragEvent&&(i.preventDefault(),e.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),t.classList.remove("is-shown"),t.innerHTML="",t.removeAttribute("style"))}))});let a=e.builderPanel?.querySelectorAll(".builder-column");a&&a.length&&a.forEach(t=>{t instanceof HTMLElement&&(t.addEventListener("dragover",function(e){e instanceof DragEvent&&(e.preventDefault(),t.classList.add("dragover"))}),t.addEventListener("dragleave",function(e){e instanceof DragEvent&&(e.preventDefault(),t.classList.remove("dragover"))}),t.addEventListener("drop",function(i){if(!(i instanceof DragEvent))return;i.preventDefault(),t.classList.remove("dragover");let a=i.dataTransfer?.getData("text");if(!a)return;let r=null;try{r=JSON.parse(a)}catch(e){console.error("Error parsing JSON data:",e),r=null}if(!r)return;let n=r.widgetKey;if(!n)return;let l=e.availableWidgetsPanel?.querySelector(`.widget-item[data-widget-key="${n}"]`);if(!l)return;let d=t.querySelector(".empty-widget-item");d&&d.remove();let s=l.cloneNode(!0);s instanceof HTMLElement&&(s.classList.remove("disabled"),s.classList.remove("is-dragging")),t.appendChild(s),jQuery(".builder-column").sortable("refresh"),l.classList.add("disabled")}))})},initSortable:function(){this.params&&this.availableWidgetsPanel&&this.builderPanel&&jQuery(".sortable-widgets").sortable({connectWith:".builder-column",placeholder:"widget-item sortable-placeholder",start:function(e,t){document.body.classList.add("is-sorting-widget");let i=t.item[0].querySelector(".widget-label");i instanceof HTMLElement&&t.placeholder[0].appendChild(i.cloneNode(!0))},update:function(e,t){let i=e.target;i.children.length||jQuery(i).append("<div class='widget-item empty-widget-item'>&nbsp;</div>")},stop:function(e,t){document.body.classList.remove("is-sorting-widget")}})},destroySortable:function(){this.availableWidgetsPanel&&this.builderPanel&&jQuery(".builder-column").sortable("destroy")},updateComponentState:function(t){let i=this.form?.querySelector("textarea");i&&(i.value=e(t))},valuesEqual:function(t,i){return e(t)===e(i)}});wp.customize.controlConstructor["wpbf-header-builder"]=t}();
//# sourceMappingURL=builder-control-min.js.map
