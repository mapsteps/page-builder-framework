!function(){"use strict";window.wp.customize&&(window.wp.customize.controlConstructor["wpbf-builder"]=window.wp.customize.wpbfDynamicControl.extend({isSaving:!1,form:void 0,draggableData:void 0,emptyWidgetItemMarkup:"<div class='widget-item empty-widget-item'>&nbsp;</div>",availableWidgetsPanel:void 0,builderPanel:void 0,initWpbfControl:function(e){(e=e||this)&&(e.setting?.bind(t=>{e.updateComponentState?.(t)}),e.buildAvailableWidgetsPanel?.(),e.buildBuilderPanel?.(),e.initDraggable?.(),e.initDroppable?.(),window.setTimeout(()=>{e.initSortable?.()},1))},isSortableEmpty:function(e){const t=this.findHtmlEls?.(e,".widget-item");if(!t||!t.length)return!0;for(let i=0;i<t.length;i++){const e=t[i];if(!e.classList.contains("empty-widget-item")&&!e.classList.contains("ui-sortable-placeholder")&&!e.classList.contains("ui-sortable-helper"))return!1}return!0},isWidgetActive:function(e){return!!this.params&&this.params.builder.activeWidgetKeys.includes(e)},findWidgetByKey:function(e){if(!this.params)return;const t=this.params.builder.availableWidgets;if(t.length)for(const i of t)if(i.key===e)return i},buildAvailableWidgetsPanel:function(){const e=this;if(!e.container)return;const t=e.params;if(!t)return;const i=e.findHtmlEl?.(e.container[0],".available-widgets-panel");if(!i)return;e.availableWidgetsPanel=i,jQuery(document.body).append('<div class="widget-drag-helper"></div>');const n=t.builder.availableWidgets,a=jQuery("<div></div>").addClass("builder-widgets available-widgets").appendTo(e.availableWidgetsPanel);n.forEach(t=>{const i=t.key;jQuery("<div></div>").addClass(`widget-item widget-item-${i} ${e.isWidgetActive?.(i)?"disabled":""}`).attr("data-widget-key",i).attr("draggable","true").html(`<span class="widget-label">${t.label}</span>`).on("click",function(i){e.handleWidgetClick?.(this,t)}).appendTo(a)})},buildBuilderPanel:function(){const e=this,t=e.params;if(!t)return;const i=t.builder.availableRows,n=t.builder.availableWidgets;if(!i||!n)return;const a=e.findHtmlEl?.("#customize-preview");if(!a)return;const s=jQuery("<div></div>").addClass(`wpbf-builder-panel ${t.id}-builder-panel`).attr("data-wpbf-builder-panel",t.id).insertAfter(a);i.forEach(i=>{const n=jQuery("<div></div>").addClass("builder-row").attr("data-row-key",i.key).appendTo(s),a=jQuery("<div></div>").addClass("builder-inner-row").appendTo(n);jQuery("<div></div>").addClass("row-label").attr("data-row-key",i.key).text(i.label).appendTo(n),jQuery("<button></button>").addClass("row-setting-button").attr("data-row-key",i.key).html('<i class="dashicons dashicons-admin-generic"></i>').on("click",()=>e.handleRowSettingClick?.(i.key)).appendTo(n);const r=t.value[i.key];i.columns.forEach((t,n)=>{let s="";t.key.endsWith("_start")?s="wpbf-content-start":t.key.endsWith("_end")?s="wpbf-content-end":0!==n&&n!==i.columns.length-1&&(s="wpbf-content-center column-middle"),0===n?s+=" column-start wpbf-content-start":n===i.columns.length-1&&(s+=" column-end wpbf-content-end");const d=jQuery("<div></div>").addClass(`builder-widgets builder-column sortable-widgets wpbf-flex ${s}`).attr("data-column-key",t.key).appendTo(a),o="empty-widget-list";if(!r||!Object.keys(r).length)return d.addClass(o),void d.html(e.emptyWidgetItemMarkup??"");const l=r[t.key];if(!l||!l.length)return d.addClass(o),void d.html(e.emptyWidgetItemMarkup??"");l.forEach(t=>{const i=e.createWidgetItem?.(t,!0);i&&d.append(i)})}),e.bindCustomizeSection?.(i.key)}),e.builderPanel=s[0]},handleRowSettingClick:function(e){window.wp.customize?.section(`wpbf_header_builder_${e}_section`,function(e){e.expand(e.params)})},bindCustomizeSection:function(e){window.wp.customize?.section(`wpbf_header_builder_${e}_section`,function(t){t.expanded.bind(function(t){const i=document.querySelector(`.builder-row[data-row-key="${e}"]`);i&&(t?i.classList.add("is-active"):i.classList.remove("is-active"))})})},handleWidgetClick:function(e,t){if(!e.classList.contains("ui-sortable-handle")&&!e.classList.contains("disabled"))return;if(!t.section)return;const i=window.wp.customize?.section(t.section);i&&i.params&&i.expand(i.params)},initDraggable:function(){const e=this;if(!e.params)return;if(!e.availableWidgetsPanel||!e.builderPanel)return;const t=e.findHtmlEl?.(".widget-drag-helper");if(!t)return;const i=e.findHtmlEls?.(e.availableWidgetsPanel,".widget-item");i&&i.length&&i.forEach(i=>{i instanceof HTMLElement&&(i.addEventListener("dragstart",function(n){if(!(n instanceof DragEvent))return;document.body.classList.add("is-dragging-widget"),i.classList.add("is-dragging"),t.classList.add("is-shown");const a=i.dataset.widgetKey;if(!a)return;e.draggableData={widgetKey:a},n.dataTransfer?.setData("text",JSON.stringify({widgetKey:a})),t.innerHTML=i.outerHTML;const s=i.getBoundingClientRect(),r=s.left,d=s.top;t.style.left=r+"px",t.style.top=d+"px";const o=e.findHtmlEl?.(t,".widget-item"),l=o?.getBoundingClientRect(),c=l?.width||80;t.style.width=c+"px",n.dataTransfer?.setDragImage(t,0,0),window.setTimeout(()=>{t.classList.remove("is-shown")},10)}),i.addEventListener("dragend",function(n){n instanceof DragEvent&&(n.preventDefault(),i.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),t.classList.remove("is-shown"),t.innerHTML="",t.removeAttribute("style"),e.draggableData=void 0)}))})},initDroppable:function(){const e=this;if(!e.params)return;if(!e.availableWidgetsPanel||!e.builderPanel)return;const t=e.findHtmlEls?.(e.builderPanel,".builder-column");t&&t.length&&t.forEach(t=>{t.addEventListener("dragenter",function(e){e instanceof DragEvent&&(e.preventDefault(),t.classList.add("dragover"))}),t.addEventListener("dragover",function(e){e.preventDefault()}),t.addEventListener("dragleave",function(e){e instanceof DragEvent&&(e.preventDefault(),t.classList.remove("dragover"))}),t.addEventListener("drop",function(i){if(!(i instanceof DragEvent))return;i.preventDefault(),t.classList.remove("dragover");const n=e.getWidgetItemFromDraggableData?.(i);if(!n)return;const a=n.dataset.widgetKey;if(!a)return;const s=e.createWidgetItem?.(a,!0);if(!s)return;const r=t.querySelector(".ui-sortable-placeholder.from-available-widgets");r&&t.removeChild(r),t.classList.contains("column-end")?t.insertBefore(s,t.firstChild):t.appendChild(s);const d=t.querySelector(".empty-widget-item");d&&d.remove(),jQuery(t).sortable("refresh"),n.classList.add("disabled"),e.draggableData=void 0,e.updateCustomizerSetting?.()})})},parseDraggableData:function(e){const t=e.dataTransfer?.getData("text");if(!t)return;let i;try{i=JSON.parse(t)}catch(n){console.error("Error parsing JSON data:",n)}return i||void 0},getWidgetItemFromDraggableData:function(e){const t=e.dataTransfer?.getData("text");if(!t)return;const i=this.parseDraggableData?.(e);if(!i)return;const n=i.widgetKey;if(!n)return;const a=this.findHtmlEl?.(this.availableWidgetsPanel,`.widget-item[data-widget-key="${n}"]`);return a},createWidgetItem:function(e,t){const i=this,n=i.findWidgetByKey?.(e);if(!n)return;const a=i.findHtmlEl?.(i.availableWidgetsPanel,`.widget-item[data-widget-key="${e}"]`);if(!a)return;const s=a.cloneNode(!0);if(s instanceof HTMLElement){if(s.classList.remove("disabled"),s.classList.remove("is-dragging"),s.removeAttribute("draggable"),t){const e=document.createElement("button");e.type="button",e.className="widget-button delete-widget-button",e.innerHTML='<i class="dashicons dashicons-no-alt"></i>',s.appendChild(e),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),i.handleDeleteActiveWidget?.(s,a)}),s.addEventListener("click",function(e){e.preventDefault(),i.handleWidgetClick?.(this,n)})}return s}},initSortable:function(){const e=this;e.params&&e.availableWidgetsPanel&&e.builderPanel&&(jQuery(".sortable-widgets").sortable({connectWith:".builder-column",placeholder:"widget-item",start:function(t,i){document.body.classList.add("is-sorting-widget");const n=e.findHtmlEl?.(i.item[0],".widget-label");n&&i.placeholder[0].appendChild(n.cloneNode(!0))},update:function(t,i){const n=t.target;n instanceof HTMLElement&&(e.checkSortableContent?.(n),e.updateCustomizerSetting?.())},stop:function(e,t){document.body.classList.remove("is-sorting-widget")}}),jQuery(".builder-column.column-middle").on("sortover",function(e,t){e.target.classList.remove("empty-widget-list")}),jQuery(".builder-column.column-middle").on("sortout",function(t,i){e.checkSortableContent?.(t.target)}))},handleDeleteActiveWidget:function(e,t){const i=this;t?.classList.remove("disabled");const n=e.closest(".sortable-widgets");e.remove(),n instanceof HTMLElement&&i.checkSortableContent?.(n),n&&jQuery(n).sortable("refresh"),i.updateCustomizerSetting?.()},checkSortableContent:function(e){const t="empty-widget-list",i=e.querySelector(".empty-widget-item");this.isSortableEmpty?.(e)?(e.classList.add(t),i||jQuery(e).append(this.emptyWidgetItemMarkup??"")):(e.classList.remove(t),i&&i.remove())},destroySortable:function(){this.availableWidgetsPanel&&this.builderPanel&&jQuery(".builder-column").sortable("destroy")},updateCustomizerSetting:function(){const e=this;e.isSaving||(e.isSaving=!0,setTimeout(()=>{const t=e.findHtmlEls?.(e.builderPanel,".builder-row");if(!t||!t.length)return void(e.isSaving=!1);const i={};t.forEach(t=>{const n=t.dataset.rowKey;if(!n)return;i[n]={};const a=e.findHtmlEls?.(t,".builder-column.sortable-widgets");a&&a.length&&a.forEach(t=>{const a=t.dataset.columnKey;if(!a)return;i[n][a]=[];const s=e.findHtmlEls?.(t,".widget-item");s&&s.length&&s.forEach(e=>{if(e.classList.contains("empty-widget-item"))return;if(e.classList.contains("ui-sortable-placeholder"))return;const t=e.dataset.widgetKey;t&&i[n][a].push(t)})})}),e.setting?.set(i),e.isSaving=!1},1))},updateComponentState:function(e){}}))}();
//# sourceMappingURL=builder-control-min.js.map
