window.wp.customize&&(window.wp.customize.controlConstructor["wpbf-builder"]=window.wp.customize.wpbfDynamicControl.extend({isSaving:!1,form:void 0,draggableData:void 0,emptyWidgetItemMarkup:"<div class='widget-item empty-widget-item'>&nbsp;</div>",availableWidgetsPanel:void 0,builderPanel:void 0,initWpbfControl:function(e){(e=e||this)&&(e.setting?.bind(t=>{e.updateComponentState?.(t)}),e.buildAvailableWidgetsPanel?.(),e.buildBuilderPanel?.(),e.initDraggable?.(),e.initDroppable?.(),window.setTimeout(()=>{e.initSortable?.()},1))},isSortableEmpty:function(e){let t=this.findHtmlEls?.(e,".widget-item");if(!t||!t.length)return!0;for(let e=0;e<t.length;e++){let i=t[e];if(!(i.classList.contains("empty-widget-item")||i.classList.contains("ui-sortable-placeholder"))&&!i.classList.contains("ui-sortable-helper"))return!1}return!0},isWidgetActive:function(e){return!!this.params&&this.params.builder.activeWidgetKeys.includes(e)},findWidgetByKey:function(e){if(!this.params)return;let t=this.params.builder.availableWidgets;if(t.length){for(let i of t)if(i.key===e)return i}},buildAvailableWidgetsPanel:function(){let e=this;if(!e.container)return;let t=e.params;if(!t)return;let i=e.findHtmlEl?.(e.container[0],".available-widgets-panel");if(!i)return;e.availableWidgetsPanel=i,jQuery(document.body).append('<div class="widget-drag-helper"></div>');let a=t.builder.availableWidgets,n=jQuery("<div></div>").addClass("builder-widgets available-widgets").appendTo(e.availableWidgetsPanel);a.forEach(t=>{let i=t.key;jQuery("<div></div>").addClass(`widget-item widget-item-${i} ${e.isWidgetActive?.(i)?"disabled":""}`).attr("data-widget-key",i).attr("draggable","true").html(`<span class="widget-label">${t.label}</span>`).on("click",function(i){e.handleWidgetClick?.(this,t)}).appendTo(n)})},buildBuilderPanel:function(){let e=this,t=e.params;if(!t)return;let i=t.builder.availableRows,a=t.builder.availableWidgets;if(!i||!a)return;let n=e.findHtmlEl?.("#customize-preview");if(!n)return;let l=jQuery("<div></div>").addClass(`wpbf-builder-panel ${t.id}-builder-panel`).attr("data-wpbf-builder-panel",t.id).insertAfter(n);i.forEach(i=>{let a=jQuery("<div></div>").addClass("builder-row").attr("data-row-key",i.key).appendTo(l),n=jQuery("<div></div>").addClass("builder-inner-row").appendTo(a);jQuery("<div></div>").addClass("row-label").attr("data-row-key",i.key).text(i.label).appendTo(a),jQuery("<button></button>").addClass("row-setting-button").attr("data-row-key",i.key).html('<i class="dashicons dashicons-admin-generic"></i>').on("click",()=>e.handleRowSettingClick?.(i.key)).appendTo(a);let d=t.value[i.key];i.columns.forEach((t,a)=>{let l="";t.key.endsWith("_start")?l="wpbf-content-start":t.key.endsWith("_end")?l="wpbf-content-end":0!==a&&a!==i.columns.length-1&&(l="wpbf-content-center column-middle"),0===a?l+=" column-start wpbf-content-start":a===i.columns.length-1&&(l+=" column-end wpbf-content-end");let r=jQuery("<div></div>").addClass(`builder-widgets builder-column sortable-widgets wpbf-flex ${l}`).attr("data-column-key",t.key).appendTo(n),s="empty-widget-list";if(!d||!Object.keys(d).length){r.addClass(s),r.html(e.emptyWidgetItemMarkup??"");return}let o=d[t.key];if(!o||!o.length){r.addClass(s),r.html(e.emptyWidgetItemMarkup??"");return}o.forEach(t=>{let i=e.createWidgetItem?.(t,!0);i&&r.append(i)})}),e.bindCustomizeSection?.(i.key)}),e.builderPanel=l[0]},handleRowSettingClick:function(e){window.wp.customize?.section(`wpbf_header_builder_${e}_section`,function(e){e.expand(e.params)})},bindCustomizeSection:function(e){window.wp.customize?.section(`wpbf_header_builder_${e}_section`,function(t){t.expanded.bind(function(t){let i=document.querySelector(`.builder-row[data-row-key="${e}"]`);i&&(t?i.classList.add("is-active"):i.classList.remove("is-active"))})})},handleWidgetClick:function(e,t){if(!e.classList.contains("ui-sortable-handle")&&!e.classList.contains("disabled")||!t.section)return;let i=window.wp.customize?.section(t.section);i&&i.params&&i.expand(i.params)},initDraggable:function(){let e=this;if(!e.params||!e.availableWidgetsPanel||!e.builderPanel)return;let t=e.findHtmlEl?.(".widget-drag-helper");if(!t)return;let i=e.findHtmlEls?.(e.availableWidgetsPanel,".widget-item");i&&i.length&&i.forEach(i=>{i instanceof HTMLElement&&(i.addEventListener("dragstart",function(a){if(!(a instanceof DragEvent))return;document.body.classList.add("is-dragging-widget"),i.classList.add("is-dragging"),t.classList.add("is-shown");let n=i.dataset.widgetKey;if(!n)return;e.draggableData={widgetKey:n},a.dataTransfer?.setData("text",JSON.stringify({widgetKey:n})),t.innerHTML=i.outerHTML;let l=i.getBoundingClientRect(),d=l.left,r=l.top;t.style.left=d+"px",t.style.top=r+"px";let s=e.findHtmlEl?.(t,".widget-item"),o=s?.getBoundingClientRect(),u=o?.width||80;t.style.width=u+"px",a.dataTransfer?.setDragImage(t,0,0),window.setTimeout(()=>{t.classList.remove("is-shown")},10)}),i.addEventListener("dragend",function(a){a instanceof DragEvent&&(a.preventDefault(),i.classList.remove("is-dragging"),document.body.classList.remove("is-dragging-widget"),t.classList.remove("is-shown"),t.innerHTML="",t.removeAttribute("style"),e.draggableData=void 0)}))})},initDroppable:function(){let e=this;if(!e.params||!e.availableWidgetsPanel||!e.builderPanel)return;let t=e.findHtmlEls?.(e.builderPanel,".builder-column");t&&t.length&&t.forEach(t=>{t.addEventListener("dragenter",function(e){e instanceof DragEvent&&(e.preventDefault(),t.classList.add("dragover"))}),t.addEventListener("dragover",function(e){e.preventDefault()}),t.addEventListener("dragleave",function(e){e instanceof DragEvent&&(e.preventDefault(),t.classList.remove("dragover"))}),t.addEventListener("drop",function(i){if(!(i instanceof DragEvent))return;i.preventDefault(),t.classList.remove("dragover");let a=e.getWidgetItemFromDraggableData?.(i);if(!a)return;let n=a.dataset.widgetKey;if(!n)return;let l=e.createWidgetItem?.(n,!0);if(!l)return;let d=t.querySelector(".ui-sortable-placeholder.from-available-widgets");d&&t.removeChild(d),t.classList.contains("column-end")?t.insertBefore(l,t.firstChild):t.appendChild(l);let r=t.querySelector(".empty-widget-item");r&&r.remove(),jQuery(t).sortable("refresh"),a.classList.add("disabled"),e.draggableData=void 0,e.updateCustomizerSetting?.()})})},parseDraggableData:function(e){let t,i=e.dataTransfer?.getData("text");if(i){try{t=JSON.parse(i)}catch(e){console.error("Error parsing JSON data:",e)}if(t)return t}},getWidgetItemFromDraggableData:function(e){if(!e.dataTransfer?.getData("text"))return;let t=this.parseDraggableData?.(e);if(!t)return;let i=t.widgetKey;if(i)return this.findHtmlEl?.(this.availableWidgetsPanel,`.widget-item[data-widget-key="${i}"]`)},createWidgetItem:function(e,t){let i=this,a=i.findWidgetByKey?.(e);if(!a)return;let n=i.findHtmlEl?.(i.availableWidgetsPanel,`.widget-item[data-widget-key="${e}"]`);if(!n)return;let l=n.cloneNode(!0);if(l instanceof HTMLElement){if(l.classList.remove("disabled"),l.classList.remove("is-dragging"),l.removeAttribute("draggable"),t){let e=document.createElement("button");e.type="button",e.className="widget-button delete-widget-button",e.innerHTML='<i class="dashicons dashicons-no-alt"></i>',l.appendChild(e),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),i.handleDeleteActiveWidget?.(l,n)}),l.addEventListener("click",function(e){e.preventDefault(),i.handleWidgetClick?.(this,a)})}return l}},initSortable:function(){let e=this;e.params&&e.availableWidgetsPanel&&e.builderPanel&&(jQuery(".sortable-widgets").sortable({connectWith:".builder-column",placeholder:"widget-item",start:function(t,i){document.body.classList.add("is-sorting-widget");let a=e.findHtmlEl?.(i.item[0],".widget-label");a&&i.placeholder[0].appendChild(a.cloneNode(!0))},update:function(t,i){let a=t.target;a instanceof HTMLElement&&(e.checkSortableContent?.(a),e.updateCustomizerSetting?.())},stop:function(e,t){document.body.classList.remove("is-sorting-widget")}}),jQuery(".builder-column.column-middle").on("sortover",function(e,t){e.target.classList.remove("empty-widget-list")}),jQuery(".builder-column.column-middle").on("sortout",function(t,i){e.checkSortableContent?.(t.target)}))},handleDeleteActiveWidget:function(e,t){t?.classList.remove("disabled");let i=e.closest(".sortable-widgets");e.remove(),i instanceof HTMLElement&&this.checkSortableContent?.(i),i&&jQuery(i).sortable("refresh"),this.updateCustomizerSetting?.()},checkSortableContent:function(e){let t="empty-widget-list",i=e.querySelector(".empty-widget-item");this.isSortableEmpty?.(e)?(e.classList.add(t),i||jQuery(e).append(this.emptyWidgetItemMarkup??"")):(e.classList.remove(t),i&&i.remove())},destroySortable:function(){this.availableWidgetsPanel&&this.builderPanel&&jQuery(".builder-column").sortable("destroy")},updateCustomizerSetting:function(){let e=this;e.isSaving||(e.isSaving=!0,setTimeout(()=>{let t=e.findHtmlEls?.(e.builderPanel,".builder-row");if(!t||!t.length){e.isSaving=!1;return}let i={};t.forEach(t=>{let a=t.dataset.rowKey;if(!a)return;i[a]={};let n=e.findHtmlEls?.(t,".builder-column.sortable-widgets");n&&n.length&&n.forEach(t=>{let n=t.dataset.columnKey;if(!n)return;i[a][n]=[];let l=e.findHtmlEls?.(t,".widget-item");l&&l.length&&l.forEach(e=>{if(e.classList.contains("empty-widget-item")||e.classList.contains("ui-sortable-placeholder"))return;let t=e.dataset.widgetKey;t&&i[a][n].push(t)})})}),e.setting?.set(i),e.isSaving=!1},1))},updateComponentState:function(e){}}));
//# sourceMappingURL=builder-control-min.js.map
