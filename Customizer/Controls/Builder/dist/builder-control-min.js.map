{"version":3,"file":"builder-control-min.js","sources":["../src/builder-control.ts"],"sourcesContent":["import { BuilderValue, WpbfBuilderControl } from \"./builder-interface\";\n\n(function () {\n\tif (!window.wp.customize) return;\n\n\twindow.wp.customize.controlConstructor[\"wpbf-builder\"] =\n\t\twindow.wp.customize.wpbfDynamicControl.extend<WpbfBuilderControl>({\n\t\t\tisSaving: false,\n\n\t\t\tform: undefined,\n\n\t\t\tdraggableData: undefined,\n\n\t\t\temptyWidgetItemMarkup:\n\t\t\t\t\"<div class='widget-item empty-widget-item'>&nbsp;</div>\",\n\n\t\t\tavailableWidgetsPanel: undefined,\n\n\t\t\tbuilderPanel: undefined,\n\n\t\t\tinitWpbfControl: function (\n\t\t\t\tthis: WpbfBuilderControl,\n\t\t\t\tcontrol?: WpbfBuilderControl,\n\t\t\t) {\n\t\t\t\tcontrol = control || this;\n\t\t\t\tif (!control) return;\n\n\t\t\t\t/**\n\t\t\t\t * Listen to customizer setting change event.\n\t\t\t\t * Update component state when customizer setting changed.\n\t\t\t\t */\n\t\t\t\tcontrol.setting?.bind((value: Record<string, any>) => {\n\t\t\t\t\tcontrol.updateComponentState?.(value);\n\t\t\t\t});\n\n\t\t\t\tcontrol.buildAvailableWidgetsPanel?.();\n\t\t\t\tcontrol.buildBuilderPanel?.();\n\t\t\t\tcontrol.initDraggable?.();\n\t\t\t\tcontrol.initDroppable?.();\n\n\t\t\t\t// Timeout to wait for the elements to be rendered.\n\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\tcontrol.initSortable?.();\n\t\t\t\t}, 1);\n\t\t\t},\n\n\t\t\tisSortableEmpty: function (sortableEl) {\n\t\t\t\tconst children = this.findHtmlEls?.(sortableEl, \".widget-item\");\n\n\t\t\t\tif (!children || !children.length) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\t\t\tconst child = children[i];\n\n\t\t\t\t\tif (child.classList.contains(\"empty-widget-item\")) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (child.classList.contains(\"ui-sortable-placeholder\")) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (child.classList.contains(\"ui-sortable-helper\")) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\tisWidgetActive: function (widgetKey) {\n\t\t\t\tif (!this.params) return false;\n\t\t\t\treturn this.params.builder.activeWidgetKeys.includes(widgetKey);\n\t\t\t},\n\n\t\t\tfindWidgetByKey: function (widgetKey) {\n\t\t\t\tif (!this.params) return undefined;\n\n\t\t\t\tconst availableWidgets = this.params.builder.availableWidgets;\n\t\t\t\tif (!availableWidgets.length) return undefined;\n\n\t\t\t\tfor (const widget of availableWidgets) {\n\t\t\t\t\tif (widget.key === widgetKey) {\n\t\t\t\t\t\treturn widget;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t},\n\n\t\t\tbuildAvailableWidgetsPanel: function () {\n\t\t\t\tconst control = this;\n\t\t\t\tif (!control.container) return;\n\n\t\t\t\tconst params = control.params;\n\t\t\t\tif (!params) return;\n\n\t\t\t\tconst availableWidgetsPanel = control.findHtmlEl?.(\n\t\t\t\t\tcontrol.container[0],\n\t\t\t\t\t\".available-widgets-panel\",\n\t\t\t\t);\n\n\t\t\t\tif (!availableWidgetsPanel) return;\n\n\t\t\t\tcontrol.availableWidgetsPanel = availableWidgetsPanel;\n\n\t\t\t\tjQuery(document.body).append('<div class=\"widget-drag-helper\"></div>');\n\n\t\t\t\tconst availableWidgets = params.builder.availableWidgets;\n\n\t\t\t\tconst $availableWidgetListEl = jQuery(\"<div></div>\")\n\t\t\t\t\t.addClass(\"builder-widgets available-widgets\")\n\t\t\t\t\t.appendTo(control.availableWidgetsPanel);\n\n\t\t\t\t// Build the available widgets list based on `availableWidgets`.\n\t\t\t\tavailableWidgets.forEach((widget) => {\n\t\t\t\t\tconst widgetKey = widget.key;\n\n\t\t\t\t\tconst $widgetItem = jQuery(\"<div></div>\");\n\n\t\t\t\t\t$widgetItem\n\t\t\t\t\t\t.addClass(\n\t\t\t\t\t\t\t`widget-item widget-item-${widgetKey} ${control.isWidgetActive?.(widgetKey) ? \"disabled\" : \"\"}`,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.attr(\"data-widget-key\", widgetKey)\n\t\t\t\t\t\t.attr(\"draggable\", \"true\")\n\t\t\t\t\t\t.html(`<span class=\"widget-label\">${widget.label}</span>`)\n\t\t\t\t\t\t.on(\"click\", function (e) {\n\t\t\t\t\t\t\tcontrol.handleWidgetClick?.(this, widget);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.appendTo($availableWidgetListEl);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tbuildBuilderPanel: function () {\n\t\t\t\tconst control = this;\n\t\t\t\tconst params = control.params;\n\t\t\t\tif (!params) return;\n\n\t\t\t\tconst availableRows = params.builder.availableRows;\n\t\t\t\tconst availableWidgets = params.builder.availableWidgets;\n\t\t\t\tif (!availableRows || !availableWidgets) return;\n\n\t\t\t\tconst customizePreview = control.findHtmlEl?.(\"#customize-preview\");\n\t\t\t\tif (!customizePreview) return;\n\n\t\t\t\t// Create the panel.\n\t\t\t\tconst $builderPanel = jQuery(\"<div></div>\")\n\t\t\t\t\t.addClass(`wpbf-builder-panel ${params.id}-builder-panel`)\n\t\t\t\t\t.attr(\"data-wpbf-builder-panel\", params.id)\n\t\t\t\t\t.insertAfter(customizePreview);\n\n\t\t\t\tavailableRows.forEach((row) => {\n\t\t\t\t\t// Build the row.\n\t\t\t\t\tconst $row = jQuery(\"<div></div>\")\n\t\t\t\t\t\t.addClass(`builder-row`)\n\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\n\t\t\t\t\t\t.appendTo($builderPanel);\n\n\t\t\t\t\t// Build the inner row.\n\t\t\t\t\tconst $innerRow = jQuery(\"<div></div>\")\n\t\t\t\t\t\t.addClass(`builder-inner-row`)\n\t\t\t\t\t\t.appendTo($row);\n\n\t\t\t\t\t// Build the row label (tooltip)\n\t\t\t\t\tjQuery(\"<div></div>\")\n\t\t\t\t\t\t.addClass(\"row-label\")\n\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\n\t\t\t\t\t\t.text(row.label)\n\t\t\t\t\t\t.appendTo($row);\n\n\t\t\t\t\t// Build the row setting button.\n\t\t\t\t\tjQuery(\"<button></button>\")\n\t\t\t\t\t\t.addClass(\"row-setting-button\")\n\t\t\t\t\t\t.attr(\"data-row-key\", row.key)\n\t\t\t\t\t\t.html('<i class=\"dashicons dashicons-admin-generic\"></i>')\n\t\t\t\t\t\t.on(\"click\", () => control.handleRowSettingClick?.(row.key))\n\t\t\t\t\t\t.appendTo($row);\n\n\t\t\t\t\tconst matchedRow = params.value[row.key];\n\n\t\t\t\t\trow.columns.forEach((column, columnIndex) => {\n\t\t\t\t\t\tlet columnPosClass = \"\";\n\n\t\t\t\t\t\tif (column.key.endsWith(\"_start\")) {\n\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-start\";\n\t\t\t\t\t\t} else if (column.key.endsWith(\"_end\")) {\n\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-end\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (columnIndex !== 0 && columnIndex !== row.columns.length - 1) {\n\t\t\t\t\t\t\t\tcolumnPosClass = \"wpbf-content-center column-middle\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (columnIndex === 0) {\n\t\t\t\t\t\t\tcolumnPosClass += \" column-start wpbf-content-start\";\n\t\t\t\t\t\t} else if (columnIndex === row.columns.length - 1) {\n\t\t\t\t\t\t\tcolumnPosClass += \" column-end wpbf-content-end\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst $widgetListEl = jQuery(\"<div></div>\")\n\t\t\t\t\t\t\t.addClass(\n\t\t\t\t\t\t\t\t`builder-widgets builder-column sortable-widgets wpbf-flex ${columnPosClass}`,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.attr(\"data-column-key\", column.key)\n\t\t\t\t\t\t\t.appendTo($innerRow);\n\n\t\t\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\n\n\t\t\t\t\t\tif (!matchedRow || !Object.keys(matchedRow).length) {\n\t\t\t\t\t\t\t$widgetListEl.addClass(emptyWidgetListClass);\n\t\t\t\t\t\t\t$widgetListEl.html(control.emptyWidgetItemMarkup ?? \"\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst matchedColumn = matchedRow[column.key];\n\n\t\t\t\t\t\tif (!matchedColumn || !matchedColumn.length) {\n\t\t\t\t\t\t\t$widgetListEl.addClass(emptyWidgetListClass);\n\t\t\t\t\t\t\t$widgetListEl.html(control.emptyWidgetItemMarkup ?? \"\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Build the widget list based on `matchedColumn`.\n\t\t\t\t\t\tmatchedColumn.forEach((widgetKey) => {\n\t\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(widgetKey, true);\n\t\t\t\t\t\t\tif (!newWidgetItem) return;\n\n\t\t\t\t\t\t\t$widgetListEl.append(newWidgetItem);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tcontrol.bindCustomizeSection?.(row.key);\n\t\t\t\t});\n\n\t\t\t\tcontrol.builderPanel = $builderPanel[0];\n\t\t\t},\n\n\t\t\thandleRowSettingClick: function (rowKey) {\n\t\t\t\twindow.wp.customize?.section(\n\t\t\t\t\t`wpbf_header_builder_${rowKey}_section`,\n\t\t\t\t\tfunction (section) {\n\t\t\t\t\t\tsection.expand(section.params);\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t},\n\n\t\t\tbindCustomizeSection: function (rowKey) {\n\t\t\t\twindow.wp.customize?.section(\n\t\t\t\t\t`wpbf_header_builder_${rowKey}_section`,\n\t\t\t\t\tfunction (section) {\n\t\t\t\t\t\tsection.expanded.bind(function (expanded) {\n\t\t\t\t\t\t\tconst row = document.querySelector(\n\t\t\t\t\t\t\t\t`.builder-row[data-row-key=\"${rowKey}\"]`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!row) return;\n\n\t\t\t\t\t\t\tif (expanded) {\n\t\t\t\t\t\t\t\trow.classList.add(\"is-active\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow.classList.remove(\"is-active\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t},\n\n\t\t\thandleWidgetClick: function (widgetEl, widgetData) {\n\t\t\t\t// If this is from the available widgets panel.\n\t\t\t\tif (!widgetEl.classList.contains(\"ui-sortable-handle\")) {\n\t\t\t\t\tif (!widgetEl.classList.contains(\"disabled\")) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!widgetData.section) return;\n\n\t\t\t\tconst connectedSection = window.wp.customize?.section(\n\t\t\t\t\twidgetData.section,\n\t\t\t\t);\n\t\t\t\tif (!connectedSection || !connectedSection.params) return;\n\n\t\t\t\tconnectedSection.expand(connectedSection.params);\n\t\t\t},\n\n\t\t\tinitDraggable: function () {\n\t\t\t\tconst control = this;\n\t\t\t\tconst params = control.params;\n\n\t\t\t\tif (!params) return;\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\n\n\t\t\t\tconst dragHelper = control.findHtmlEl?.(\".widget-drag-helper\");\n\t\t\t\tif (!dragHelper) return;\n\n\t\t\t\tconst availableWidgetItems = control.findHtmlEls?.(\n\t\t\t\t\tcontrol.availableWidgetsPanel,\n\t\t\t\t\t\".widget-item\",\n\t\t\t\t);\n\n\t\t\t\tif (!availableWidgetItems || !availableWidgetItems.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tavailableWidgetItems.forEach((item) => {\n\t\t\t\t\tif (!(item instanceof HTMLElement)) return;\n\n\t\t\t\t\titem.addEventListener(\"dragstart\", function (e) {\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\n\n\t\t\t\t\t\tdocument.body.classList.add(\"is-dragging-widget\");\n\t\t\t\t\t\titem.classList.add(\"is-dragging\");\n\t\t\t\t\t\tdragHelper.classList.add(\"is-shown\");\n\n\t\t\t\t\t\tconst widgetKey = item.dataset.widgetKey;\n\t\t\t\t\t\tif (!widgetKey) return;\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Set the data to be transferred.\n\t\t\t\t\t\t * We use both e.dataTransfer and control.draggableData to store the data.\n\t\t\t\t\t\t * Because e.dataTransfer can't be accessed from \"dragenter\" and \"dragover\" event.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tcontrol.draggableData = { widgetKey };\n\t\t\t\t\t\te.dataTransfer?.setData(\"text\", JSON.stringify({ widgetKey }));\n\n\t\t\t\t\t\tdragHelper.innerHTML = item.outerHTML;\n\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * The visualDragHelper is a direct body child element with position: fixed, left: 0, and top: 0.\n\t\t\t\t\t\t * We need to set the position of the dragVisualHelper to be in the same position of current `item` (.wiget-item).\n\t\t\t\t\t\t * Meaning, we need to get the top and left position of the current event element and set the fixed position of the dragVisualHelper.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tconst draggedElRect = item.getBoundingClientRect();\n\t\t\t\t\t\tconst draggedElFixedLeftPos = draggedElRect.left;\n\t\t\t\t\t\tconst draggedElFixedTopPos = draggedElRect.top;\n\n\t\t\t\t\t\tdragHelper.style.left = draggedElFixedLeftPos + \"px\";\n\t\t\t\t\t\tdragHelper.style.top = draggedElFixedTopPos + \"px\";\n\n\t\t\t\t\t\tconst dragHelperInnerEl = control.findHtmlEl?.(\n\t\t\t\t\t\t\tdragHelper,\n\t\t\t\t\t\t\t\".widget-item\",\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst innerElRect = dragHelperInnerEl?.getBoundingClientRect();\n\t\t\t\t\t\tconst dragHelperInnerElWidth = innerElRect?.width || 80;\n\n\t\t\t\t\t\tdragHelper.style.width = dragHelperInnerElWidth + \"px\";\n\n\t\t\t\t\t\te.dataTransfer?.setDragImage(dragHelper, 0, 0);\n\n\t\t\t\t\t\twindow.setTimeout(() => {\n\t\t\t\t\t\t\tdragHelper.classList.remove(\"is-shown\");\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t});\n\n\t\t\t\t\titem.addEventListener(\"dragend\", function (e) {\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\titem.classList.remove(\"is-dragging\");\n\t\t\t\t\t\tdocument.body.classList.remove(\"is-dragging-widget\");\n\n\t\t\t\t\t\tdragHelper.classList.remove(\"is-shown\");\n\t\t\t\t\t\tdragHelper.innerHTML = \"\";\n\t\t\t\t\t\tdragHelper.removeAttribute(\"style\");\n\n\t\t\t\t\t\tcontrol.draggableData = undefined;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tinitDroppable: function () {\n\t\t\t\tconst control = this;\n\t\t\t\tconst params = control.params;\n\n\t\t\t\tif (!params) return;\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\n\n\t\t\t\tconst builderDropZones = control.findHtmlEls?.(\n\t\t\t\t\tcontrol.builderPanel,\n\t\t\t\t\t\".builder-column\",\n\t\t\t\t);\n\n\t\t\t\tif (!builderDropZones || !builderDropZones.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tbuilderDropZones.forEach((dropZone) => {\n\t\t\t\t\tdropZone.addEventListener(\"dragenter\", function (e) {\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tdropZone.classList.add(\"dragover\");\n\t\t\t\t\t});\n\n\t\t\t\t\t// This empty block is necessary to let the dropZone accept the drop event.\n\t\t\t\t\tdropZone.addEventListener(\"dragover\", function (e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n\t\t\t\t\tdropZone.addEventListener(\"dragleave\", function (e) {\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tdropZone.classList.remove(\"dragover\");\n\t\t\t\t\t});\n\n\t\t\t\t\tdropZone.addEventListener(\"drop\", function (e) {\n\t\t\t\t\t\tif (!(e instanceof DragEvent)) return;\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tdropZone.classList.remove(\"dragover\");\n\n\t\t\t\t\t\tconst widgetItem = control.getWidgetItemFromDraggableData?.(e);\n\t\t\t\t\t\tif (!widgetItem) return;\n\n\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\n\t\t\t\t\t\tif (!widgetKey) return;\n\n\t\t\t\t\t\tconst newWidgetItem = control.createWidgetItem?.(widgetKey, true);\n\t\t\t\t\t\tif (!newWidgetItem) return;\n\n\t\t\t\t\t\tconst temporaryWidgetItem = dropZone.querySelector(\n\t\t\t\t\t\t\t\".ui-sortable-placeholder.from-available-widgets\",\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (temporaryWidgetItem) {\n\t\t\t\t\t\t\tdropZone.removeChild(temporaryWidgetItem);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dropZone.classList.contains(\"column-end\")) {\n\t\t\t\t\t\t\tdropZone.insertBefore(newWidgetItem, dropZone.firstChild);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdropZone.appendChild(newWidgetItem);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst emptyWidgetItem =\n\t\t\t\t\t\t\tdropZone.querySelector(\".empty-widget-item\");\n\n\t\t\t\t\t\tif (emptyWidgetItem) {\n\t\t\t\t\t\t\temptyWidgetItem.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Now refresh the sortable.\n\t\t\t\t\t\tjQuery(dropZone).sortable(\"refresh\");\n\n\t\t\t\t\t\twidgetItem.classList.add(\"disabled\");\n\t\t\t\t\t\tcontrol.draggableData = undefined;\n\t\t\t\t\t\tcontrol.updateCustomizerSetting?.();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tparseDraggableData: function (e) {\n\t\t\t\tconst data = e.dataTransfer?.getData(\"text\");\n\t\t\t\tif (!data) return undefined;\n\n\t\t\t\tlet parsedJson: undefined | Record<string, any> = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tparsedJson = JSON.parse(data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(\"Error parsing JSON data:\", e);\n\t\t\t\t}\n\n\t\t\t\tif (!parsedJson) return undefined;\n\n\t\t\t\treturn parsedJson;\n\t\t\t},\n\n\t\t\tgetWidgetItemFromDraggableData: function (e) {\n\t\t\t\tconst data = e.dataTransfer?.getData(\"text\");\n\t\t\t\tif (!data) return undefined;\n\t\t\t\tconst control = this;\n\n\t\t\t\tconst parsedJson = this.parseDraggableData?.(e);\n\t\t\t\tif (!parsedJson) return undefined;\n\n\t\t\t\tconst widgetKey = parsedJson.widgetKey;\n\t\t\t\tif (!widgetKey) return undefined;\n\n\t\t\t\tconst widgetItem = control.findHtmlEl?.(\n\t\t\t\t\tthis.availableWidgetsPanel,\n\t\t\t\t\t`.widget-item[data-widget-key=\"${widgetKey}\"]`,\n\t\t\t\t);\n\n\t\t\t\treturn widgetItem;\n\t\t\t},\n\n\t\t\tcreateWidgetItem: function (widgetKey, insideBuilderPanel) {\n\t\t\t\tconst control = this;\n\t\t\t\tconst widgetData = control.findWidgetByKey?.(widgetKey);\n\t\t\t\tif (!widgetData) return undefined;\n\n\t\t\t\tconst widgetItemToClone = control.findHtmlEl?.(\n\t\t\t\t\tcontrol.availableWidgetsPanel,\n\t\t\t\t\t`.widget-item[data-widget-key=\"${widgetKey}\"]`,\n\t\t\t\t);\n\n\t\t\t\tif (!widgetItemToClone) return undefined;\n\n\t\t\t\tconst newWidgetItem = widgetItemToClone.cloneNode(true);\n\t\t\t\tif (!(newWidgetItem instanceof HTMLElement)) return undefined;\n\n\t\t\t\tnewWidgetItem.classList.remove(\"disabled\");\n\t\t\t\tnewWidgetItem.classList.remove(\"is-dragging\");\n\t\t\t\tnewWidgetItem.removeAttribute(\"draggable\");\n\n\t\t\t\tif (insideBuilderPanel) {\n\t\t\t\t\tconst deleteButton = document.createElement(\"button\");\n\t\t\t\t\tdeleteButton.type = \"button\";\n\t\t\t\t\tdeleteButton.className = \"widget-button delete-widget-button\";\n\t\t\t\t\tdeleteButton.innerHTML = '<i class=\"dashicons dashicons-no-alt\"></i>';\n\t\t\t\t\tnewWidgetItem.appendChild(deleteButton);\n\n\t\t\t\t\tdeleteButton.addEventListener(\"click\", function (e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\t\tcontrol.handleDeleteActiveWidget?.(\n\t\t\t\t\t\t\tnewWidgetItem,\n\t\t\t\t\t\t\twidgetItemToClone,\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t\tnewWidgetItem.addEventListener(\"click\", function (e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tcontrol.handleWidgetClick?.(this, widgetData);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn newWidgetItem;\n\t\t\t},\n\n\t\t\tinitSortable: function () {\n\t\t\t\tconst control = this;\n\t\t\t\tconst params = control.params;\n\n\t\t\t\tif (!params) return;\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\n\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\n\n\t\t\t\tjQuery(\".sortable-widgets\").sortable({\n\t\t\t\t\tconnectWith: \".builder-column\",\n\t\t\t\t\tplaceholder: \"widget-item\",\n\t\t\t\t\tstart: function (e, ui) {\n\t\t\t\t\t\tdocument.body.classList.add(\"is-sorting-widget\");\n\n\t\t\t\t\t\tconst labelEl = control.findHtmlEl?.(ui.item[0], \".widget-label\");\n\n\t\t\t\t\t\tif (labelEl) {\n\t\t\t\t\t\t\tui.placeholder[0].appendChild(labelEl.cloneNode(true));\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tupdate: function (e, ui) {\n\t\t\t\t\t\tconst sortableEl = e.target;\n\t\t\t\t\t\tif (!(sortableEl instanceof HTMLElement)) return;\n\n\t\t\t\t\t\tcontrol.checkSortableContent?.(sortableEl);\n\t\t\t\t\t\tcontrol.updateCustomizerSetting?.();\n\t\t\t\t\t},\n\t\t\t\t\tstop: function (e, ui) {\n\t\t\t\t\t\tdocument.body.classList.remove(\"is-sorting-widget\");\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tjQuery(\".builder-column.column-middle\").on(\n\t\t\t\t\t\"sortover\",\n\t\t\t\t\tfunction (e, ui) {\n\t\t\t\t\t\tconst target = e.target;\n\t\t\t\t\t\ttarget.classList.remove(emptyWidgetListClass);\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tjQuery(\".builder-column.column-middle\").on(\"sortout\", function (e, ui) {\n\t\t\t\t\tcontrol.checkSortableContent?.(e.target);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\thandleDeleteActiveWidget: function (activeWidgetEl, availableWidgetEl) {\n\t\t\t\tconst control = this;\n\n\t\t\t\tavailableWidgetEl?.classList.remove(\"disabled\");\n\n\t\t\t\tconst sortableEL = activeWidgetEl.closest(\".sortable-widgets\");\n\n\t\t\t\tactiveWidgetEl.remove();\n\n\t\t\t\tif (sortableEL instanceof HTMLElement) {\n\t\t\t\t\tcontrol.checkSortableContent?.(sortableEL);\n\t\t\t\t}\n\n\t\t\t\tif (sortableEL) {\n\t\t\t\t\tjQuery(sortableEL).sortable(\"refresh\");\n\t\t\t\t}\n\n\t\t\t\tcontrol.updateCustomizerSetting?.();\n\t\t\t},\n\n\t\t\tcheckSortableContent: function (sortableEl) {\n\t\t\t\tconst emptyWidgetListClass = \"empty-widget-list\";\n\t\t\t\tconst emptyWidgetItemClass = \"empty-widget-item\";\n\n\t\t\t\tconst emptyWidgetItem = sortableEl.querySelector(\n\t\t\t\t\t\".\" + emptyWidgetItemClass,\n\t\t\t\t);\n\n\t\t\t\tif (this.isSortableEmpty?.(sortableEl)) {\n\t\t\t\t\tsortableEl.classList.add(emptyWidgetListClass);\n\n\t\t\t\t\tif (!emptyWidgetItem) {\n\t\t\t\t\t\tjQuery(sortableEl).append(this.emptyWidgetItemMarkup ?? \"\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsortableEl.classList.remove(emptyWidgetListClass);\n\n\t\t\t\t\tif (emptyWidgetItem) {\n\t\t\t\t\t\temptyWidgetItem.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tdestroySortable: function () {\n\t\t\t\tconst control = this;\n\t\t\t\tif (!control.availableWidgetsPanel || !control.builderPanel) return;\n\n\t\t\t\tjQuery(\".builder-column\").sortable(\"destroy\");\n\t\t\t},\n\n\t\t\tupdateCustomizerSetting: function () {\n\t\t\t\tconst control = this;\n\n\t\t\t\tif (control.isSaving) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcontrol.isSaving = true;\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst builderRows = control.findHtmlEls?.(\n\t\t\t\t\t\tcontrol.builderPanel,\n\t\t\t\t\t\t\".builder-row\",\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!builderRows || !builderRows.length) {\n\t\t\t\t\t\tcontrol.isSaving = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst values: BuilderValue = {};\n\n\t\t\t\t\tbuilderRows.forEach((row) => {\n\t\t\t\t\t\tconst rowKey = row.dataset.rowKey;\n\t\t\t\t\t\tif (!rowKey) return;\n\n\t\t\t\t\t\tvalues[rowKey] = {};\n\n\t\t\t\t\t\tconst sortableColumns = control.findHtmlEls?.(\n\t\t\t\t\t\t\trow,\n\t\t\t\t\t\t\t\".builder-column.sortable-widgets\",\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (!sortableColumns || !sortableColumns.length) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsortableColumns.forEach((column) => {\n\t\t\t\t\t\t\tconst columnKey = column.dataset.columnKey;\n\t\t\t\t\t\t\tif (!columnKey) return;\n\n\t\t\t\t\t\t\tvalues[rowKey][columnKey] = [];\n\n\t\t\t\t\t\t\tconst widgetItems = control.findHtmlEls?.(column, \".widget-item\");\n\n\t\t\t\t\t\t\tif (!widgetItems || !widgetItems.length) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\twidgetItems.forEach((widgetItem) => {\n\t\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"empty-widget-item\")) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (widgetItem.classList.contains(\"ui-sortable-placeholder\")) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst widgetKey = widgetItem.dataset.widgetKey;\n\t\t\t\t\t\t\t\tif (!widgetKey) return;\n\n\t\t\t\t\t\t\t\tvalues[rowKey][columnKey].push(widgetKey);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tcontrol.setting?.set(values);\n\t\t\t\t\tcontrol.isSaving = false;\n\t\t\t\t}, 1);\n\t\t\t},\n\n\t\t\tupdateComponentState: function (\n\t\t\t\tthis: WpbfBuilderControl,\n\t\t\t\tvalue: Record<string, any>,\n\t\t\t) {\n\t\t\t\t// Update available-widgets & sortable-widgets.\n\t\t\t},\n\t\t});\n})();\n"],"names":["window","wp","customize","controlConstructor","wpbfDynamicControl","extend","isSaving","form","draggableData","emptyWidgetItemMarkup","availableWidgetsPanel","builderPanel","initWpbfControl","control","this","setting","bind","value","updateComponentState","buildAvailableWidgetsPanel","buildBuilderPanel","initDraggable","initDroppable","setTimeout","initSortable","isSortableEmpty","sortableEl","children","findHtmlEls","length","i","child","classList","contains","isWidgetActive","widgetKey","params","builder","activeWidgetKeys","includes","findWidgetByKey","availableWidgets","widget","key","container","findHtmlEl","jQuery","document","body","append","$availableWidgetListEl","addClass","appendTo","forEach","attr","html","label","on","e","handleWidgetClick","availableRows","customizePreview","$builderPanel","id","insertAfter","row","$row","$innerRow","text","handleRowSettingClick","matchedRow","columns","column","columnIndex","columnPosClass","endsWith","$widgetListEl","emptyWidgetListClass","Object","keys","matchedColumn","newWidgetItem","createWidgetItem","bindCustomizeSection","rowKey","section","expand","expanded","querySelector","add","remove","widgetEl","widgetData","connectedSection","dragHelper","availableWidgetItems","item","HTMLElement","addEventListener","DragEvent","dataset","dataTransfer","setData","JSON","stringify","innerHTML","outerHTML","draggedElRect","getBoundingClientRect","draggedElFixedLeftPos","left","draggedElFixedTopPos","top","style","dragHelperInnerEl","innerElRect","dragHelperInnerElWidth","width","setDragImage","preventDefault","removeAttribute","builderDropZones","dropZone","widgetItem","getWidgetItemFromDraggableData","temporaryWidgetItem","removeChild","insertBefore","firstChild","appendChild","emptyWidgetItem","sortable","updateCustomizerSetting","parseDraggableData","data","getData","parsedJson","parse","console","error","insideBuilderPanel","widgetItemToClone","cloneNode","deleteButton","createElement","type","className","stopPropagation","handleDeleteActiveWidget","connectWith","placeholder","start","ui","labelEl","update","target","checkSortableContent","stop","activeWidgetEl","availableWidgetEl","sortableEL","closest","destroySortable","builderRows","values","sortableColumns","columnKey","widgetItems","push","set"],"mappings":"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"}